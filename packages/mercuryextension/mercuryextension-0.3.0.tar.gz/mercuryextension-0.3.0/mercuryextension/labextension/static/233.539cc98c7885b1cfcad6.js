"use strict";(self.webpackChunk_mljar_mercuryextension=self.webpackChunk_mljar_mercuryextension||[]).push([[233],{233:(e,t,o)=>{o.r(t),o.d(t,{MercuryWidgetFactory:()=>I,default:()=>R});var n=o(909),i=o(480),r=o(215),s=o(131),a=o(200),c=o(241),l=o(135),d=o(262);class u extends l.DocumentWidget{constructor(e,t){super({context:e,content:t}),this.title.label=e.localPath,this.title.closable=!0,this.addClass("jp-NotebookPanel")}}const h=new d.Token("@mljar:IMercuryTracker");var m,g=o(256),p=o(602),f=o(607),C=o(762),_=o(697),y=o(206);class x{constructor(e){this._cellId="",this._sidebar=!1,this._cellId=e.cellId,this._sidebar=e.sidebar}get cellId(){return this._cellId}get sidebar(){return this._sidebar}dispose(){p.Signal.clearData(this)}}class b extends g.Panel{constructor(e,t){super(),this.removeClass("lm-Widget"),this.removeClass("p-Widget"),this.addClass("cell-item-widget"),this._model=new x(t);const o=new g.Panel;o.addClass("cell-item-content"),e.addClass("cell-item-widget"),o.addWidget(e),this.addWidget(o)}dispose(){this.isDisposed||(this._model.dispose(),super.dispose())}get cellId(){return this._model.cellId}get sidebar(){return this._model.sidebar}}class w{constructor(e){this._mutex=(0,_.createMutex)(),this._ystate=new y.Map,this._context=e.context,this.rendermime=e.rendermime,this.contentFactory=e.contentFactory,this.mimeTypeService=e.mimeTypeService,this._editorConfig=e.editorConfig,this._notebookConfig=e.notebookConfig,this._ready=new p.Signal(this),this._cellRemoved=new p.Signal(this),this._stateChanged=new p.Signal(this),this._contentChanged=new p.Signal(this),this._context.sessionContext.ready.then((()=>{const e=this._context.model.sharedModel;this._ystate=e.ystate,!0!==this._ystate.get("executed")&&e.transact((()=>{this._ystate.set("executed",!1)}),!1),this._context.save().then((e=>{this._ready.emit(null)}))})),this._context.model.contentChanged.connect(this._updateCells,this)}get ready(){return this._ready}get cellRemoved(){return this._cellRemoved}get stateChanged(){return this._stateChanged}get contentChanged(){return this._contentChanged}get editorConfig(){return this._editorConfig}set editorConfig(e){this._editorConfig=e}get notebookConfig(){return this._notebookConfig}set notebookConfig(e){this._notebookConfig=e}set executed(e){this._ystate.set("executed",e)}get cells(){return this._context.model.cells}get deletedCells(){return this._context.model.deletedCells}createCell(e,t=!1){let o,n=!1;switch(e.type){case"code":{const i=new f.CodeCell({model:e,rendermime:this.rendermime,contentFactory:this.contentFactory,editorConfig:this._editorConfig.code});i.readOnly=!0;for(let e=0;e<i.outputArea.model.length;e++)"application/vnd.jupyter.widget-view+json"in i.outputArea.model.get(e).data&&(n=!0);if(n&&!t)o=new C.SimplifiedOutputArea({model:i.outputArea.model,rendermime:i.outputArea.rendermime,contentFactory:i.outputArea.contentFactory});else if(o=i,t){const t={config:this._editorConfig.code};o=new f.InputArea({model:e,contentFactory:this.contentFactory,editorOptions:t})}break}case"markdown":{const t=new f.MarkdownCell({model:e,rendermime:this.rendermime,contentFactory:this.contentFactory,editorConfig:this._editorConfig.markdown});t.inputHidden=!1,t.rendered=!0,m.removeElements(t.node,"jp-Collapser"),m.removeElements(t.node,"jp-InputPrompt"),o=t;break}default:{const t=new f.RawCell({model:e,contentFactory:this.contentFactory,editorConfig:this._editorConfig.raw});t.inputHidden=!1,m.removeElements(t.node,"jp-Collapser"),m.removeElements(t.node,"jp-InputPrompt"),o=t;break}}const i={cellId:e.id,cellWidget:o,sidebar:n};return new b(o,i)}execute(e){if("code"!==e.type||this._ystate.get("executed"))return;const t=new f.CodeCell({model:e,rendermime:this.rendermime,contentFactory:this.contentFactory,editorConfig:this._editorConfig.code});C.SimplifiedOutputArea.execute(e.sharedModel.source,t.outputArea,this._context.sessionContext).then((t=>{"execute_reply"===(null==t?void 0:t.header.msg_type)&&"ok"===t.content.status&&(e.executionCount=t.content.execution_count)})).catch((e=>console.error(e)))}_updateCells(){this._mutex((()=>{this._contentChanged.emit(null),console.log("content changed")}))}}!function(e){e.removeElements=function(e,t){const o=e.getElementsByClassName(t);for(let e=0;e<o.length;e++)o[e].remove()}}(m||(m={}));class k extends g.Panel{constructor(e){super(),this._cellItems=[],this.id="mercury-main-panel",this.addClass("mercury-main-panel"),this._model=e,this._model.ready.connect((()=>{this._initCellItems()})),this._left=new g.Panel,this._right=new g.Panel,this._left.addClass("mercury-left-panel"),this._right.addClass("mercury-right-panel"),this.addWidget(this._left),this.addWidget(this._right)}_initCellItems(){const e=this._model.cells;for(let t=0;t<(null==e?void 0:e.length);t++){const o=e.get(t),n=this._model.createCell(o);if(this._cellItems.push(n),n.sidebar){this._left.addWidget(n);const e=this._model.createCell(o,!0);this._right.addWidget(e),this._cellItems.push(e)}else this._right.addWidget(n)}}dispose(){this.isDisposed||(p.Signal.clearData(this),super.dispose())}onAfterAttach(e){super.onAfterAttach(e)}onBeforeDetach(e){super.onBeforeDetach(e)}get cellWidgets(){return this._cellItems}executeCellItems(){const e=this._model.cells;this._model.executed=!1;for(let t=0;t<(null==e?void 0:e.length);t++){const o=e.get(t);this._model.execute(o)}this._model.executed=!0}}class v extends g.Panel{constructor(e){super(),this.addClass("jp-Notebook"),this.addClass("jp-NotebookPanel-notebook"),this.addClass("mercury-panel"),this._context=e.context,this.rendermime=e.rendermime,this.contentFactory=e.contentFactory,this.mimeTypeService=e.mimeTypeService,this._editorConfig=e.editorConfig,this._notebookConfig=e.notebookConfig;const t=new w({context:this._context,rendermime:this.rendermime,contentFactory:this.contentFactory,mimeTypeService:this.mimeTypeService,editorConfig:this._editorConfig,notebookConfig:this._notebookConfig});this._appWidget=new k(t),this.addWidget(this._appWidget)}dispose(){p.Signal.clearData(this),super.dispose()}get editorConfig(){return this._editorConfig}set editorConfig(e){this._editorConfig=e}get notebookConfig(){return this._notebookConfig}set notebookConfig(e){this._notebookConfig=e}get cellWidgets(){return this._appWidget.cellWidgets}}class I extends l.ABCWidgetFactory{constructor(e){super(e),this.rendermime=e.rendermime,this.contentFactory=e.contentFactory||new i.NotebookPanel.ContentFactory({editorFactory:e.editorFactoryService.newInlineEditor}),this.mimeTypeService=e.mimeTypeService,this._editorConfig=e.editorConfig||i.StaticNotebook.defaultEditorConfig,this._notebookConfig=e.notebookConfig||i.StaticNotebook.defaultNotebookConfig}get editorConfig(){return this._editorConfig}set editorConfig(e){this._editorConfig=e}get notebookConfig(){return this._notebookConfig}set notebookConfig(e){this._notebookConfig=e}createNewWidget(e,t){const o={context:e,rendermime:t?t.content.rendermime:this.rendermime.clone({resolver:e.urlResolver}),contentFactory:this.contentFactory,mimeTypeService:this.mimeTypeService,editorConfig:t?t.content.editorConfig:this._editorConfig,notebookConfig:t?t.content.notebookConfig:this._notebookConfig};return new u(e,new v(o))}}const M=new(o(460).LabIcon)({name:"@mljar/party-icon",svgstr:'<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-confetti" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h2" /><path d="M5 4v2" /><path d="M11.5 4l-.5 2" /><path d="M18 5h2" /><path d="M19 4v2" /><path d="M15 9l-1 1" /><path d="M18 13l2 -.5" /><path d="M18 19h2" /><path d="M19 18v2" /><path d="M14 16.518l-6.518 -6.518l-4.39 9.58a1 1 0 0 0 1.329 1.329l9.579 -4.39z" /></svg>'});class S{constructor(e){this._commands=e}createNew(e){const t=new a.ToolbarButton({tooltip:"Open with Mercury",icon:M,onClick:()=>{this._commands.execute("docmanager:open",{path:e.context.path,factory:"Mercury",options:{mode:"split-right",ref:e.id}}).then((t=>{t instanceof g.Widget&&e.content.disposed.connect((()=>{t.dispose()}))}))}});return e.toolbar.insertItem(0,"open-mercury",t),t}}const F={id:"@mljar:mercury-extension",autoStart:!0,provides:h,requires:[i.NotebookPanel.IContentFactory,c.IMainMenu,s.IEditorServices,r.IRenderMimeRegistry],optional:[n.ILayoutRestorer],activate:(e,t,o,n,r)=>{console.log("Mercury extension is active.");const s=new a.WidgetTracker({namespace:"@mljar/mercury-widget-tracker"}),c=new I({name:"Mercury",fileTypes:["notebook"],modelName:"notebook",preferKernel:!0,canStartKernel:!0,rendermime:r,contentFactory:t,editorConfig:i.StaticNotebook.defaultEditorConfig,notebookConfig:i.StaticNotebook.defaultNotebookConfig,mimeTypeService:n.mimeTypeService,editorFactoryService:n.factoryService,notebookPanel:null});return c.widgetCreated.connect(((t,o)=>{o.context.pathChanged.connect((()=>{s.save(o)})),s.add(o),o.update(),e.commands.notifyCommandChanged()})),e.docRegistry.addWidgetFactory(c),e.docRegistry.addWidgetExtension("Notebook",new S(e.commands)),s}};var W=o(814),j=o(627);function*T(e){for(const t of e.cellWidgets)t instanceof j.WidgetRenderer&&(yield t)}const E={id:"@mljar/mercury-support-ipywidgets",autoStart:!0,optional:[h,W.IJupyterWidgetRegistry],activate:(e,t,o)=>{o&&(null==t||t.forEach((e=>{(0,j.registerWidgetManager)(e.context,e.content.rendermime,T(e.content))})),null==t||t.widgetAdded.connect(((e,t)=>{(0,j.registerWidgetManager)(t.context,t.content.rendermime,T(t.content))})))}},P={id:"@mljar/mercury-commands",description:"Commands used in Mercury",autoStart:!0,requires:[i.INotebookTracker],activate:(e,t)=>{console.log("execute below"),e.commands.addCommand("@mljar/mercury-execute-below",{label:"Execute cells below",execute:()=>{const e=t.currentWidget;e&&(console.log("Run all below"),function(e,t){if(!e.model||!e.activeCell)return Promise.resolve(!1);const o=e.activeCellIndex;e.activeCellIndex=e.activeCellIndex+1,i.NotebookActions.runAllBelow(e,t,void 0,void 0).finally((()=>{e.activeCellIndex=o}))}(e.content,e.context.sessionContext))}})}};var A=o(678),N=o(53),D=o(354);class O{async runCell({cell:e,notebook:t,notebookConfig:o,onCellExecuted:n,onCellExecutionScheduled:r,sessionContext:s,sessionDialogs:c,translator:l}){var d;const u=(l=null!=l?l:A.nullTranslator).load("jupyterlab");switch(e.model.type){case"markdown":e.rendered=!0,e.inputHidden=!1,n({cell:e,success:!0});break;case"code":if(s){if(s.isTerminating){await(0,a.showDialog)({title:u.__("Kernel Terminating"),body:u.__("The kernel for %1 appears to be terminating. You can not run any cell for now.",null===(d=s.session)||void 0===d?void 0:d.path),buttons:[a.Dialog.okButton()]});break}if(s.pendingInput)return await(0,a.showDialog)({title:u.__("Cell not executed due to pending input"),body:u.__("The cell has not been executed to avoid kernel deadlock as there is another pending input! Type your input in the input box, press Enter and try again."),buttons:[a.Dialog.okButton()]}),!1;if(s.hasNoKernel&&await s.startKernel()&&c&&await c.selectKernel(s),s.hasNoKernel)return e.model.sharedModel.transact((()=>{e.model.clearExecution()})),!0;const l=t.deletedCells;r({cell:e});let h=!1;try{const n=await async function(e,t,o){const n=e.model,i=n.sharedModel.getSource(),r={cellId:n.sharedModel.getId()};o={...n.metadata,...o,...r};const{recordTiming:s}=o;let a;e.setPrompt("*"),n.trusted=!0;try{const r=async function(e,t,o,n){var i;let r=!0;n&&Array.isArray(n.tags)&&-1!==n.tags.indexOf("raises-exception")&&(r=!1);const s={code:e,stop_on_error:r},a=null===(i=o.session)||void 0===i?void 0:i.kernel;if(!a)throw new Error("Session has no kernel.");const c=a.requestExecute(s,!1,n);return Object.defineProperty(t,"executeCounter",{value:0,writable:!0}),Object.prototype.hasOwnProperty.call(t,"monkey")||(Object.defineProperty(t,"future",{set(e){if(this.model.isDisposed)throw Error("Model is disposed");this._future!==e&&(this._future&&this._future.dispose(),this._future=e,e.done.finally((()=>{this._pendingInput=!1})).catch((()=>{})),e.onIOPub=e=>{const t=e.header.msg_type;try{switch(t){case"execute_result":case"display_data":case"stream":case"error":console.log(e),this.executeCounter+=1}1===this.executeCounter&&(this.model.clear(),this.widgets.length&&(this._clear(),this.outputLengthChanged.emit(Math.min(this.model.length,this._maxNumberOutputs))),this.executeCounter+=1)}catch(e){console.log(e)}this._onIOPub(e)},e.onReply=this._onExecuteReply,e.onStdin=t=>{D.KernelMessage.isInputRequestMsg(t)&&this.onInputRequest(t,e)})}}),Object.defineProperty(t,"monkey",{value:42,writable:!1})),t.future=c,c.done}(i,e.outputArea,t,o);if(s){const t=e=>{let t;switch(e.header.msg_type){case"status":t=`status.${e.content.execution_state}`;break;case"execute_input":t="execute_input";break;default:return!0}const o=e.header.date||(new Date).toISOString(),i=Object.assign({},n.getMetadata("execution"));return i[`iopub.${t}`]=o,n.setMetadata("execution",i),!0};e.outputArea.future.registerMessageHook(t)}else n.deleteMetadata("execution");a=e.outputArea.future;const c=await r;if(n.executionCount=c.content.execution_count,s){const e=Object.assign({},n.getMetadata("execution")),t=c.metadata.started;t&&(e["shell.execute_reply.started"]=t);const o=c.header.date;e["shell.execute_reply"]=o||(new Date).toISOString(),n.setMetadata("execution",e)}return c}catch(t){throw a&&!e.isDisposed&&e.outputArea.future===a&&e.setPrompt(""),t}}(e,s,{deletedCells:l,recordTiming:o.recordTiming});l.splice(0,l.length),h=(()=>{if(e.isDisposed)return!1;if(!n)return!0;if("ok"===n.content.status){const o=n.content;return o.payload&&o.payload.length&&function(e,t,o){var n;const i=null===(n=e.payload)||void 0===n?void 0:n.filter((e=>"set_next_input"===e.source))[0];if(!i)return;const r=i.text;if(i.replace)return void o.model.sharedModel.setSource(r);const s=t.sharedModel,a=t.cells,c=(0,N.findIndex)(a,(e=>e===o.model));-1===c?s.insertCell(s.cells.length,{cell_type:"code",source:r,metadata:{trusted:!1}}):s.insertCell(c+1,{cell_type:"code",source:r,metadata:{trusted:!1}})}(o,t,e),!0}throw new i.KernelError(n.content)})()}catch(e){}return h&&n({cell:e,success:!0}),h}e.model.sharedModel.transact((()=>{e.model.clearExecution()}),!1)}return Promise.resolve(!0)}}const R=[F,E,P,{id:"@mljar:notebook-cell-executor",description:"Mercury cell executor",autoStart:!0,provides:i.INotebookCellExecutor,activate:e=>(console.log("cell executor"),new O)}]}}]);