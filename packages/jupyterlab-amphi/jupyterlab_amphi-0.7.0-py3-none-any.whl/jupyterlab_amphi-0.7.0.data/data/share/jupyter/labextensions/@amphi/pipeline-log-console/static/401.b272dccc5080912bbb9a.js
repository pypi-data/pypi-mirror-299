"use strict";(self.webpackChunk_amphi_pipeline_log_console=self.webpackChunk_amphi_pipeline_log_console||[]).push([[401],{7401:(e,t,n)=>{n.r(t),n.d(t,{default:()=>H});var s=n(2200),o=n(7909),i=n(5215),r=n(7460),a=n(4614),l=n(5881),c=n(4602);class d{constructor(e){this._isDisposed=!1,this._disposed=new c.Signal(this),this._rendermime=null,this._connector=e}get disposed(){return this._disposed}get isDisposed(){return this._isDisposed}get rendermime(){return this._rendermime}dispose(){this.isDisposed||(this._isDisposed=!0,this._disposed.emit(),c.Signal.clearData(this))}}class p extends d{constructor(e){var t;super(e.connector),this._id=e.id,this._rendermime=null!==(t=e.rendermime)&&void 0!==t?t:null,this._ready=this._connector.ready,this._connector.kernelRestarted.connect(((e,t)=>{this._ready=this._connector.ready}))}get id(){return this._id}get ready(){return this._ready}}class h{constructor(e){this._kernelRestarted=new c.Signal(this),this._session=e.session,this._session.statusChanged.connect(((e,t)=>{switch(t){case"restarting":case"autorestarting":this._kernelRestarted.emit(this._session.ready)}}))}get kernelRestarted(){return this._kernelRestarted}get kernelLanguage(){var e;return(null===(e=this._session.session)||void 0===e?void 0:e.kernel)?this._session.session.kernel.info.then((e=>e.language_info.name)):Promise.resolve("")}get kernelName(){return this._session.kernelDisplayName}get ready(){return this._session.ready}get iopubMessage(){return this._session.iopubMessage}execute(e){var t;if(!(null===(t=this._session.session)||void 0===t?void 0:t.kernel))throw new Error("No session available.");return this._session.session.kernel.requestExecute(e)}}var m=n(5256),u=n(3345),g=n.n(u),_=n(7628),y=n.n(_),v=n(931),x=n(6216),w=n(8769);const C=({htmlData:e})=>{const[t,n]=(0,u.useState)([]),[s,o]=(0,u.useState)([]);return(0,u.useEffect)((()=>{const{data:t,headers:s}=function(e){const t=(new DOMParser).parseFromString(e,"text/html");let n=Array.from(t.querySelectorAll("table thead th")).slice(1).map((e=>{var t,n;return null!==(n=null===(t=e.textContent)||void 0===t?void 0:t.trim())&&void 0!==n?n:""}));const s=t.querySelectorAll("table tbody tr");return{data:Array.from(s,(e=>{var t,s;const o=e.querySelectorAll("th, td"),i={};return i.index=null!==(s=null===(t=o[0].textContent)||void 0===t?void 0:t.trim())&&void 0!==s?s:"",n.forEach(((e,t)=>{var n,s,r;i[e]=null!==(r=null===(s=null===(n=o[t+1])||void 0===n?void 0:n.textContent)||void 0===s?void 0:s.trim())&&void 0!==r?r:""})),i})),headers:["index",...n]}}(e);n(t),o(s.map(((e,t)=>{const n=e.match(/^(.*)\s\(([^)]+)\)$/),s=n?n[1]:e,o=n?n[2]:null;return{title:0===t?"":g().createElement(g().Fragment,null,g().createElement("div",{style:{whiteSpace:"nowrap"}},g().createElement("div",null,s),o&&g().createElement(x.A,{style:{fontSize:"10px",marginTop:"4px",color:"#5F9A97"}},o))),dataIndex:e,key:e,...0===t&&{rowScope:"row"},ellipsis:!0,render:e=>g().createElement("div",{style:{fontSize:"12px",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",maxWidth:"200px",minWidth:"25px"}},e)}})))}),[e]),g().createElement(w.A,{dataSource:t,columns:s,pagination:!1,size:"small",scroll:{x:"max-content"},style:{fontSize:"12px",tableLayout:"fixed",minWidth:"100%"}})};var S=n(83);const f=({htmlData:e})=>{const t=(e=>{console.log("htmlContent: %o",e);const t=(new DOMParser).parseFromString(e,"text/html").querySelectorAll("#documents > div._amphi_document");console.log("documentElements: %o",t);const n=[];return t.forEach((e=>{var t,s,o;console.log("element: %o",e);const i=e.querySelector("div._amphi_nb"),r=e.querySelector("div._amphi_page_content"),a=e.querySelector("div._amphi_metadata");if(i&&r&&a){const e=(null===(t=i.textContent)||void 0===t?void 0:t.trim())||"",l=(null===(s=r.innerHTML)||void 0===s?void 0:s.replace("<strong>Document Content:</strong>","").trim())||"";console.log("pageContent: %o",l);let c,d=(null===(o=a.textContent)||void 0===o?void 0:o.replace("Metadata:","").trim())||"";console.log("metadataText: %o",d);try{d=d.replace(/'/g,'"'),c=JSON.parse(d)}catch(e){console.error("Error parsing metadata:",e),c=d}n.push({nb:e,page_content:l,metadata:c})}})),console.log("documents: %o",n),n})(e).map(((e,t)=>({title:e.nb,key:`doc-${t}`,children:[{title:g().createElement("pre",{style:{userSelect:"text",cursor:"text"}},e.page_content),key:`doc-${t}-page-content`},{title:"Metadata",key:`doc-${t}-metadata`,children:Object.entries(e.metadata).map((([e,n])=>({title:`${e}: ${n}`,key:`doc-${t}-metadata-${e}`})))}]})));return console.log("Tree data %o",t),g().createElement(S.A,{defaultExpandedKeys:t.map((e=>e.key)),defaultSelectedKeys:t.map((e=>e.key)),defaultCheckedKeys:t.map((e=>e.key)),treeData:t})};var b=n(4363),k=n(7516),E=n(3361),D=n(6198);const{Text:T}=b.A;class L extends m.Widget{constructor(){super(),this._source=null,this.addClass("amphi-Console"),this._title=A.createTitle(),this._title.className="amphi-Console-title",this._console=A.createConsole(),this._console.className="amphi-Console-table",this.node.appendChild(this._title),this.node.appendChild(this._console)}get source(){return this._source}set source(e){this._source!==e&&(this._source&&this._source.disposed.disconnect(this.onSourceDisposed,this),this._source=e,this._source&&this._source.disposed.connect(this.onSourceDisposed,this))}dispose(){this.isDisposed||(this.source=null,super.dispose())}onNewLog(e,t,n){if(!this.isAttached)return;this._console.tFoot||(this._console.createTFoot(),this._console.tFoot.className="amphi-Console-content");let s=this._console.tFoot.insertRow(0);s.className="amphi-Console-table-row";let o,i=s.insertCell(0);switch(i.innerHTML=`\n    <span>\n      ${v.renderToString(g().createElement(k.A,null,g().createElement(T,null,e)))}\n    </span>\n  `,i.style.padding="5px",i.className="amphi-Console-date",g().createElement(D.A,{style:{fontSize:24},spin:!0}),t){case"info":i=s.insertCell(1),i.style.padding="5px",o=document.createElement("div"),i.appendChild(o);let e=/SUCCESS/i.test(n)?"success":/ERROR|WARNING/i.test(n)?"warning":"info";console.log("content %o",n),y().render(g().createElement(E.A,{showIcon:!0,message:g().createElement("div",{dangerouslySetInnerHTML:{__html:n}}),type:e}),o);break;case"error":i=s.insertCell(1),i.style.padding="5px",o=document.createElement("div"),i.appendChild(o),y().render(g().createElement(E.A,{message:"Error",showIcon:!0,description:g().createElement("div",{dangerouslySetInnerHTML:{__html:n.replace(/\n/g,"<br>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;")}}),type:"error"}),o);break;case"data":i=s.insertCell(1),i.style.padding="5",o=document.createElement("div"),i.appendChild(o);const t=(new DOMParser).parseFromString(n,"text/html").querySelector("div");t&&"documents"===t.id?y().render(g().createElement(f,{htmlData:n}),o):y().render(g().createElement(C,{htmlData:n}),o)}this._console.parentElement.scrollTop=0}clearLogs(){if(this._console.tFoot)for(;this._console.tFoot.rows.length>0;)this._console.tFoot.deleteRow(0)}onSourceDisposed(e,t){this.source=null}}var A;!function(e){const t=new Map(Object.entries({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"}));e.escapeHtml=function(e){return String(e).replace(/[&<>"'/]/g,(e=>t.get(e)))},e.createConsole=function(){return document.createElement("table")},e.createTitle=function(e=""){const t=document.createElement("p");return t.innerHTML=e,t}}(A||(A={}));class I{constructor(){this._source=null,this._panel=null,this._handlers={}}hasHandler(e){return!!this._handlers[e]}getHandler(e){return this._handlers[e]}addHandler(e){this._handlers[e.id]=e}get panel(){return this._panel}set panel(e){this.panel!==e&&(this._panel=e,e&&!e.source&&(e.source=this._source))}get source(){return this._source}set source(e){this._source!==e&&(this._source&&this._source.disposed.disconnect(this._onSourceDisposed,this),this._source=e,this._panel&&!this._panel.isDisposed&&(this._panel.source=this._source),this._source&&this._source.disposed.connect(this._onSourceDisposed,this))}_onSourceDisposed(){this._source=null}}var M=n(7262);const $=new M.Token("jupyterlab_extension/logconsole:IPipelineConsoleManager");var P;new M.Token("jupyterlab_extension/logconsole:IPipelineConsole"),function(e){e.open="pipeline-console:open"}(P||(P={}));const H=[{id:"@amphi/pipeline-log-console:extension",requires:[s.ICommandPalette,o.ILayoutRestorer,o.ILabShell,a.ISettingRegistry],provides:$,autoStart:!0,activate:(e,t,n,o,i)=>{const a=new I,l=P.open,c=new s.WidgetTracker({namespace:"pipeline-console"});let d=80;function p(e){d=e.get("maxPreview").composite,console.log(`Settings Example extension: maxPreview is set to '${d}'`)}return Promise.all([e.restored,i.load("@amphi/pipeline-log-console:extension")]).then((([,n])=>{p(n),n.changed.connect(p),e.commands.addCommand(l,{label:"Pipeline Console",execute:()=>{let t=null;for(const n of e.shell.widgets("main"))if("amphi-metadataPanel"===n.id){t=n;break}a.panel&&!a.panel.isDisposed||(a.panel=function(){const e=new L;return e.id="amphi-logConsole",e.title.label="Pipeline Console",e.title.icon=r.listIcon,e.title.closable=!0,e.disposed.connect((()=>{a.panel===e&&(a.panel=null)})),c.add(e),e}()),t&&t.isAttached?a.panel.isAttached||e.shell.add(a.panel,"main",{ref:t.id,mode:"tab-after"}):a.panel.isAttached||e.shell.add(a.panel,"main",{mode:"split-bottom"}),e.shell.activateById(a.panel.id)}}),t.addItem({command:l,category:"Pipeline Console"}),e.commands.addCommand("pipeline-console:clear",{execute:()=>{a.panel.clearLogs()},label:"Clear Console"}),e.commands.addCommand("pipeline-console:settings",{execute:()=>{},label:"Console Settings"}),e.contextMenu.addItem({command:"pipeline-console:clear",selector:".amphi-Console",rank:1})})).catch((e=>{console.error(`Something went wrong when reading the settings.\n${e}`)})),n.restore(c,{command:l,args:()=>({}),name:()=>"amphi-logConsole"}),console.log("JupyterLab extension @amphi/pipeline-log-console is activated!"),a}},{id:"@amphi/pipeline-log-console:pipelines",requires:[$,l.IPipelineTracker,o.ILabShell],autoStart:!0,activate:(e,t,n,o)=>{const r={};function a(e){const t=new Date(e);return`${t.toLocaleDateString()}\n${t.toLocaleTimeString()}`}n.widgetAdded.connect(((e,n)=>{t.hasHandler(n.context.sessionContext.path)?r[n.id]=new Promise(((e,s)=>{e(t.getHandler(n.context.sessionContext.path))})):r[n.id]=new Promise(((e,o)=>{const l=n.context.sessionContext,c=new h({session:l}),d={connector:c,id:l.path},m=new p(d);t.addHandler(m),n.disposed.connect((()=>{delete r[n.id],m.dispose()})),m.ready.then((()=>{e(m),c.ready.then((async()=>{l.session.kernel.anyMessage.connect(((e,n)=>{if(t.panel&&"recv"===n.direction)if("execute_result"===n.msg.header.msg_type||"display_data"===n.msg.header.msg_type){const e=n.msg.content;e.data["text/html"]&&t.panel.onNewLog(a(n.msg.header.date),"data",e.data["text/html"])}else if("stream"===n.msg.header.msg_type){const e=n.msg;if(e.content.text&&"\n"!==e.content.text){const o=document.createElement("div"),r={host:o,source:e.content.text,sanitizer:new s.Sanitizer};(0,i.renderText)(r).then((()=>{const e=o.outerHTML;t.panel.onNewLog(a(n.msg.header.date),"info",e)}))}}else if("error"===n.msg.header.msg_type){const e=n.msg,o=e.content.traceback.join("\n"),r=`traceback-${Date.now()}`,l=document.createElement("div"),c=`${e.content.evalue}`;l.innerHTML=`<pre><span>${c}</span><br><a href="#" style="text-decoration: underline; color: grey;" id="link-${r}" onClick="document.getElementById('${r}').style.display = document.getElementById('${r}').style.display === 'none' ? 'block' : 'none'; return false;">Show Traceback</a></pre>`;const d=document.createElement("pre");d.id=r,d.style.display="none",l.appendChild(d);const p={host:d,source:o,sanitizer:new s.Sanitizer};(0,i.renderText)(p).then((()=>{const n=l.outerHTML;t.panel.onNewLog(a(e.header.date),"error",n)}))}}))}))}))})),l(o)}));const l=(e,s)=>{var o;const i=null!==(o=null==s?void 0:s.newValue)&&void 0!==o?o:e.currentWidget;i&&n.has(i)&&r[i.id].then((e=>{e&&(t.source=e)}))};l(o),o.currentChanged.connect(l)}}]}}]);