System.register(["vue","./sentry-legacy.5.2.3.dev31313.js","vue-content-loader","./_commonjsHelpers-legacy.5.2.3.dev31313.js"],(function(e,a){"use strict";var l,t,s,r,n,o,i,d,u,c,f,m,p,b,v,g,_,y,h,w,k,z,x,A,C,$,S,D,q,P,B,j,M,R,T,F,O,U,I,L,E,V,H,N,Y,W,G,J,K,Q,Z,X,ee,ae,le,te,se,re,ne,oe,ie,de,ue,ce,fe,me,pe,be,ve,ge,_e,ye,he,we,ke,ze,xe,Ae,Ce,$e,Se,De,qe,Pe,Be,je,Me,Re,Te,Fe,Oe,Ue,Ie,Le,Ee,Ve,He;return{setters:[e=>{l=e.defineComponent,t=e.openBlock,s=e.createElementBlock,r=e.Fragment,n=e.createVNode,o=e.mergeProps,i=e.createElementVNode,d=e.toDisplayString,u=e.unref,c=e.renderSlot,f=e.normalizeClass,m=e.ref,p=e.onMounted,b=e.createBlock,v=e.withCtx,g=e.createCommentVNode,_=e.computed,y=e.createTextVNode,h=e.renderList,w=e.readonly,k=e.watchEffect,z=e.resolveComponent,x=e.watchPostEffect,A=e.Teleport,C=e.withModifiers,$=e.createApp},e=>{S=e.E,D=e.y,q=e.C,P=e.bn,B=e.I,j=e._,M=e.b,R=e.bo,T=e.e,F=e.ah,O=e.z,U=e.K,I=e.D,L=e.G,E=e.b7,V=e.bp,H=e.bq,N=e.aq,Y=e.bb,W=e.br,G=e.bs,J=e.am,K=e.L,Q=e.ac,Z=e.bt,X=e.aO,ee=e.b2,ae=e.bu,le=e.bv,te=e.W,se=e.a6,re=e.aL,ne=e.bw,oe=e.ar,ie=e.Y,de=e.a0,ue=e.bx,ce=e.by,fe=e.aF,me=e.bz,pe=e.bA,be=e.bB,ve=e.bC,ge=e.bD,_e=e.bE,ye=e.bF,he=e.bG,we=e.bH,ke=e.b6,ze=e.bI,xe=e.bJ,Ae=e.a,Ce=e.bK,$e=e.bL,Se=e.bM,De=e.bN,qe=e.a7,Pe=e.bO,Be=e.bP,je=e.bQ,Me=e.bd,Re=e.bg,Te=e.aN,Fe=e.bh,Oe=e.bi,Ue=e.bj,Ie=e.bR,Le=e.bS,Ee=e.bk,Ve=e.bl,He=e.bm},null,null],execute:function(){const e={class:"fr-ml-1v fr-text--bold"},a=l({__name:"AvatarWithName",props:{user:{},size:{default:12}},setup:a=>(a,l)=>(t(),s(r,null,[n(S,o(a.$attrs,{user:a.user,size:a.size,rounded:!0}),null,16,["user","size"]),i("span",e,d(a.user.first_name)+" "+d(a.user.last_name),1)],64))}),Ne=["aria-label"],Ye={class:"fr-breadcrumb__list"},We={__name:"Breadcrumb",setup(e){const{t:a}=D();return(e,l)=>(t(),s("nav",{rol:"navigation","aria-label":u(a)("You're here:"),class:"fr-breadcrumb fr-mb-5v"},[i("ol",Ye,[c(e.$slots,"default")])],8,Ne))}},Ge={class:"fr-text--sm fr-my-0"},Je={class:"fr-grid-row fr-grid-row--right not-enlarged"},Ke=["href","title"],Qe=l({__name:"QualityScoreTooltipContent",props:{dataset:{}},setup(e){const{t:a}=D();return(e,l)=>(t(),s(r,null,[i("h5",Ge,d(u(a)("Metadata quality:")),1),n(u(q),{passed:e.dataset.quality.dataset_description_quality,messagePassed:u(a)("Data description filled"),messageFailed:u(a)("Data description empty"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),n(u(q),{passed:e.dataset.quality.resources_documentation,messagePassed:u(a)("Files documented"),messageFailed:u(a)("Files documentation missing"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),n(u(q),{passed:e.dataset.quality.license,messagePassed:u(a)("License filled"),messageFailed:u(a)("No license set"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),n(u(q),{passed:e.dataset.quality.update_frequency&&!!e.dataset.quality.update_fulfilled_in_time,messagePassed:u(a)("Update frequency followed"),messageFailed:e.dataset.quality.update_frequency?u(a)("Update frequency not followed"):u(a)("Update frequency not set"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),n(u(q),{passed:e.dataset.quality.has_open_format,messagePassed:u(a)("File formats are open"),messageFailed:u(a)("File formats are closed"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),n(u(q),{passed:e.dataset.quality.temporal_coverage,messagePassed:u(a)("Temporal coverage filled"),messageFailed:u(a)("Temporal coverage not set"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),n(u(q),{passed:e.dataset.quality.spatial,messagePassed:u(a)("Spatial coverage filled"),messageFailed:u(a)("Spatial coverage not set"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),n(u(q),{passed:e.dataset.quality.all_resources_available,messagePassed:u(a)("All files are available"),messageFailed:u(a)("Some files are unavailable"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),i("div",Je,[i("a",{href:u(P),target:"_blank",rel:"noopener",title:u(a)("Learn more about this indicator - opens a new window")},d(u(a)("Learn more about this indicator")),9,Ke)])],64))}}),Ze=l({__name:"AdminBadge",props:{type:{}},setup:e=>(e,a)=>(t(),s("p",{class:f(["fr-badge",{"fr-badge--blue-cumulus":"info"===e.type,"fr-badge--error fr-badge--no-icon":"error"===e.type,"fr-badge--warning fr-badge--no-icon":"warning"===e.type,"fr-badge--success fr-badge--no-icon":"success"===e.type}])},[c(e.$slots,"default")],2))}),Xe=["aria-describedby"],ea=["id"],aa=j(l({inheritAttrs:!1,__name:"AdminContentWithTooltip",setup(e){const a=B(),l=m(),n=m("");return p((()=>{l.value&&(n.value=l.value.textContent||"")})),(e,f)=>(t(),s(r,null,[i("p",o(e.$attrs,{"aria-describedby":u(a),ref_key:"contentRef",ref:l}),[c(e.$slots,"default",{},void 0,!0)],16,Xe),i("span",{class:"fr-hidden-xl fr-tooltip fr-placement",id:u(a),role:"tooltip","aria-hidden":"true"},d(n.value),9,ea)],64))}}),[["__scopeId","data-v-d192f17a"]]),la=l({__name:"AdminLoader",props:{scale:{default:4}},setup:e=>(M(R),(e,a)=>(t(),b(u(T),{name:"ri-loader-5-line",animation:"spin",scale:e.scale,fill:"var(--blue-cumulus-sun-368-moon-732)"},null,8,["scale"])))}),ta={class:"fr-table fr-mb-2w"},sa=l({__name:"AdminTable",props:{loading:{type:Boolean,default:!1}},setup:e=>(e,a)=>(t(),s("div",ta,[i("table",null,[c(e.$slots,"default",{},void 0,!0)]),e.loading?(t(),b(F,{key:0,class:"fr-p-4w text-align-center"},{default:v((()=>[n(la)])),_:1})):g("",!0)]))}),ra=j(sa,[["__scopeId","data-v-cae574a4"]]),na={class:"fr-text--bold"},oa={key:1,class:"fr-grid-row fr-grid-row--middle justify-between"},ia=["title"],da=j(l({__name:"AdminTableTh",props:{sorted:{}},emits:["sort"],setup(e,{emit:a}){const l=e,r=a,{t:n}=D(),o=_((()=>void 0!==l.sorted));function m(){return"desc"===l.sorted?r("sort","asc"):r("sort","desc")}return(e,a)=>(t(),s("th",na,[o.value?(t(),s("div",oa,[c(e.$slots,"default",{},void 0,!0),i("button",{class:f(["fr-ml-1w fr-btn fr-btn--sm fr-btn--tertiary-no-outline",{"fr-icon-arrow-down-line":!e.sorted||"asc"===e.sorted,"fr-icon-arrow-up-line":"desc"===e.sorted,"text-grey-500":e.sorted,"text-mention-grey":!e.sorted}]),onClick:m,title:u(n)("Sort")},d(u(n)("Sort")),11,ia)])):c(e.$slots,"default",{key:0},void 0,!0)]))}}),[["__scopeId","data-v-5acf0bf0"]]),ua=["aria-describedby"],ca=["id"],fa=l({__name:"Tooltip",setup(e){const a=B("tooltip");return(e,l)=>(t(),s(r,null,[i("p",o(e.$attrs,{"aria-describedby":u(a)}),[c(e.$slots,"default")],16,ua),i("span",{class:"fr-tooltip fr-placement",id:u(a),role:"tooltip","aria-hidden":"true"},[c(e.$slots,"tooltip")],8,ca)],64))}}),ma=["href"],pa={class:"monospace"},ba={class:"monospace"},va={class:"monospace"},ga={class:"monospace"},_a={class:"monospace"},ya=l({__name:"AdminDatasetsTable",props:{datasets:{},loading:{type:Boolean},sortDirection:{},sortedBy:{}},emits:["sort"],setup(e,{emit:a}){const l=a,o=e,{t:c}=D();function f(e,a){l("sort",e,a)}function m(e){return o.sortedBy===e?o.sortDirection:null}function p(e){return Array.isArray(e.resources)?e.resources.length:e.resources.total}function g(e){return`${E}dataset/${e.id}/`}function _(e){return e.deleted?{label:c("Deleted"),type:"error"}:e.archived?{label:c("Archived"),type:"warning"}:e.private?{label:c("Private"),type:"default"}:{label:c("Public"),type:"info"}}return(e,a)=>(t(),b(ra,{loading:e.loading},{default:v((()=>[i("thead",null,[i("tr",null,[n(da,{onSort:a[0]||(a[0]=e=>f("title",e)),sorted:m("title"),scope:"col"},{default:v((()=>[y(d(u(c)("Title of the dataset")),1)])),_:1},8,["sorted"]),n(da,{scope:"col"},{default:v((()=>[y(d(u(c)("Status")),1)])),_:1}),n(da,{onSort:a[1]||(a[1]=e=>f("created",e)),sorted:m("created"),scope:"col"},{default:v((()=>[y(d(u(c)("Created at")),1)])),_:1},8,["sorted"]),n(da,{onSort:a[2]||(a[2]=e=>f("last_update",e)),sorted:m("last_update"),scope:"col"},{default:v((()=>[y(d(u(c)("Updated at")),1)])),_:1},8,["sorted"]),n(da,{scope:"col"},{default:v((()=>[y(d(u(c)("Files")),1)])),_:1}),n(da,{scope:"col"},{default:v((()=>[y(d(u(c)("Score")),1)])),_:1}),n(da,{scope:"col"},{default:v((()=>[n(fa,null,{tooltip:v((()=>[y(d(u(c)("Discussions")),1)])),default:v((()=>[a[6]||(a[6]=i("span",{class:"fr-icon--sm fr-icon-chat-3-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1}),n(da,{onSort:a[3]||(a[3]=e=>f("views",e)),sorted:m("views"),scope:"col"},{default:v((()=>[n(fa,null,{tooltip:v((()=>[y(d(u(c)("Views")),1)])),default:v((()=>[a[7]||(a[7]=i("span",{class:"fr-icon--sm fr-icon-eye-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1},8,["sorted"]),n(da,{scope:"col"},{default:v((()=>[n(fa,null,{tooltip:v((()=>[y(d(u(c)("Downloads")),1)])),default:v((()=>[a[8]||(a[8]=i("span",{class:"fr-icon--sm fr-icon-download-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1}),n(da,{onSort:a[4]||(a[4]=e=>f("reuses",e)),sorted:m("reuses"),scope:"col"},{default:v((()=>[n(fa,null,{tooltip:v((()=>[y(d(u(c)("Reuses")),1)])),default:v((()=>[a[9]||(a[9]=i("span",{class:"fr-icon--sm fr-icon-line-chart-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1},8,["sorted"]),n(da,{onSort:a[5]||(a[5]=e=>f("followers",e)),sorted:m("followers"),scope:"col"},{default:v((()=>[n(fa,null,{tooltip:v((()=>[y(d(u(c)("Favorites")),1)])),default:v((()=>[a[10]||(a[10]=i("span",{class:"fr-icon--sm fr-icon-star-s-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1},8,["sorted"])])]),i("tbody",null,[(t(!0),s(r,null,h(e.datasets,(e=>{var a;return t(),s("tr",{key:e.id},[i("td",null,[n(aa,null,{default:v((()=>[i("a",{class:"fr-link fr-reset-link",href:g(e)},[n(u(O),{text:e.title,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,ma)])),_:2},1024)]),i("td",null,[n(Ze,{type:_(e).type},{default:v((()=>[y(d(_(e).label),1)])),_:2},1032,["type"])]),i("td",null,d(u(U)(e.created_at)),1),i("td",null,d(u(U)(e.last_modified)),1),i("td",null,d(p(e)),1),i("td",null,[n(fa,null,{tooltip:v((()=>[n(Qe,{dataset:e},null,8,["dataset"])])),default:v((()=>[n(u(I),{class:"w-100",score:e.quality.score},null,8,["score"])])),_:2},1024)]),i("td",pa,d(u(L)(e.metrics.discussions)),1),i("td",ba,d(u(L)(e.metrics.views)),1),i("td",va,d(u(L)(null!==(a=e.metrics.resources_downloads)&&void 0!==a?a:0)),1),i("td",ga,d(u(L)(e.metrics.reuses)),1),i("td",_a,d(u(L)(e.metrics.followers)),1)])})),128))])])),_:1},8,["loading"]))}}),ha=m(null);function wa(){return{currentOrganization:w(ha),setCurrentOrganization:e=>{ha.value=e}}}const ka=["href"],za=["src","alt"],xa=l({__name:"AdminPublishButton",props:{type:{}},setup(e){const a=e,{t:l}=D(),r=_((()=>{switch(a.type){case"dataset":return H;case"harvester":return`${E}harvester/new/`;case"reuse":return V}}));return(e,a)=>(t(),s("a",{href:r.value,class:"fr-btn fr-icon-add-line fr-btn--icon-left"},[y(d(u(l)("Publish on"))+" ",1),i("img",{class:"fr-ml-1v",src:u("/_themes/gouvfr/assets/logotype-white.svg"),loading:"lazy",alt:u(N)},null,8,za)],8,ka))}}),Aa={key:0},Ca={class:"fr-breadcrumb__link","aria-current":"page"},$a={class:"fr-h3 fr-mb-5v"},Sa={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},Da={class:"fr-col"},qa={class:"subtitle subtitle--uppercase fr-m-0"},Pa={key:0,class:"fr-col-auto fr-grid-row fr-grid-row--middle"},Ba=["href"],ja={class:"text-align-center fr-py-1w"},Ma=["src"],Ra={class:"fr-text--bold fr-my-3v"},Ta=l({__name:"Datasets",props:{oid:{}},setup(e){const{t:a}=D(),l=e,r=m([]),o=m(!1),c=m(1),f=m(10),p=m(0),h=m("created"),w=m("desc"),x=_((()=>`${"asc"===w.value?"":"-"}${h.value}`)),A=m(""),C=Y(A,Q),{currentOrganization:$}=wa();function S(e,a){h.value=e,w.value=a}return k((async()=>{o.value=!0,r.value=[];try{const e=await W(l.oid,C.value,c.value,f.value,x.value);r.value=e.data,c.value=e.page,f.value=e.page_size,p.value=e.total}finally{o.value=!1}})),(e,l)=>{const m=z("router-link");return t(),s("div",null,[n(We,null,{default:v((()=>[i("li",null,[n(m,{class:"fr-breadcrumb__link",to:"/"},{default:v((()=>[y(d(u(a)("Administration")),1)])),_:1})]),u($)?(t(),s("li",Aa,[n(m,{class:"fr-breadcrumb__link",to:"/"},{default:v((()=>[y(d(u($).name),1)])),_:1})])):g("",!0),i("li",null,[i("a",Ca,d(u(a)("Datasets")),1)])])),_:1}),i("h1",$a,d(u(a)("Datasets")),1),i("div",Sa,[i("div",Da,[i("h2",qa,d(u(a)("{n} datasets",p.value)),1)]),p.value?(t(),s("div",Pa,[i("div",null,[i("a",{href:u(G)(e.oid),class:"fr-btn fr-btn--sm fr-icon-download-line fr-btn--icon-left"},d(u(a)("Download catalog")),9,Ba)])])):g("",!0)]),o.value||p.value>0?(t(),b(ya,{key:0,datasets:r.value,loading:o.value,"sort-direction":w.value,sortedBy:h.value,onSort:S},null,8,["datasets","loading","sort-direction","sortedBy"])):(t(),b(F,{key:1,class:"fr-my-2w"},{default:v((()=>[i("div",ja,[i("img",{src:u(J),alt:"",loading:"lazy"},null,8,Ma),i("p",Ra,d(u(a)("You haven't published a dataset yet")),1),n(xa,{type:"dataset"})])])),_:1})),p.value>f.value?(t(),b(u(K),{key:2,page:c.value,"page-size":f.value,"total-results":p.value,onChange:l[0]||(l[0]=e=>c.value=e)},null,8,["page","page-size","total-results"])):g("",!0)])}}}),Fa=["href"],Oa={class:"monospace"},Ua={class:"monospace"},Ia={class:"monospace"},La={class:"monospace"},Ea=l({__name:"AdminReusesTable",props:{reuses:{},loading:{type:Boolean},sortedBy:{},sortDirection:{}},emits:["sort"],setup(e){const a=e,{t:l}=D();function o(e){return a.sortedBy===e?a.sortDirection:null}function c(e){return`${E}reuse/${e.id}/`}function f(e){return e.deleted?{label:l("Deleted"),type:"error"}:e.archived?{label:l("Archived"),type:"warning"}:e.private?{label:l("Private"),type:"default"}:{label:l("Public"),type:"info"}}return(e,a)=>(t(),b(ra,{loading:e.loading},{default:v((()=>[i("thead",null,[n(da,{onSort:a[0]||(a[0]=a=>e.$emit("sort","title",a)),sorted:o("title"),scope:"col"},{default:v((()=>[y(d(u(l)("Reuse title")),1)])),_:1},8,["sorted"]),n(da,null,{default:v((()=>[y(d(u(l)("Status")),1)])),_:1}),n(da,{onSort:a[1]||(a[1]=a=>e.$emit("sort","created",a)),sorted:o("created"),scope:"col"},{default:v((()=>[y(d(u(l)("Created at")),1)])),_:1},8,["sorted"]),n(da,{onSort:a[2]||(a[2]=a=>e.$emit("sort","datasets",a)),sorted:o("datasets"),scope:"col"},{default:v((()=>[y(d(u(l)("Datasets")),1)])),_:1},8,["sorted"]),n(da,{scope:"col"},{default:v((()=>[n(fa,null,{tooltip:v((()=>[y(d(u(l)("Discussions")),1)])),default:v((()=>[a[5]||(a[5]=i("span",{class:"fr-icon--sm fr-icon-chat-3-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1}),n(da,{onSort:a[3]||(a[3]=a=>e.$emit("sort","views",a)),sorted:o("views"),scope:"col"},{default:v((()=>[n(fa,null,{tooltip:v((()=>[y(d(u(l)("Views")),1)])),default:v((()=>[a[6]||(a[6]=i("span",{class:"fr-icon--sm fr-icon-eye-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1},8,["sorted"]),n(da,{onSort:a[4]||(a[4]=a=>e.$emit("sort","followers",a)),sorted:o("followers"),scope:"col"},{default:v((()=>[n(fa,null,{tooltip:v((()=>[y(d(u(l)("Favorites")),1)])),default:v((()=>[a[7]||(a[7]=i("span",{class:"fr-icon--sm fr-icon-star-s-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1},8,["sorted"])]),i("tbody",null,[(t(!0),s(r,null,h(e.reuses,(e=>(t(),s("tr",null,[i("td",null,[n(aa,null,{default:v((()=>[i("a",{class:"fr-link fr-reset-link",href:c(e)},[n(u(O),{text:e.title,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,Fa)])),_:2},1024)]),i("td",null,[n(Ze,{type:f(e).type},{default:v((()=>[y(d(f(e).label),1)])),_:2},1032,["type"])]),i("td",null,d(u(U)(e.created_at)),1),i("td",Oa,d(u(L)(e.datasets.length)),1),i("td",Ua,d(u(L)(e.metrics.discussions)),1),i("td",Ia,d(u(L)(e.metrics.views)),1),i("td",La,d(u(L)(e.metrics.followers)),1)])))),256))])])),_:1},8,["loading"]))}}),Va={class:"fr-container--fluid"},Ha={key:0},Na={class:"fr-breadcrumb__link","aria-current":"page"},Ya={class:"fr-h3"},Wa={class:"subtitle subtitle--uppercase"},Ga={class:"text-align-center fr-py-1w"},Ja=["src"],Ka={class:"fr-text--bold fr-my-3v"},Qa=l({__name:"Reuses",props:{oid:{}},setup(e){const{t:a}=D(),l=e,r=m([]),o=m(!1),c=m(1),f=m(10),p=m(0),h=m("created"),w=m("desc"),x=_((()=>`${"asc"===w.value?"":"-"}${h.value}`)),{currentOrganization:A}=wa();function C(e,a){h.value=e,w.value=a}return k((async()=>{o.value=!0,r.value=[];try{const e=await Z(l.oid,c.value,f.value,x.value);r.value=e.data,c.value=e.page,f.value=e.page_size,p.value=e.total}finally{o.value=!1}})),(e,l)=>{const m=z("router-link");return t(),s("div",Va,[n(We,null,{default:v((()=>[i("li",null,[n(m,{class:"fr-breadcrumb__link",to:"/"},{default:v((()=>[y(d(u(a)("Administration")),1)])),_:1})]),u(A)?(t(),s("li",Ha,[n(m,{class:"fr-breadcrumb__link",to:"/"},{default:v((()=>[y(d(u(A).name),1)])),_:1})])):g("",!0),i("li",null,[i("a",Na,d(u(a)("Reuses")),1)])])),_:1}),i("h1",Ya,d(u(a)("Reuses")),1),i("h2",Wa,d(u(a)("{n} reuses of your organization",r.value.length)),1),o.value||p.value>0?(t(),b(Ea,{key:0,reuses:r.value,loading:o.value,sortDirection:w.value,sortedBy:h.value,onSort:C},null,8,["reuses","loading","sortDirection","sortedBy"])):(t(),b(F,{key:1,class:"fr-mt-1w fr-mb-2w"},{default:v((()=>[i("div",Ga,[i("img",{src:u("/_themes/gouvfr/assets/reuse2.svg"),alt:"",loading:"lazy"},null,8,Ja),i("p",Ka,d(u(a)("You haven't published a reuse yet")),1),n(xa,{type:"reuse"})])])),_:1})),p.value>f.value?(t(),b(u(K),{key:2,page:c.value,"page-size":f.value,"total-results":p.value,onChange:l[0]||(l[0]=e=>c.value=e)},null,8,["page","page-size","total-results"])):g("",!0)])}}}),Za={class:"fr-breadcrumb__link","aria-current":"page"},Xa={key:0,class:"fr-h1"},el={class:"fr-alert fr-alert--info"},al={class:"fr-alert__title"},ll={href:"/admin/me/"},tl=l({__name:"Me",setup(e){const{t:a}=D(),l=m(null);return p((async()=>l.value=await X())),(e,r)=>{const o=z("router-link");return t(),s("div",null,[n(We,null,{default:v((()=>[i("li",null,[n(o,{class:"fr-breadcrumb__link",to:"/"},{default:v((()=>[y(d(u(a)("Administration")),1)])),_:1})]),i("li",null,[i("a",Za,d(u(a)("Me")),1)])])),_:1}),l.value?(t(),s("h1",Xa,d(l.value.first_name)+" "+d(l.value.last_name),1)):g("",!0),i("div",el,[i("h3",al,d(u(a)("This is a WIP page")),1),i("p",null,[i("a",ll,d(u(a)("You can edit your profil on the current admin.")),1)])])])}}}),sl={class:"fr-sidemenu__item"},rl=["innerHTML"],nl=j(l({__name:"AdminSidebarLink",props:{label:{},icon:{},iconHtml:{},to:{}},setup:e=>(e,a)=>{const l=z("router-link");return t(),s("li",sl,[i("div",{class:f([{"fr-icon-svg fr-icon--sm":e.iconHtml},"fr-enlarge-link fr-sidemenu__link fr-mb-1w"])},[e.iconHtml?(t(),s("div",{key:0,class:"fr-mr-1w fr-grid-row",innerHTML:e.iconHtml},null,8,rl)):e.icon?(t(),s("div",{key:1,class:f([e.icon,"fr-mr-1w fr-icon--sm"]),"aria-hidden":"true"},null,2)):g("",!0),n(l,{to:e.to},{default:v((()=>[y(d(e.label),1)])),_:1},8,["to"])],2)])}}),[["__scopeId","data-v-5e2ff0a8"]]),ol=["aria-expanded","aria-controls","aria-current"],il={class:"fr-mx-1w"},dl={class:"logo logo--sm"},ul={class:"fr-mx-1w fr-col text-overflow-ellipsis"},cl=["id"],fl={class:"fr-sidemenu__list fr-mx-1w fr-my-3v"},ml=l({__name:"AdminSidebarMenu",props:{user:{},organization:{},isOpened:{type:Boolean}},emits:["open","click"],setup(e){const a=e,{t:l}=D(),o=B("menu");return x((()=>{setTimeout((()=>{!function(e,a){const l=document.getElementById(o);a(l)&&(e?a(l).collapse.disclose():a(l).collapse.conceal())}(a.isOpened,globalThis.dsfr)}),200)})),(e,a)=>(t(),s("li",{class:f(["fr-sidemenu__item",{"fr-sidemenu__item--active":e.isOpened}])},[i("button",{class:"fr-sidemenu__btn","aria-expanded":e.isOpened,"aria-controls":u(o),"aria-current":e.isOpened,onClick:a[0]||(a[0]=a=>e.$emit("open"))},[e.user?(t(),s(r,{key:0},[e.user?(t(),b(u(S),{key:0,user:e.user,size:24,rounded:!0},null,8,["user"])):g("",!0),i("p",il,d(u(l)("My Profil")),1)],64)):e.organization?(t(),s(r,{key:1},[i("div",dl,[n(ee,{type:"organization",src:e.organization.logo_thumbnail,size:20},null,8,["src"])]),i("p",ul,d(e.organization.name),1)],64)):g("",!0)],8,ol),i("div",{class:"fr-collapse","data-fr-js-collapse":"",id:u(o)},[i("ul",fl,[e.user?(t(),b(nl,{key:0,icon:"fr-icon-account-circle-line",label:u(l)("Me"),to:"/me"},null,8,["label"])):e.organization?(t(),s(r,{key:1},[n(nl,{iconHtml:u('<svg width="24" height="24" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M5 12V18C5 18 5 21 12 21C19 21 19 18 19 18V12" stroke="currentColor" stroke-width="1.5"/>\n<path d="M5 6V12C5 12 5 15 12 15C19 15 19 12 19 12V6" stroke="currentColor" stroke-width="1.5"/>\n<path d="M12 3C19 3 19 6 19 6C19 6 19 9 12 9C5 9 5 6 5 6C5 6 5 3 12 3Z" stroke="currentColor" stroke-width="1.5"/>\n</svg>\n'),label:u(l)("Datasets"),to:{name:"organization-datasets",params:{oid:e.organization.id}},onClick:a[1]||(a[1]=a=>e.$emit("click"))},null,8,["iconHtml","label","to"]),n(nl,{icon:"fr-icon-line-chart-line",label:u(l)("Reuses"),to:{name:"organization-reuses",params:{oid:e.organization.id}},onClick:a[2]||(a[2]=a=>e.$emit("click"))},null,8,["label","to"]),n(nl,{icon:"fr-icon-chat-3-line",label:u(l)("Discussions"),to:{name:"organization-discussions",params:{oid:e.organization.id}},onClick:a[3]||(a[3]=a=>e.$emit("click"))},null,8,["label","to"]),n(nl,{icon:"fr-icon-parent-line",label:u(l)("Members"),to:{name:"organization-members",params:{oid:e.organization.id}},onClick:a[4]||(a[4]=a=>e.$emit("click"))},null,8,["label","to"]),n(nl,{icon:"fr-icon-server-line",label:u(l)("Harvesters"),to:{name:"organization-harvesters",params:{oid:e.organization.id}},onClick:a[5]||(a[5]=a=>e.$emit("click"))},null,8,["label","to"]),n(nl,{icon:"fr-icon-user-line",label:u(l)("Profile"),to:{name:"organization-profile",params:{oid:e.organization.id}}},null,8,["label","to"])],64)):g("",!0)])],8,cl)],2))}}),pl=j(ml,[["__scopeId","data-v-cc8c7ed5"]]),bl={class:"fr-container--fluid h-100"},vl={class:"fr-grid-row h-100 bg-grey-50"},gl={class:"fr-col-12 fr-col-md-4 fr-col-lg-3 fr-col-xl-2"},_l=["aria-label"],yl={class:"fr-sidemenu__inner"},hl=["aria-controls"],wl=["id"],kl={class:"fr-sidemenu__list"},zl={class:"fr-col-12 fr-col-md-8 fr-col-lg-9 fr-col-xl-10 h-100 fr-px-2w"},xl=l({__name:"Admin",setup(e){const{t:a}=D(),l=ae(),n=B("menu"),o=m(null),c=m(),{setCurrentOrganization:f}=wa(),v=le();function _(e){return e===c.value}function y(e){c.value=e.id}return p((async()=>{var e;if(o.value=await X(),l.name||(o.value.organizations.length>0?v.replace({name:"organization-datasets",params:{oid:o.value.organizations[0].id}}):v.replace({name:"me"})),"me"===l.name)c.value=null===(e=te)||void 0===e?void 0:e.id;else if(o.value.organizations.length>0){let e=o.value.organizations[0];var a;l.params.oid&&(e=null!==(a=o.value.organizations.find((e=>e.id===l.params.oid)))&&void 0!==a?a:e),y(e),f(e)}})),(e,c)=>{const m=z("router-view");return t(),s("div",bl,[i("div",vl,[i("div",gl,[i("nav",{class:"fr-sidemenu fr-pr-0","aria-label":u(a)("Administration menu")},[i("div",yl,[i("button",{class:"fr-sidemenu__btn",hidden:"","aria-controls":u(n),"aria-expanded":"false"},d(u(a)("Open menu")),9,hl),i("div",{class:"fr-collapse",id:u(n)},[i("ul",kl,[u(te)?(t(),b(pl,{key:0,user:u(te),"is-opened":_(u(te).id),onOpen:c[0]||(c[0]=e=>y(u(te)))},null,8,["user","is-opened"])):g("",!0),o.value?(t(!0),s(r,{key:1},h(o.value.organizations,(e=>(t(),b(pl,{organization:e,"is-opened":_(e.id),onOpen:()=>y(e),onClick:()=>u(f)(e)},null,8,["organization","is-opened","onOpen","onClick"])))),256)):g("",!0)])],8,wl)])],8,_l)]),i("div",zl,[(t(),b(m,{key:u(l).fullPath,class:"fr-container--fluid"}))])])])}}}),Al=j(xl,[["__scopeId","data-v-1057ebbe"]]),Cl=["aria-labelledby","id"],$l={class:"fr-container fr-container--fluid fr-container-md"},Sl={class:"fr-grid-row fr-grid-row--center"},Dl={class:"fr-col-12 fr-col-md-8"},ql={class:"fr-modal__body"},Pl={class:"fr-modal__header"},Bl=["title","aria-controls"],jl={class:"fr-modal__content"},Ml=["id"],Rl={class:"fr-modal__footer"},Tl={class:"fr-btns-group fr-btns-group--right fr-btns-group--sm fr-btns-group--inline-lg fr-btns-group--icon-left"},Fl=["disabled"],Ol=["disabled"],Ul=l({__name:"AdminAddMemberModal",props:{id:{},oid:{},roles:{}},emits:["memberAdded"],setup(e,{emit:a}){const l=e,s=a,{t:r}=D(),{toast:o}=ie(),c=m(!1),f=m(),p=m("editor"),v=_((()=>"fr-modal-title-user-"+l.id));async function y(){try{c.value=!0,f.value&&(await ne(l.oid,f.value,p.value),s("memberAdded"),w())}catch(e){o.error(r("An error occurred while update member role."))}finally{c.value=!1}}function h(e){return e.map((e=>{var a;const l={...e,avatar_thumbnail:null!==(a=e.avatar_url)&&void 0!==a?a:void 0};return{value:l.id,label:l.first_name+" "+l.last_name,image:oe(l,32)}}))}function w(){c.value=!1,f.value=void 0,p.value="editor";const e=document.getElementById(l.id);globalThis.dsfr(e).modal.conceal()}return(e,a)=>(t(),b(A,{to:"body"},[i("dialog",{"aria-labelledby":v.value,role:"dialog",id:e.id,class:"fr-modal"},[i("div",$l,[i("div",Sl,[i("div",Dl,[i("div",ql,[i("div",Pl,[i("button",{class:"fr-btn--close fr-btn",title:u(r)("Close the modal dialog"),"aria-controls":e.id},d(u(r)("Close")),9,Bl)]),i("form",{onSubmit:C(y,["prevent"])},[i("div",jl,[i("h1",{id:v.value,class:"fr-modal__title fr-mb-2w"},d(u(r)("Add member to the organization")),9,Ml),n(se,{placeholder:e.$t("Search a user"),searchPlaceholder:e.$t("Search a user..."),suggestUrl:"/users/suggest/",values:f.value,onChange:a[0]||(a[0]=e=>f.value=e),allOption:e.$t("Select a user"),addAllOption:!1,onSuggest:h,roundedImages:!0},null,8,["placeholder","searchPlaceholder","values","allOption"]),e.roles.length>0?(t(),b(re,{key:0,label:u(r)("Role of the member"),"model-value":p.value,"onUpdate:modelValue":a[1]||(a[1]=e=>p.value=e),options:e.roles},null,8,["label","model-value","options"])):g("",!0)]),i("div",Rl,[i("div",Tl,[i("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary-grey-500",type:"button",onClick:w,disabled:c.value},d(u(r)("Cancel")),9,Fl),i("button",{class:"fr-btn",type:"submit",disabled:c.value},d(u(r)("Add to the organization")),9,Ol)])])],32)])])])])],8,Cl)]))}}),Il=["aria-controls"],Ll=l({__name:"AdminAddMemberButton",props:{oid:{},roles:{}},emits:["memberAdded"],setup(e){const a=e,{t:l}=D(),o=_((()=>"fr-modal-add-user-"+a.oid));return(e,a)=>(t(),s(r,null,[i("button",{class:"fr-btn fr-btn--sm fr-btn--icon-left fr-icon-add-line","data-fr-opened":"false","aria-controls":o.value},d(u(l)("Add member")),9,Il),n(Ul,{id:o.value,oid:e.oid,roles:e.roles,onMemberAdded:a[0]||(a[0]=a=>e.$emit("memberAdded"))},null,8,["id","oid","roles"])],64))}}),El={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},Vl=l({__name:"AdminDangerZone",setup:e=>(e,a)=>(t(),b(u(de),{color:"error",type:"secondary",weight:"regular"},{default:v((()=>[i("div",El,[c(e.$slots,"default")])])),_:3}))}),Hl={class:"fr-px-1v rounded-2 monospace fr-text--sm text-mention-grey bg-grey-100 fr-m-0"},Nl=l({__name:"AdminEmail",props:{email:{}},setup:e=>(e,a)=>(t(),s("p",Hl,d(e.email),1))}),Yl=["aria-labelledby","id"],Wl={class:"fr-container fr-container--fluid fr-container-md"},Gl={class:"fr-grid-row fr-grid-row--center"},Jl={class:"fr-col-12 fr-col-md-8"},Kl={class:"fr-modal__body"},Ql={class:"fr-modal__header"},Zl=["title","aria-controls"],Xl={class:"fr-modal__content"},et=["id"],at={class:"fr-grid-row fr-grid-row--middle fr-mb-2w"},lt={class:"fr-text--bold fr-m-0 fr-mr-1v"},tt={class:"fr-col"},st={class:"fr-col-auto"},rt=["disabled"],nt={class:"fr-col"},ot={class:"fr-m-0 text-grey-500"},it={class:"fr-m-0 fr-text--xs text-default-error"},dt={class:"fr-col-auto"},ut=["disabled"],ct=l({__name:"AdminEditMemberModal",props:{id:{},member:{},oid:{},roles:{}},emits:["memberUpdated"],setup(e,{emit:a}){const l=e,s=a,r=_((()=>"fr-modal-title-user-"+l.id)),{t:o}=D(),{toast:c}=ie(),f=m(!1);function p(){f.value=!1;const e=document.getElementById(l.id);globalThis.dsfr(e).modal.conceal()}return(e,a)=>{return t(),b(A,{to:"body"},[i("dialog",{"aria-labelledby":r.value,role:"dialog",id:e.id,class:"fr-modal"},[i("div",Wl,[i("div",Gl,[i("div",Jl,[i("div",Kl,[i("div",Ql,[i("button",{class:"fr-btn--close fr-btn",title:u(o)("Close the modal dialog"),"aria-controls":e.id},d(u(o)("Close")),9,Zl)]),i("div",Xl,[i("h1",{id:r.value,class:"fr-modal__title fr-mb-2w"},d(u(o)("Edit member")),9,et),i("div",at,[n(u(S),{class:"fr-mr-1v",user:e.member.user,rounded:!0,size:24},null,8,["user"]),i("p",lt,d(e.member.user.first_name)+" "+d(e.member.user.last_name),1),e.member.user.email?(t(),b(Nl,{key:0,email:e.member.user.email},null,8,["email"])):g("",!0)]),i("form",{class:"fr-grid-row fr-grid-row--gutters fr-grid-row--bottom",onSubmit:a[1]||(a[1]=C((a=>async function(e){if(e.newRole)try{f.value=!0,await ue(l.oid,e.user.id,e.newRole),s("memberUpdated"),p()}catch(a){c.error(o("An error occurred while update member role."))}finally{f.value=!1}else p()}(e.member)),["prevent"]))},[i("div",tt,[e.roles.length>0?(t(),b(re,{key:0,label:u(o)("Role of the member"),"model-value":e.member.role,"onUpdate:modelValue":a[0]||(a[0]=a=>e.member.newRole=a),options:(m=e.member.role,l.roles.map((e=>{const a={...e};return a.value===m&&(a.selected=!0),a})))},null,8,["label","model-value","options"])):g("",!0)]),i("div",st,[i("button",{class:"fr-btn",type:"submit",disabled:f.value},d(u(o)("Validate")),9,rt)])],32),n(Vl,{class:"fr-mt-2w"},{default:v((()=>[i("div",nt,[i("p",ot,d(u(o)("Remove member from the organization")),1),i("p",it,d(u(o)("Be careful, this action can't be reverse.")),1)]),i("div",dt,[i("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error fr-btn--icon-left fr-icon-logout-box-r-line",disabled:f.value,onClick:a[2]||(a[2]=a=>async function(e){try{f.value=!0,await ce(l.oid,e.user.id),s("memberUpdated")}catch(a){c.error(o("An error occurred while removing this member."))}finally{f.value=!1}}(e.member))},d(u(o)("Remove member")),9,ut)])])),_:1})])])])])])],8,Yl)]);var m}}}),ft=["aria-controls"],mt=l({__name:"AdminEditMemberButton",props:{member:{},oid:{},roles:{}},emits:["memberUpdated"],setup(e){const a=e,{t:l}=D(),o=_((()=>"fr-modal-user-"+a.member.user.id));return(e,a)=>(t(),s(r,null,[i("button",{class:"fr-btn fr-btn--sm fr-btn--secondary-grey-500 fr-btn--tertiary-no-outline fr-icon-pencil-line","data-fr-opened":"false","aria-controls":o.value},d(u(l)("Edit")),9,ft),n(ct,{id:o.value,member:e.member,oid:e.oid,roles:e.roles,onMemberUpdated:a[0]||(a[0]=a=>e.$emit("memberUpdated"))},null,8,["id","member","oid","roles"])],64))}}),pt={class:"fr-mt-n9v fr-mb-2w"},bt={class:"fr-badge fr-badge--info fr-badge--no-icon"},vt={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},gt={class:"fr-col"},_t={class:"fr-grid-row fr-grid-row--middle"},yt={class:"fr-text--bold fr-m-0 fr-mr-1v"},ht={class:"fr-m-0"},wt={class:"fr-ml-3v fr-mt-1-5v fr-mb-0 filet filet-default-grey fr-text--sm"},kt={key:0,class:"fr-col-auto fr-grid-row flex-direction-column"},zt=["disabled"],xt=["disabled","aria-controls"],At=["aria-labelledby","id"],Ct={class:"fr-container fr-container--fluid fr-container-md"},$t={class:"fr-grid-row fr-grid-row--center"},St={class:"fr-col-12 fr-col-md-8"},Dt={class:"fr-modal__body"},qt={class:"fr-modal__header"},Pt=["title","aria-controls"],Bt={class:"fr-modal__content"},jt=["id"],Mt={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--right"},Rt={class:"fr-col-auto"},Tt=["disabled"],Ft={class:"fr-col-auto"},Ot=["disabled"],Ut=l({__name:"AdminMembershipRequest",props:{loading:{type:Boolean},oid:{},request:{},showActions:{type:Boolean}},emits:["accept","refuse"],setup(e,{emit:a}){const l=e,r=a,{t:o}=D(),c=m(""),f=B("modal"),p=B("modalTitle");function _(){const e=document.getElementById(f);globalThis.dsfr(e).modal.conceal()}function h(){r("refuse",l.request.id,c.value),_()}function w(){c.value="",_()}return(e,a)=>{const l=z("AdminMembershipRequest",!0);return t(),b(F,{class:"drop-shadow rounded-xxs fr-mt-3w"},{default:v((()=>[i("div",pt,[i("p",bt,[a[2]||(a[2]=i("span",{class:"fr-icon-user-add-line fr-icon--sm","aria-hidden":"true"},null,-1)),y(" "+d(u(o)("Membership Request")),1)])]),i("div",vt,[i("div",gt,[i("div",_t,[n(u(S),{class:"fr-mr-1v",user:e.request.user,rounded:!0,size:24},null,8,["user"]),i("p",yt,d(e.request.user.first_name)+" "+d(e.request.user.last_name),1),e.request.user.email?(t(),b(Nl,{key:0,email:e.request.user.email,class:"fr-mr-1v"},null,8,["email"])):g("",!0),i("p",ht,d(u(o)("asks to join the organization.")),1)]),i("div",wt,d(e.request.comment),1)]),e.showActions?(t(),s("div",kt,[i("button",{class:"fr-btn fr-btn--sm fr-btn--icon-left fr-mb-1w fr-icon-check-line",onClick:a[0]||(a[0]=a=>e.$emit("accept",e.request.id)),disabled:e.loading,"data-testid":"accept"},d(u(o)("Accept request")),9,zt),i("button",{class:"fr-btn fr-btn--icon-left fr-btn--sm fr-btn--secondary fr-btn--secondary--error fr-icon-close-line",disabled:e.loading,"data-fr-opened":"false","aria-controls":u(f),"data-testid":"refuse"},d(u(o)("Refuse")),9,xt),(t(),b(A,{to:"body"},[i("dialog",{"aria-labelledby":u(p),role:"dialog",id:u(f),class:"fr-modal","data-testid":"modal"},[i("div",Ct,[i("div",$t,[i("div",St,[i("div",Dt,[i("div",qt,[i("button",{class:"fr-btn--close fr-btn",title:u(o)("Close the modal dialog"),"aria-controls":u(f),onClick:C(w,["prevent"])},d(u(o)("Close")),9,Pt)]),i("div",Bt,[i("h1",{id:u(p),class:"fr-modal__title fr-mb-2w"},d(u(o)("Refuse membership request")),9,jt),n(l,{class:"fr-mt-4w fr-mb-2w",loading:!1,oid:e.oid,request:e.request,"show-actions":!1},null,8,["oid","request"]),i("form",{onSubmit:C(h,["prevent"]),onReset:w},[n(fe,{label:u(o)("You can provide the refusal reason:"),modelValue:c.value,"onUpdate:modelValue":a[1]||(a[1]=e=>c.value=e),"data-testid":"comment-group"},null,8,["label","modelValue"]),i("div",Mt,[i("div",Rt,[i("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary-grey-500",type:"reset",disabled:e.loading,"data-testid":"cancel-modal-button"},d(u(o)("Cancel")),9,Tt)]),i("div",Ft,[i("button",{class:"fr-btn",type:"submit",disabled:e.loading,"data-testid":"refuse-modal-button"},d(u(o)("Refuse request")),9,Ot)])])],32)])])])])])],8,At)]))])):g("",!0)])])),_:1})}}}),It={key:0},Lt={class:"fr-breadcrumb__link","aria-current":"page"},Et={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle justify-center"},Vt={class:"fr-col-12 fr-col-md"},Ht={class:"fr-h3 fr-mb-5v"},Nt={key:0,class:"fr-col-auto"},Yt={class:"subtitle subtitle--uppercase fr-m-0"},Wt={class:"subtitle subtitle--uppercase fr-mt-2w fr-mb-1v"},Gt={class:"fr-table fr-table--layout-fixed"},Jt={class:"fr-text--bold fr-m-0"},Kt={class:"fr-m-0 fr-text--xs text-mention-grey f-italic"},Qt={key:0},Zt={key:1},Xt={key:0},es=l({__name:"Members",props:{oid:{}},setup(e){const a=e;M(me);const{t:l}=D(),{toast:o}=ie(),c=m([]),f=_((()=>pe||A.value.some((e=>{var a;return e.user.id===(null===(a=te)||void 0===a?void 0:a.id)&&"admin"===e.role})))),w=m([]),{currentOrganization:x}=wa(),A=m([]),C=m(!1);function $(e){var a,l;return null!==(a=null===(l=w.value.find((a=>a.value===e)))||void 0===l?void 0:l.label)&&void 0!==a?a:e}async function S(){C.value=!0,A.value=[];try{const e=await ye(a.oid);A.value=e.members}finally{C.value=!1}}async function q(){const e=await be(a.oid);c.value=e}async function P(e){C.value=!0;const t=[];try{await he(a.oid,e),t.push(q()),t.push(S())}catch(s){o.error(l("An error occurred while accepting this membership."))}finally{Promise.all(t).finally((()=>C.value=!1))}}async function B(e,t){C.value=!0;const s=[];try{await we(a.oid,e,t),s.push(q()),s.push(S())}catch(r){o.error(l("An error occurred while refusing this membership."))}finally{Promise.all(s).finally((()=>C.value=!1))}}return k((()=>{f.value&&be(a.oid).then((e=>c.value=e))})),p((()=>{ve().then(ge).then((e=>w.value=e)),S()})),(e,a)=>{const o=z("router-link");return t(),s("div",null,[n(We,null,{default:v((()=>[i("li",null,[n(o,{class:"fr-breadcrumb__link",to:"/"},{default:v((()=>[y(d(u(l)("Administration")),1)])),_:1})]),u(x)?(t(),s("li",It,[n(o,{class:"fr-breadcrumb__link",to:"/"},{default:v((()=>[y(d(u(x).name),1)])),_:1})])):g("",!0),i("li",null,[i("a",Lt,d(u(l)("Members")),1)])])),_:1}),i("div",Et,[i("div",Vt,[i("h1",Ht,d(u(l)("Members")),1)]),f.value?(t(),s("div",Nt,[n(Ll,{oid:e.oid,roles:w.value,onMemberAdded:S},null,8,["oid","roles"])])):g("",!0)]),c.value.length?(t(),s(r,{key:0},[i("h2",Yt,d(u(l)("{n} requests",{n:c.value.length})),1),(t(!0),s(r,null,h(c.value,(a=>(t(),b(Ut,{class:"fr-mb-4w",key:a.id,loading:C.value,oid:e.oid,request:a,"show-actions":!0,onAccept:P,onRefuse:B},null,8,["loading","oid","request"])))),128))],64)):g("",!0),i("h2",Wt,d(u(l)("{n} members",{n:A.value.length})),1),i("div",Gt,[n(ra,{loading:C.value},{default:v((()=>[i("thead",null,[i("tr",null,[n(da,{scope:"col"},{default:v((()=>[y(d(u(l)("Members")),1)])),_:1}),n(da,{scope:"col"},{default:v((()=>[y(d(u(l)("Status")),1)])),_:1}),n(da,{scope:"col"},{default:v((()=>[y(d(u(l)("Member since")),1)])),_:1}),n(da,{scope:"col"},{default:v((()=>[y(d(u(l)("Last connection")),1)])),_:1}),f.value?(t(),b(da,{key:0,scope:"col"},{default:v((()=>[y(d(u(l)("Action")),1)])),_:1})):g("",!0)])]),i("tbody",null,[(t(!0),s(r,null,h(A.value,(a=>{return t(),s("tr",{key:a.user.id},[i("td",null,[i("p",Jt,d(a.user.first_name)+" "+d(a.user.last_name),1),i("p",Kt,[n(u(T),{height:11,width:11,name:"ri-mail-line"}),y(" "+d(a.user.email),1)])]),i("td",null,[n(Ze,{type:(r=a.role,"admin"===r?"info":"default")},{default:v((()=>[y(d($(a.role)),1)])),_:2},1032,["type"])]),i("td",null,d(u(U)(a.since)),1),i("td",null,[a.user.last_login_at?(t(),s("span",Qt,d(u(_e)(a.user.last_login_at)),1)):(t(),s("span",Zt,d(u(l)("No connection")),1))]),f.value?(t(),s("td",Xt,[n(mt,{member:a,oid:e.oid,roles:w.value,onMemberUpdated:S},null,8,["member","oid","roles"])])):g("",!0)]);var r})),128))])])),_:1},8,["loading"])])])}}}),as={class:"fr-container--fluid"},ls={key:0},ts={class:"fr-breadcrumb__link","aria-current":"page"},ss=["id"],rs=["disabled","onClick"],ns={class:"fr-col"},os={class:"fr-m-0 text-grey-500"},is={class:"fr-m-0 fr-text--xs text-default-error"},ds={class:"fr-col-auto"},us=["disabled","aria-controls"],cs=["aria-labelledby","id"],fs={class:"fr-container fr-container--fluid fr-container-md"},ms={class:"fr-grid-row fr-grid-row--center"},ps={class:"fr-col-12 fr-col-md-8"},bs={class:"fr-modal__body"},vs={class:"fr-modal__header"},gs=["title","aria-controls"],_s={class:"fr-modal__content"},ys=["id"],hs={class:"fr-text--bold"},ws={class:"fr-modal__footer"},ks={class:"fr-btns-group fr-btns-group--right fr-btns-group--inline-reverse fr-btns-group--inline-lg fr-btns-group--icon-left"},zs=["disabled"],xs=l({__name:"Profile",props:{oid:{}},setup(e){const{t:a}=D(),{toast:l}=ie(),r=le(),o=m(null),c=m(null),{currentOrganization:f}=wa(),_=m([]),h=m(!1),w=B("modal"),k=B("modalTitle");function x(){f.value&&(h.value=!0,ze(f.value.id).then((()=>{r.replace("/"),window.location.reload()})).catch((()=>l.error(a("An error occured when deleting the organization.")))).finally((()=>h.value=!1)))}function C(e){h.value=!0,xe(e).then((()=>l.success(a("Organization updated !")))).catch((()=>l.error(a("An error occured when updating the organization.")))).finally((()=>h.value=!1))}return p((async()=>o.value=await X())),(e,l)=>{const r=z("router-link");return t(),s("div",as,[n(We,null,{default:v((()=>[i("li",null,[n(r,{class:"fr-breadcrumb__link",to:"/"},{default:v((()=>[y(d(u(a)("Administration")),1)])),_:1})]),u(f)?(t(),s("li",ls,[n(r,{class:"fr-breadcrumb__link",to:"/"},{default:v((()=>[y(d(u(f).name),1)])),_:1})])):g("",!0),i("li",null,[i("a",ts,d(u(a)("Profile")),1)])])),_:1}),c.value?(t(),s("h2",{key:0,class:"subtitle subtitle--uppercase fr-mb-5v",id:c.value.legend},d(u(a)("Edit profile")),9,ss)):g("",!0),u(f)?(t(),b(ke,{key:1,organization:u(f),errors:_.value,showLegend:!1,showWell:!1,ref_key:"form",ref:c,onSubmit:C},{submitButton:v((({submit:e})=>[i("button",{class:"fr-btn fr-btn--icon-left fr-icon-save-line",disabled:h.value,"data-testid":"submitButton",onClick:e},d(u(a)("Save")),9,rs)])),default:v((()=>[n(Vl,{class:"fr-mt-6w"},{default:v((()=>[i("div",ns,[i("p",os,d(u(a)("Delete the organization")),1),i("p",is,d(u(a)("Be careful, this action can't be reverse.")),1)]),i("div",ds,[i("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error fr-btn--icon-left fr-icon-delete-line",disabled:h.value,"data-fr-opened":"false","aria-controls":u(w)},d(u(a)("Delete")),9,us),(t(),b(A,{to:"body"},[i("dialog",{"aria-labelledby":u(k),role:"dialog",id:u(w),class:"fr-modal"},[i("div",fs,[i("div",ms,[i("div",ps,[i("div",bs,[i("div",vs,[i("button",{class:"fr-btn--close fr-btn",title:u(a)("Close the modal dialog"),"aria-controls":u(w)},d(u(a)("Close")),9,gs)]),i("div",_s,[i("h1",{id:u(k),class:"fr-modal__title fr-mb-2w"},d(u(a)("Are you sure you want to delete this organization ?")),9,ys),i("p",hs,d(u(a)("This action can't be reverse.")),1),i("p",null,d(u(a)("All content published with this organization will stay online, with the same URL but in an anonymous form, i.e. without being linked to a data producer.")),1),i("p",null,d(u(a)("If you want to delete your published content too, start by deleting the contents before deleting your account.")),1)]),i("div",ws,[i("div",ks,[i("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error",role:"button",disabled:h.value,onClick:x},d(u(a)("Delete")),9,zs)])])])])])])],8,cs)]))])])),_:1})])),_:1},8,["organization","errors"])):g("",!0)])}}});async function As(e){switch(e.class){case"Dataservice":return async function(e){return(await Ae.get(`dataservices/${e}/`)).data}(e.id);case"Dataset":return Be(e.id);case"Post":return async function(e){return(await Ae.get(`posts/${e}/`)).data}(e.id);case"Reuse":return Pe(e.id);default:return null}}function Cs(e,a){return null===e?null:{title:$s(e),icon:Ds(a),page:Ss(e)}}function $s(e){return null===e?"":"title"in e?e.title:"headline"in e?e.headline:je(e,`Unknown type ${e}`)}function Ss(e){return null===e?"":"page"in e?e.page:"self_web_url"in e?e.self_web_url:je(e,`Unknown type ${e}`)}function Ds(e){switch(e){case"Dataservice":return"ri-terminal-line";case"Dataset":return"ri-database-2-line";case"Post":return"ri-article-line";case"Reuse":return"ri-line-chart-line";default:return""}}M(De,Se,$e,Ce);const qs={class:"fr-text--bold"},Ps={key:0},Bs=["href"],js={class:"inline-flex"},Ms=["href"],Rs=l({__name:"AdminDiscussionsTable",props:{discussions:{},loading:{type:Boolean},sortDirection:{},sortedBy:{}},emits:["sort"],setup(e){const l=e,{t:o}=D(),c=m({}),f=m({});function p(e,a){return a?a.page+"#/discussions/"+e:""}function _(e){return l.sortedBy===e?l.sortDirection:null}function w(e){return e.discussion.slice(-1)[0]}return k((async()=>{for(const e of l.discussions)if(!(e.subject.id in c.value)){const a=As(e.subject);c.value[e.subject.id]=a;const l=await c.value[e.subject.id];f.value[e.subject.id]=Cs(l,e.subject.class)}})),(e,l)=>(t(),b(ra,{class:"fr-table--layout-fixed",loading:e.loading},{default:v((()=>[i("thead",null,[n(da,{onSort:l[0]||(l[0]=a=>e.$emit("sort","title",a)),sorted:_("title"),scope:"col"},{default:v((()=>[y(d(u(o)("Discussion")),1)])),_:1},8,["sorted"]),n(da,{scope:"col"},{default:v((()=>[y(d(u(o)("Number of comments")),1)])),_:1}),n(da,{scope:"col"},{default:v((()=>[y(d(u(o)("Last comment")),1)])),_:1}),n(da,{onSort:l[1]||(l[1]=a=>e.$emit("sort","closed",a)),sorted:_("closed"),scope:"col"},{default:v((()=>[y(d(u(o)("Closed at")),1)])),_:1},8,["sorted"]),n(da,{scope:"col",style:{width:"25%"}},{default:v((()=>[y(d(u(o)("URL")),1)])),_:1})]),i("tbody",null,[(t(!0),s(r,null,h(e.discussions,(e=>{var l,c,m;return t(),s("tr",null,[i("td",null,[i("p",qs,[n(u(O),{text:e.title,"auto-resize":!0,"max-lines":1},null,8,["text"])]),f.value[e.subject.id]?(t(),s("p",Ps,[i("a",{class:"fr-link inline-flex",href:null===(l=f.value[e.subject.id])||void 0===l?void 0:l.page},[n(u(T),{height:12,class:"self-center",name:null===(c=f.value[e.subject.id])||void 0===c?void 0:c.icon},null,8,["name"]),n(u(O),{class:"overflow-wrap-anywhere",text:null===(m=f.value[e.subject.id])||void 0===m?void 0:m.title,"auto-resize":!0,"max-lines":1},null,8,["text"])],8,Bs)])):g("",!0)]),i("td",null,d(e.discussion.length),1),i("td",null,[i("div",null,[i("p",null,d(u(U)(w(e).posted_on)),1),i("p",js,[y(d(u(o)("by "))+" ",1),n(u(a),{class:"fr-ml-1v",user:w(e).posted_by},null,8,["user"])])])]),i("td",null,[e.closed?(t(),s(r,{key:0},[y(d(u(U)(e.closed)),1)],64)):g("",!0)]),i("td",null,[f.value[e.subject.id]?(t(),s("a",{key:0,class:"fr-link inline-flex",href:p(e.id,f.value[e.subject.id]),target:"_blank"},[n(u(O),{text:p(e.id,f.value[e.subject.id]),"auto-resize":!0,"max-lines":1},null,8,["text"])],8,Ms)):g("",!0)])])})),256))])])),_:1},8,["loading"]))}}),Ts={class:"fr-container--fluid"},Fs={key:0},Os={class:"fr-breadcrumb__link","aria-current":"page"},Us={class:"fr-h3"},Is={class:"subtitle subtitle--uppercase"},Ls={class:"text-align-center fr-py-1w"},Es=["src"],Vs={class:"fr-text--bold fr-my-3v"},Hs=l({__name:"Discussions",props:{oid:{}},setup(e){const{t:a}=D(),l=e,r=m(!1),o=m(1),c=m(10),f=m(0),p=m("created"),h=m("desc"),w=_((()=>`${"asc"===h.value?"":"-"}${p.value}`)),x=m([]),{currentOrganization:A}=wa();function C(e,a){p.value=e,h.value=a}return k((async()=>{r.value=!0,x.value=[];try{const e=await async function(e,a,l,t){return(await Ae.get(qe("discussions/"),{params:{org:e,sort:t,page_size:l,page:a}})).data}(l.oid,o.value,c.value,w.value);x.value=e.data,o.value=e.page,c.value=e.page_size,f.value=e.total}finally{r.value=!1}})),(e,l)=>{const m=z("router-link");return t(),s("div",Ts,[n(We,null,{default:v((()=>[i("li",null,[n(m,{class:"fr-breadcrumb__link",to:"/"},{default:v((()=>[y(d(u(a)("Administration")),1)])),_:1})]),u(A)?(t(),s("li",Fs,[n(m,{class:"fr-breadcrumb__link",to:"/"},{default:v((()=>[y(d(u(A).name),1)])),_:1})])):g("",!0),i("li",null,[i("a",Os,d(u(a)("Discussions")),1)])])),_:1}),i("h1",Us,d(u(a)("Discussions")),1),i("h2",Is,d(u(a)("{n} discussions",f.value)),1),r.value||f.value>0?(t(),b(Rs,{key:0,discussions:x.value,loading:r.value,"sort-direction":h.value,sortedBy:p.value,onSort:C},null,8,["discussions","loading","sort-direction","sortedBy"])):(t(),b(F,{key:1,class:"fr-my-2w"},{default:v((()=>[i("div",Ls,[i("img",{src:u("/_themes/gouvfr/assets/discussion.svg"),alt:"",loading:"lazy"},null,8,Es),i("p",Vs,d(u(a)("There is no discussion yet")),1)])])),_:1})),f.value>c.value?(t(),b(u(K),{key:2,page:o.value,"page-size":c.value,"total-results":f.value,onChange:l[0]||(l[0]=e=>o.value=e)},null,8,["page","page-size","total-results"])):g("",!0)])}}}),Ns={class:"fr-container--fluid"},Ys={key:0},Ws={class:"fr-breadcrumb__link","aria-current":"page"},Gs={class:"fr-h3"},Js={class:"subtitle subtitle--uppercase"},Ks=["href"],Qs={class:"text-align-center fr-py-1w"},Zs=["src"],Xs={class:"fr-text--bold fr-my-3v"},er=l({__name:"Harvesters",props:{oid:{}},setup(e){const{t:a}=D(),l=e,o=m(!1),c=m(1),f=m(10),p=m(0),_=m([]),w=m({}),{currentOrganization:x}=wa();function A(e){return`${E}harvester/${e.id}/`}function C(e){return e.last_job?w.value[e.last_job.id].items.filter((e=>e.dataservice)).length:0}function $(e){return e.last_job?w.value[e.last_job.id].items.filter((e=>e.dataset)).length:0}function S(e){var l;switch(null===(l=e.last_job)||void 0===l?void 0:l.status){case"pending":return{label:a("Pending"),type:"default"};case"initializing":return{label:a("Initializing"),type:"info"};case"initialized":return{label:a("Initialized"),type:"default"};case"processing":return{label:a("Processing"),type:"info"};case"done":return{label:a("Done"),type:"success"};case"done-errors":return{label:a("Done with errors"),type:"warning"};case"failed":return{label:a("Failed"),type:"error"};default:return{label:a("No job yet"),type:"default"}}}return k((async()=>{o.value=!0,_.value=[];try{const a=await async function(e,a,l){return(await Ae.get(qe("harvest/sources/"),{params:{owner:e,deleted:!0,page:a,page_size:l}})).data}(l.oid,c.value,f.value);_.value=a.data,c.value=a.page,f.value=a.page_size,p.value=a.total;const t=[];for(const l of _.value){var e;null!==(e=l.last_job)&&void 0!==e&&e.id&&t.push(Ae.get(`harvest/job/${l.last_job.id}/`))}const s=await Promise.allSettled(t);for(const e of s)"fulfilled"===e.status&&(console.log(e.value.data),w.value[e.value.data.id]=e.value.data)}finally{o.value=!1}})),(e,l)=>{const m=z("router-link");return t(),s("div",Ns,[n(We,null,{default:v((()=>[i("li",null,[n(m,{class:"fr-breadcrumb__link",to:"/"},{default:v((()=>[y(d(u(a)("Administration")),1)])),_:1})]),u(x)?(t(),s("li",Ys,[n(m,{class:"fr-breadcrumb__link",to:"/"},{default:v((()=>[y(d(u(x).name),1)])),_:1})])):g("",!0),i("li",null,[i("a",Ws,d(u(a)("Harvesters")),1)])])),_:1}),i("h1",Gs,d(u(a)("Harvesters")),1),i("h2",Js,d(u(a)("{n} harvesters",p.value)),1),o.value||p.value?(t(),b(ra,{key:0,loading:o.value},{default:v((()=>[i("thead",null,[n(da,{scope:"col"},{default:v((()=>[y(d(u(a)("Name")),1)])),_:1}),n(da,{scope:"col"},{default:v((()=>[y(d(u(a)("Status")),1)])),_:1}),n(da,{scope:"col"},{default:v((()=>[y(d(u(a)("Created at")),1)])),_:1}),n(da,{scope:"col"},{default:v((()=>[y(d(u(a)("Last run")),1)])),_:1}),n(da,{scope:"col"},{default:v((()=>[y(d(u(a)("Datasets")),1)])),_:1}),n(da,{scope:"col"},{default:v((()=>[y(d(u(a)("Dataservices")),1)])),_:1})]),i("tbody",null,[(t(!0),s(r,null,h(_.value,(e=>{var l;return t(),s("tr",null,[i("td",null,[n(aa,null,{default:v((()=>[i("a",{class:"fr-link fr-reset-link",href:A(e)},[n(u(O),{text:e.name,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,Ks)])),_:2},1024)]),i("td",null,[n(Ze,{type:S(e).type},{default:v((()=>[y(d(S(e).label),1)])),_:2},1032,["type"])]),i("td",null,d(u(U)(e.created_at)),1),i("td",null,[null!==(l=e.last_job)&&void 0!==l&&l.ended?(t(),s(r,{key:0},[y(d(u(U)(e.last_job.ended)),1)],64)):(t(),s(r,{key:1},[y(d(u(a)("Not yet")),1)],64))]),i("td",null,d($(e)),1),i("td",null,d(C(e)),1)])})),256))])])),_:1},8,["loading"])):(t(),b(F,{key:1,class:"fr-my-2w"},{default:v((()=>[i("div",Qs,[i("img",{src:u("/_themes/gouvfr/assets/harvester.svg"),alt:"",loading:"lazy"},null,8,Zs),i("p",Xs,d(u(a)("There is no harvesters yet")),1),n(xa,{type:"harvester"})])])),_:1})),p.value>f.value?(t(),b(u(K),{key:2,page:c.value,"page-size":f.value,"total-results":p.value,onChange:l[0]||(l[0]=e=>c.value=e)},null,8,["page","page-size","total-results"])):g("",!0)])}}});Me({admin_root:E,default_lang:Re.global.locale.value,only_locales:Re.global.locale.value,schema_documentation_url:Te,schema_validata_url:Fe,show_copy_resource_permalink:!0,tabular_api_url:Oe,tabular_page_size:Ue,title:N});const ar=[{path:"/me",component:tl,name:"me"},{path:"/organizations/:oid",children:[{path:"datasets",component:Ta,props:!0,name:"organization-datasets"},{path:"reuses",component:Qa,props:!0,name:"organization-reuses"},{path:"discussions",component:Hs,props:!0,name:"organization-discussions"},{path:"members",component:es,props:!0,name:"organization-members"},{path:"harvesters",component:er,props:!0,name:"organization-harvesters"},{path:"profile",component:xs,props:!0,name:"organization-profile"}]}],lr=Ie({history:Le(),routes:ar}),tr=$(Al);Ee(tr),tr.use(Ve),tr.use(He),tr.use(Re),tr.use(lr),tr.mount("#admin"),globalThis.dsfr.start(),console.log("JS is injected !")}}}));
