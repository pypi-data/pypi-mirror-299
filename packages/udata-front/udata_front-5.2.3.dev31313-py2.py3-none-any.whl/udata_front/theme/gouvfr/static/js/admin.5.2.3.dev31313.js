import{defineComponent as q,openBlock as u,createElementBlock as h,Fragment as P,createVNode as n,mergeProps as ce,createElementVNode as t,toDisplayString as o,unref as e,renderSlot as j,normalizeClass as x,ref as w,onMounted as ee,createBlock as C,withCtx as d,createCommentVNode as D,computed as O,createTextVNode as y,renderList as N,readonly as Se,watchEffect as K,resolveComponent as I,watchPostEffect as De,Teleport as ne,withModifiers as ae,createApp as Re}from"vue";import{E as re,y as T,C as U,bn as qe,I as H,_ as Q,b as fe,bo as Me,e as _e,ah as Z,z as J,K as E,D as Te,G as F,b7 as te,bp as Pe,bq as Be,aq as ye,bb as Oe,br as Ie,bs as Le,am as Fe,L as le,ac as je,bt as Ue,aO as me,b2 as He,bu as Ee,bv as $e,W as G,a6 as Ve,aL as we,bw as Ne,ar as We,Y as ie,a0 as Ye,bx as Ge,by as Je,aF as Ke,bz as Qe,bA as Ze,bB as ge,bC as Xe,bD as xe,bE as et,bF as tt,bG as st,bH as ot,b6 as at,bI as nt,bJ as rt,a as se,bK as lt,bL as it,bM as dt,bN as ut,a7 as ke,bO as ct,bP as ft,bQ as ze,bd as _t,bg as ue,aN as mt,bh as pt,bi as bt,bj as gt,bR as vt,bS as ht,bk as yt,bl as $t,bm as wt}from"./sentry.5.2.3.dev31313.js";import"vue-content-loader";import"./_commonjsHelpers.5.2.3.dev31313.js";function Fn(){import.meta.url,import("_").catch(()=>1);async function*_(){}}const kt={class:"fr-ml-1v fr-text--bold"},zt=q({__name:"AvatarWithName",props:{user:{},size:{default:12}},setup(_){return(s,a)=>(u(),h(P,null,[n(re,ce(s.$attrs,{user:s.user,size:s.size,rounded:!0}),null,16,["user","size"]),t("span",kt,o(s.user.first_name)+" "+o(s.user.last_name),1)],64))}}),At=["aria-label"],Ct={class:"fr-breadcrumb__list"},W={__name:"Breadcrumb",setup(_){const{t:s}=T();return(a,p)=>(u(),h("nav",{rol:"navigation","aria-label":e(s)("You're here:"),class:"fr-breadcrumb fr-mb-5v"},[t("ol",Ct,[j(a.$slots,"default")])],8,At))}},St={class:"fr-text--sm fr-my-0"},Dt={class:"fr-grid-row fr-grid-row--right not-enlarged"},Rt=["href","title"],qt=q({__name:"QualityScoreTooltipContent",props:{dataset:{}},setup(_){const{t:s}=T();return(a,p)=>(u(),h(P,null,[t("h5",St,o(e(s)("Metadata quality:")),1),n(e(U),{passed:a.dataset.quality.dataset_description_quality,messagePassed:e(s)("Data description filled"),messageFailed:e(s)("Data description empty"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),n(e(U),{passed:a.dataset.quality.resources_documentation,messagePassed:e(s)("Files documented"),messageFailed:e(s)("Files documentation missing"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),n(e(U),{passed:a.dataset.quality.license,messagePassed:e(s)("License filled"),messageFailed:e(s)("No license set"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),n(e(U),{passed:a.dataset.quality.update_frequency&&!!a.dataset.quality.update_fulfilled_in_time,messagePassed:e(s)("Update frequency followed"),messageFailed:a.dataset.quality.update_frequency?e(s)("Update frequency not followed"):e(s)("Update frequency not set"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),n(e(U),{passed:a.dataset.quality.has_open_format,messagePassed:e(s)("File formats are open"),messageFailed:e(s)("File formats are closed"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),n(e(U),{passed:a.dataset.quality.temporal_coverage,messagePassed:e(s)("Temporal coverage filled"),messageFailed:e(s)("Temporal coverage not set"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),n(e(U),{passed:a.dataset.quality.spatial,messagePassed:e(s)("Spatial coverage filled"),messageFailed:e(s)("Spatial coverage not set"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),n(e(U),{passed:a.dataset.quality.all_resources_available,messagePassed:e(s)("All files are available"),messageFailed:e(s)("Some files are unavailable"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),t("div",Dt,[t("a",{href:e(qe),target:"_blank",rel:"noopener",title:e(s)("Learn more about this indicator - opens a new window")},o(e(s)("Learn more about this indicator")),9,Rt)])],64))}}),de=q({__name:"AdminBadge",props:{type:{}},setup(_){return(s,a)=>(u(),h("p",{class:x(["fr-badge",{"fr-badge--blue-cumulus":s.type==="info","fr-badge--error fr-badge--no-icon":s.type==="error","fr-badge--warning fr-badge--no-icon":s.type==="warning","fr-badge--success fr-badge--no-icon":s.type==="success"}])},[j(s.$slots,"default")],2))}}),Mt=["aria-describedby"],Tt=["id"],Pt=q({inheritAttrs:!1,__name:"AdminContentWithTooltip",setup(_){const s=H(),a=w(),p=w("");return ee(()=>{a.value&&(p.value=a.value.textContent||"")}),(r,l)=>(u(),h(P,null,[t("p",ce(r.$attrs,{"aria-describedby":e(s),ref_key:"contentRef",ref:a}),[j(r.$slots,"default",{},void 0,!0)],16,Mt),t("span",{class:"fr-hidden-xl fr-tooltip fr-placement",id:e(s),role:"tooltip","aria-hidden":"true"},o(p.value),9,Tt)],64))}});const pe=Q(Pt,[["__scopeId","data-v-d192f17a"]]),Bt=q({__name:"AdminLoader",props:{scale:{default:4}},setup(_){return fe(Me),(s,a)=>(u(),C(e(_e),{name:"ri-loader-5-line",animation:"spin",scale:s.scale,fill:"var(--blue-cumulus-sun-368-moon-732)"},null,8,["scale"]))}}),Ot={class:"fr-table fr-mb-2w"},It=q({__name:"AdminTable",props:{loading:{type:Boolean,default:!1}},setup(_){return(s,a)=>(u(),h("div",Ot,[t("table",null,[j(s.$slots,"default",{},void 0,!0)]),s.loading?(u(),C(Z,{key:0,class:"fr-p-4w text-align-center"},{default:d(()=>[n(Bt)]),_:1})):D("",!0)]))}});const oe=Q(It,[["__scopeId","data-v-cae574a4"]]),Lt={class:"fr-text--bold"},Ft={key:1,class:"fr-grid-row fr-grid-row--middle justify-between"},jt=["title"],Ut=q({__name:"AdminTableTh",props:{sorted:{}},emits:["sort"],setup(_,{emit:s}){const a=_,p=s,{t:r}=T(),l=O(()=>a.sorted!==void 0);function i(){return a.sorted==="desc"?p("sort","asc"):p("sort","desc")}return(f,m)=>(u(),h("th",Lt,[l.value?(u(),h("div",Ft,[j(f.$slots,"default",{},void 0,!0),t("button",{class:x(["fr-ml-1w fr-btn fr-btn--sm fr-btn--tertiary-no-outline",{"fr-icon-arrow-down-line":!f.sorted||f.sorted==="asc","fr-icon-arrow-up-line":f.sorted==="desc","text-grey-500":f.sorted,"text-mention-grey":!f.sorted}]),onClick:i,title:e(r)("Sort")},o(e(r)("Sort")),11,jt)])):j(f.$slots,"default",{key:0},void 0,!0)]))}});const S=Q(Ut,[["__scopeId","data-v-5acf0bf0"]]),Ht=["aria-describedby"],Et=["id"],L=q({__name:"Tooltip",setup(_){const s=H("tooltip");return(a,p)=>(u(),h(P,null,[t("p",ce(a.$attrs,{"aria-describedby":e(s)}),[j(a.$slots,"default")],16,Ht),t("span",{class:"fr-tooltip fr-placement",id:e(s),role:"tooltip","aria-hidden":"true"},[j(a.$slots,"tooltip")],8,Et)],64))}}),Vt=["href"],Nt={class:"monospace"},Wt={class:"monospace"},Yt={class:"monospace"},Gt={class:"monospace"},Jt={class:"monospace"},Kt=q({__name:"AdminDatasetsTable",props:{datasets:{},loading:{type:Boolean},sortDirection:{},sortedBy:{}},emits:["sort"],setup(_,{emit:s}){const a=s,p=_,{t:r}=T();function l(g,b){a("sort",g,b)}function i(g){return p.sortedBy===g?p.sortDirection:null}function f(g){return Array.isArray(g.resources)?g.resources.length:g.resources.total}function m(g){return"".concat(te,"dataset/").concat(g.id,"/")}function $(g){return g.deleted?{label:r("Deleted"),type:"error"}:g.archived?{label:r("Archived"),type:"warning"}:g.private?{label:r("Private"),type:"default"}:{label:r("Public"),type:"info"}}return(g,b)=>(u(),C(oe,{loading:g.loading},{default:d(()=>[t("thead",null,[t("tr",null,[n(S,{onSort:b[0]||(b[0]=c=>l("title",c)),sorted:i("title"),scope:"col"},{default:d(()=>[y(o(e(r)("Title of the dataset")),1)]),_:1},8,["sorted"]),n(S,{scope:"col"},{default:d(()=>[y(o(e(r)("Status")),1)]),_:1}),n(S,{onSort:b[1]||(b[1]=c=>l("created",c)),sorted:i("created"),scope:"col"},{default:d(()=>[y(o(e(r)("Created at")),1)]),_:1},8,["sorted"]),n(S,{onSort:b[2]||(b[2]=c=>l("last_update",c)),sorted:i("last_update"),scope:"col"},{default:d(()=>[y(o(e(r)("Updated at")),1)]),_:1},8,["sorted"]),n(S,{scope:"col"},{default:d(()=>[y(o(e(r)("Files")),1)]),_:1}),n(S,{scope:"col"},{default:d(()=>[y(o(e(r)("Score")),1)]),_:1}),n(S,{scope:"col"},{default:d(()=>[n(L,null,{tooltip:d(()=>[y(o(e(r)("Discussions")),1)]),default:d(()=>[b[6]||(b[6]=t("span",{class:"fr-icon--sm fr-icon-chat-3-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1}),n(S,{onSort:b[3]||(b[3]=c=>l("views",c)),sorted:i("views"),scope:"col"},{default:d(()=>[n(L,null,{tooltip:d(()=>[y(o(e(r)("Views")),1)]),default:d(()=>[b[7]||(b[7]=t("span",{class:"fr-icon--sm fr-icon-eye-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1},8,["sorted"]),n(S,{scope:"col"},{default:d(()=>[n(L,null,{tooltip:d(()=>[y(o(e(r)("Downloads")),1)]),default:d(()=>[b[8]||(b[8]=t("span",{class:"fr-icon--sm fr-icon-download-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1}),n(S,{onSort:b[4]||(b[4]=c=>l("reuses",c)),sorted:i("reuses"),scope:"col"},{default:d(()=>[n(L,null,{tooltip:d(()=>[y(o(e(r)("Reuses")),1)]),default:d(()=>[b[9]||(b[9]=t("span",{class:"fr-icon--sm fr-icon-line-chart-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1},8,["sorted"]),n(S,{onSort:b[5]||(b[5]=c=>l("followers",c)),sorted:i("followers"),scope:"col"},{default:d(()=>[n(L,null,{tooltip:d(()=>[y(o(e(r)("Favorites")),1)]),default:d(()=>[b[10]||(b[10]=t("span",{class:"fr-icon--sm fr-icon-star-s-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1},8,["sorted"])])]),t("tbody",null,[(u(!0),h(P,null,N(g.datasets,c=>{var v;return u(),h("tr",{key:c.id},[t("td",null,[n(pe,null,{default:d(()=>[t("a",{class:"fr-link fr-reset-link",href:m(c)},[n(e(J),{text:c.title,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,Vt)]),_:2},1024)]),t("td",null,[n(de,{type:$(c).type},{default:d(()=>[y(o($(c).label),1)]),_:2},1032,["type"])]),t("td",null,o(e(E)(c.created_at)),1),t("td",null,o(e(E)(c.last_modified)),1),t("td",null,o(f(c)),1),t("td",null,[n(L,null,{tooltip:d(()=>[n(qt,{dataset:c},null,8,["dataset"])]),default:d(()=>[n(e(Te),{class:"w-100",score:c.quality.score},null,8,["score"])]),_:2},1024)]),t("td",Nt,o(e(F)(c.metrics.discussions)),1),t("td",Wt,o(e(F)(c.metrics.views)),1),t("td",Yt,o(e(F)((v=c.metrics.resources_downloads)!=null?v:0)),1),t("td",Gt,o(e(F)(c.metrics.reuses)),1),t("td",Jt,o(e(F)(c.metrics.followers)),1)])}),128))])]),_:1},8,["loading"]))}}),ve=w(null);function Y(){const _=s=>{ve.value=s};return{currentOrganization:Se(ve),setCurrentOrganization:_}}const Qt="/_themes/gouvfr/assets/logotype-white.svg",Zt=["href"],Xt=["src","alt"],be=q({__name:"AdminPublishButton",props:{type:{}},setup(_){const s=_,{t:a}=T(),p=O(()=>{switch(s.type){case"dataset":return Be;case"harvester":return"".concat(te,"harvester/new/");case"reuse":return Pe}});return(r,l)=>(u(),h("a",{href:p.value,class:"fr-btn fr-icon-add-line fr-btn--icon-left"},[y(o(e(a)("Publish on"))+" ",1),t("img",{class:"fr-ml-1v",src:e(Qt),loading:"lazy",alt:e(ye)},null,8,Xt)],8,Zt))}}),xt={key:0},es={class:"fr-breadcrumb__link","aria-current":"page"},ts={class:"fr-h3 fr-mb-5v"},ss={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},os={class:"fr-col"},as={class:"subtitle subtitle--uppercase fr-m-0"},ns={key:0,class:"fr-col-auto fr-grid-row fr-grid-row--middle"},rs=["href"],ls={class:"text-align-center fr-py-1w"},is=["src"],ds={class:"fr-text--bold fr-my-3v"},us=q({__name:"Datasets",props:{oid:{}},setup(_){const{t:s}=T(),a=_,p=w([]),r=w(!1),l=w(1),i=w(10),f=w(0),m=w("created"),$=w("desc"),g=O(()=>"".concat($.value==="asc"?"":"-").concat(m.value)),b=w(""),c=Oe(b,je),{currentOrganization:v}=Y();function k(z,A){m.value=z,$.value=A}return K(async()=>{r.value=!0,p.value=[];try{const z=await Ie(a.oid,c.value,l.value,i.value,g.value);p.value=z.data,l.value=z.page,i.value=z.page_size,f.value=z.total}finally{r.value=!1}}),(z,A)=>{const R=I("router-link");return u(),h("div",null,[n(W,null,{default:d(()=>[t("li",null,[n(R,{class:"fr-breadcrumb__link",to:"/"},{default:d(()=>[y(o(e(s)("Administration")),1)]),_:1})]),e(v)?(u(),h("li",xt,[n(R,{class:"fr-breadcrumb__link",to:"/"},{default:d(()=>[y(o(e(v).name),1)]),_:1})])):D("",!0),t("li",null,[t("a",es,o(e(s)("Datasets")),1)])]),_:1}),t("h1",ts,o(e(s)("Datasets")),1),t("div",ss,[t("div",os,[t("h2",as,o(e(s)("{n} datasets",f.value)),1)]),f.value?(u(),h("div",ns,[t("div",null,[t("a",{href:e(Le)(z.oid),class:"fr-btn fr-btn--sm fr-icon-download-line fr-btn--icon-left"},o(e(s)("Download catalog")),9,rs)])])):D("",!0)]),r.value||f.value>0?(u(),C(Kt,{key:0,datasets:p.value,loading:r.value,"sort-direction":$.value,sortedBy:m.value,onSort:k},null,8,["datasets","loading","sort-direction","sortedBy"])):(u(),C(Z,{key:1,class:"fr-my-2w"},{default:d(()=>[t("div",ls,[t("img",{src:e(Fe),alt:"",loading:"lazy"},null,8,is),t("p",ds,o(e(s)("You haven't published a dataset yet")),1),n(be,{type:"dataset"})])]),_:1})),f.value>i.value?(u(),C(e(le),{key:2,page:l.value,"page-size":i.value,"total-results":f.value,onChange:A[0]||(A[0]=M=>l.value=M)},null,8,["page","page-size","total-results"])):D("",!0)])}}}),cs=["href"],fs={class:"monospace"},_s={class:"monospace"},ms={class:"monospace"},ps={class:"monospace"},bs=q({__name:"AdminReusesTable",props:{reuses:{},loading:{type:Boolean},sortedBy:{},sortDirection:{}},emits:["sort"],setup(_){const s=_,{t:a}=T();function p(i){return s.sortedBy===i?s.sortDirection:null}function r(i){return"".concat(te,"reuse/").concat(i.id,"/")}function l(i){return i.deleted?{label:a("Deleted"),type:"error"}:i.archived?{label:a("Archived"),type:"warning"}:i.private?{label:a("Private"),type:"default"}:{label:a("Public"),type:"info"}}return(i,f)=>(u(),C(oe,{loading:i.loading},{default:d(()=>[t("thead",null,[n(S,{onSort:f[0]||(f[0]=m=>i.$emit("sort","title",m)),sorted:p("title"),scope:"col"},{default:d(()=>[y(o(e(a)("Reuse title")),1)]),_:1},8,["sorted"]),n(S,null,{default:d(()=>[y(o(e(a)("Status")),1)]),_:1}),n(S,{onSort:f[1]||(f[1]=m=>i.$emit("sort","created",m)),sorted:p("created"),scope:"col"},{default:d(()=>[y(o(e(a)("Created at")),1)]),_:1},8,["sorted"]),n(S,{onSort:f[2]||(f[2]=m=>i.$emit("sort","datasets",m)),sorted:p("datasets"),scope:"col"},{default:d(()=>[y(o(e(a)("Datasets")),1)]),_:1},8,["sorted"]),n(S,{scope:"col"},{default:d(()=>[n(L,null,{tooltip:d(()=>[y(o(e(a)("Discussions")),1)]),default:d(()=>[f[5]||(f[5]=t("span",{class:"fr-icon--sm fr-icon-chat-3-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1}),n(S,{onSort:f[3]||(f[3]=m=>i.$emit("sort","views",m)),sorted:p("views"),scope:"col"},{default:d(()=>[n(L,null,{tooltip:d(()=>[y(o(e(a)("Views")),1)]),default:d(()=>[f[6]||(f[6]=t("span",{class:"fr-icon--sm fr-icon-eye-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1},8,["sorted"]),n(S,{onSort:f[4]||(f[4]=m=>i.$emit("sort","followers",m)),sorted:p("followers"),scope:"col"},{default:d(()=>[n(L,null,{tooltip:d(()=>[y(o(e(a)("Favorites")),1)]),default:d(()=>[f[7]||(f[7]=t("span",{class:"fr-icon--sm fr-icon-star-s-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1},8,["sorted"])]),t("tbody",null,[(u(!0),h(P,null,N(i.reuses,m=>(u(),h("tr",null,[t("td",null,[n(pe,null,{default:d(()=>[t("a",{class:"fr-link fr-reset-link",href:r(m)},[n(e(J),{text:m.title,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,cs)]),_:2},1024)]),t("td",null,[n(de,{type:l(m).type},{default:d(()=>[y(o(l(m).label),1)]),_:2},1032,["type"])]),t("td",null,o(e(E)(m.created_at)),1),t("td",fs,o(e(F)(m.datasets.length)),1),t("td",_s,o(e(F)(m.metrics.discussions)),1),t("td",ms,o(e(F)(m.metrics.views)),1),t("td",ps,o(e(F)(m.metrics.followers)),1)]))),256))])]),_:1},8,["loading"]))}}),gs="/_themes/gouvfr/assets/reuse2.svg",vs={class:"fr-container--fluid"},hs={key:0},ys={class:"fr-breadcrumb__link","aria-current":"page"},$s={class:"fr-h3"},ws={class:"subtitle subtitle--uppercase"},ks={class:"text-align-center fr-py-1w"},zs=["src"],As={class:"fr-text--bold fr-my-3v"},Cs=q({__name:"Reuses",props:{oid:{}},setup(_){const{t:s}=T(),a=_,p=w([]),r=w(!1),l=w(1),i=w(10),f=w(0),m=w("created"),$=w("desc"),g=O(()=>"".concat($.value==="asc"?"":"-").concat(m.value)),{currentOrganization:b}=Y();function c(v,k){m.value=v,$.value=k}return K(async()=>{r.value=!0,p.value=[];try{const v=await Ue(a.oid,l.value,i.value,g.value);p.value=v.data,l.value=v.page,i.value=v.page_size,f.value=v.total}finally{r.value=!1}}),(v,k)=>{const z=I("router-link");return u(),h("div",vs,[n(W,null,{default:d(()=>[t("li",null,[n(z,{class:"fr-breadcrumb__link",to:"/"},{default:d(()=>[y(o(e(s)("Administration")),1)]),_:1})]),e(b)?(u(),h("li",hs,[n(z,{class:"fr-breadcrumb__link",to:"/"},{default:d(()=>[y(o(e(b).name),1)]),_:1})])):D("",!0),t("li",null,[t("a",ys,o(e(s)("Reuses")),1)])]),_:1}),t("h1",$s,o(e(s)("Reuses")),1),t("h2",ws,o(e(s)("{n} reuses of your organization",p.value.length)),1),r.value||f.value>0?(u(),C(bs,{key:0,reuses:p.value,loading:r.value,sortDirection:$.value,sortedBy:m.value,onSort:c},null,8,["reuses","loading","sortDirection","sortedBy"])):(u(),C(Z,{key:1,class:"fr-mt-1w fr-mb-2w"},{default:d(()=>[t("div",ks,[t("img",{src:e(gs),alt:"",loading:"lazy"},null,8,zs),t("p",As,o(e(s)("You haven't published a reuse yet")),1),n(be,{type:"reuse"})])]),_:1})),f.value>i.value?(u(),C(e(le),{key:2,page:l.value,"page-size":i.value,"total-results":f.value,onChange:k[0]||(k[0]=A=>l.value=A)},null,8,["page","page-size","total-results"])):D("",!0)])}}}),Ss={class:"fr-breadcrumb__link","aria-current":"page"},Ds={key:0,class:"fr-h1"},Rs={class:"fr-alert fr-alert--info"},qs={class:"fr-alert__title"},Ms={href:"/admin/me/"},Ts=q({__name:"Me",setup(_){const{t:s}=T(),a=w(null);return ee(async()=>a.value=await me()),(p,r)=>{const l=I("router-link");return u(),h("div",null,[n(W,null,{default:d(()=>[t("li",null,[n(l,{class:"fr-breadcrumb__link",to:"/"},{default:d(()=>[y(o(e(s)("Administration")),1)]),_:1})]),t("li",null,[t("a",Ss,o(e(s)("Me")),1)])]),_:1}),a.value?(u(),h("h1",Ds,o(a.value.first_name)+" "+o(a.value.last_name),1)):D("",!0),t("div",Rs,[t("h3",qs,o(e(s)("This is a WIP page")),1),t("p",null,[t("a",Ms,o(e(s)("You can edit your profil on the current admin.")),1)])])])}}}),Ps='<svg width="24" height="24" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M5 12V18C5 18 5 21 12 21C19 21 19 18 19 18V12" stroke="currentColor" stroke-width="1.5"/>\n<path d="M5 6V12C5 12 5 15 12 15C19 15 19 12 19 12V6" stroke="currentColor" stroke-width="1.5"/>\n<path d="M12 3C19 3 19 6 19 6C19 6 19 9 12 9C5 9 5 6 5 6C5 6 5 3 12 3Z" stroke="currentColor" stroke-width="1.5"/>\n</svg>\n',Bs={class:"fr-sidemenu__item"},Os=["innerHTML"],Is=q({__name:"AdminSidebarLink",props:{label:{},icon:{},iconHtml:{},to:{}},setup(_){return(s,a)=>{const p=I("router-link");return u(),h("li",Bs,[t("div",{class:x([{"fr-icon-svg fr-icon--sm":s.iconHtml},"fr-enlarge-link fr-sidemenu__link fr-mb-1w"])},[s.iconHtml?(u(),h("div",{key:0,class:"fr-mr-1w fr-grid-row",innerHTML:s.iconHtml},null,8,Os)):s.icon?(u(),h("div",{key:1,class:x([s.icon,"fr-mr-1w fr-icon--sm"]),"aria-hidden":"true"},null,2)):D("",!0),n(p,{to:s.to},{default:d(()=>[y(o(s.label),1)]),_:1},8,["to"])],2)])}}});const V=Q(Is,[["__scopeId","data-v-5e2ff0a8"]]),Ls=["aria-expanded","aria-controls","aria-current"],Fs={class:"fr-mx-1w"},js={class:"logo logo--sm"},Us={class:"fr-mx-1w fr-col text-overflow-ellipsis"},Hs=["id"],Es={class:"fr-sidemenu__list fr-mx-1w fr-my-3v"},Vs=q({__name:"AdminSidebarMenu",props:{user:{},organization:{},isOpened:{type:Boolean}},emits:["open","click"],setup(_){const s=_,{t:a}=T(),p=H("menu");function r(l,i){const f=document.getElementById(p);i(f)&&(l?i(f).collapse.disclose():i(f).collapse.conceal())}return De(()=>{setTimeout(()=>{r(s.isOpened,globalThis.dsfr)},200)}),(l,i)=>(u(),h("li",{class:x(["fr-sidemenu__item",{"fr-sidemenu__item--active":l.isOpened}])},[t("button",{class:"fr-sidemenu__btn","aria-expanded":l.isOpened,"aria-controls":e(p),"aria-current":l.isOpened,onClick:i[0]||(i[0]=f=>l.$emit("open"))},[l.user?(u(),h(P,{key:0},[l.user?(u(),C(e(re),{key:0,user:l.user,size:24,rounded:!0},null,8,["user"])):D("",!0),t("p",Fs,o(e(a)("My Profil")),1)],64)):l.organization?(u(),h(P,{key:1},[t("div",js,[n(He,{type:"organization",src:l.organization.logo_thumbnail,size:20},null,8,["src"])]),t("p",Us,o(l.organization.name),1)],64)):D("",!0)],8,Ls),t("div",{class:"fr-collapse","data-fr-js-collapse":"",id:e(p)},[t("ul",Es,[l.user?(u(),C(V,{key:0,icon:"fr-icon-account-circle-line",label:e(a)("Me"),to:"/me"},null,8,["label"])):l.organization?(u(),h(P,{key:1},[n(V,{iconHtml:e(Ps),label:e(a)("Datasets"),to:{name:"organization-datasets",params:{oid:l.organization.id}},onClick:i[1]||(i[1]=f=>l.$emit("click"))},null,8,["iconHtml","label","to"]),n(V,{icon:"fr-icon-line-chart-line",label:e(a)("Reuses"),to:{name:"organization-reuses",params:{oid:l.organization.id}},onClick:i[2]||(i[2]=f=>l.$emit("click"))},null,8,["label","to"]),n(V,{icon:"fr-icon-chat-3-line",label:e(a)("Discussions"),to:{name:"organization-discussions",params:{oid:l.organization.id}},onClick:i[3]||(i[3]=f=>l.$emit("click"))},null,8,["label","to"]),n(V,{icon:"fr-icon-parent-line",label:e(a)("Members"),to:{name:"organization-members",params:{oid:l.organization.id}},onClick:i[4]||(i[4]=f=>l.$emit("click"))},null,8,["label","to"]),n(V,{icon:"fr-icon-server-line",label:e(a)("Harvesters"),to:{name:"organization-harvesters",params:{oid:l.organization.id}},onClick:i[5]||(i[5]=f=>l.$emit("click"))},null,8,["label","to"]),n(V,{icon:"fr-icon-user-line",label:e(a)("Profile"),to:{name:"organization-profile",params:{oid:l.organization.id}}},null,8,["label","to"])],64)):D("",!0)])],8,Hs)],2))}});const he=Q(Vs,[["__scopeId","data-v-cc8c7ed5"]]),Ns={class:"fr-container--fluid h-100"},Ws={class:"fr-grid-row h-100 bg-grey-50"},Ys={class:"fr-col-12 fr-col-md-4 fr-col-lg-3 fr-col-xl-2"},Gs=["aria-label"],Js={class:"fr-sidemenu__inner"},Ks=["aria-controls"],Qs=["id"],Zs={class:"fr-sidemenu__list"},Xs={class:"fr-col-12 fr-col-md-8 fr-col-lg-9 fr-col-xl-10 h-100 fr-px-2w"},xs=q({__name:"Admin",setup(_){const{t:s}=T(),a=Ee(),p=H("menu"),r=w(null),l=w(),{setCurrentOrganization:i}=Y(),f=$e();function m(g){return g===l.value}function $(g){l.value=g.id}return ee(async()=>{var g,b;if(r.value=await me(),a.name||(r.value.organizations.length>0?f.replace({name:"organization-datasets",params:{oid:r.value.organizations[0].id}}):f.replace({name:"me"})),a.name==="me")l.value=(g=G)==null?void 0:g.id;else if(r.value.organizations.length>0){let c=r.value.organizations[0];a.params.oid&&(c=(b=r.value.organizations.find(v=>v.id===a.params.oid))!=null?b:c),$(c),i(c)}}),(g,b)=>{const c=I("router-view");return u(),h("div",Ns,[t("div",Ws,[t("div",Ys,[t("nav",{class:"fr-sidemenu fr-pr-0","aria-label":e(s)("Administration menu")},[t("div",Js,[t("button",{class:"fr-sidemenu__btn",hidden:"","aria-controls":e(p),"aria-expanded":"false"},o(e(s)("Open menu")),9,Ks),t("div",{class:"fr-collapse",id:e(p)},[t("ul",Zs,[e(G)?(u(),C(he,{key:0,user:e(G),"is-opened":m(e(G).id),onOpen:b[0]||(b[0]=v=>$(e(G)))},null,8,["user","is-opened"])):D("",!0),r.value?(u(!0),h(P,{key:1},N(r.value.organizations,v=>(u(),C(he,{organization:v,"is-opened":m(v.id),onOpen:()=>$(v),onClick:()=>e(i)(v)},null,8,["organization","is-opened","onOpen","onClick"]))),256)):D("",!0)])],8,Qs)])],8,Gs)]),t("div",Xs,[(u(),C(c,{key:e(a).fullPath,class:"fr-container--fluid"}))])])])}}});const eo=Q(xs,[["__scopeId","data-v-1057ebbe"]]),to=["aria-labelledby","id"],so={class:"fr-container fr-container--fluid fr-container-md"},oo={class:"fr-grid-row fr-grid-row--center"},ao={class:"fr-col-12 fr-col-md-8"},no={class:"fr-modal__body"},ro={class:"fr-modal__header"},lo=["title","aria-controls"],io={class:"fr-modal__content"},uo=["id"],co={class:"fr-modal__footer"},fo={class:"fr-btns-group fr-btns-group--right fr-btns-group--sm fr-btns-group--inline-lg fr-btns-group--icon-left"},_o=["disabled"],mo=["disabled"],po=q({__name:"AdminAddMemberModal",props:{id:{},oid:{},roles:{}},emits:["memberAdded"],setup(_,{emit:s}){const a=_,p=s,{t:r}=T(),{toast:l}=ie(),i=w(!1),f=w(),m=w("editor"),$=O(()=>"fr-modal-title-user-"+a.id);async function g(){try{i.value=!0,f.value&&(await Ne(a.oid,f.value,m.value),p("memberAdded"),c())}catch(v){l.error(r("An error occurred while update member role."))}finally{i.value=!1}}function b(v){return v.map(k=>{var A;const z={...k,avatar_thumbnail:(A=k.avatar_url)!=null?A:void 0};return{value:z.id,label:z.first_name+" "+z.last_name,image:We(z,32)}})}function c(){i.value=!1,f.value=void 0,m.value="editor";const v=document.getElementById(a.id);globalThis.dsfr(v).modal.conceal()}return(v,k)=>(u(),C(ne,{to:"body"},[t("dialog",{"aria-labelledby":$.value,role:"dialog",id:v.id,class:"fr-modal"},[t("div",so,[t("div",oo,[t("div",ao,[t("div",no,[t("div",ro,[t("button",{class:"fr-btn--close fr-btn",title:e(r)("Close the modal dialog"),"aria-controls":v.id},o(e(r)("Close")),9,lo)]),t("form",{onSubmit:ae(g,["prevent"])},[t("div",io,[t("h1",{id:$.value,class:"fr-modal__title fr-mb-2w"},o(e(r)("Add member to the organization")),9,uo),n(Ve,{placeholder:v.$t("Search a user"),searchPlaceholder:v.$t("Search a user..."),suggestUrl:"/users/suggest/",values:f.value,onChange:k[0]||(k[0]=z=>f.value=z),allOption:v.$t("Select a user"),addAllOption:!1,onSuggest:b,roundedImages:!0},null,8,["placeholder","searchPlaceholder","values","allOption"]),v.roles.length>0?(u(),C(we,{key:0,label:e(r)("Role of the member"),"model-value":m.value,"onUpdate:modelValue":k[1]||(k[1]=z=>m.value=z),options:v.roles},null,8,["label","model-value","options"])):D("",!0)]),t("div",co,[t("div",fo,[t("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary-grey-500",type:"button",onClick:c,disabled:i.value},o(e(r)("Cancel")),9,_o),t("button",{class:"fr-btn",type:"submit",disabled:i.value},o(e(r)("Add to the organization")),9,mo)])])],32)])])])])],8,to)]))}}),bo=["aria-controls"],go=q({__name:"AdminAddMemberButton",props:{oid:{},roles:{}},emits:["memberAdded"],setup(_){const s=_,{t:a}=T(),p=O(()=>"fr-modal-add-user-"+s.oid);return(r,l)=>(u(),h(P,null,[t("button",{class:"fr-btn fr-btn--sm fr-btn--icon-left fr-icon-add-line","data-fr-opened":"false","aria-controls":p.value},o(e(a)("Add member")),9,bo),n(po,{id:p.value,oid:r.oid,roles:r.roles,onMemberAdded:l[0]||(l[0]=i=>r.$emit("memberAdded"))},null,8,["id","oid","roles"])],64))}}),vo={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},Ae=q({__name:"AdminDangerZone",setup(_){return(s,a)=>(u(),C(e(Ye),{color:"error",type:"secondary",weight:"regular"},{default:d(()=>[t("div",vo,[j(s.$slots,"default")])]),_:3}))}}),ho={class:"fr-px-1v rounded-2 monospace fr-text--sm text-mention-grey bg-grey-100 fr-m-0"},Ce=q({__name:"AdminEmail",props:{email:{}},setup(_){return(s,a)=>(u(),h("p",ho,o(s.email),1))}}),yo=["aria-labelledby","id"],$o={class:"fr-container fr-container--fluid fr-container-md"},wo={class:"fr-grid-row fr-grid-row--center"},ko={class:"fr-col-12 fr-col-md-8"},zo={class:"fr-modal__body"},Ao={class:"fr-modal__header"},Co=["title","aria-controls"],So={class:"fr-modal__content"},Do=["id"],Ro={class:"fr-grid-row fr-grid-row--middle fr-mb-2w"},qo={class:"fr-text--bold fr-m-0 fr-mr-1v"},Mo={class:"fr-col"},To={class:"fr-col-auto"},Po=["disabled"],Bo={class:"fr-col"},Oo={class:"fr-m-0 text-grey-500"},Io={class:"fr-m-0 fr-text--xs text-default-error"},Lo={class:"fr-col-auto"},Fo=["disabled"],jo=q({__name:"AdminEditMemberModal",props:{id:{},member:{},oid:{},roles:{}},emits:["memberUpdated"],setup(_,{emit:s}){const a=_,p=s,r=O(()=>"fr-modal-title-user-"+a.id),{t:l}=T(),{toast:i}=ie(),f=w(!1);async function m(c){if(!c.newRole){b();return}try{f.value=!0,await Ge(a.oid,c.user.id,c.newRole),p("memberUpdated"),b()}catch(v){i.error(l("An error occurred while update member role."))}finally{f.value=!1}}async function $(c){try{f.value=!0,await Je(a.oid,c.user.id),p("memberUpdated")}catch(v){i.error(l("An error occurred while removing this member."))}finally{f.value=!1}}function g(c){return a.roles.map(v=>{const k={...v};return k.value===c&&(k.selected=!0),k})}function b(){f.value=!1;const c=document.getElementById(a.id);globalThis.dsfr(c).modal.conceal()}return(c,v)=>(u(),C(ne,{to:"body"},[t("dialog",{"aria-labelledby":r.value,role:"dialog",id:c.id,class:"fr-modal"},[t("div",$o,[t("div",wo,[t("div",ko,[t("div",zo,[t("div",Ao,[t("button",{class:"fr-btn--close fr-btn",title:e(l)("Close the modal dialog"),"aria-controls":c.id},o(e(l)("Close")),9,Co)]),t("div",So,[t("h1",{id:r.value,class:"fr-modal__title fr-mb-2w"},o(e(l)("Edit member")),9,Do),t("div",Ro,[n(e(re),{class:"fr-mr-1v",user:c.member.user,rounded:!0,size:24},null,8,["user"]),t("p",qo,o(c.member.user.first_name)+" "+o(c.member.user.last_name),1),c.member.user.email?(u(),C(Ce,{key:0,email:c.member.user.email},null,8,["email"])):D("",!0)]),t("form",{class:"fr-grid-row fr-grid-row--gutters fr-grid-row--bottom",onSubmit:v[1]||(v[1]=ae(k=>m(c.member),["prevent"]))},[t("div",Mo,[c.roles.length>0?(u(),C(we,{key:0,label:e(l)("Role of the member"),"model-value":c.member.role,"onUpdate:modelValue":v[0]||(v[0]=k=>c.member.newRole=k),options:g(c.member.role)},null,8,["label","model-value","options"])):D("",!0)]),t("div",To,[t("button",{class:"fr-btn",type:"submit",disabled:f.value},o(e(l)("Validate")),9,Po)])],32),n(Ae,{class:"fr-mt-2w"},{default:d(()=>[t("div",Bo,[t("p",Oo,o(e(l)("Remove member from the organization")),1),t("p",Io,o(e(l)("Be careful, this action can't be reverse.")),1)]),t("div",Lo,[t("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error fr-btn--icon-left fr-icon-logout-box-r-line",disabled:f.value,onClick:v[2]||(v[2]=k=>$(c.member))},o(e(l)("Remove member")),9,Fo)])]),_:1})])])])])])],8,yo)]))}}),Uo=["aria-controls"],Ho=q({__name:"AdminEditMemberButton",props:{member:{},oid:{},roles:{}},emits:["memberUpdated"],setup(_){const s=_,{t:a}=T(),p=O(()=>"fr-modal-user-"+s.member.user.id);return(r,l)=>(u(),h(P,null,[t("button",{class:"fr-btn fr-btn--sm fr-btn--secondary-grey-500 fr-btn--tertiary-no-outline fr-icon-pencil-line","data-fr-opened":"false","aria-controls":p.value},o(e(a)("Edit")),9,Uo),n(jo,{id:p.value,member:r.member,oid:r.oid,roles:r.roles,onMemberUpdated:l[0]||(l[0]=i=>r.$emit("memberUpdated"))},null,8,["id","member","oid","roles"])],64))}}),Eo={class:"fr-mt-n9v fr-mb-2w"},Vo={class:"fr-badge fr-badge--info fr-badge--no-icon"},No={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},Wo={class:"fr-col"},Yo={class:"fr-grid-row fr-grid-row--middle"},Go={class:"fr-text--bold fr-m-0 fr-mr-1v"},Jo={class:"fr-m-0"},Ko={class:"fr-ml-3v fr-mt-1-5v fr-mb-0 filet filet-default-grey fr-text--sm"},Qo={key:0,class:"fr-col-auto fr-grid-row flex-direction-column"},Zo=["disabled"],Xo=["disabled","aria-controls"],xo=["aria-labelledby","id"],ea={class:"fr-container fr-container--fluid fr-container-md"},ta={class:"fr-grid-row fr-grid-row--center"},sa={class:"fr-col-12 fr-col-md-8"},oa={class:"fr-modal__body"},aa={class:"fr-modal__header"},na=["title","aria-controls"],ra={class:"fr-modal__content"},la=["id"],ia={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--right"},da={class:"fr-col-auto"},ua=["disabled"],ca={class:"fr-col-auto"},fa=["disabled"],_a=q({__name:"AdminMembershipRequest",props:{loading:{type:Boolean},oid:{},request:{},showActions:{type:Boolean}},emits:["accept","refuse"],setup(_,{emit:s}){const a=_,p=s,{t:r}=T(),l=w(""),i=H("modal"),f=H("modalTitle");function m(){const b=document.getElementById(i);globalThis.dsfr(b).modal.conceal()}function $(){p("refuse",a.request.id,l.value),m()}function g(){l.value="",m()}return(b,c)=>{const v=I("AdminMembershipRequest",!0);return u(),C(Z,{class:"drop-shadow rounded-xxs fr-mt-3w"},{default:d(()=>[t("div",Eo,[t("p",Vo,[c[2]||(c[2]=t("span",{class:"fr-icon-user-add-line fr-icon--sm","aria-hidden":"true"},null,-1)),y(" "+o(e(r)("Membership Request")),1)])]),t("div",No,[t("div",Wo,[t("div",Yo,[n(e(re),{class:"fr-mr-1v",user:b.request.user,rounded:!0,size:24},null,8,["user"]),t("p",Go,o(b.request.user.first_name)+" "+o(b.request.user.last_name),1),b.request.user.email?(u(),C(Ce,{key:0,email:b.request.user.email,class:"fr-mr-1v"},null,8,["email"])):D("",!0),t("p",Jo,o(e(r)("asks to join the organization.")),1)]),t("div",Ko,o(b.request.comment),1)]),b.showActions?(u(),h("div",Qo,[t("button",{class:"fr-btn fr-btn--sm fr-btn--icon-left fr-mb-1w fr-icon-check-line",onClick:c[0]||(c[0]=k=>b.$emit("accept",b.request.id)),disabled:b.loading,"data-testid":"accept"},o(e(r)("Accept request")),9,Zo),t("button",{class:"fr-btn fr-btn--icon-left fr-btn--sm fr-btn--secondary fr-btn--secondary--error fr-icon-close-line",disabled:b.loading,"data-fr-opened":"false","aria-controls":e(i),"data-testid":"refuse"},o(e(r)("Refuse")),9,Xo),(u(),C(ne,{to:"body"},[t("dialog",{"aria-labelledby":e(f),role:"dialog",id:e(i),class:"fr-modal","data-testid":"modal"},[t("div",ea,[t("div",ta,[t("div",sa,[t("div",oa,[t("div",aa,[t("button",{class:"fr-btn--close fr-btn",title:e(r)("Close the modal dialog"),"aria-controls":e(i),onClick:ae(g,["prevent"])},o(e(r)("Close")),9,na)]),t("div",ra,[t("h1",{id:e(f),class:"fr-modal__title fr-mb-2w"},o(e(r)("Refuse membership request")),9,la),n(v,{class:"fr-mt-4w fr-mb-2w",loading:!1,oid:b.oid,request:b.request,"show-actions":!1},null,8,["oid","request"]),t("form",{onSubmit:ae($,["prevent"]),onReset:g},[n(Ke,{label:e(r)("You can provide the refusal reason:"),modelValue:l.value,"onUpdate:modelValue":c[1]||(c[1]=k=>l.value=k),"data-testid":"comment-group"},null,8,["label","modelValue"]),t("div",ia,[t("div",da,[t("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary-grey-500",type:"reset",disabled:b.loading,"data-testid":"cancel-modal-button"},o(e(r)("Cancel")),9,ua)]),t("div",ca,[t("button",{class:"fr-btn",type:"submit",disabled:b.loading,"data-testid":"refuse-modal-button"},o(e(r)("Refuse request")),9,fa)])])],32)])])])])])],8,xo)]))])):D("",!0)])]),_:1})}}}),ma={key:0},pa={class:"fr-breadcrumb__link","aria-current":"page"},ba={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle justify-center"},ga={class:"fr-col-12 fr-col-md"},va={class:"fr-h3 fr-mb-5v"},ha={key:0,class:"fr-col-auto"},ya={class:"subtitle subtitle--uppercase fr-m-0"},$a={class:"subtitle subtitle--uppercase fr-mt-2w fr-mb-1v"},wa={class:"fr-table fr-table--layout-fixed"},ka={class:"fr-text--bold fr-m-0"},za={class:"fr-m-0 fr-text--xs text-mention-grey f-italic"},Aa={key:0},Ca={key:1},Sa={key:0},Da=q({__name:"Members",props:{oid:{}},setup(_){const s=_;fe(Qe);const{t:a}=T(),{toast:p}=ie(),r=w([]),l=O(()=>Ze||m.value.some(A=>{var R;return A.user.id===((R=G)==null?void 0:R.id)&&A.role==="admin"})),i=w([]),{currentOrganization:f}=Y(),m=w([]),$=w(!1);function g(A){var R,M;return(M=(R=i.value.find(B=>B.value===A))==null?void 0:R.label)!=null?M:A}function b(A){return A==="admin"?"info":"default"}async function c(){$.value=!0,m.value=[];try{const A=await tt(s.oid);m.value=A.members}finally{$.value=!1}}async function v(){const A=await ge(s.oid);r.value=A}async function k(A){$.value=!0;const R=[];try{await st(s.oid,A),R.push(v()),R.push(c())}catch(M){p.error(a("An error occurred while accepting this membership."))}finally{Promise.all(R).finally(()=>$.value=!1)}}async function z(A,R){$.value=!0;const M=[];try{await ot(s.oid,A,R),M.push(v()),M.push(c())}catch(B){p.error(a("An error occurred while refusing this membership."))}finally{Promise.all(M).finally(()=>$.value=!1)}}return K(()=>{l.value&&ge(s.oid).then(A=>r.value=A)}),ee(()=>{Xe().then(xe).then(A=>i.value=A),c()}),(A,R)=>{const M=I("router-link");return u(),h("div",null,[n(W,null,{default:d(()=>[t("li",null,[n(M,{class:"fr-breadcrumb__link",to:"/"},{default:d(()=>[y(o(e(a)("Administration")),1)]),_:1})]),e(f)?(u(),h("li",ma,[n(M,{class:"fr-breadcrumb__link",to:"/"},{default:d(()=>[y(o(e(f).name),1)]),_:1})])):D("",!0),t("li",null,[t("a",pa,o(e(a)("Members")),1)])]),_:1}),t("div",ba,[t("div",ga,[t("h1",va,o(e(a)("Members")),1)]),l.value?(u(),h("div",ha,[n(go,{oid:A.oid,roles:i.value,onMemberAdded:c},null,8,["oid","roles"])])):D("",!0)]),r.value.length?(u(),h(P,{key:0},[t("h2",ya,o(e(a)("{n} requests",{n:r.value.length})),1),(u(!0),h(P,null,N(r.value,B=>(u(),C(_a,{class:"fr-mb-4w",key:B.id,loading:$.value,oid:A.oid,request:B,"show-actions":!0,onAccept:k,onRefuse:z},null,8,["loading","oid","request"]))),128))],64)):D("",!0),t("h2",$a,o(e(a)("{n} members",{n:m.value.length})),1),t("div",wa,[n(oe,{loading:$.value},{default:d(()=>[t("thead",null,[t("tr",null,[n(S,{scope:"col"},{default:d(()=>[y(o(e(a)("Members")),1)]),_:1}),n(S,{scope:"col"},{default:d(()=>[y(o(e(a)("Status")),1)]),_:1}),n(S,{scope:"col"},{default:d(()=>[y(o(e(a)("Member since")),1)]),_:1}),n(S,{scope:"col"},{default:d(()=>[y(o(e(a)("Last connection")),1)]),_:1}),l.value?(u(),C(S,{key:0,scope:"col"},{default:d(()=>[y(o(e(a)("Action")),1)]),_:1})):D("",!0)])]),t("tbody",null,[(u(!0),h(P,null,N(m.value,B=>(u(),h("tr",{key:B.user.id},[t("td",null,[t("p",ka,o(B.user.first_name)+" "+o(B.user.last_name),1),t("p",za,[n(e(_e),{height:11,width:11,name:"ri-mail-line"}),y(" "+o(B.user.email),1)])]),t("td",null,[n(de,{type:b(B.role)},{default:d(()=>[y(o(g(B.role)),1)]),_:2},1032,["type"])]),t("td",null,o(e(E)(B.since)),1),t("td",null,[B.user.last_login_at?(u(),h("span",Aa,o(e(et)(B.user.last_login_at)),1)):(u(),h("span",Ca,o(e(a)("No connection")),1))]),l.value?(u(),h("td",Sa,[n(Ho,{member:B,oid:A.oid,roles:i.value,onMemberUpdated:c},null,8,["member","oid","roles"])])):D("",!0)]))),128))])]),_:1},8,["loading"])])])}}}),Ra={class:"fr-container--fluid"},qa={key:0},Ma={class:"fr-breadcrumb__link","aria-current":"page"},Ta=["id"],Pa=["disabled","onClick"],Ba={class:"fr-col"},Oa={class:"fr-m-0 text-grey-500"},Ia={class:"fr-m-0 fr-text--xs text-default-error"},La={class:"fr-col-auto"},Fa=["disabled","aria-controls"],ja=["aria-labelledby","id"],Ua={class:"fr-container fr-container--fluid fr-container-md"},Ha={class:"fr-grid-row fr-grid-row--center"},Ea={class:"fr-col-12 fr-col-md-8"},Va={class:"fr-modal__body"},Na={class:"fr-modal__header"},Wa=["title","aria-controls"],Ya={class:"fr-modal__content"},Ga=["id"],Ja={class:"fr-text--bold"},Ka={class:"fr-modal__footer"},Qa={class:"fr-btns-group fr-btns-group--right fr-btns-group--inline-reverse fr-btns-group--inline-lg fr-btns-group--icon-left"},Za=["disabled"],Xa=q({__name:"Profile",props:{oid:{}},setup(_){const{t:s}=T(),{toast:a}=ie(),p=$e(),r=w(null),l=w(null),{currentOrganization:i}=Y(),f=w([]),m=w(!1),$=H("modal"),g=H("modalTitle");function b(){i.value&&(m.value=!0,nt(i.value.id).then(()=>{p.replace("/"),window.location.reload()}).catch(()=>a.error(s("An error occured when deleting the organization."))).finally(()=>m.value=!1))}function c(v){m.value=!0,rt(v).then(()=>a.success(s("Organization updated !"))).catch(()=>a.error(s("An error occured when updating the organization."))).finally(()=>m.value=!1)}return ee(async()=>r.value=await me()),(v,k)=>{const z=I("router-link");return u(),h("div",Ra,[n(W,null,{default:d(()=>[t("li",null,[n(z,{class:"fr-breadcrumb__link",to:"/"},{default:d(()=>[y(o(e(s)("Administration")),1)]),_:1})]),e(i)?(u(),h("li",qa,[n(z,{class:"fr-breadcrumb__link",to:"/"},{default:d(()=>[y(o(e(i).name),1)]),_:1})])):D("",!0),t("li",null,[t("a",Ma,o(e(s)("Profile")),1)])]),_:1}),l.value?(u(),h("h2",{key:0,class:"subtitle subtitle--uppercase fr-mb-5v",id:l.value.legend},o(e(s)("Edit profile")),9,Ta)):D("",!0),e(i)?(u(),C(at,{key:1,organization:e(i),errors:f.value,showLegend:!1,showWell:!1,ref_key:"form",ref:l,onSubmit:c},{submitButton:d(({submit:A})=>[t("button",{class:"fr-btn fr-btn--icon-left fr-icon-save-line",disabled:m.value,"data-testid":"submitButton",onClick:A},o(e(s)("Save")),9,Pa)]),default:d(()=>[n(Ae,{class:"fr-mt-6w"},{default:d(()=>[t("div",Ba,[t("p",Oa,o(e(s)("Delete the organization")),1),t("p",Ia,o(e(s)("Be careful, this action can't be reverse.")),1)]),t("div",La,[t("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error fr-btn--icon-left fr-icon-delete-line",disabled:m.value,"data-fr-opened":"false","aria-controls":e($)},o(e(s)("Delete")),9,Fa),(u(),C(ne,{to:"body"},[t("dialog",{"aria-labelledby":e(g),role:"dialog",id:e($),class:"fr-modal"},[t("div",Ua,[t("div",Ha,[t("div",Ea,[t("div",Va,[t("div",Na,[t("button",{class:"fr-btn--close fr-btn",title:e(s)("Close the modal dialog"),"aria-controls":e($)},o(e(s)("Close")),9,Wa)]),t("div",Ya,[t("h1",{id:e(g),class:"fr-modal__title fr-mb-2w"},o(e(s)("Are you sure you want to delete this organization ?")),9,Ga),t("p",Ja,o(e(s)("This action can't be reverse.")),1),t("p",null,o(e(s)("All content published with this organization will stay online, with the same URL but in an anonymous form, i.e. without being linked to a data producer.")),1),t("p",null,o(e(s)("If you want to delete your published content too, start by deleting the contents before deleting your account.")),1)]),t("div",Ka,[t("div",Qa,[t("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error",role:"button",disabled:m.value,onClick:b},o(e(s)("Delete")),9,Za)])])])])])])],8,ja)]))])]),_:1})]),_:1},8,["organization","errors"])):D("",!0)])}}});async function xa(_){return(await se.get("posts/".concat(_,"/"))).data}async function en(_){return(await se.get("dataservices/".concat(_,"/"))).data}fe(ut,dt,it,lt);async function tn(_,s,a,p){return(await se.get(ke("discussions/"),{params:{org:_,sort:p,page_size:a,page:s}})).data}async function sn(_){switch(_.class){case"Dataservice":return en(_.id);case"Dataset":return ft(_.id);case"Post":return xa(_.id);case"Reuse":return ct(_.id);default:return null}}function on(_,s){return _===null?null:{title:an(_),icon:rn(s),page:nn(_)}}function an(_){return _===null?"":"title"in _?_.title:"headline"in _?_.headline:ze(_,"Unknown type ".concat(_))}function nn(_){return _===null?"":"page"in _?_.page:"self_web_url"in _?_.self_web_url:ze(_,"Unknown type ".concat(_))}function rn(_){switch(_){case"Dataservice":return"ri-terminal-line";case"Dataset":return"ri-database-2-line";case"Post":return"ri-article-line";case"Reuse":return"ri-line-chart-line";default:return""}}const ln={class:"fr-text--bold"},dn={key:0},un=["href"],cn={class:"inline-flex"},fn=["href"],_n=q({__name:"AdminDiscussionsTable",props:{discussions:{},loading:{type:Boolean},sortDirection:{},sortedBy:{}},emits:["sort"],setup(_){const s=_,{t:a}=T(),p=w({}),r=w({});K(async()=>{for(const m of s.discussions)if(!(m.subject.id in p.value)){const $=sn(m.subject);p.value[m.subject.id]=$;const g=await p.value[m.subject.id];r.value[m.subject.id]=on(g,m.subject.class)}});function l(m,$){return $?$.page+"#/discussions/"+m:""}function i(m){return s.sortedBy===m?s.sortDirection:null}function f(m){return m.discussion.slice(-1)[0]}return(m,$)=>(u(),C(oe,{class:"fr-table--layout-fixed",loading:m.loading},{default:d(()=>[t("thead",null,[n(S,{onSort:$[0]||($[0]=g=>m.$emit("sort","title",g)),sorted:i("title"),scope:"col"},{default:d(()=>[y(o(e(a)("Discussion")),1)]),_:1},8,["sorted"]),n(S,{scope:"col"},{default:d(()=>[y(o(e(a)("Number of comments")),1)]),_:1}),n(S,{scope:"col"},{default:d(()=>[y(o(e(a)("Last comment")),1)]),_:1}),n(S,{onSort:$[1]||($[1]=g=>m.$emit("sort","closed",g)),sorted:i("closed"),scope:"col"},{default:d(()=>[y(o(e(a)("Closed at")),1)]),_:1},8,["sorted"]),n(S,{scope:"col",style:{width:"25%"}},{default:d(()=>[y(o(e(a)("URL")),1)]),_:1})]),t("tbody",null,[(u(!0),h(P,null,N(m.discussions,g=>{var b,c,v;return u(),h("tr",null,[t("td",null,[t("p",ln,[n(e(J),{text:g.title,"auto-resize":!0,"max-lines":1},null,8,["text"])]),r.value[g.subject.id]?(u(),h("p",dn,[t("a",{class:"fr-link inline-flex",href:(b=r.value[g.subject.id])==null?void 0:b.page},[n(e(_e),{height:12,class:"self-center",name:(c=r.value[g.subject.id])==null?void 0:c.icon},null,8,["name"]),n(e(J),{class:"overflow-wrap-anywhere",text:(v=r.value[g.subject.id])==null?void 0:v.title,"auto-resize":!0,"max-lines":1},null,8,["text"])],8,un)])):D("",!0)]),t("td",null,o(g.discussion.length),1),t("td",null,[t("div",null,[t("p",null,o(e(E)(f(g).posted_on)),1),t("p",cn,[y(o(e(a)("by "))+" ",1),n(e(zt),{class:"fr-ml-1v",user:f(g).posted_by},null,8,["user"])])])]),t("td",null,[g.closed?(u(),h(P,{key:0},[y(o(e(E)(g.closed)),1)],64)):D("",!0)]),t("td",null,[r.value[g.subject.id]?(u(),h("a",{key:0,class:"fr-link inline-flex",href:l(g.id,r.value[g.subject.id]),target:"_blank"},[n(e(J),{text:l(g.id,r.value[g.subject.id]),"auto-resize":!0,"max-lines":1},null,8,["text"])],8,fn)):D("",!0)])])}),256))])]),_:1},8,["loading"]))}}),mn="/_themes/gouvfr/assets/discussion.svg",pn={class:"fr-container--fluid"},bn={key:0},gn={class:"fr-breadcrumb__link","aria-current":"page"},vn={class:"fr-h3"},hn={class:"subtitle subtitle--uppercase"},yn={class:"text-align-center fr-py-1w"},$n=["src"],wn={class:"fr-text--bold fr-my-3v"},kn=q({__name:"Discussions",props:{oid:{}},setup(_){const{t:s}=T(),a=_,p=w(!1),r=w(1),l=w(10),i=w(0),f=w("created"),m=w("desc"),$=O(()=>"".concat(m.value==="asc"?"":"-").concat(f.value)),g=w([]),{currentOrganization:b}=Y();function c(v,k){f.value=v,m.value=k}return K(async()=>{p.value=!0,g.value=[];try{const v=await tn(a.oid,r.value,l.value,$.value);g.value=v.data,r.value=v.page,l.value=v.page_size,i.value=v.total}finally{p.value=!1}}),(v,k)=>{const z=I("router-link");return u(),h("div",pn,[n(W,null,{default:d(()=>[t("li",null,[n(z,{class:"fr-breadcrumb__link",to:"/"},{default:d(()=>[y(o(e(s)("Administration")),1)]),_:1})]),e(b)?(u(),h("li",bn,[n(z,{class:"fr-breadcrumb__link",to:"/"},{default:d(()=>[y(o(e(b).name),1)]),_:1})])):D("",!0),t("li",null,[t("a",gn,o(e(s)("Discussions")),1)])]),_:1}),t("h1",vn,o(e(s)("Discussions")),1),t("h2",hn,o(e(s)("{n} discussions",i.value)),1),p.value||i.value>0?(u(),C(_n,{key:0,discussions:g.value,loading:p.value,"sort-direction":m.value,sortedBy:f.value,onSort:c},null,8,["discussions","loading","sort-direction","sortedBy"])):(u(),C(Z,{key:1,class:"fr-my-2w"},{default:d(()=>[t("div",yn,[t("img",{src:e(mn),alt:"",loading:"lazy"},null,8,$n),t("p",wn,o(e(s)("There is no discussion yet")),1)])]),_:1})),i.value>l.value?(u(),C(e(le),{key:2,page:r.value,"page-size":l.value,"total-results":i.value,onChange:k[0]||(k[0]=A=>r.value=A)},null,8,["page","page-size","total-results"])):D("",!0)])}}});async function zn(_,s,a){return(await se.get(ke("harvest/sources/"),{params:{owner:_,deleted:!0,page:s,page_size:a}})).data}const An="/_themes/gouvfr/assets/harvester.svg",Cn={class:"fr-container--fluid"},Sn={key:0},Dn={class:"fr-breadcrumb__link","aria-current":"page"},Rn={class:"fr-h3"},qn={class:"subtitle subtitle--uppercase"},Mn=["href"],Tn={class:"text-align-center fr-py-1w"},Pn=["src"],Bn={class:"fr-text--bold fr-my-3v"},On=q({__name:"Harvesters",props:{oid:{}},setup(_){const{t:s}=T(),a=_,p=w(!1),r=w(1),l=w(10),i=w(0),f=w([]),m=w({}),{currentOrganization:$}=Y();function g(k){return"".concat(te,"harvester/").concat(k.id,"/")}function b(k){return k.last_job?m.value[k.last_job.id].items.filter(z=>z.dataservice).length:0}function c(k){return k.last_job?m.value[k.last_job.id].items.filter(z=>z.dataset).length:0}function v(k){var z;switch((z=k.last_job)==null?void 0:z.status){case"pending":return{label:s("Pending"),type:"default"};case"initializing":return{label:s("Initializing"),type:"info"};case"initialized":return{label:s("Initialized"),type:"default"};case"processing":return{label:s("Processing"),type:"info"};case"done":return{label:s("Done"),type:"success"};case"done-errors":return{label:s("Done with errors"),type:"warning"};case"failed":return{label:s("Failed"),type:"error"};default:return{label:s("No job yet"),type:"default"}}}return K(async()=>{var k;p.value=!0,f.value=[];try{const z=await zn(a.oid,r.value,l.value);f.value=z.data,r.value=z.page,l.value=z.page_size,i.value=z.total;const A=[];for(const M of f.value)(k=M.last_job)!=null&&k.id&&A.push(se.get("harvest/job/".concat(M.last_job.id,"/")));const R=await Promise.allSettled(A);for(const M of R)M.status==="fulfilled"&&(console.log(M.value.data),m.value[M.value.data.id]=M.value.data)}finally{p.value=!1}}),(k,z)=>{const A=I("router-link");return u(),h("div",Cn,[n(W,null,{default:d(()=>[t("li",null,[n(A,{class:"fr-breadcrumb__link",to:"/"},{default:d(()=>[y(o(e(s)("Administration")),1)]),_:1})]),e($)?(u(),h("li",Sn,[n(A,{class:"fr-breadcrumb__link",to:"/"},{default:d(()=>[y(o(e($).name),1)]),_:1})])):D("",!0),t("li",null,[t("a",Dn,o(e(s)("Harvesters")),1)])]),_:1}),t("h1",Rn,o(e(s)("Harvesters")),1),t("h2",qn,o(e(s)("{n} harvesters",i.value)),1),p.value||i.value?(u(),C(oe,{key:0,loading:p.value},{default:d(()=>[t("thead",null,[n(S,{scope:"col"},{default:d(()=>[y(o(e(s)("Name")),1)]),_:1}),n(S,{scope:"col"},{default:d(()=>[y(o(e(s)("Status")),1)]),_:1}),n(S,{scope:"col"},{default:d(()=>[y(o(e(s)("Created at")),1)]),_:1}),n(S,{scope:"col"},{default:d(()=>[y(o(e(s)("Last run")),1)]),_:1}),n(S,{scope:"col"},{default:d(()=>[y(o(e(s)("Datasets")),1)]),_:1}),n(S,{scope:"col"},{default:d(()=>[y(o(e(s)("Dataservices")),1)]),_:1})]),t("tbody",null,[(u(!0),h(P,null,N(f.value,R=>{var M;return u(),h("tr",null,[t("td",null,[n(pe,null,{default:d(()=>[t("a",{class:"fr-link fr-reset-link",href:g(R)},[n(e(J),{text:R.name,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,Mn)]),_:2},1024)]),t("td",null,[n(de,{type:v(R).type},{default:d(()=>[y(o(v(R).label),1)]),_:2},1032,["type"])]),t("td",null,o(e(E)(R.created_at)),1),t("td",null,[(M=R.last_job)!=null&&M.ended?(u(),h(P,{key:0},[y(o(e(E)(R.last_job.ended)),1)],64)):(u(),h(P,{key:1},[y(o(e(s)("Not yet")),1)],64))]),t("td",null,o(c(R)),1),t("td",null,o(b(R)),1)])}),256))])]),_:1},8,["loading"])):(u(),C(Z,{key:1,class:"fr-my-2w"},{default:d(()=>[t("div",Tn,[t("img",{src:e(An),alt:"",loading:"lazy"},null,8,Pn),t("p",Bn,o(e(s)("There is no harvesters yet")),1),n(be,{type:"harvester"})])]),_:1})),i.value>l.value?(u(),C(e(le),{key:2,page:r.value,"page-size":l.value,"total-results":i.value,onChange:z[0]||(z[0]=R=>r.value=R)},null,8,["page","page-size","total-results"])):D("",!0)])}}});_t({admin_root:te,default_lang:ue.global.locale.value,only_locales:ue.global.locale.value,schema_documentation_url:mt,schema_validata_url:pt,show_copy_resource_permalink:!0,tabular_api_url:bt,tabular_page_size:gt,title:ye});const In=[{path:"/me",component:Ts,name:"me"},{path:"/organizations/:oid",children:[{path:"datasets",component:us,props:!0,name:"organization-datasets"},{path:"reuses",component:Cs,props:!0,name:"organization-reuses"},{path:"discussions",component:kn,props:!0,name:"organization-discussions"},{path:"members",component:Da,props:!0,name:"organization-members"},{path:"harvesters",component:On,props:!0,name:"organization-harvesters"},{path:"profile",component:Xa,props:!0,name:"organization-profile"}]}],Ln=vt({history:ht(),routes:In}),X=Re(eo);yt(X);X.use($t);X.use(wt);X.use(ue);X.use(Ln);X.mount("#admin");globalThis.dsfr.start();console.log("JS is injected !");export{Fn as __vite_legacy_guard};
