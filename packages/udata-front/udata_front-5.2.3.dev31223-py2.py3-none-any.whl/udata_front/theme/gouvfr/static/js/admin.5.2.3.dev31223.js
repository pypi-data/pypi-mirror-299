import{defineComponent as q,openBlock as d,createElementBlock as y,Fragment as P,createVNode as n,mergeProps as de,createElementVNode as t,toDisplayString as o,unref as e,renderSlot as F,normalizeClass as X,ref as w,onMounted as x,createBlock as C,withCtx as u,createCommentVNode as S,computed as B,createTextVNode as $,renderList as E,readonly as Ae,watchEffect as J,resolveComponent as O,watchPostEffect as Ce,Teleport as oe,withModifiers as se,createApp as Se}from"vue";import{E as ae,y as T,C as j,bn as De,I as U,_ as K,b as ge,bo as Re,e as ve,ah as Q,z as G,K as H,D as qe,G as L,b7 as ee,bp as Me,bq as Te,aq as he,bb as Pe,br as Be,bs as Oe,am as Ie,L as ne,ac as Le,bt as Fe,aO as ue,b2 as je,bu as Ue,bv as ye,W as Y,a6 as He,aL as $e,bw as Ne,ar as Ee,Y as re,a0 as Ve,bx as We,by as Ye,aF as Ge,bz as Je,bA as me,bB as Ke,bC as Qe,bD as Ze,bE as Xe,bF as xe,bG as et,b6 as tt,bH as st,bI as ot,a as te,bJ as at,bK as nt,bL as rt,bM as lt,a7 as we,bN as it,bO as dt,bP as ke,bd as ut,bg as ie,aN as ct,bh as ft,bi as _t,bj as mt,bQ as pt,bR as bt,bk as gt,bl as vt,bm as ht}from"./sentry.5.2.3.dev31223.js";import"vue-content-loader";import"./_commonjsHelpers.5.2.3.dev31223.js";function In(){import.meta.url,import("_").catch(()=>1);async function*f(){}}const yt={class:"fr-ml-1v fr-text--bold"},$t=q({__name:"AvatarWithName",props:{user:{},size:{default:12}},setup(f){return(s,a)=>(d(),y(P,null,[n(ae,de(s.$attrs,{user:s.user,size:s.size,rounded:!0}),null,16,["user","size"]),t("span",yt,o(s.user.first_name)+" "+o(s.user.last_name),1)],64))}}),wt=["aria-label"],kt={class:"fr-breadcrumb__list"},V={__name:"Breadcrumb",setup(f){const{t:s}=T();return(a,p)=>(d(),y("nav",{rol:"navigation","aria-label":e(s)("You're here:"),class:"fr-breadcrumb fr-mb-5v"},[t("ol",kt,[F(a.$slots,"default")])],8,wt))}},zt={class:"fr-text--sm fr-my-0"},At={class:"fr-grid-row fr-grid-row--right not-enlarged"},Ct=["href","title"],St=q({__name:"QualityScoreTooltipContent",props:{dataset:{}},setup(f){const{t:s}=T();return(a,p)=>(d(),y(P,null,[t("h5",zt,o(e(s)("Metadata quality:")),1),n(e(j),{passed:a.dataset.quality.dataset_description_quality,messagePassed:e(s)("Data description filled"),messageFailed:e(s)("Data description empty"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),n(e(j),{passed:a.dataset.quality.resources_documentation,messagePassed:e(s)("Files documented"),messageFailed:e(s)("Files documentation missing"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),n(e(j),{passed:a.dataset.quality.license,messagePassed:e(s)("License filled"),messageFailed:e(s)("No license set"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),n(e(j),{passed:a.dataset.quality.update_frequency&&!!a.dataset.quality.update_fulfilled_in_time,messagePassed:e(s)("Update frequency followed"),messageFailed:a.dataset.quality.update_frequency?e(s)("Update frequency not followed"):e(s)("Update frequency not set"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),n(e(j),{passed:a.dataset.quality.has_open_format,messagePassed:e(s)("File formats are open"),messageFailed:e(s)("File formats are closed"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),n(e(j),{passed:a.dataset.quality.temporal_coverage,messagePassed:e(s)("Temporal coverage filled"),messageFailed:e(s)("Temporal coverage not set"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),n(e(j),{passed:a.dataset.quality.spatial,messagePassed:e(s)("Spatial coverage filled"),messageFailed:e(s)("Spatial coverage not set"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),n(e(j),{passed:a.dataset.quality.all_resources_available,messagePassed:e(s)("All files are available"),messageFailed:e(s)("Some files are unavailable"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),t("div",At,[t("a",{href:e(De),target:"_blank",rel:"noopener",title:e(s)("Learn more about this indicator - opens a new window")},o(e(s)("Learn more about this indicator")),9,Ct)])],64))}}),ce=q({__name:"AdminBadge",props:{type:{}},setup(f){return(s,a)=>(d(),y("p",{class:X(["fr-badge",{"fr-badge--blue-cumulus":s.type==="info","fr-badge--error fr-badge--no-icon":s.type==="error","fr-badge--warning fr-badge--no-icon":s.type==="warning","fr-badge--success fr-badge--no-icon":s.type==="success"}])},[F(s.$slots,"default")],2))}}),Dt=["aria-describedby"],Rt=["id"],qt=q({inheritAttrs:!1,__name:"AdminContentWithTooltip",setup(f){const s=U(),a=w(),p=w("");return x(()=>{a.value&&(p.value=a.value.textContent||"")}),(r,l)=>(d(),y(P,null,[t("p",de(r.$attrs,{"aria-describedby":e(s),ref_key:"contentRef",ref:a}),[F(r.$slots,"default",{},void 0,!0)],16,Dt),t("span",{class:"fr-hidden-xl fr-tooltip fr-placement",id:e(s),role:"tooltip","aria-hidden":"true"},o(p.value),9,Rt)],64))}});const fe=K(qt,[["__scopeId","data-v-d192f17a"]]),Mt=q({__name:"AdminLoader",props:{scale:{default:4}},setup(f){return ge(Re),(s,a)=>(d(),C(e(ve),{name:"ri-loader-5-line",animation:"spin",scale:s.scale,fill:"var(--blue-cumulus-sun-368-moon-732)"},null,8,["scale"]))}}),Tt={class:"fr-table fr-mb-2w"},Pt=q({__name:"AdminTable",props:{loading:{type:Boolean,default:!1}},setup(f){return(s,a)=>(d(),y("div",Tt,[t("table",null,[F(s.$slots,"default",{},void 0,!0)]),s.loading?(d(),C(Q,{key:0,class:"fr-p-4w text-align-center"},{default:u(()=>[n(Mt)]),_:1})):S("",!0)]))}});const le=K(Pt,[["__scopeId","data-v-cae574a4"]]),Bt={class:"fr-text--bold"},Ot={key:1,class:"fr-grid-row fr-grid-row--middle justify-between"},It=["title"],Lt=q({__name:"AdminTableTh",props:{sorted:{}},emits:["sort"],setup(f,{emit:s}){const a=f,p=s,{t:r}=T(),l=B(()=>a.sorted!==void 0);function i(){return a.sorted==="desc"?p("sort","asc"):p("sort","desc")}return(c,_)=>(d(),y("th",Bt,[l.value?(d(),y("div",Ot,[F(c.$slots,"default",{},void 0,!0),t("button",{class:X(["fr-ml-1w fr-btn fr-btn--sm fr-btn--tertiary-no-outline",{"fr-icon-arrow-down-line":!c.sorted||c.sorted==="asc","fr-icon-arrow-up-line":c.sorted==="desc","text-grey-500":c.sorted,"text-mention-grey":!c.sorted}]),onClick:i,title:e(r)("Sort")},o(e(r)("Sort")),11,It)])):F(c.$slots,"default",{key:0},void 0,!0)]))}});const D=K(Lt,[["__scopeId","data-v-5acf0bf0"]]),Ft=["aria-describedby"],jt=["id"],I=q({__name:"Tooltip",setup(f){const s=U("tooltip");return(a,p)=>(d(),y(P,null,[t("p",de(a.$attrs,{"aria-describedby":e(s)}),[F(a.$slots,"default")],16,Ft),t("span",{class:"fr-tooltip fr-placement",id:e(s),role:"tooltip","aria-hidden":"true"},[F(a.$slots,"tooltip")],8,jt)],64))}}),Ut=["href"],Ht={class:"monospace"},Nt={class:"monospace"},Et={class:"monospace"},Vt={class:"monospace"},Wt={class:"monospace"},Yt=q({__name:"AdminDatasetsTable",props:{datasets:{},loading:{type:Boolean},sortDirection:{},sortedBy:{}},emits:["sort"],setup(f,{emit:s}){const a=s,p=f,{t:r}=T();function l(g,b){a("sort",g,b)}function i(g){return p.sortedBy===g?p.sortDirection:null}function c(g){return Array.isArray(g.resources)?g.resources.length:g.resources.total}function _(g){return"".concat(ee,"dataset/").concat(g.id,"/")}function z(g){return g.deleted?{label:r("Deleted"),type:"error"}:g.archived?{label:r("Archived"),type:"warning"}:g.private?{label:r("Private"),type:"default"}:{label:r("Public"),type:"info"}}return(g,b)=>(d(),C(le,{loading:g.loading},{default:u(()=>[t("thead",null,[t("tr",null,[n(D,{onSort:b[0]||(b[0]=m=>l("title",m)),sorted:i("title"),scope:"col"},{default:u(()=>[$(o(e(r)("Title of the dataset")),1)]),_:1},8,["sorted"]),n(D,{scope:"col"},{default:u(()=>[$(o(e(r)("Status")),1)]),_:1}),n(D,{onSort:b[1]||(b[1]=m=>l("created",m)),sorted:i("created"),scope:"col"},{default:u(()=>[$(o(e(r)("Created at")),1)]),_:1},8,["sorted"]),n(D,{onSort:b[2]||(b[2]=m=>l("last_update",m)),sorted:i("last_update"),scope:"col"},{default:u(()=>[$(o(e(r)("Updated at")),1)]),_:1},8,["sorted"]),n(D,{scope:"col"},{default:u(()=>[$(o(e(r)("Files")),1)]),_:1}),n(D,{scope:"col"},{default:u(()=>[$(o(e(r)("Score")),1)]),_:1}),n(D,{scope:"col"},{default:u(()=>[n(I,null,{tooltip:u(()=>[$(o(e(r)("Discussions")),1)]),default:u(()=>[b[6]||(b[6]=t("span",{class:"fr-icon--sm fr-icon-chat-3-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1}),n(D,{onSort:b[3]||(b[3]=m=>l("views",m)),sorted:i("views"),scope:"col"},{default:u(()=>[n(I,null,{tooltip:u(()=>[$(o(e(r)("Views")),1)]),default:u(()=>[b[7]||(b[7]=t("span",{class:"fr-icon--sm fr-icon-eye-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1},8,["sorted"]),n(D,{scope:"col"},{default:u(()=>[n(I,null,{tooltip:u(()=>[$(o(e(r)("Downloads")),1)]),default:u(()=>[b[8]||(b[8]=t("span",{class:"fr-icon--sm fr-icon-download-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1}),n(D,{onSort:b[4]||(b[4]=m=>l("reuses",m)),sorted:i("reuses"),scope:"col"},{default:u(()=>[n(I,null,{tooltip:u(()=>[$(o(e(r)("Reuses")),1)]),default:u(()=>[b[9]||(b[9]=t("span",{class:"fr-icon--sm fr-icon-line-chart-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1},8,["sorted"]),n(D,{onSort:b[5]||(b[5]=m=>l("followers",m)),sorted:i("followers"),scope:"col"},{default:u(()=>[n(I,null,{tooltip:u(()=>[$(o(e(r)("Favorites")),1)]),default:u(()=>[b[10]||(b[10]=t("span",{class:"fr-icon--sm fr-icon-star-s-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1},8,["sorted"])])]),t("tbody",null,[(d(!0),y(P,null,E(g.datasets,m=>{var v;return d(),y("tr",{key:m.id},[t("td",null,[n(fe,null,{default:u(()=>[t("a",{class:"fr-link fr-reset-link",href:_(m)},[n(e(G),{text:m.title,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,Ut)]),_:2},1024)]),t("td",null,[n(ce,{type:z(m).type},{default:u(()=>[$(o(z(m).label),1)]),_:2},1032,["type"])]),t("td",null,o(e(H)(m.created_at)),1),t("td",null,o(e(H)(m.last_modified)),1),t("td",null,o(c(m)),1),t("td",null,[n(I,null,{tooltip:u(()=>[n(St,{dataset:m},null,8,["dataset"])]),default:u(()=>[n(e(qe),{class:"w-100",score:m.quality.score},null,8,["score"])]),_:2},1024)]),t("td",Ht,o(e(L)(m.metrics.discussions)),1),t("td",Nt,o(e(L)(m.metrics.views)),1),t("td",Et,o(e(L)((v=m.metrics.resources_downloads)!=null?v:0)),1),t("td",Vt,o(e(L)(m.metrics.reuses)),1),t("td",Wt,o(e(L)(m.metrics.followers)),1)])}),128))])]),_:1},8,["loading"]))}}),pe=w(null);function W(){const f=s=>{pe.value=s};return{currentOrganization:Ae(pe),setCurrentOrganization:f}}const Gt="/_themes/gouvfr/assets/logotype-white.svg",Jt=["href"],Kt=["src","alt"],_e=q({__name:"AdminPublishButton",props:{type:{}},setup(f){const s=f,{t:a}=T(),p=B(()=>{switch(s.type){case"dataset":return Te;case"harvester":return"".concat(ee,"harvester/new/");case"reuse":return Me}});return(r,l)=>(d(),y("a",{href:p.value,class:"fr-btn fr-icon-add-line fr-btn--icon-left"},[$(o(e(a)("Publish on"))+" ",1),t("img",{class:"fr-ml-1v",src:e(Gt),loading:"lazy",alt:e(he)},null,8,Kt)],8,Jt))}}),Qt={key:0},Zt={class:"fr-breadcrumb__link","aria-current":"page"},Xt={class:"fr-h3 fr-mb-5v"},xt={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},es={class:"fr-col"},ts={class:"subtitle subtitle--uppercase fr-m-0"},ss={key:0,class:"fr-col-auto fr-grid-row fr-grid-row--middle"},os=["href"],as={class:"text-align-center fr-py-1w"},ns=["src"],rs={class:"fr-text--bold fr-my-3v"},ls=q({__name:"Datasets",props:{oid:{}},setup(f){const{t:s}=T(),a=f,p=w([]),r=w(!1),l=w(1),i=w(10),c=w(0),_=w("created"),z=w("desc"),g=B(()=>"".concat(z.value==="asc"?"":"-").concat(_.value)),b=w(""),m=Pe(b,Le),{currentOrganization:v}=W();function k(h,A){_.value=h,z.value=A}return J(async()=>{r.value=!0,p.value=[];try{const h=await Be(a.oid,m.value,l.value,i.value,g.value);p.value=h.data,l.value=h.page,i.value=h.page_size,c.value=h.total}finally{r.value=!1}}),(h,A)=>{const M=O("router-link");return d(),y("div",null,[n(V,null,{default:u(()=>[t("li",null,[n(M,{class:"fr-breadcrumb__link",to:"/"},{default:u(()=>[$(o(e(s)("Administration")),1)]),_:1})]),e(v)?(d(),y("li",Qt,[n(M,{class:"fr-breadcrumb__link",to:"/"},{default:u(()=>[$(o(e(v).name),1)]),_:1})])):S("",!0),t("li",null,[t("a",Zt,o(e(s)("Datasets")),1)])]),_:1}),t("h1",Xt,o(e(s)("Datasets")),1),t("div",xt,[t("div",es,[t("h2",ts,o(e(s)("{n} datasets",c.value)),1)]),c.value?(d(),y("div",ss,[t("div",null,[t("a",{href:e(Oe)(h.oid),class:"fr-btn fr-btn--sm fr-icon-download-line fr-btn--icon-left"},o(e(s)("Download catalog")),9,os)])])):S("",!0)]),r.value||c.value>0?(d(),C(Yt,{key:0,datasets:p.value,loading:r.value,"sort-direction":z.value,sortedBy:_.value,onSort:k},null,8,["datasets","loading","sort-direction","sortedBy"])):(d(),C(Q,{key:1,class:"fr-my-2w"},{default:u(()=>[t("div",as,[t("img",{src:e(Ie),alt:"",loading:"lazy"},null,8,ns),t("p",rs,o(e(s)("You haven't published a dataset yet")),1),n(_e,{type:"dataset"})])]),_:1})),c.value>i.value?(d(),C(e(ne),{key:2,page:l.value,"page-size":i.value,"total-results":c.value,onChange:A[0]||(A[0]=R=>l.value=R)},null,8,["page","page-size","total-results"])):S("",!0)])}}}),is=["href"],ds={class:"monospace"},us={class:"monospace"},cs={class:"monospace"},fs={class:"monospace"},_s=q({__name:"AdminReusesTable",props:{reuses:{},loading:{type:Boolean},sortedBy:{},sortDirection:{}},emits:["sort"],setup(f){const s=f,{t:a}=T();function p(i){return s.sortedBy===i?s.sortDirection:null}function r(i){return"".concat(ee,"reuse/").concat(i.id,"/")}function l(i){return i.deleted?{label:a("Deleted"),type:"error"}:i.archived?{label:a("Archived"),type:"warning"}:i.private?{label:a("Private"),type:"default"}:{label:a("Public"),type:"info"}}return(i,c)=>(d(),C(le,{loading:i.loading},{default:u(()=>[t("thead",null,[n(D,{onSort:c[0]||(c[0]=_=>i.$emit("sort","title",_)),sorted:p("title"),scope:"col"},{default:u(()=>[$(o(e(a)("Reuse title")),1)]),_:1},8,["sorted"]),n(D,null,{default:u(()=>[$(o(e(a)("Status")),1)]),_:1}),n(D,{onSort:c[1]||(c[1]=_=>i.$emit("sort","created",_)),sorted:p("created"),scope:"col"},{default:u(()=>[$(o(e(a)("Created at")),1)]),_:1},8,["sorted"]),n(D,{onSort:c[2]||(c[2]=_=>i.$emit("sort","datasets",_)),sorted:p("datasets"),scope:"col"},{default:u(()=>[$(o(e(a)("Datasets")),1)]),_:1},8,["sorted"]),n(D,{scope:"col"},{default:u(()=>[n(I,null,{tooltip:u(()=>[$(o(e(a)("Discussions")),1)]),default:u(()=>[c[5]||(c[5]=t("span",{class:"fr-icon--sm fr-icon-chat-3-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1}),n(D,{onSort:c[3]||(c[3]=_=>i.$emit("sort","views",_)),sorted:p("views"),scope:"col"},{default:u(()=>[n(I,null,{tooltip:u(()=>[$(o(e(a)("Views")),1)]),default:u(()=>[c[6]||(c[6]=t("span",{class:"fr-icon--sm fr-icon-eye-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1},8,["sorted"]),n(D,{onSort:c[4]||(c[4]=_=>i.$emit("sort","followers",_)),sorted:p("followers"),scope:"col"},{default:u(()=>[n(I,null,{tooltip:u(()=>[$(o(e(a)("Favorites")),1)]),default:u(()=>[c[7]||(c[7]=t("span",{class:"fr-icon--sm fr-icon-star-s-line","aria-hidden":"true"},null,-1))]),_:1})]),_:1},8,["sorted"])]),t("tbody",null,[(d(!0),y(P,null,E(i.reuses,_=>(d(),y("tr",null,[t("td",null,[n(fe,null,{default:u(()=>[t("a",{class:"fr-link fr-reset-link",href:r(_)},[n(e(G),{text:_.title,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,is)]),_:2},1024)]),t("td",null,[n(ce,{type:l(_).type},{default:u(()=>[$(o(l(_).label),1)]),_:2},1032,["type"])]),t("td",null,o(e(H)(_.created_at)),1),t("td",ds,o(e(L)(_.datasets.length)),1),t("td",us,o(e(L)(_.metrics.discussions)),1),t("td",cs,o(e(L)(_.metrics.views)),1),t("td",fs,o(e(L)(_.metrics.followers)),1)]))),256))])]),_:1},8,["loading"]))}}),ms="/_themes/gouvfr/assets/reuse2.svg",ps={class:"fr-container--fluid"},bs={key:0},gs={class:"fr-breadcrumb__link","aria-current":"page"},vs={class:"fr-h3"},hs={class:"subtitle subtitle--uppercase"},ys={class:"text-align-center fr-py-1w"},$s=["src"],ws={class:"fr-text--bold fr-my-3v"},ks=q({__name:"Reuses",props:{oid:{}},setup(f){const{t:s}=T(),a=f,p=w([]),r=w(!1),l=w(1),i=w(10),c=w(0),_=w("created"),z=w("desc"),g=B(()=>"".concat(z.value==="asc"?"":"-").concat(_.value)),{currentOrganization:b}=W();function m(v,k){_.value=v,z.value=k}return J(async()=>{r.value=!0,p.value=[];try{const v=await Fe(a.oid,l.value,i.value,g.value);p.value=v.data,l.value=v.page,i.value=v.page_size,c.value=v.total}finally{r.value=!1}}),(v,k)=>{const h=O("router-link");return d(),y("div",ps,[n(V,null,{default:u(()=>[t("li",null,[n(h,{class:"fr-breadcrumb__link",to:"/"},{default:u(()=>[$(o(e(s)("Administration")),1)]),_:1})]),e(b)?(d(),y("li",bs,[n(h,{class:"fr-breadcrumb__link",to:"/"},{default:u(()=>[$(o(e(b).name),1)]),_:1})])):S("",!0),t("li",null,[t("a",gs,o(e(s)("Reuses")),1)])]),_:1}),t("h1",vs,o(e(s)("Reuses")),1),t("h2",hs,o(e(s)("{n} reuses of your organization",p.value.length)),1),r.value||c.value>0?(d(),C(_s,{key:0,reuses:p.value,loading:r.value,sortDirection:z.value,sortedBy:_.value,onSort:m},null,8,["reuses","loading","sortDirection","sortedBy"])):(d(),C(Q,{key:1,class:"fr-mt-1w fr-mb-2w"},{default:u(()=>[t("div",ys,[t("img",{src:e(ms),alt:"",loading:"lazy"},null,8,$s),t("p",ws,o(e(s)("You haven't published a reuse yet")),1),n(_e,{type:"reuse"})])]),_:1})),c.value>i.value?(d(),C(e(ne),{key:2,page:l.value,"page-size":i.value,"total-results":c.value,onChange:k[0]||(k[0]=A=>l.value=A)},null,8,["page","page-size","total-results"])):S("",!0)])}}}),zs={class:"fr-breadcrumb__link","aria-current":"page"},As={key:0,class:"fr-h1"},Cs={class:"fr-alert fr-alert--info"},Ss={class:"fr-alert__title"},Ds={href:"/admin/me/"},Rs=q({__name:"Me",setup(f){const{t:s}=T(),a=w(null);return x(async()=>a.value=await ue()),(p,r)=>{const l=O("router-link");return d(),y("div",null,[n(V,null,{default:u(()=>[t("li",null,[n(l,{class:"fr-breadcrumb__link",to:"/"},{default:u(()=>[$(o(e(s)("Administration")),1)]),_:1})]),t("li",null,[t("a",zs,o(e(s)("Me")),1)])]),_:1}),a.value?(d(),y("h1",As,o(a.value.first_name)+" "+o(a.value.last_name),1)):S("",!0),t("div",Cs,[t("h3",Ss,o(e(s)("This is a WIP page")),1),t("p",null,[t("a",Ds,o(e(s)("You can edit your profil on the current admin.")),1)])])])}}}),qs='<svg width="24" height="24" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M5 12V18C5 18 5 21 12 21C19 21 19 18 19 18V12" stroke="currentColor" stroke-width="1.5"/>\n<path d="M5 6V12C5 12 5 15 12 15C19 15 19 12 19 12V6" stroke="currentColor" stroke-width="1.5"/>\n<path d="M12 3C19 3 19 6 19 6C19 6 19 9 12 9C5 9 5 6 5 6C5 6 5 3 12 3Z" stroke="currentColor" stroke-width="1.5"/>\n</svg>\n',Ms={class:"fr-sidemenu__item"},Ts=["innerHTML"],Ps=q({__name:"AdminSidebarLink",props:{label:{},icon:{},iconHtml:{},to:{}},setup(f){return(s,a)=>{const p=O("router-link");return d(),y("li",Ms,[t("div",{class:X([{"fr-icon-svg fr-icon--sm":s.iconHtml},"fr-enlarge-link fr-sidemenu__link fr-mb-1w"])},[s.iconHtml?(d(),y("div",{key:0,class:"fr-mr-1w fr-grid-row",innerHTML:s.iconHtml},null,8,Ts)):s.icon?(d(),y("div",{key:1,class:X([s.icon,"fr-mr-1w fr-icon--sm"]),"aria-hidden":"true"},null,2)):S("",!0),n(p,{to:s.to},{default:u(()=>[$(o(s.label),1)]),_:1},8,["to"])],2)])}}});const N=K(Ps,[["__scopeId","data-v-5e2ff0a8"]]),Bs=["aria-expanded","aria-controls","aria-current"],Os={class:"fr-mx-1w"},Is={class:"logo logo--sm"},Ls={class:"fr-mx-1w fr-col text-overflow-ellipsis"},Fs=["id"],js={class:"fr-sidemenu__list fr-mx-1w fr-my-3v"},Us=q({__name:"AdminSidebarMenu",props:{user:{},organization:{},isOpened:{type:Boolean}},emits:["open","click"],setup(f){const s=f,{t:a}=T(),p=U("menu");function r(l,i){const c=document.getElementById(p);i(c)&&(l?i(c).collapse.disclose():i(c).collapse.conceal())}return Ce(()=>{setTimeout(()=>{r(s.isOpened,globalThis.dsfr)},200)}),(l,i)=>(d(),y("li",{class:X(["fr-sidemenu__item",{"fr-sidemenu__item--active":l.isOpened}])},[t("button",{class:"fr-sidemenu__btn","aria-expanded":l.isOpened,"aria-controls":e(p),"aria-current":l.isOpened,onClick:i[0]||(i[0]=c=>l.$emit("open"))},[l.user?(d(),y(P,{key:0},[l.user?(d(),C(e(ae),{key:0,user:l.user,size:24,rounded:!0},null,8,["user"])):S("",!0),t("p",Os,o(e(a)("My Profil")),1)],64)):l.organization?(d(),y(P,{key:1},[t("div",Is,[n(je,{type:"organization",src:l.organization.logo_thumbnail,size:20},null,8,["src"])]),t("p",Ls,o(l.organization.name),1)],64)):S("",!0)],8,Bs),t("div",{class:"fr-collapse","data-fr-js-collapse":"",id:e(p)},[t("ul",js,[l.user?(d(),C(N,{key:0,icon:"fr-icon-account-circle-line",label:e(a)("Me"),to:"/me"},null,8,["label"])):l.organization?(d(),y(P,{key:1},[n(N,{iconHtml:e(qs),label:e(a)("Datasets"),to:{name:"organization-datasets",params:{oid:l.organization.id}},onClick:i[1]||(i[1]=c=>l.$emit("click"))},null,8,["iconHtml","label","to"]),n(N,{icon:"fr-icon-line-chart-line",label:e(a)("Reuses"),to:{name:"organization-reuses",params:{oid:l.organization.id}},onClick:i[2]||(i[2]=c=>l.$emit("click"))},null,8,["label","to"]),n(N,{icon:"fr-icon-chat-3-line",label:e(a)("Discussions"),to:{name:"organization-discussions",params:{oid:l.organization.id}},onClick:i[3]||(i[3]=c=>l.$emit("click"))},null,8,["label","to"]),n(N,{icon:"fr-icon-parent-line",label:e(a)("Members"),to:{name:"organization-members",params:{oid:l.organization.id}}},null,8,["label","to"]),n(N,{icon:"fr-icon-server-line",label:e(a)("Harvesters"),to:{name:"organization-harvesters",params:{oid:l.organization.id}},onClick:i[4]||(i[4]=c=>l.$emit("click"))},null,8,["label","to"]),n(N,{icon:"fr-icon-user-line",label:e(a)("Profile"),to:{name:"organization-profile",params:{oid:l.organization.id}}},null,8,["label","to"])],64)):S("",!0)])],8,Fs)],2))}});const be=K(Us,[["__scopeId","data-v-e84561ef"]]),Hs={class:"fr-container--fluid h-100"},Ns={class:"fr-grid-row h-100 bg-grey-50"},Es={class:"fr-col-12 fr-col-md-4 fr-col-lg-3 fr-col-xl-2"},Vs=["aria-label"],Ws={class:"fr-sidemenu__inner"},Ys=["aria-controls"],Gs=["id"],Js={class:"fr-sidemenu__list"},Ks={class:"fr-col-12 fr-col-md-8 fr-col-lg-9 fr-col-xl-10 h-100 fr-px-2w"},Qs=q({__name:"Admin",setup(f){const{t:s}=T(),a=Ue(),p=U("menu"),r=w(null),l=w(),{setCurrentOrganization:i}=W(),c=ye();function _(g){return g===l.value}function z(g){l.value=g.id}return x(async()=>{var g,b;if(r.value=await ue(),a.name||(r.value.organizations.length>0?c.replace({name:"organization-datasets",params:{oid:r.value.organizations[0].id}}):c.replace({name:"me"})),a.name==="me")l.value=(g=Y)==null?void 0:g.id;else if(r.value.organizations.length>0){let m=r.value.organizations[0];a.params.oid&&(m=(b=r.value.organizations.find(v=>v.id===a.params.oid))!=null?b:m),z(m),i(m)}}),(g,b)=>{const m=O("router-view");return d(),y("div",Hs,[t("div",Ns,[t("div",Es,[t("nav",{class:"fr-sidemenu fr-pr-0","aria-label":e(s)("Administration menu")},[t("div",Ws,[t("button",{class:"fr-sidemenu__btn",hidden:"","aria-controls":e(p),"aria-expanded":"false"},o(e(s)("Open menu")),9,Ys),t("div",{class:"fr-collapse",id:e(p)},[t("ul",Js,[e(Y)?(d(),C(be,{key:0,user:e(Y),"is-opened":_(e(Y).id),onOpen:b[0]||(b[0]=v=>z(e(Y)))},null,8,["user","is-opened"])):S("",!0),r.value?(d(!0),y(P,{key:1},E(r.value.organizations,v=>(d(),C(be,{organization:v,"is-opened":_(v.id),onOpen:()=>z(v),onClick:()=>e(i)(v)},null,8,["organization","is-opened","onOpen","onClick"]))),256)):S("",!0)])],8,Gs)])],8,Vs)]),t("div",Ks,[(d(),C(m,{key:e(a).fullPath,class:"fr-container--fluid"}))])])])}}});const Zs=K(Qs,[["__scopeId","data-v-1057ebbe"]]),Xs=["aria-labelledby","id"],xs={class:"fr-container fr-container--fluid fr-container-md"},eo={class:"fr-grid-row fr-grid-row--center"},to={class:"fr-col-12 fr-col-md-8"},so={class:"fr-modal__body"},oo={class:"fr-modal__header"},ao=["title","aria-controls"],no={class:"fr-modal__content"},ro=["id"],lo={class:"fr-modal__footer"},io={class:"fr-btns-group fr-btns-group--right fr-btns-group--sm fr-btns-group--inline-lg fr-btns-group--icon-left"},uo=["disabled"],co=["disabled"],fo=q({__name:"AdminAddMemberModal",props:{id:{},oid:{},roles:{}},emits:["memberAdded"],setup(f,{emit:s}){const a=f,p=s,{t:r}=T(),{toast:l}=re(),i=w(!1),c=w(),_=w("editor"),z=B(()=>"fr-modal-title-user-"+a.id);async function g(){try{i.value=!0,c.value&&(await Ne(a.oid,c.value,_.value),p("memberAdded"),m())}catch(v){l.error(r("An error occurred while update member role."))}finally{i.value=!1}}function b(v){return v.map(k=>{var A;const h={...k,avatar_thumbnail:(A=k.avatar_url)!=null?A:void 0};return{value:h.id,label:h.first_name+" "+h.last_name,image:Ee(h,32)}})}function m(){i.value=!1,c.value=void 0,_.value="editor";const v=document.getElementById(a.id);globalThis.dsfr(v).modal.conceal()}return(v,k)=>(d(),C(oe,{to:"body"},[t("dialog",{"aria-labelledby":z.value,role:"dialog",id:v.id,class:"fr-modal"},[t("div",xs,[t("div",eo,[t("div",to,[t("div",so,[t("div",oo,[t("button",{class:"fr-btn--close fr-btn",title:e(r)("Close the modal dialog"),"aria-controls":v.id},o(e(r)("Close")),9,ao)]),t("form",{onSubmit:se(g,["prevent"])},[t("div",no,[t("h1",{id:z.value,class:"fr-modal__title fr-mb-2w"},o(e(r)("Add member to the organization")),9,ro),n(He,{placeholder:v.$t("Search a user"),searchPlaceholder:v.$t("Search a user..."),suggestUrl:"/users/suggest/",values:c.value,onChange:k[0]||(k[0]=h=>c.value=h),allOption:v.$t("Select a user"),addAllOption:!1,onSuggest:b,roundedImages:!0},null,8,["placeholder","searchPlaceholder","values","allOption"]),v.roles.length>0?(d(),C($e,{key:0,label:e(r)("Role of the member"),"model-value":_.value,"onUpdate:modelValue":k[1]||(k[1]=h=>_.value=h),options:v.roles},null,8,["label","model-value","options"])):S("",!0)]),t("div",lo,[t("div",io,[t("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary-grey-500",type:"button",onClick:m,disabled:i.value},o(e(r)("Cancel")),9,uo),t("button",{class:"fr-btn",type:"submit",disabled:i.value},o(e(r)("Add to the organization")),9,co)])])],32)])])])])],8,Xs)]))}}),_o=["aria-controls"],mo=q({__name:"AdminAddMemberButton",props:{oid:{},roles:{}},emits:["memberAdded"],setup(f){const s=f,{t:a}=T(),p=B(()=>"fr-modal-add-user-"+s.oid);return(r,l)=>(d(),y(P,null,[t("button",{class:"fr-btn fr-btn--sm fr-btn--icon-left fr-icon-add-line","data-fr-opened":"false","aria-controls":p.value},o(e(a)("Add member")),9,_o),n(fo,{id:p.value,oid:r.oid,roles:r.roles,onMemberAdded:l[0]||(l[0]=i=>r.$emit("memberAdded"))},null,8,["id","oid","roles"])],64))}}),po={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},ze=q({__name:"AdminDangerZone",setup(f){return(s,a)=>(d(),C(e(Ve),{color:"error",type:"secondary",weight:"regular"},{default:u(()=>[t("div",po,[F(s.$slots,"default")])]),_:3}))}}),bo=["aria-labelledby","id"],go={class:"fr-container fr-container--fluid fr-container-md"},vo={class:"fr-grid-row fr-grid-row--center"},ho={class:"fr-col-12 fr-col-md-8"},yo={class:"fr-modal__body"},$o={class:"fr-modal__header"},wo=["title","aria-controls"],ko={class:"fr-modal__content"},zo=["id"],Ao={class:"fr-grid-row fr-grid-row--middle fr-text--bold fr-mb-2w"},Co={class:"fr-col"},So={class:"fr-col-auto"},Do=["disabled"],Ro={class:"fr-col"},qo={class:"fr-m-0 text-grey-500"},Mo={class:"fr-m-0 fr-text--xs text-default-error"},To={class:"fr-col-auto"},Po=["disabled"],Bo=q({__name:"AdminEditMemberModal",props:{id:{},member:{},oid:{},roles:{}},emits:["memberUpdated"],setup(f,{emit:s}){const a=f,p=s,r=B(()=>"fr-modal-title-user-"+a.id),{t:l}=T(),{toast:i}=re(),c=w(!1);async function _(m){if(!m.newRole){b();return}try{c.value=!0,await We(a.oid,m.user.id,m.newRole),p("memberUpdated"),b()}catch(v){i.error(l("An error occurred while update member role."))}finally{c.value=!1}}async function z(m){try{c.value=!0,await Ye(a.oid,m.user.id),p("memberUpdated")}catch(v){i.error(l("An error occurred while removing this member."))}finally{c.value=!1}}function g(m){return a.roles.map(v=>{const k={...v};return k.value===m&&(k.selected=!0),k})}function b(){c.value=!1;const m=document.getElementById(a.id);globalThis.dsfr(m).modal.conceal()}return(m,v)=>(d(),C(oe,{to:"body"},[t("dialog",{"aria-labelledby":r.value,role:"dialog",id:m.id,class:"fr-modal"},[t("div",go,[t("div",vo,[t("div",ho,[t("div",yo,[t("div",$o,[t("button",{class:"fr-btn--close fr-btn",title:e(l)("Close the modal dialog"),"aria-controls":m.id},o(e(l)("Close")),9,wo)]),t("div",ko,[t("h1",{id:r.value,class:"fr-modal__title fr-mb-2w"},o(e(l)("Edit member")),9,zo),t("p",Ao,[n(e(ae),{class:"fr-mr-1v",user:m.member.user,rounded:!0,size:24},null,8,["user"]),$(" "+o(m.member.user.first_name)+" "+o(m.member.user.last_name),1)]),t("form",{class:"fr-grid-row fr-grid-row--gutters fr-grid-row--bottom",onSubmit:v[1]||(v[1]=se(k=>_(m.member),["prevent"]))},[t("div",Co,[m.roles.length>0?(d(),C($e,{key:0,label:e(l)("Role of the member"),"model-value":m.member.role,"onUpdate:modelValue":v[0]||(v[0]=k=>m.member.newRole=k),options:g(m.member.role)},null,8,["label","model-value","options"])):S("",!0)]),t("div",So,[t("button",{class:"fr-btn",type:"submit",disabled:c.value},o(e(l)("Validate")),9,Do)])],32),n(ze,{class:"fr-mt-2w"},{default:u(()=>[t("div",Ro,[t("p",qo,o(e(l)("Remove member from the organization")),1),t("p",Mo,o(e(l)("Be careful, this action can't be reverse.")),1)]),t("div",To,[t("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error fr-btn--icon-left fr-icon-logout-box-r-line",disabled:c.value,onClick:v[2]||(v[2]=k=>z(m.member))},o(e(l)("Remove member")),9,Po)])]),_:1})])])])])])],8,bo)]))}}),Oo=["aria-controls"],Io=q({__name:"AdminEditMemberButton",props:{member:{},oid:{},roles:{}},emits:["memberUpdated"],setup(f){const s=f,{t:a}=T(),p=B(()=>"fr-modal-user-"+s.member.user.id);return(r,l)=>(d(),y(P,null,[t("button",{class:"fr-btn fr-btn--sm fr-btn--tertiary-no-outline fr-icon-pencil-line","data-fr-opened":"false","aria-controls":p.value},o(e(a)("Edit")),9,Oo),n(Bo,{id:p.value,member:r.member,oid:r.oid,roles:r.roles,onMemberUpdated:l[0]||(l[0]=i=>r.$emit("memberUpdated"))},null,8,["id","member","oid","roles"])],64))}}),Lo={class:"fr-mt-n9v fr-mb-2w"},Fo={class:"fr-badge fr-badge--info fr-badge--no-icon"},jo={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},Uo={class:"fr-col"},Ho={class:"fr-grid-row fr-grid-row--middle"},No={class:"fr-ml-3v fr-mt-1-5v fr-mb-0 filet filet-default-grey fr-text--sm"},Eo={key:0,class:"fr-col-auto fr-grid-row flex-direction-column"},Vo=["disabled"],Wo=["disabled","aria-controls"],Yo=["aria-labelledby","id"],Go={class:"fr-container fr-container--fluid fr-container-md"},Jo={class:"fr-grid-row fr-grid-row--center"},Ko={class:"fr-col-12 fr-col-md-8"},Qo={class:"fr-modal__body"},Zo={class:"fr-modal__header"},Xo=["title","aria-controls"],xo={class:"fr-modal__content"},ea=["id"],ta={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--right"},sa={class:"fr-col-auto"},oa=["disabled"],aa={class:"fr-col-auto"},na=["disabled"],ra=q({__name:"AdminMembershipRequest",props:{loading:{type:Boolean},oid:{},request:{},showActions:{type:Boolean}},emits:["accept","refuse"],setup(f,{emit:s}){const a=f,p=s,{t:r}=T(),l=w(""),i=U("modal"),c=U("modalTitle");function _(){const b=document.getElementById(i);globalThis.dsfr(b).modal.conceal()}function z(){p("refuse",a.request.id,l.value),_()}function g(){l.value="",_()}return(b,m)=>{const v=O("AdminMembershipRequest",!0);return d(),C(Q,{class:"drop-shadow rounded-xxs fr-mt-3w"},{default:u(()=>[t("div",Lo,[t("p",Fo,[m[2]||(m[2]=t("span",{class:"fr-icon-user-add-line fr-icon--sm","aria-hidden":"true"},null,-1)),$(" "+o(e(r)("Membership Request")),1)])]),t("div",jo,[t("div",Uo,[t("div",Ho,[n(e(ae),{class:"fr-mr-1v",user:b.request.user,rounded:!0,size:24},null,8,["user"]),$(" "+o(e(r)("{fullName} asks to join the organization.",{fullName:b.request.user.first_name+" "+b.request.user.last_name})),1)]),t("div",No,o(b.request.comment),1)]),b.showActions?(d(),y("div",Eo,[t("button",{class:"fr-btn fr-btn--sm fr-btn--icon-left fr-mb-1w fr-icon-check-line",onClick:m[0]||(m[0]=k=>b.$emit("accept",b.request.id)),disabled:b.loading,"data-testid":"accept"},o(e(r)("Accept request")),9,Vo),t("button",{class:"fr-btn fr-btn--icon-left fr-btn--sm fr-btn--secondary fr-btn--secondary--error fr-icon-close-line",disabled:b.loading,"data-fr-opened":"false","aria-controls":e(i),"data-testid":"refuse"},o(e(r)("Refuse")),9,Wo),(d(),C(oe,{to:"body"},[t("dialog",{"aria-labelledby":e(c),role:"dialog",id:e(i),class:"fr-modal","data-testid":"modal"},[t("div",Go,[t("div",Jo,[t("div",Ko,[t("div",Qo,[t("div",Zo,[t("button",{class:"fr-btn--close fr-btn",title:e(r)("Close the modal dialog"),"aria-controls":e(i),onClick:se(g,["prevent"])},o(e(r)("Close")),9,Xo)]),t("div",xo,[t("h1",{id:e(c),class:"fr-modal__title fr-mb-2w"},o(e(r)("Refuse membership request")),9,ea),n(v,{class:"fr-mt-4w fr-mb-2w",loading:!1,oid:b.oid,request:b.request,"show-actions":!1},null,8,["oid","request"]),t("form",{onSubmit:se(z,["prevent"]),onReset:g},[n(Ge,{label:e(r)("You can provide the refusal reason:"),modelValue:l.value,"onUpdate:modelValue":m[1]||(m[1]=k=>l.value=k),"data-testid":"comment-group"},null,8,["label","modelValue"]),t("div",ta,[t("div",sa,[t("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary-grey-500",type:"reset",disabled:b.loading,"data-testid":"cancel-modal-button"},o(e(r)("Cancel")),9,oa)]),t("div",aa,[t("button",{class:"fr-btn",type:"submit",disabled:b.loading,"data-testid":"refuse-modal-button"},o(e(r)("Refuse request")),9,na)])])],32)])])])])])],8,Yo)]))])):S("",!0)])]),_:1})}}}),la={key:0},ia={class:"fr-breadcrumb__link","aria-current":"page"},da={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle justify-center"},ua={class:"fr-col-12 fr-col-md"},ca={class:"fr-h1 fr-mb-2w"},fa={key:0,class:"fr-col-auto"},_a={class:"subtitle subtitle--uppercase"},ma={class:"subtitle subtitle--uppercase fr-mt-2w fr-mb-1v"},pa={class:"fr-table fr-table--layout-fixed"},ba={scope:"col"},ga={scope:"col"},va={scope:"col"},ha={scope:"col"},ya={scope:"col"},$a={key:0,scope:"col"},wa={class:"fr-badge"},ka={key:0},za={key:1},Aa={key:0},Ca=q({__name:"Members",props:{oid:{}},setup(f){const s=f,{t:a}=T(),{toast:p}=re(),r=w([]),l=B(()=>Je||_.value.some(h=>{var A;return h.user.id===((A=Y)==null?void 0:A.id)&&h.role==="admin"})),i=w([]),{currentOrganization:c}=W(),_=w([]),z=w(!1);function g(h){var A,M;return(M=(A=i.value.find(R=>R.value===h))==null?void 0:A.label)!=null?M:h}async function b(){const h=await Xe(s.oid);_.value=h.members}async function m(){const h=await me(s.oid);r.value=h}async function v(h){z.value=!0;const A=[];try{await xe(s.oid,h),A.push(m()),A.push(b())}catch(M){p.error(a("An error occurred while accepting this membership."))}finally{Promise.all(A).finally(()=>z.value=!1)}}async function k(h,A){z.value=!0;const M=[];try{await et(s.oid,h,A),M.push(m()),M.push(b())}catch(R){p.error(a("An error occurred while refusing this membership."))}finally{Promise.all(M).finally(()=>z.value=!1)}}return J(()=>{l.value&&me(s.oid).then(h=>r.value=h)}),x(()=>{Ke().then(Qe).then(h=>i.value=h),b()}),(h,A)=>{const M=O("router-link");return d(),y("div",null,[n(V,null,{default:u(()=>[t("li",null,[n(M,{class:"fr-breadcrumb__link",to:"/"},{default:u(()=>[$(o(e(a)("Administration")),1)]),_:1})]),e(c)?(d(),y("li",la,[n(M,{class:"fr-breadcrumb__link",to:"/"},{default:u(()=>[$(o(e(c).name),1)]),_:1})])):S("",!0),t("li",null,[t("a",ia,o(e(a)("Members")),1)])]),_:1}),t("div",da,[t("div",ua,[t("h1",ca,o(e(a)("Members")),1)]),l.value?(d(),y("div",fa,[n(mo,{oid:h.oid,roles:i.value,onMemberAdded:b},null,8,["oid","roles"])])):S("",!0)]),r.value.length?(d(),y(P,{key:0},[t("h2",_a,o(e(a)("{n} requests",{n:r.value.length})),1),(d(!0),y(P,null,E(r.value,R=>(d(),C(ra,{class:"fr-mb-4w",key:R.id,loading:z.value,oid:h.oid,request:R,"show-actions":!0,onAccept:v,onRefuse:k},null,8,["loading","oid","request"]))),128))],64)):S("",!0),t("h2",ma,o(e(a)("{n} members",{n:_.value.length})),1),t("div",pa,[t("table",null,[t("thead",null,[t("tr",null,[t("th",ba,o(e(a)("Members")),1),t("th",ga,o(e(a)("Email")),1),t("th",va,o(e(a)("Status")),1),t("th",ha,o(e(a)("Member since")),1),t("th",ya,o(e(a)("Last connection")),1),l.value?(d(),y("th",$a,o(e(a)("Action")),1)):S("",!0)])]),t("tbody",null,[(d(!0),y(P,null,E(_.value,R=>(d(),y("tr",{key:R.user.id},[t("td",null,o(R.user.first_name)+" "+o(R.user.last_name),1),t("td",null,o(R.user.email),1),t("td",null,[t("p",wa,o(g(R.role)),1)]),t("td",null,o(e(H)(R.since)),1),t("td",null,[R.user.last_login_at?(d(),y("span",ka,o(e(Ze)(R.user.last_login_at)),1)):(d(),y("span",za,o(e(a)("No connection")),1))]),l.value?(d(),y("td",Aa,[n(Io,{member:R,oid:h.oid,roles:i.value,onMemberUpdated:b},null,8,["member","oid","roles"])])):S("",!0)]))),128))])])])])}}}),Sa={class:"fr-container--fluid"},Da={key:0},Ra={class:"fr-breadcrumb__link","aria-current":"page"},qa=["id"],Ma=["disabled","onClick"],Ta={class:"fr-col"},Pa={class:"fr-m-0 text-grey-500"},Ba={class:"fr-m-0 fr-text--xs text-default-error"},Oa={class:"fr-col-auto"},Ia=["disabled","aria-controls"],La=["aria-labelledby","id"],Fa={class:"fr-container fr-container--fluid fr-container-md"},ja={class:"fr-grid-row fr-grid-row--center"},Ua={class:"fr-col-12 fr-col-md-8"},Ha={class:"fr-modal__body"},Na={class:"fr-modal__header"},Ea=["title","aria-controls"],Va={class:"fr-modal__content"},Wa=["id"],Ya={class:"fr-text--bold"},Ga={class:"fr-modal__footer"},Ja={class:"fr-btns-group fr-btns-group--right fr-btns-group--inline-reverse fr-btns-group--inline-lg fr-btns-group--icon-left"},Ka=["disabled"],Qa=q({__name:"Profile",props:{oid:{}},setup(f){const{t:s}=T(),{toast:a}=re(),p=ye(),r=w(null),l=w(null),{currentOrganization:i}=W(),c=w([]),_=w(!1),z=U("modal"),g=U("modalTitle");function b(){i.value&&(_.value=!0,st(i.value.id).then(()=>{p.replace("/"),window.location.reload()}).catch(()=>a.error(s("An error occured when deleting the organization."))).finally(()=>_.value=!1))}function m(v){_.value=!0,ot(v).then(()=>a.success(s("Organization updated !"))).catch(()=>a.error(s("An error occured when updating the organization."))).finally(()=>_.value=!1)}return x(async()=>r.value=await ue()),(v,k)=>{const h=O("router-link");return d(),y("div",Sa,[n(V,null,{default:u(()=>[t("li",null,[n(h,{class:"fr-breadcrumb__link",to:"/"},{default:u(()=>[$(o(e(s)("Administration")),1)]),_:1})]),e(i)?(d(),y("li",Da,[n(h,{class:"fr-breadcrumb__link",to:"/"},{default:u(()=>[$(o(e(i).name),1)]),_:1})])):S("",!0),t("li",null,[t("a",Ra,o(e(s)("Profile")),1)])]),_:1}),l.value?(d(),y("h2",{key:0,class:"subtitle subtitle--uppercase fr-mb-5v",id:l.value.legend},o(e(s)("Edit profile")),9,qa)):S("",!0),e(i)?(d(),C(tt,{key:1,organization:e(i),errors:c.value,showLegend:!1,showWell:!1,ref_key:"form",ref:l,onSubmit:m},{submitButton:u(({submit:A})=>[t("button",{class:"fr-btn fr-btn--icon-left fr-icon-save-line",disabled:_.value,"data-testid":"submitButton",onClick:A},o(e(s)("Save")),9,Ma)]),default:u(()=>[n(ze,{class:"fr-mt-6w"},{default:u(()=>[t("div",Ta,[t("p",Pa,o(e(s)("Delete the organization")),1),t("p",Ba,o(e(s)("Be careful, this action can't be reverse.")),1)]),t("div",Oa,[t("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error fr-btn--icon-left fr-icon-delete-line",disabled:_.value,"data-fr-opened":"false","aria-controls":e(z)},o(e(s)("Delete")),9,Ia),(d(),C(oe,{to:"body"},[t("dialog",{"aria-labelledby":e(g),role:"dialog",id:e(z),class:"fr-modal"},[t("div",Fa,[t("div",ja,[t("div",Ua,[t("div",Ha,[t("div",Na,[t("button",{class:"fr-btn--close fr-btn",title:e(s)("Close the modal dialog"),"aria-controls":e(z)},o(e(s)("Close")),9,Ea)]),t("div",Va,[t("h1",{id:e(g),class:"fr-modal__title fr-mb-2w"},o(e(s)("Are you sure you want to delete this organization ?")),9,Wa),t("p",Ya,o(e(s)("This action can't be reverse.")),1),t("p",null,o(e(s)("All content published with this organization will stay online, with the same URL but in an anonymous form, i.e. without being linked to a data producer.")),1),t("p",null,o(e(s)("If you want to delete your published content too, start by deleting the contents before deleting your account.")),1)]),t("div",Ga,[t("div",Ja,[t("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error",role:"button",disabled:_.value,onClick:b},o(e(s)("Delete")),9,Ka)])])])])])])],8,La)]))])]),_:1})]),_:1},8,["organization","errors"])):S("",!0)])}}});async function Za(f){return(await te.get("posts/".concat(f,"/"))).data}async function Xa(f){return(await te.get("dataservices/".concat(f,"/"))).data}ge(lt,rt,nt,at);async function xa(f,s,a,p){return(await te.get(we("discussions/"),{params:{org:f,sort:p,page_size:a,page:s}})).data}async function en(f){switch(f.class){case"Dataservice":return Xa(f.id);case"Dataset":return dt(f.id);case"Post":return Za(f.id);case"Reuse":return it(f.id);default:return null}}function tn(f,s){return f===null?null:{title:sn(f),icon:an(s),page:on(f)}}function sn(f){return f===null?"":"title"in f?f.title:"headline"in f?f.headline:ke(f,"Unknown type ".concat(f))}function on(f){return f===null?"":"page"in f?f.page:"self_web_url"in f?f.self_web_url:ke(f,"Unknown type ".concat(f))}function an(f){switch(f){case"Dataservice":return"ri-terminal-line";case"Dataset":return"ri-database-2-line";case"Post":return"ri-article-line";case"Reuse":return"ri-line-chart-line";default:return""}}const nn={class:"fr-text--bold"},rn={key:0},ln=["href"],dn={class:"inline-flex"},un=["href"],cn=q({__name:"AdminDiscussionsTable",props:{discussions:{},loading:{type:Boolean},sortDirection:{},sortedBy:{}},emits:["sort"],setup(f){const s=f,{t:a}=T(),p=w({}),r=w({});J(async()=>{for(const _ of s.discussions)if(!(_.subject.id in p.value)){const z=en(_.subject);p.value[_.subject.id]=z;const g=await p.value[_.subject.id];r.value[_.subject.id]=tn(g,_.subject.class)}});function l(_,z){return z?z.page+"#/discussions/"+_:""}function i(_){return s.sortedBy===_?s.sortDirection:null}function c(_){return _.discussion.slice(-1)[0]}return(_,z)=>(d(),C(le,{class:"fr-table--layout-fixed",loading:_.loading},{default:u(()=>[t("thead",null,[n(D,{onSort:z[0]||(z[0]=g=>_.$emit("sort","title",g)),sorted:i("title"),scope:"col"},{default:u(()=>[$(o(e(a)("Discussion")),1)]),_:1},8,["sorted"]),n(D,{scope:"col"},{default:u(()=>[$(o(e(a)("Number of comments")),1)]),_:1}),n(D,{scope:"col"},{default:u(()=>[$(o(e(a)("Last comment")),1)]),_:1}),n(D,{onSort:z[1]||(z[1]=g=>_.$emit("sort","closed",g)),sorted:i("closed"),scope:"col"},{default:u(()=>[$(o(e(a)("Closed at")),1)]),_:1},8,["sorted"]),n(D,{scope:"col",style:{width:"25%"}},{default:u(()=>[$(o(e(a)("URL")),1)]),_:1})]),t("tbody",null,[(d(!0),y(P,null,E(_.discussions,g=>{var b,m,v;return d(),y("tr",null,[t("td",null,[t("p",nn,[n(e(G),{text:g.title,"auto-resize":!0,"max-lines":1},null,8,["text"])]),r.value[g.subject.id]?(d(),y("p",rn,[t("a",{class:"fr-link inline-flex",href:(b=r.value[g.subject.id])==null?void 0:b.page},[n(e(ve),{height:12,class:"self-center",name:(m=r.value[g.subject.id])==null?void 0:m.icon},null,8,["name"]),n(e(G),{class:"overflow-wrap-anywhere",text:(v=r.value[g.subject.id])==null?void 0:v.title,"auto-resize":!0,"max-lines":1},null,8,["text"])],8,ln)])):S("",!0)]),t("td",null,o(g.discussion.length),1),t("td",null,[t("div",null,[t("p",null,o(e(H)(c(g).posted_on)),1),t("p",dn,[$(o(e(a)("by "))+" ",1),n(e($t),{class:"fr-ml-1v",user:c(g).posted_by},null,8,["user"])])])]),t("td",null,[g.closed?(d(),y(P,{key:0},[$(o(e(H)(g.closed)),1)],64)):S("",!0)]),t("td",null,[r.value[g.subject.id]?(d(),y("a",{key:0,class:"fr-link inline-flex",href:l(g.id,r.value[g.subject.id]),target:"_blank"},[n(e(G),{text:l(g.id,r.value[g.subject.id]),"auto-resize":!0,"max-lines":1},null,8,["text"])],8,un)):S("",!0)])])}),256))])]),_:1},8,["loading"]))}}),fn="/_themes/gouvfr/assets/discussion.svg",_n={class:"fr-container--fluid"},mn={key:0},pn={class:"fr-breadcrumb__link","aria-current":"page"},bn={class:"fr-h3"},gn={class:"subtitle subtitle--uppercase"},vn={class:"text-align-center fr-py-1w"},hn=["src"],yn={class:"fr-text--bold fr-my-3v"},$n=q({__name:"Discussions",props:{oid:{}},setup(f){const{t:s}=T(),a=f,p=w(!1),r=w(1),l=w(10),i=w(0),c=w("created"),_=w("desc"),z=B(()=>"".concat(_.value==="asc"?"":"-").concat(c.value)),g=w([]),{currentOrganization:b}=W();function m(v,k){c.value=v,_.value=k}return J(async()=>{p.value=!0,g.value=[];try{const v=await xa(a.oid,r.value,l.value,z.value);g.value=v.data,r.value=v.page,l.value=v.page_size,i.value=v.total}finally{p.value=!1}}),(v,k)=>{const h=O("router-link");return d(),y("div",_n,[n(V,null,{default:u(()=>[t("li",null,[n(h,{class:"fr-breadcrumb__link",to:"/"},{default:u(()=>[$(o(e(s)("Administration")),1)]),_:1})]),e(b)?(d(),y("li",mn,[n(h,{class:"fr-breadcrumb__link",to:"/"},{default:u(()=>[$(o(e(b).name),1)]),_:1})])):S("",!0),t("li",null,[t("a",pn,o(e(s)("Discussions")),1)])]),_:1}),t("h1",bn,o(e(s)("Discussions")),1),t("h2",gn,o(e(s)("{n} discussions",i.value)),1),p.value||i.value>0?(d(),C(cn,{key:0,discussions:g.value,loading:p.value,"sort-direction":_.value,sortedBy:c.value,onSort:m},null,8,["discussions","loading","sort-direction","sortedBy"])):(d(),C(Q,{key:1,class:"fr-my-2w"},{default:u(()=>[t("div",vn,[t("img",{src:e(fn),alt:"",loading:"lazy"},null,8,hn),t("p",yn,o(e(s)("There is no discussion yet")),1)])]),_:1})),i.value>l.value?(d(),C(e(ne),{key:2,page:r.value,"page-size":l.value,"total-results":i.value,onChange:k[0]||(k[0]=A=>r.value=A)},null,8,["page","page-size","total-results"])):S("",!0)])}}});async function wn(f,s,a){return(await te.get(we("harvest/sources/"),{params:{owner:f,deleted:!0,page:s,page_size:a}})).data}const kn="/_themes/gouvfr/assets/harvester.svg",zn={class:"fr-container--fluid"},An={key:0},Cn={class:"fr-breadcrumb__link","aria-current":"page"},Sn={class:"fr-h3"},Dn={class:"subtitle subtitle--uppercase"},Rn=["href"],qn={class:"text-align-center fr-py-1w"},Mn=["src"],Tn={class:"fr-text--bold fr-my-3v"},Pn=q({__name:"Harvesters",props:{oid:{}},setup(f){const{t:s}=T(),a=f,p=w(!1),r=w(1),l=w(10),i=w(0),c=w([]),_=w({}),{currentOrganization:z}=W();function g(k){return"".concat(ee,"harvester/").concat(k.id,"/")}function b(k){return k.last_job?_.value[k.last_job.id].items.filter(h=>h.dataservice).length:0}function m(k){return k.last_job?_.value[k.last_job.id].items.filter(h=>h.dataset).length:0}function v(k){var h;switch((h=k.last_job)==null?void 0:h.status){case"pending":return{label:s("Pending"),type:"default"};case"initializing":return{label:s("Initializing"),type:"info"};case"initialized":return{label:s("Initialized"),type:"default"};case"processing":return{label:s("Processing"),type:"info"};case"done":return{label:s("Done"),type:"success"};case"done-errors":return{label:s("Done with errors"),type:"warning"};case"failed":return{label:s("Failed"),type:"error"};default:return{label:s("No job yet"),type:"default"}}}return J(async()=>{var k;p.value=!0,c.value=[];try{const h=await wn(a.oid,r.value,l.value);c.value=h.data,r.value=h.page,l.value=h.page_size,i.value=h.total;const A=[];for(const R of c.value)(k=R.last_job)!=null&&k.id&&A.push(te.get("harvest/job/".concat(R.last_job.id,"/")));const M=await Promise.allSettled(A);for(const R of M)R.status==="fulfilled"&&(console.log(R.value.data),_.value[R.value.data.id]=R.value.data)}finally{p.value=!1}}),(k,h)=>{const A=O("router-link");return d(),y("div",zn,[n(V,null,{default:u(()=>[t("li",null,[n(A,{class:"fr-breadcrumb__link",to:"/"},{default:u(()=>[$(o(e(s)("Administration")),1)]),_:1})]),e(z)?(d(),y("li",An,[n(A,{class:"fr-breadcrumb__link",to:"/"},{default:u(()=>[$(o(e(z).name),1)]),_:1})])):S("",!0),t("li",null,[t("a",Cn,o(e(s)("Harvesters")),1)])]),_:1}),t("h1",Sn,o(e(s)("Harvesters")),1),t("h2",Dn,o(e(s)("{n} harvesters",i.value)),1),p.value||i.value?(d(),C(le,{key:0,loading:p.value},{default:u(()=>[t("thead",null,[n(D,{scope:"col"},{default:u(()=>[$(o(e(s)("Name")),1)]),_:1}),n(D,{scope:"col"},{default:u(()=>[$(o(e(s)("Status")),1)]),_:1}),n(D,{scope:"col"},{default:u(()=>[$(o(e(s)("Created at")),1)]),_:1}),n(D,{scope:"col"},{default:u(()=>[$(o(e(s)("Last run")),1)]),_:1}),n(D,{scope:"col"},{default:u(()=>[$(o(e(s)("Datasets")),1)]),_:1}),n(D,{scope:"col"},{default:u(()=>[$(o(e(s)("Dataservices")),1)]),_:1})]),t("tbody",null,[(d(!0),y(P,null,E(c.value,M=>{var R;return d(),y("tr",null,[t("td",null,[n(fe,null,{default:u(()=>[t("a",{class:"fr-link fr-reset-link",href:g(M)},[n(e(G),{text:M.name,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,Rn)]),_:2},1024)]),t("td",null,[n(ce,{type:v(M).type},{default:u(()=>[$(o(v(M).label),1)]),_:2},1032,["type"])]),t("td",null,o(e(H)(M.created_at)),1),t("td",null,[(R=M.last_job)!=null&&R.ended?(d(),y(P,{key:0},[$(o(e(H)(M.last_job.ended)),1)],64)):(d(),y(P,{key:1},[$(o(e(s)("Not yet")),1)],64))]),t("td",null,o(m(M)),1),t("td",null,o(b(M)),1)])}),256))])]),_:1},8,["loading"])):(d(),C(Q,{key:1,class:"fr-my-2w"},{default:u(()=>[t("div",qn,[t("img",{src:e(kn),alt:"",loading:"lazy"},null,8,Mn),t("p",Tn,o(e(s)("There is no harvesters yet")),1),n(_e,{type:"harvester"})])]),_:1})),i.value>l.value?(d(),C(e(ne),{key:2,page:r.value,"page-size":l.value,"total-results":i.value,onChange:h[0]||(h[0]=M=>r.value=M)},null,8,["page","page-size","total-results"])):S("",!0)])}}});ut({admin_root:ee,default_lang:ie.global.locale.value,only_locales:ie.global.locale.value,schema_documentation_url:ct,schema_validata_url:ft,show_copy_resource_permalink:!0,tabular_api_url:_t,tabular_page_size:mt,title:he});const Bn=[{path:"/me",component:Rs,name:"me"},{path:"/organizations/:oid",children:[{path:"datasets",component:ls,props:!0,name:"organization-datasets"},{path:"reuses",component:ks,props:!0,name:"organization-reuses"},{path:"discussions",component:$n,props:!0,name:"organization-discussions"},{path:"members",component:Ca,props:!0,name:"organization-members"},{path:"harvesters",component:Pn,props:!0,name:"organization-harvesters"},{path:"profile",component:Qa,props:!0,name:"organization-profile"}]}],On=pt({history:bt(),routes:Bn}),Z=Se(Zs);gt(Z);Z.use(vt);Z.use(ht);Z.use(ie);Z.use(On);Z.mount("#admin");globalThis.dsfr.start();console.log("JS is injected !");export{In as __vite_legacy_guard};
