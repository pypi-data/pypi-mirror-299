System.register(["vue","./sentry-legacy.5.2.3.dev31223.js","vue-content-loader","./_commonjsHelpers-legacy.5.2.3.dev31223.js"],(function(e,a){"use strict";var l,t,s,r,o,n,i,d,u,c,f,m,p,b,v,g,_,y,h,w,k,z,x,A,C,$,D,S,P,q,B,j,M,R,T,F,O,U,I,L,E,V,N,H,Y,W,G,J,K,Q,Z,X,ee,ae,le,te,se,re,oe,ne,ie,de,ue,ce,fe,me,pe,be,ve,ge,_e,ye,he,we,ke,ze,xe,Ae,Ce,$e,De,Se,Pe,qe,Be,je,Me,Re,Te,Fe,Oe,Ue,Ie,Le,Ee,Ve;return{setters:[e=>{l=e.defineComponent,t=e.openBlock,s=e.createElementBlock,r=e.Fragment,o=e.createVNode,n=e.mergeProps,i=e.createElementVNode,d=e.toDisplayString,u=e.unref,c=e.renderSlot,f=e.normalizeClass,m=e.ref,p=e.onMounted,b=e.createBlock,v=e.withCtx,g=e.createCommentVNode,_=e.computed,y=e.createTextVNode,h=e.renderList,w=e.readonly,k=e.watchEffect,z=e.resolveComponent,x=e.watchPostEffect,A=e.Teleport,C=e.withModifiers,$=e.createApp},e=>{D=e.E,S=e.y,P=e.C,q=e.bn,B=e.I,j=e._,M=e.b,R=e.bo,T=e.e,F=e.ah,O=e.z,U=e.K,I=e.D,L=e.G,E=e.b7,V=e.bp,N=e.bq,H=e.aq,Y=e.bb,W=e.br,G=e.bs,J=e.am,K=e.L,Q=e.ac,Z=e.bt,X=e.aO,ee=e.b2,ae=e.bu,le=e.bv,te=e.W,se=e.a6,re=e.aL,oe=e.bw,ne=e.ar,ie=e.Y,de=e.a0,ue=e.bx,ce=e.by,fe=e.aF,me=e.bz,pe=e.bA,be=e.bB,ve=e.bC,ge=e.bD,_e=e.bE,ye=e.bF,he=e.bG,we=e.b6,ke=e.bH,ze=e.bI,xe=e.a,Ae=e.bJ,Ce=e.bK,$e=e.bL,De=e.bM,Se=e.a7,Pe=e.bN,qe=e.bO,Be=e.bP,je=e.bd,Me=e.bg,Re=e.aN,Te=e.bh,Fe=e.bi,Oe=e.bj,Ue=e.bQ,Ie=e.bR,Le=e.bk,Ee=e.bl,Ve=e.bm},null,null],execute:function(){const e={class:"fr-ml-1v fr-text--bold"},a=l({__name:"AvatarWithName",props:{user:{},size:{default:12}},setup:a=>(a,l)=>(t(),s(r,null,[o(D,n(a.$attrs,{user:a.user,size:a.size,rounded:!0}),null,16,["user","size"]),i("span",e,d(a.user.first_name)+" "+d(a.user.last_name),1)],64))}),Ne=["aria-label"],He={class:"fr-breadcrumb__list"},Ye={__name:"Breadcrumb",setup(e){const{t:a}=S();return(e,l)=>(t(),s("nav",{rol:"navigation","aria-label":u(a)("You're here:"),class:"fr-breadcrumb fr-mb-5v"},[i("ol",He,[c(e.$slots,"default")])],8,Ne))}},We={class:"fr-text--sm fr-my-0"},Ge={class:"fr-grid-row fr-grid-row--right not-enlarged"},Je=["href","title"],Ke=l({__name:"QualityScoreTooltipContent",props:{dataset:{}},setup(e){const{t:a}=S();return(e,l)=>(t(),s(r,null,[i("h5",We,d(u(a)("Metadata quality:")),1),o(u(P),{passed:e.dataset.quality.dataset_description_quality,messagePassed:u(a)("Data description filled"),messageFailed:u(a)("Data description empty"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),o(u(P),{passed:e.dataset.quality.resources_documentation,messagePassed:u(a)("Files documented"),messageFailed:u(a)("Files documentation missing"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),o(u(P),{passed:e.dataset.quality.license,messagePassed:u(a)("License filled"),messageFailed:u(a)("No license set"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),o(u(P),{passed:e.dataset.quality.update_frequency&&!!e.dataset.quality.update_fulfilled_in_time,messagePassed:u(a)("Update frequency followed"),messageFailed:e.dataset.quality.update_frequency?u(a)("Update frequency not followed"):u(a)("Update frequency not set"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),o(u(P),{passed:e.dataset.quality.has_open_format,messagePassed:u(a)("File formats are open"),messageFailed:u(a)("File formats are closed"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),o(u(P),{passed:e.dataset.quality.temporal_coverage,messagePassed:u(a)("Temporal coverage filled"),messageFailed:u(a)("Temporal coverage not set"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),o(u(P),{passed:e.dataset.quality.spatial,messagePassed:u(a)("Spatial coverage filled"),messageFailed:u(a)("Spatial coverage not set"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),o(u(P),{passed:e.dataset.quality.all_resources_available,messagePassed:u(a)("All files are available"),messageFailed:u(a)("Some files are unavailable"),class:"fr-my-1w"},null,8,["passed","messagePassed","messageFailed"]),i("div",Ge,[i("a",{href:u(q),target:"_blank",rel:"noopener",title:u(a)("Learn more about this indicator - opens a new window")},d(u(a)("Learn more about this indicator")),9,Je)])],64))}}),Qe=l({__name:"AdminBadge",props:{type:{}},setup:e=>(e,a)=>(t(),s("p",{class:f(["fr-badge",{"fr-badge--blue-cumulus":"info"===e.type,"fr-badge--error fr-badge--no-icon":"error"===e.type,"fr-badge--warning fr-badge--no-icon":"warning"===e.type,"fr-badge--success fr-badge--no-icon":"success"===e.type}])},[c(e.$slots,"default")],2))}),Ze=["aria-describedby"],Xe=["id"],ea=j(l({inheritAttrs:!1,__name:"AdminContentWithTooltip",setup(e){const a=B(),l=m(),o=m("");return p((()=>{l.value&&(o.value=l.value.textContent||"")})),(e,f)=>(t(),s(r,null,[i("p",n(e.$attrs,{"aria-describedby":u(a),ref_key:"contentRef",ref:l}),[c(e.$slots,"default",{},void 0,!0)],16,Ze),i("span",{class:"fr-hidden-xl fr-tooltip fr-placement",id:u(a),role:"tooltip","aria-hidden":"true"},d(o.value),9,Xe)],64))}}),[["__scopeId","data-v-d192f17a"]]),aa=l({__name:"AdminLoader",props:{scale:{default:4}},setup:e=>(M(R),(e,a)=>(t(),b(u(T),{name:"ri-loader-5-line",animation:"spin",scale:e.scale,fill:"var(--blue-cumulus-sun-368-moon-732)"},null,8,["scale"])))}),la={class:"fr-table fr-mb-2w"},ta=l({__name:"AdminTable",props:{loading:{type:Boolean,default:!1}},setup:e=>(e,a)=>(t(),s("div",la,[i("table",null,[c(e.$slots,"default",{},void 0,!0)]),e.loading?(t(),b(F,{key:0,class:"fr-p-4w text-align-center"},{default:v((()=>[o(aa)])),_:1})):g("",!0)]))}),sa=j(ta,[["__scopeId","data-v-cae574a4"]]),ra={class:"fr-text--bold"},oa={key:1,class:"fr-grid-row fr-grid-row--middle justify-between"},na=["title"],ia=j(l({__name:"AdminTableTh",props:{sorted:{}},emits:["sort"],setup(e,{emit:a}){const l=e,r=a,{t:o}=S(),n=_((()=>void 0!==l.sorted));function m(){return"desc"===l.sorted?r("sort","asc"):r("sort","desc")}return(e,a)=>(t(),s("th",ra,[n.value?(t(),s("div",oa,[c(e.$slots,"default",{},void 0,!0),i("button",{class:f(["fr-ml-1w fr-btn fr-btn--sm fr-btn--tertiary-no-outline",{"fr-icon-arrow-down-line":!e.sorted||"asc"===e.sorted,"fr-icon-arrow-up-line":"desc"===e.sorted,"text-grey-500":e.sorted,"text-mention-grey":!e.sorted}]),onClick:m,title:u(o)("Sort")},d(u(o)("Sort")),11,na)])):c(e.$slots,"default",{key:0},void 0,!0)]))}}),[["__scopeId","data-v-5acf0bf0"]]),da=["aria-describedby"],ua=["id"],ca=l({__name:"Tooltip",setup(e){const a=B("tooltip");return(e,l)=>(t(),s(r,null,[i("p",n(e.$attrs,{"aria-describedby":u(a)}),[c(e.$slots,"default")],16,da),i("span",{class:"fr-tooltip fr-placement",id:u(a),role:"tooltip","aria-hidden":"true"},[c(e.$slots,"tooltip")],8,ua)],64))}}),fa=["href"],ma={class:"monospace"},pa={class:"monospace"},ba={class:"monospace"},va={class:"monospace"},ga={class:"monospace"},_a=l({__name:"AdminDatasetsTable",props:{datasets:{},loading:{type:Boolean},sortDirection:{},sortedBy:{}},emits:["sort"],setup(e,{emit:a}){const l=a,n=e,{t:c}=S();function f(e,a){l("sort",e,a)}function m(e){return n.sortedBy===e?n.sortDirection:null}function p(e){return Array.isArray(e.resources)?e.resources.length:e.resources.total}function g(e){return`${E}dataset/${e.id}/`}function _(e){return e.deleted?{label:c("Deleted"),type:"error"}:e.archived?{label:c("Archived"),type:"warning"}:e.private?{label:c("Private"),type:"default"}:{label:c("Public"),type:"info"}}return(e,a)=>(t(),b(sa,{loading:e.loading},{default:v((()=>[i("thead",null,[i("tr",null,[o(ia,{onSort:a[0]||(a[0]=e=>f("title",e)),sorted:m("title"),scope:"col"},{default:v((()=>[y(d(u(c)("Title of the dataset")),1)])),_:1},8,["sorted"]),o(ia,{scope:"col"},{default:v((()=>[y(d(u(c)("Status")),1)])),_:1}),o(ia,{onSort:a[1]||(a[1]=e=>f("created",e)),sorted:m("created"),scope:"col"},{default:v((()=>[y(d(u(c)("Created at")),1)])),_:1},8,["sorted"]),o(ia,{onSort:a[2]||(a[2]=e=>f("last_update",e)),sorted:m("last_update"),scope:"col"},{default:v((()=>[y(d(u(c)("Updated at")),1)])),_:1},8,["sorted"]),o(ia,{scope:"col"},{default:v((()=>[y(d(u(c)("Files")),1)])),_:1}),o(ia,{scope:"col"},{default:v((()=>[y(d(u(c)("Score")),1)])),_:1}),o(ia,{scope:"col"},{default:v((()=>[o(ca,null,{tooltip:v((()=>[y(d(u(c)("Discussions")),1)])),default:v((()=>[a[6]||(a[6]=i("span",{class:"fr-icon--sm fr-icon-chat-3-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1}),o(ia,{onSort:a[3]||(a[3]=e=>f("views",e)),sorted:m("views"),scope:"col"},{default:v((()=>[o(ca,null,{tooltip:v((()=>[y(d(u(c)("Views")),1)])),default:v((()=>[a[7]||(a[7]=i("span",{class:"fr-icon--sm fr-icon-eye-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1},8,["sorted"]),o(ia,{scope:"col"},{default:v((()=>[o(ca,null,{tooltip:v((()=>[y(d(u(c)("Downloads")),1)])),default:v((()=>[a[8]||(a[8]=i("span",{class:"fr-icon--sm fr-icon-download-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1}),o(ia,{onSort:a[4]||(a[4]=e=>f("reuses",e)),sorted:m("reuses"),scope:"col"},{default:v((()=>[o(ca,null,{tooltip:v((()=>[y(d(u(c)("Reuses")),1)])),default:v((()=>[a[9]||(a[9]=i("span",{class:"fr-icon--sm fr-icon-line-chart-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1},8,["sorted"]),o(ia,{onSort:a[5]||(a[5]=e=>f("followers",e)),sorted:m("followers"),scope:"col"},{default:v((()=>[o(ca,null,{tooltip:v((()=>[y(d(u(c)("Favorites")),1)])),default:v((()=>[a[10]||(a[10]=i("span",{class:"fr-icon--sm fr-icon-star-s-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1},8,["sorted"])])]),i("tbody",null,[(t(!0),s(r,null,h(e.datasets,(e=>{var a;return t(),s("tr",{key:e.id},[i("td",null,[o(ea,null,{default:v((()=>[i("a",{class:"fr-link fr-reset-link",href:g(e)},[o(u(O),{text:e.title,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,fa)])),_:2},1024)]),i("td",null,[o(Qe,{type:_(e).type},{default:v((()=>[y(d(_(e).label),1)])),_:2},1032,["type"])]),i("td",null,d(u(U)(e.created_at)),1),i("td",null,d(u(U)(e.last_modified)),1),i("td",null,d(p(e)),1),i("td",null,[o(ca,null,{tooltip:v((()=>[o(Ke,{dataset:e},null,8,["dataset"])])),default:v((()=>[o(u(I),{class:"w-100",score:e.quality.score},null,8,["score"])])),_:2},1024)]),i("td",ma,d(u(L)(e.metrics.discussions)),1),i("td",pa,d(u(L)(e.metrics.views)),1),i("td",ba,d(u(L)(null!==(a=e.metrics.resources_downloads)&&void 0!==a?a:0)),1),i("td",va,d(u(L)(e.metrics.reuses)),1),i("td",ga,d(u(L)(e.metrics.followers)),1)])})),128))])])),_:1},8,["loading"]))}}),ya=m(null);function ha(){return{currentOrganization:w(ya),setCurrentOrganization:e=>{ya.value=e}}}const wa=["href"],ka=["src","alt"],za=l({__name:"AdminPublishButton",props:{type:{}},setup(e){const a=e,{t:l}=S(),r=_((()=>{switch(a.type){case"dataset":return N;case"harvester":return`${E}harvester/new/`;case"reuse":return V}}));return(e,a)=>(t(),s("a",{href:r.value,class:"fr-btn fr-icon-add-line fr-btn--icon-left"},[y(d(u(l)("Publish on"))+" ",1),i("img",{class:"fr-ml-1v",src:u("/_themes/gouvfr/assets/logotype-white.svg"),loading:"lazy",alt:u(H)},null,8,ka)],8,wa))}}),xa={key:0},Aa={class:"fr-breadcrumb__link","aria-current":"page"},Ca={class:"fr-h3 fr-mb-5v"},$a={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},Da={class:"fr-col"},Sa={class:"subtitle subtitle--uppercase fr-m-0"},Pa={key:0,class:"fr-col-auto fr-grid-row fr-grid-row--middle"},qa=["href"],Ba={class:"text-align-center fr-py-1w"},ja=["src"],Ma={class:"fr-text--bold fr-my-3v"},Ra=l({__name:"Datasets",props:{oid:{}},setup(e){const{t:a}=S(),l=e,r=m([]),n=m(!1),c=m(1),f=m(10),p=m(0),h=m("created"),w=m("desc"),x=_((()=>`${"asc"===w.value?"":"-"}${h.value}`)),A=m(""),C=Y(A,Q),{currentOrganization:$}=ha();function D(e,a){h.value=e,w.value=a}return k((async()=>{n.value=!0,r.value=[];try{const e=await W(l.oid,C.value,c.value,f.value,x.value);r.value=e.data,c.value=e.page,f.value=e.page_size,p.value=e.total}finally{n.value=!1}})),(e,l)=>{const m=z("router-link");return t(),s("div",null,[o(Ye,null,{default:v((()=>[i("li",null,[o(m,{class:"fr-breadcrumb__link",to:"/"},{default:v((()=>[y(d(u(a)("Administration")),1)])),_:1})]),u($)?(t(),s("li",xa,[o(m,{class:"fr-breadcrumb__link",to:"/"},{default:v((()=>[y(d(u($).name),1)])),_:1})])):g("",!0),i("li",null,[i("a",Aa,d(u(a)("Datasets")),1)])])),_:1}),i("h1",Ca,d(u(a)("Datasets")),1),i("div",$a,[i("div",Da,[i("h2",Sa,d(u(a)("{n} datasets",p.value)),1)]),p.value?(t(),s("div",Pa,[i("div",null,[i("a",{href:u(G)(e.oid),class:"fr-btn fr-btn--sm fr-icon-download-line fr-btn--icon-left"},d(u(a)("Download catalog")),9,qa)])])):g("",!0)]),n.value||p.value>0?(t(),b(_a,{key:0,datasets:r.value,loading:n.value,"sort-direction":w.value,sortedBy:h.value,onSort:D},null,8,["datasets","loading","sort-direction","sortedBy"])):(t(),b(F,{key:1,class:"fr-my-2w"},{default:v((()=>[i("div",Ba,[i("img",{src:u(J),alt:"",loading:"lazy"},null,8,ja),i("p",Ma,d(u(a)("You haven't published a dataset yet")),1),o(za,{type:"dataset"})])])),_:1})),p.value>f.value?(t(),b(u(K),{key:2,page:c.value,"page-size":f.value,"total-results":p.value,onChange:l[0]||(l[0]=e=>c.value=e)},null,8,["page","page-size","total-results"])):g("",!0)])}}}),Ta=["href"],Fa={class:"monospace"},Oa={class:"monospace"},Ua={class:"monospace"},Ia={class:"monospace"},La=l({__name:"AdminReusesTable",props:{reuses:{},loading:{type:Boolean},sortedBy:{},sortDirection:{}},emits:["sort"],setup(e){const a=e,{t:l}=S();function n(e){return a.sortedBy===e?a.sortDirection:null}function c(e){return`${E}reuse/${e.id}/`}function f(e){return e.deleted?{label:l("Deleted"),type:"error"}:e.archived?{label:l("Archived"),type:"warning"}:e.private?{label:l("Private"),type:"default"}:{label:l("Public"),type:"info"}}return(e,a)=>(t(),b(sa,{loading:e.loading},{default:v((()=>[i("thead",null,[o(ia,{onSort:a[0]||(a[0]=a=>e.$emit("sort","title",a)),sorted:n("title"),scope:"col"},{default:v((()=>[y(d(u(l)("Reuse title")),1)])),_:1},8,["sorted"]),o(ia,null,{default:v((()=>[y(d(u(l)("Status")),1)])),_:1}),o(ia,{onSort:a[1]||(a[1]=a=>e.$emit("sort","created",a)),sorted:n("created"),scope:"col"},{default:v((()=>[y(d(u(l)("Created at")),1)])),_:1},8,["sorted"]),o(ia,{onSort:a[2]||(a[2]=a=>e.$emit("sort","datasets",a)),sorted:n("datasets"),scope:"col"},{default:v((()=>[y(d(u(l)("Datasets")),1)])),_:1},8,["sorted"]),o(ia,{scope:"col"},{default:v((()=>[o(ca,null,{tooltip:v((()=>[y(d(u(l)("Discussions")),1)])),default:v((()=>[a[5]||(a[5]=i("span",{class:"fr-icon--sm fr-icon-chat-3-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1}),o(ia,{onSort:a[3]||(a[3]=a=>e.$emit("sort","views",a)),sorted:n("views"),scope:"col"},{default:v((()=>[o(ca,null,{tooltip:v((()=>[y(d(u(l)("Views")),1)])),default:v((()=>[a[6]||(a[6]=i("span",{class:"fr-icon--sm fr-icon-eye-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1},8,["sorted"]),o(ia,{onSort:a[4]||(a[4]=a=>e.$emit("sort","followers",a)),sorted:n("followers"),scope:"col"},{default:v((()=>[o(ca,null,{tooltip:v((()=>[y(d(u(l)("Favorites")),1)])),default:v((()=>[a[7]||(a[7]=i("span",{class:"fr-icon--sm fr-icon-star-s-line","aria-hidden":"true"},null,-1))])),_:1})])),_:1},8,["sorted"])]),i("tbody",null,[(t(!0),s(r,null,h(e.reuses,(e=>(t(),s("tr",null,[i("td",null,[o(ea,null,{default:v((()=>[i("a",{class:"fr-link fr-reset-link",href:c(e)},[o(u(O),{text:e.title,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,Ta)])),_:2},1024)]),i("td",null,[o(Qe,{type:f(e).type},{default:v((()=>[y(d(f(e).label),1)])),_:2},1032,["type"])]),i("td",null,d(u(U)(e.created_at)),1),i("td",Fa,d(u(L)(e.datasets.length)),1),i("td",Oa,d(u(L)(e.metrics.discussions)),1),i("td",Ua,d(u(L)(e.metrics.views)),1),i("td",Ia,d(u(L)(e.metrics.followers)),1)])))),256))])])),_:1},8,["loading"]))}}),Ea={class:"fr-container--fluid"},Va={key:0},Na={class:"fr-breadcrumb__link","aria-current":"page"},Ha={class:"fr-h3"},Ya={class:"subtitle subtitle--uppercase"},Wa={class:"text-align-center fr-py-1w"},Ga=["src"],Ja={class:"fr-text--bold fr-my-3v"},Ka=l({__name:"Reuses",props:{oid:{}},setup(e){const{t:a}=S(),l=e,r=m([]),n=m(!1),c=m(1),f=m(10),p=m(0),h=m("created"),w=m("desc"),x=_((()=>`${"asc"===w.value?"":"-"}${h.value}`)),{currentOrganization:A}=ha();function C(e,a){h.value=e,w.value=a}return k((async()=>{n.value=!0,r.value=[];try{const e=await Z(l.oid,c.value,f.value,x.value);r.value=e.data,c.value=e.page,f.value=e.page_size,p.value=e.total}finally{n.value=!1}})),(e,l)=>{const m=z("router-link");return t(),s("div",Ea,[o(Ye,null,{default:v((()=>[i("li",null,[o(m,{class:"fr-breadcrumb__link",to:"/"},{default:v((()=>[y(d(u(a)("Administration")),1)])),_:1})]),u(A)?(t(),s("li",Va,[o(m,{class:"fr-breadcrumb__link",to:"/"},{default:v((()=>[y(d(u(A).name),1)])),_:1})])):g("",!0),i("li",null,[i("a",Na,d(u(a)("Reuses")),1)])])),_:1}),i("h1",Ha,d(u(a)("Reuses")),1),i("h2",Ya,d(u(a)("{n} reuses of your organization",r.value.length)),1),n.value||p.value>0?(t(),b(La,{key:0,reuses:r.value,loading:n.value,sortDirection:w.value,sortedBy:h.value,onSort:C},null,8,["reuses","loading","sortDirection","sortedBy"])):(t(),b(F,{key:1,class:"fr-mt-1w fr-mb-2w"},{default:v((()=>[i("div",Wa,[i("img",{src:u("/_themes/gouvfr/assets/reuse2.svg"),alt:"",loading:"lazy"},null,8,Ga),i("p",Ja,d(u(a)("You haven't published a reuse yet")),1),o(za,{type:"reuse"})])])),_:1})),p.value>f.value?(t(),b(u(K),{key:2,page:c.value,"page-size":f.value,"total-results":p.value,onChange:l[0]||(l[0]=e=>c.value=e)},null,8,["page","page-size","total-results"])):g("",!0)])}}}),Qa={class:"fr-breadcrumb__link","aria-current":"page"},Za={key:0,class:"fr-h1"},Xa={class:"fr-alert fr-alert--info"},el={class:"fr-alert__title"},al={href:"/admin/me/"},ll=l({__name:"Me",setup(e){const{t:a}=S(),l=m(null);return p((async()=>l.value=await X())),(e,r)=>{const n=z("router-link");return t(),s("div",null,[o(Ye,null,{default:v((()=>[i("li",null,[o(n,{class:"fr-breadcrumb__link",to:"/"},{default:v((()=>[y(d(u(a)("Administration")),1)])),_:1})]),i("li",null,[i("a",Qa,d(u(a)("Me")),1)])])),_:1}),l.value?(t(),s("h1",Za,d(l.value.first_name)+" "+d(l.value.last_name),1)):g("",!0),i("div",Xa,[i("h3",el,d(u(a)("This is a WIP page")),1),i("p",null,[i("a",al,d(u(a)("You can edit your profil on the current admin.")),1)])])])}}}),tl={class:"fr-sidemenu__item"},sl=["innerHTML"],rl=j(l({__name:"AdminSidebarLink",props:{label:{},icon:{},iconHtml:{},to:{}},setup:e=>(e,a)=>{const l=z("router-link");return t(),s("li",tl,[i("div",{class:f([{"fr-icon-svg fr-icon--sm":e.iconHtml},"fr-enlarge-link fr-sidemenu__link fr-mb-1w"])},[e.iconHtml?(t(),s("div",{key:0,class:"fr-mr-1w fr-grid-row",innerHTML:e.iconHtml},null,8,sl)):e.icon?(t(),s("div",{key:1,class:f([e.icon,"fr-mr-1w fr-icon--sm"]),"aria-hidden":"true"},null,2)):g("",!0),o(l,{to:e.to},{default:v((()=>[y(d(e.label),1)])),_:1},8,["to"])],2)])}}),[["__scopeId","data-v-5e2ff0a8"]]),ol=["aria-expanded","aria-controls","aria-current"],nl={class:"fr-mx-1w"},il={class:"logo logo--sm"},dl={class:"fr-mx-1w fr-col text-overflow-ellipsis"},ul=["id"],cl={class:"fr-sidemenu__list fr-mx-1w fr-my-3v"},fl=l({__name:"AdminSidebarMenu",props:{user:{},organization:{},isOpened:{type:Boolean}},emits:["open","click"],setup(e){const a=e,{t:l}=S(),n=B("menu");return x((()=>{setTimeout((()=>{!function(e,a){const l=document.getElementById(n);a(l)&&(e?a(l).collapse.disclose():a(l).collapse.conceal())}(a.isOpened,globalThis.dsfr)}),200)})),(e,a)=>(t(),s("li",{class:f(["fr-sidemenu__item",{"fr-sidemenu__item--active":e.isOpened}])},[i("button",{class:"fr-sidemenu__btn","aria-expanded":e.isOpened,"aria-controls":u(n),"aria-current":e.isOpened,onClick:a[0]||(a[0]=a=>e.$emit("open"))},[e.user?(t(),s(r,{key:0},[e.user?(t(),b(u(D),{key:0,user:e.user,size:24,rounded:!0},null,8,["user"])):g("",!0),i("p",nl,d(u(l)("My Profil")),1)],64)):e.organization?(t(),s(r,{key:1},[i("div",il,[o(ee,{type:"organization",src:e.organization.logo_thumbnail,size:20},null,8,["src"])]),i("p",dl,d(e.organization.name),1)],64)):g("",!0)],8,ol),i("div",{class:"fr-collapse","data-fr-js-collapse":"",id:u(n)},[i("ul",cl,[e.user?(t(),b(rl,{key:0,icon:"fr-icon-account-circle-line",label:u(l)("Me"),to:"/me"},null,8,["label"])):e.organization?(t(),s(r,{key:1},[o(rl,{iconHtml:u('<svg width="24" height="24" stroke-width="1.5" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M5 12V18C5 18 5 21 12 21C19 21 19 18 19 18V12" stroke="currentColor" stroke-width="1.5"/>\n<path d="M5 6V12C5 12 5 15 12 15C19 15 19 12 19 12V6" stroke="currentColor" stroke-width="1.5"/>\n<path d="M12 3C19 3 19 6 19 6C19 6 19 9 12 9C5 9 5 6 5 6C5 6 5 3 12 3Z" stroke="currentColor" stroke-width="1.5"/>\n</svg>\n'),label:u(l)("Datasets"),to:{name:"organization-datasets",params:{oid:e.organization.id}},onClick:a[1]||(a[1]=a=>e.$emit("click"))},null,8,["iconHtml","label","to"]),o(rl,{icon:"fr-icon-line-chart-line",label:u(l)("Reuses"),to:{name:"organization-reuses",params:{oid:e.organization.id}},onClick:a[2]||(a[2]=a=>e.$emit("click"))},null,8,["label","to"]),o(rl,{icon:"fr-icon-chat-3-line",label:u(l)("Discussions"),to:{name:"organization-discussions",params:{oid:e.organization.id}},onClick:a[3]||(a[3]=a=>e.$emit("click"))},null,8,["label","to"]),o(rl,{icon:"fr-icon-parent-line",label:u(l)("Members"),to:{name:"organization-members",params:{oid:e.organization.id}}},null,8,["label","to"]),o(rl,{icon:"fr-icon-server-line",label:u(l)("Harvesters"),to:{name:"organization-harvesters",params:{oid:e.organization.id}},onClick:a[4]||(a[4]=a=>e.$emit("click"))},null,8,["label","to"]),o(rl,{icon:"fr-icon-user-line",label:u(l)("Profile"),to:{name:"organization-profile",params:{oid:e.organization.id}}},null,8,["label","to"])],64)):g("",!0)])],8,ul)],2))}}),ml=j(fl,[["__scopeId","data-v-e84561ef"]]),pl={class:"fr-container--fluid h-100"},bl={class:"fr-grid-row h-100 bg-grey-50"},vl={class:"fr-col-12 fr-col-md-4 fr-col-lg-3 fr-col-xl-2"},gl=["aria-label"],_l={class:"fr-sidemenu__inner"},yl=["aria-controls"],hl=["id"],wl={class:"fr-sidemenu__list"},kl={class:"fr-col-12 fr-col-md-8 fr-col-lg-9 fr-col-xl-10 h-100 fr-px-2w"},zl=l({__name:"Admin",setup(e){const{t:a}=S(),l=ae(),o=B("menu"),n=m(null),c=m(),{setCurrentOrganization:f}=ha(),v=le();function _(e){return e===c.value}function y(e){c.value=e.id}return p((async()=>{var e;if(n.value=await X(),l.name||(n.value.organizations.length>0?v.replace({name:"organization-datasets",params:{oid:n.value.organizations[0].id}}):v.replace({name:"me"})),"me"===l.name)c.value=null===(e=te)||void 0===e?void 0:e.id;else if(n.value.organizations.length>0){let e=n.value.organizations[0];var a;l.params.oid&&(e=null!==(a=n.value.organizations.find((e=>e.id===l.params.oid)))&&void 0!==a?a:e),y(e),f(e)}})),(e,c)=>{const m=z("router-view");return t(),s("div",pl,[i("div",bl,[i("div",vl,[i("nav",{class:"fr-sidemenu fr-pr-0","aria-label":u(a)("Administration menu")},[i("div",_l,[i("button",{class:"fr-sidemenu__btn",hidden:"","aria-controls":u(o),"aria-expanded":"false"},d(u(a)("Open menu")),9,yl),i("div",{class:"fr-collapse",id:u(o)},[i("ul",wl,[u(te)?(t(),b(ml,{key:0,user:u(te),"is-opened":_(u(te).id),onOpen:c[0]||(c[0]=e=>y(u(te)))},null,8,["user","is-opened"])):g("",!0),n.value?(t(!0),s(r,{key:1},h(n.value.organizations,(e=>(t(),b(ml,{organization:e,"is-opened":_(e.id),onOpen:()=>y(e),onClick:()=>u(f)(e)},null,8,["organization","is-opened","onOpen","onClick"])))),256)):g("",!0)])],8,hl)])],8,gl)]),i("div",kl,[(t(),b(m,{key:u(l).fullPath,class:"fr-container--fluid"}))])])])}}}),xl=j(zl,[["__scopeId","data-v-1057ebbe"]]),Al=["aria-labelledby","id"],Cl={class:"fr-container fr-container--fluid fr-container-md"},$l={class:"fr-grid-row fr-grid-row--center"},Dl={class:"fr-col-12 fr-col-md-8"},Sl={class:"fr-modal__body"},Pl={class:"fr-modal__header"},ql=["title","aria-controls"],Bl={class:"fr-modal__content"},jl=["id"],Ml={class:"fr-modal__footer"},Rl={class:"fr-btns-group fr-btns-group--right fr-btns-group--sm fr-btns-group--inline-lg fr-btns-group--icon-left"},Tl=["disabled"],Fl=["disabled"],Ol=l({__name:"AdminAddMemberModal",props:{id:{},oid:{},roles:{}},emits:["memberAdded"],setup(e,{emit:a}){const l=e,s=a,{t:r}=S(),{toast:n}=ie(),c=m(!1),f=m(),p=m("editor"),v=_((()=>"fr-modal-title-user-"+l.id));async function y(){try{c.value=!0,f.value&&(await oe(l.oid,f.value,p.value),s("memberAdded"),w())}catch(e){n.error(r("An error occurred while update member role."))}finally{c.value=!1}}function h(e){return e.map((e=>{var a;const l={...e,avatar_thumbnail:null!==(a=e.avatar_url)&&void 0!==a?a:void 0};return{value:l.id,label:l.first_name+" "+l.last_name,image:ne(l,32)}}))}function w(){c.value=!1,f.value=void 0,p.value="editor";const e=document.getElementById(l.id);globalThis.dsfr(e).modal.conceal()}return(e,a)=>(t(),b(A,{to:"body"},[i("dialog",{"aria-labelledby":v.value,role:"dialog",id:e.id,class:"fr-modal"},[i("div",Cl,[i("div",$l,[i("div",Dl,[i("div",Sl,[i("div",Pl,[i("button",{class:"fr-btn--close fr-btn",title:u(r)("Close the modal dialog"),"aria-controls":e.id},d(u(r)("Close")),9,ql)]),i("form",{onSubmit:C(y,["prevent"])},[i("div",Bl,[i("h1",{id:v.value,class:"fr-modal__title fr-mb-2w"},d(u(r)("Add member to the organization")),9,jl),o(se,{placeholder:e.$t("Search a user"),searchPlaceholder:e.$t("Search a user..."),suggestUrl:"/users/suggest/",values:f.value,onChange:a[0]||(a[0]=e=>f.value=e),allOption:e.$t("Select a user"),addAllOption:!1,onSuggest:h,roundedImages:!0},null,8,["placeholder","searchPlaceholder","values","allOption"]),e.roles.length>0?(t(),b(re,{key:0,label:u(r)("Role of the member"),"model-value":p.value,"onUpdate:modelValue":a[1]||(a[1]=e=>p.value=e),options:e.roles},null,8,["label","model-value","options"])):g("",!0)]),i("div",Ml,[i("div",Rl,[i("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary-grey-500",type:"button",onClick:w,disabled:c.value},d(u(r)("Cancel")),9,Tl),i("button",{class:"fr-btn",type:"submit",disabled:c.value},d(u(r)("Add to the organization")),9,Fl)])])],32)])])])])],8,Al)]))}}),Ul=["aria-controls"],Il=l({__name:"AdminAddMemberButton",props:{oid:{},roles:{}},emits:["memberAdded"],setup(e){const a=e,{t:l}=S(),n=_((()=>"fr-modal-add-user-"+a.oid));return(e,a)=>(t(),s(r,null,[i("button",{class:"fr-btn fr-btn--sm fr-btn--icon-left fr-icon-add-line","data-fr-opened":"false","aria-controls":n.value},d(u(l)("Add member")),9,Ul),o(Ol,{id:n.value,oid:e.oid,roles:e.roles,onMemberAdded:a[0]||(a[0]=a=>e.$emit("memberAdded"))},null,8,["id","oid","roles"])],64))}}),Ll={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},El=l({__name:"AdminDangerZone",setup:e=>(e,a)=>(t(),b(u(de),{color:"error",type:"secondary",weight:"regular"},{default:v((()=>[i("div",Ll,[c(e.$slots,"default")])])),_:3}))}),Vl=["aria-labelledby","id"],Nl={class:"fr-container fr-container--fluid fr-container-md"},Hl={class:"fr-grid-row fr-grid-row--center"},Yl={class:"fr-col-12 fr-col-md-8"},Wl={class:"fr-modal__body"},Gl={class:"fr-modal__header"},Jl=["title","aria-controls"],Kl={class:"fr-modal__content"},Ql=["id"],Zl={class:"fr-grid-row fr-grid-row--middle fr-text--bold fr-mb-2w"},Xl={class:"fr-col"},et={class:"fr-col-auto"},at=["disabled"],lt={class:"fr-col"},tt={class:"fr-m-0 text-grey-500"},st={class:"fr-m-0 fr-text--xs text-default-error"},rt={class:"fr-col-auto"},ot=["disabled"],nt=l({__name:"AdminEditMemberModal",props:{id:{},member:{},oid:{},roles:{}},emits:["memberUpdated"],setup(e,{emit:a}){const l=e,s=a,r=_((()=>"fr-modal-title-user-"+l.id)),{t:n}=S(),{toast:c}=ie(),f=m(!1);function p(){f.value=!1;const e=document.getElementById(l.id);globalThis.dsfr(e).modal.conceal()}return(e,a)=>{return t(),b(A,{to:"body"},[i("dialog",{"aria-labelledby":r.value,role:"dialog",id:e.id,class:"fr-modal"},[i("div",Nl,[i("div",Hl,[i("div",Yl,[i("div",Wl,[i("div",Gl,[i("button",{class:"fr-btn--close fr-btn",title:u(n)("Close the modal dialog"),"aria-controls":e.id},d(u(n)("Close")),9,Jl)]),i("div",Kl,[i("h1",{id:r.value,class:"fr-modal__title fr-mb-2w"},d(u(n)("Edit member")),9,Ql),i("p",Zl,[o(u(D),{class:"fr-mr-1v",user:e.member.user,rounded:!0,size:24},null,8,["user"]),y(" "+d(e.member.user.first_name)+" "+d(e.member.user.last_name),1)]),i("form",{class:"fr-grid-row fr-grid-row--gutters fr-grid-row--bottom",onSubmit:a[1]||(a[1]=C((a=>async function(e){if(e.newRole)try{f.value=!0,await ue(l.oid,e.user.id,e.newRole),s("memberUpdated"),p()}catch(a){c.error(n("An error occurred while update member role."))}finally{f.value=!1}else p()}(e.member)),["prevent"]))},[i("div",Xl,[e.roles.length>0?(t(),b(re,{key:0,label:u(n)("Role of the member"),"model-value":e.member.role,"onUpdate:modelValue":a[0]||(a[0]=a=>e.member.newRole=a),options:(m=e.member.role,l.roles.map((e=>{const a={...e};return a.value===m&&(a.selected=!0),a})))},null,8,["label","model-value","options"])):g("",!0)]),i("div",et,[i("button",{class:"fr-btn",type:"submit",disabled:f.value},d(u(n)("Validate")),9,at)])],32),o(El,{class:"fr-mt-2w"},{default:v((()=>[i("div",lt,[i("p",tt,d(u(n)("Remove member from the organization")),1),i("p",st,d(u(n)("Be careful, this action can't be reverse.")),1)]),i("div",rt,[i("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error fr-btn--icon-left fr-icon-logout-box-r-line",disabled:f.value,onClick:a[2]||(a[2]=a=>async function(e){try{f.value=!0,await ce(l.oid,e.user.id),s("memberUpdated")}catch(a){c.error(n("An error occurred while removing this member."))}finally{f.value=!1}}(e.member))},d(u(n)("Remove member")),9,ot)])])),_:1})])])])])])],8,Vl)]);var m}}}),it=["aria-controls"],dt=l({__name:"AdminEditMemberButton",props:{member:{},oid:{},roles:{}},emits:["memberUpdated"],setup(e){const a=e,{t:l}=S(),n=_((()=>"fr-modal-user-"+a.member.user.id));return(e,a)=>(t(),s(r,null,[i("button",{class:"fr-btn fr-btn--sm fr-btn--tertiary-no-outline fr-icon-pencil-line","data-fr-opened":"false","aria-controls":n.value},d(u(l)("Edit")),9,it),o(nt,{id:n.value,member:e.member,oid:e.oid,roles:e.roles,onMemberUpdated:a[0]||(a[0]=a=>e.$emit("memberUpdated"))},null,8,["id","member","oid","roles"])],64))}}),ut={class:"fr-mt-n9v fr-mb-2w"},ct={class:"fr-badge fr-badge--info fr-badge--no-icon"},ft={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle"},mt={class:"fr-col"},pt={class:"fr-grid-row fr-grid-row--middle"},bt={class:"fr-ml-3v fr-mt-1-5v fr-mb-0 filet filet-default-grey fr-text--sm"},vt={key:0,class:"fr-col-auto fr-grid-row flex-direction-column"},gt=["disabled"],_t=["disabled","aria-controls"],yt=["aria-labelledby","id"],ht={class:"fr-container fr-container--fluid fr-container-md"},wt={class:"fr-grid-row fr-grid-row--center"},kt={class:"fr-col-12 fr-col-md-8"},zt={class:"fr-modal__body"},xt={class:"fr-modal__header"},At=["title","aria-controls"],Ct={class:"fr-modal__content"},$t=["id"],Dt={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--right"},St={class:"fr-col-auto"},Pt=["disabled"],qt={class:"fr-col-auto"},Bt=["disabled"],jt=l({__name:"AdminMembershipRequest",props:{loading:{type:Boolean},oid:{},request:{},showActions:{type:Boolean}},emits:["accept","refuse"],setup(e,{emit:a}){const l=e,r=a,{t:n}=S(),c=m(""),f=B("modal"),p=B("modalTitle");function _(){const e=document.getElementById(f);globalThis.dsfr(e).modal.conceal()}function h(){r("refuse",l.request.id,c.value),_()}function w(){c.value="",_()}return(e,a)=>{const l=z("AdminMembershipRequest",!0);return t(),b(F,{class:"drop-shadow rounded-xxs fr-mt-3w"},{default:v((()=>[i("div",ut,[i("p",ct,[a[2]||(a[2]=i("span",{class:"fr-icon-user-add-line fr-icon--sm","aria-hidden":"true"},null,-1)),y(" "+d(u(n)("Membership Request")),1)])]),i("div",ft,[i("div",mt,[i("div",pt,[o(u(D),{class:"fr-mr-1v",user:e.request.user,rounded:!0,size:24},null,8,["user"]),y(" "+d(u(n)("{fullName} asks to join the organization.",{fullName:e.request.user.first_name+" "+e.request.user.last_name})),1)]),i("div",bt,d(e.request.comment),1)]),e.showActions?(t(),s("div",vt,[i("button",{class:"fr-btn fr-btn--sm fr-btn--icon-left fr-mb-1w fr-icon-check-line",onClick:a[0]||(a[0]=a=>e.$emit("accept",e.request.id)),disabled:e.loading,"data-testid":"accept"},d(u(n)("Accept request")),9,gt),i("button",{class:"fr-btn fr-btn--icon-left fr-btn--sm fr-btn--secondary fr-btn--secondary--error fr-icon-close-line",disabled:e.loading,"data-fr-opened":"false","aria-controls":u(f),"data-testid":"refuse"},d(u(n)("Refuse")),9,_t),(t(),b(A,{to:"body"},[i("dialog",{"aria-labelledby":u(p),role:"dialog",id:u(f),class:"fr-modal","data-testid":"modal"},[i("div",ht,[i("div",wt,[i("div",kt,[i("div",zt,[i("div",xt,[i("button",{class:"fr-btn--close fr-btn",title:u(n)("Close the modal dialog"),"aria-controls":u(f),onClick:C(w,["prevent"])},d(u(n)("Close")),9,At)]),i("div",Ct,[i("h1",{id:u(p),class:"fr-modal__title fr-mb-2w"},d(u(n)("Refuse membership request")),9,$t),o(l,{class:"fr-mt-4w fr-mb-2w",loading:!1,oid:e.oid,request:e.request,"show-actions":!1},null,8,["oid","request"]),i("form",{onSubmit:C(h,["prevent"]),onReset:w},[o(fe,{label:u(n)("You can provide the refusal reason:"),modelValue:c.value,"onUpdate:modelValue":a[1]||(a[1]=e=>c.value=e),"data-testid":"comment-group"},null,8,["label","modelValue"]),i("div",Dt,[i("div",St,[i("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary-grey-500",type:"reset",disabled:e.loading,"data-testid":"cancel-modal-button"},d(u(n)("Cancel")),9,Pt)]),i("div",qt,[i("button",{class:"fr-btn",type:"submit",disabled:e.loading,"data-testid":"refuse-modal-button"},d(u(n)("Refuse request")),9,Bt)])])],32)])])])])])],8,yt)]))])):g("",!0)])])),_:1})}}}),Mt={key:0},Rt={class:"fr-breadcrumb__link","aria-current":"page"},Tt={class:"fr-grid-row fr-grid-row--gutters fr-grid-row--middle justify-center"},Ft={class:"fr-col-12 fr-col-md"},Ot={class:"fr-h1 fr-mb-2w"},Ut={key:0,class:"fr-col-auto"},It={class:"subtitle subtitle--uppercase"},Lt={class:"subtitle subtitle--uppercase fr-mt-2w fr-mb-1v"},Et={class:"fr-table fr-table--layout-fixed"},Vt={scope:"col"},Nt={scope:"col"},Ht={scope:"col"},Yt={scope:"col"},Wt={scope:"col"},Gt={key:0,scope:"col"},Jt={class:"fr-badge"},Kt={key:0},Qt={key:1},Zt={key:0},Xt=l({__name:"Members",props:{oid:{}},setup(e){const a=e,{t:l}=S(),{toast:n}=ie(),c=m([]),f=_((()=>me||A.value.some((e=>{var a;return e.user.id===(null===(a=te)||void 0===a?void 0:a.id)&&"admin"===e.role})))),w=m([]),{currentOrganization:x}=ha(),A=m([]),C=m(!1);async function $(){const e=await _e(a.oid);A.value=e.members}async function D(){const e=await pe(a.oid);c.value=e}async function P(e){C.value=!0;const t=[];try{await ye(a.oid,e),t.push(D()),t.push($())}catch(s){n.error(l("An error occurred while accepting this membership."))}finally{Promise.all(t).finally((()=>C.value=!1))}}async function q(e,t){C.value=!0;const s=[];try{await he(a.oid,e,t),s.push(D()),s.push($())}catch(r){n.error(l("An error occurred while refusing this membership."))}finally{Promise.all(s).finally((()=>C.value=!1))}}return k((()=>{f.value&&pe(a.oid).then((e=>c.value=e))})),p((()=>{be().then(ve).then((e=>w.value=e)),$()})),(e,a)=>{const n=z("router-link");return t(),s("div",null,[o(Ye,null,{default:v((()=>[i("li",null,[o(n,{class:"fr-breadcrumb__link",to:"/"},{default:v((()=>[y(d(u(l)("Administration")),1)])),_:1})]),u(x)?(t(),s("li",Mt,[o(n,{class:"fr-breadcrumb__link",to:"/"},{default:v((()=>[y(d(u(x).name),1)])),_:1})])):g("",!0),i("li",null,[i("a",Rt,d(u(l)("Members")),1)])])),_:1}),i("div",Tt,[i("div",Ft,[i("h1",Ot,d(u(l)("Members")),1)]),f.value?(t(),s("div",Ut,[o(Il,{oid:e.oid,roles:w.value,onMemberAdded:$},null,8,["oid","roles"])])):g("",!0)]),c.value.length?(t(),s(r,{key:0},[i("h2",It,d(u(l)("{n} requests",{n:c.value.length})),1),(t(!0),s(r,null,h(c.value,(a=>(t(),b(jt,{class:"fr-mb-4w",key:a.id,loading:C.value,oid:e.oid,request:a,"show-actions":!0,onAccept:P,onRefuse:q},null,8,["loading","oid","request"])))),128))],64)):g("",!0),i("h2",Lt,d(u(l)("{n} members",{n:A.value.length})),1),i("div",Et,[i("table",null,[i("thead",null,[i("tr",null,[i("th",Vt,d(u(l)("Members")),1),i("th",Nt,d(u(l)("Email")),1),i("th",Ht,d(u(l)("Status")),1),i("th",Yt,d(u(l)("Member since")),1),i("th",Wt,d(u(l)("Last connection")),1),f.value?(t(),s("th",Gt,d(u(l)("Action")),1)):g("",!0)])]),i("tbody",null,[(t(!0),s(r,null,h(A.value,(a=>{return t(),s("tr",{key:a.user.id},[i("td",null,d(a.user.first_name)+" "+d(a.user.last_name),1),i("td",null,d(a.user.email),1),i("td",null,[i("p",Jt,d((r=a.role,null!==(n=null===(c=w.value.find((e=>e.value===r)))||void 0===c?void 0:c.label)&&void 0!==n?n:r)),1)]),i("td",null,d(u(U)(a.since)),1),i("td",null,[a.user.last_login_at?(t(),s("span",Kt,d(u(ge)(a.user.last_login_at)),1)):(t(),s("span",Qt,d(u(l)("No connection")),1))]),f.value?(t(),s("td",Zt,[o(dt,{member:a,oid:e.oid,roles:w.value,onMemberUpdated:$},null,8,["member","oid","roles"])])):g("",!0)]);var r,n,c})),128))])])])])}}}),es={class:"fr-container--fluid"},as={key:0},ls={class:"fr-breadcrumb__link","aria-current":"page"},ts=["id"],ss=["disabled","onClick"],rs={class:"fr-col"},os={class:"fr-m-0 text-grey-500"},ns={class:"fr-m-0 fr-text--xs text-default-error"},is={class:"fr-col-auto"},ds=["disabled","aria-controls"],us=["aria-labelledby","id"],cs={class:"fr-container fr-container--fluid fr-container-md"},fs={class:"fr-grid-row fr-grid-row--center"},ms={class:"fr-col-12 fr-col-md-8"},ps={class:"fr-modal__body"},bs={class:"fr-modal__header"},vs=["title","aria-controls"],gs={class:"fr-modal__content"},_s=["id"],ys={class:"fr-text--bold"},hs={class:"fr-modal__footer"},ws={class:"fr-btns-group fr-btns-group--right fr-btns-group--inline-reverse fr-btns-group--inline-lg fr-btns-group--icon-left"},ks=["disabled"],zs=l({__name:"Profile",props:{oid:{}},setup(e){const{t:a}=S(),{toast:l}=ie(),r=le(),n=m(null),c=m(null),{currentOrganization:f}=ha(),_=m([]),h=m(!1),w=B("modal"),k=B("modalTitle");function x(){f.value&&(h.value=!0,ke(f.value.id).then((()=>{r.replace("/"),window.location.reload()})).catch((()=>l.error(a("An error occured when deleting the organization.")))).finally((()=>h.value=!1)))}function C(e){h.value=!0,ze(e).then((()=>l.success(a("Organization updated !")))).catch((()=>l.error(a("An error occured when updating the organization.")))).finally((()=>h.value=!1))}return p((async()=>n.value=await X())),(e,l)=>{const r=z("router-link");return t(),s("div",es,[o(Ye,null,{default:v((()=>[i("li",null,[o(r,{class:"fr-breadcrumb__link",to:"/"},{default:v((()=>[y(d(u(a)("Administration")),1)])),_:1})]),u(f)?(t(),s("li",as,[o(r,{class:"fr-breadcrumb__link",to:"/"},{default:v((()=>[y(d(u(f).name),1)])),_:1})])):g("",!0),i("li",null,[i("a",ls,d(u(a)("Profile")),1)])])),_:1}),c.value?(t(),s("h2",{key:0,class:"subtitle subtitle--uppercase fr-mb-5v",id:c.value.legend},d(u(a)("Edit profile")),9,ts)):g("",!0),u(f)?(t(),b(we,{key:1,organization:u(f),errors:_.value,showLegend:!1,showWell:!1,ref_key:"form",ref:c,onSubmit:C},{submitButton:v((({submit:e})=>[i("button",{class:"fr-btn fr-btn--icon-left fr-icon-save-line",disabled:h.value,"data-testid":"submitButton",onClick:e},d(u(a)("Save")),9,ss)])),default:v((()=>[o(El,{class:"fr-mt-6w"},{default:v((()=>[i("div",rs,[i("p",os,d(u(a)("Delete the organization")),1),i("p",ns,d(u(a)("Be careful, this action can't be reverse.")),1)]),i("div",is,[i("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error fr-btn--icon-left fr-icon-delete-line",disabled:h.value,"data-fr-opened":"false","aria-controls":u(w)},d(u(a)("Delete")),9,ds),(t(),b(A,{to:"body"},[i("dialog",{"aria-labelledby":u(k),role:"dialog",id:u(w),class:"fr-modal"},[i("div",cs,[i("div",fs,[i("div",ms,[i("div",ps,[i("div",bs,[i("button",{class:"fr-btn--close fr-btn",title:u(a)("Close the modal dialog"),"aria-controls":u(w)},d(u(a)("Close")),9,vs)]),i("div",gs,[i("h1",{id:u(k),class:"fr-modal__title fr-mb-2w"},d(u(a)("Are you sure you want to delete this organization ?")),9,_s),i("p",ys,d(u(a)("This action can't be reverse.")),1),i("p",null,d(u(a)("All content published with this organization will stay online, with the same URL but in an anonymous form, i.e. without being linked to a data producer.")),1),i("p",null,d(u(a)("If you want to delete your published content too, start by deleting the contents before deleting your account.")),1)]),i("div",hs,[i("div",ws,[i("button",{class:"fr-btn fr-btn--secondary fr-btn--secondary--error",role:"button",disabled:h.value,onClick:x},d(u(a)("Delete")),9,ks)])])])])])])],8,us)]))])])),_:1})])),_:1},8,["organization","errors"])):g("",!0)])}}});async function xs(e){switch(e.class){case"Dataservice":return async function(e){return(await xe.get(`dataservices/${e}/`)).data}(e.id);case"Dataset":return qe(e.id);case"Post":return async function(e){return(await xe.get(`posts/${e}/`)).data}(e.id);case"Reuse":return Pe(e.id);default:return null}}function As(e,a){return null===e?null:{title:Cs(e),icon:Ds(a),page:$s(e)}}function Cs(e){return null===e?"":"title"in e?e.title:"headline"in e?e.headline:Be(e,`Unknown type ${e}`)}function $s(e){return null===e?"":"page"in e?e.page:"self_web_url"in e?e.self_web_url:Be(e,`Unknown type ${e}`)}function Ds(e){switch(e){case"Dataservice":return"ri-terminal-line";case"Dataset":return"ri-database-2-line";case"Post":return"ri-article-line";case"Reuse":return"ri-line-chart-line";default:return""}}M(De,$e,Ce,Ae);const Ss={class:"fr-text--bold"},Ps={key:0},qs=["href"],Bs={class:"inline-flex"},js=["href"],Ms=l({__name:"AdminDiscussionsTable",props:{discussions:{},loading:{type:Boolean},sortDirection:{},sortedBy:{}},emits:["sort"],setup(e){const l=e,{t:n}=S(),c=m({}),f=m({});function p(e,a){return a?a.page+"#/discussions/"+e:""}function _(e){return l.sortedBy===e?l.sortDirection:null}function w(e){return e.discussion.slice(-1)[0]}return k((async()=>{for(const e of l.discussions)if(!(e.subject.id in c.value)){const a=xs(e.subject);c.value[e.subject.id]=a;const l=await c.value[e.subject.id];f.value[e.subject.id]=As(l,e.subject.class)}})),(e,l)=>(t(),b(sa,{class:"fr-table--layout-fixed",loading:e.loading},{default:v((()=>[i("thead",null,[o(ia,{onSort:l[0]||(l[0]=a=>e.$emit("sort","title",a)),sorted:_("title"),scope:"col"},{default:v((()=>[y(d(u(n)("Discussion")),1)])),_:1},8,["sorted"]),o(ia,{scope:"col"},{default:v((()=>[y(d(u(n)("Number of comments")),1)])),_:1}),o(ia,{scope:"col"},{default:v((()=>[y(d(u(n)("Last comment")),1)])),_:1}),o(ia,{onSort:l[1]||(l[1]=a=>e.$emit("sort","closed",a)),sorted:_("closed"),scope:"col"},{default:v((()=>[y(d(u(n)("Closed at")),1)])),_:1},8,["sorted"]),o(ia,{scope:"col",style:{width:"25%"}},{default:v((()=>[y(d(u(n)("URL")),1)])),_:1})]),i("tbody",null,[(t(!0),s(r,null,h(e.discussions,(e=>{var l,c,m;return t(),s("tr",null,[i("td",null,[i("p",Ss,[o(u(O),{text:e.title,"auto-resize":!0,"max-lines":1},null,8,["text"])]),f.value[e.subject.id]?(t(),s("p",Ps,[i("a",{class:"fr-link inline-flex",href:null===(l=f.value[e.subject.id])||void 0===l?void 0:l.page},[o(u(T),{height:12,class:"self-center",name:null===(c=f.value[e.subject.id])||void 0===c?void 0:c.icon},null,8,["name"]),o(u(O),{class:"overflow-wrap-anywhere",text:null===(m=f.value[e.subject.id])||void 0===m?void 0:m.title,"auto-resize":!0,"max-lines":1},null,8,["text"])],8,qs)])):g("",!0)]),i("td",null,d(e.discussion.length),1),i("td",null,[i("div",null,[i("p",null,d(u(U)(w(e).posted_on)),1),i("p",Bs,[y(d(u(n)("by "))+" ",1),o(u(a),{class:"fr-ml-1v",user:w(e).posted_by},null,8,["user"])])])]),i("td",null,[e.closed?(t(),s(r,{key:0},[y(d(u(U)(e.closed)),1)],64)):g("",!0)]),i("td",null,[f.value[e.subject.id]?(t(),s("a",{key:0,class:"fr-link inline-flex",href:p(e.id,f.value[e.subject.id]),target:"_blank"},[o(u(O),{text:p(e.id,f.value[e.subject.id]),"auto-resize":!0,"max-lines":1},null,8,["text"])],8,js)):g("",!0)])])})),256))])])),_:1},8,["loading"]))}}),Rs={class:"fr-container--fluid"},Ts={key:0},Fs={class:"fr-breadcrumb__link","aria-current":"page"},Os={class:"fr-h3"},Us={class:"subtitle subtitle--uppercase"},Is={class:"text-align-center fr-py-1w"},Ls=["src"],Es={class:"fr-text--bold fr-my-3v"},Vs=l({__name:"Discussions",props:{oid:{}},setup(e){const{t:a}=S(),l=e,r=m(!1),n=m(1),c=m(10),f=m(0),p=m("created"),h=m("desc"),w=_((()=>`${"asc"===h.value?"":"-"}${p.value}`)),x=m([]),{currentOrganization:A}=ha();function C(e,a){p.value=e,h.value=a}return k((async()=>{r.value=!0,x.value=[];try{const e=await async function(e,a,l,t){return(await xe.get(Se("discussions/"),{params:{org:e,sort:t,page_size:l,page:a}})).data}(l.oid,n.value,c.value,w.value);x.value=e.data,n.value=e.page,c.value=e.page_size,f.value=e.total}finally{r.value=!1}})),(e,l)=>{const m=z("router-link");return t(),s("div",Rs,[o(Ye,null,{default:v((()=>[i("li",null,[o(m,{class:"fr-breadcrumb__link",to:"/"},{default:v((()=>[y(d(u(a)("Administration")),1)])),_:1})]),u(A)?(t(),s("li",Ts,[o(m,{class:"fr-breadcrumb__link",to:"/"},{default:v((()=>[y(d(u(A).name),1)])),_:1})])):g("",!0),i("li",null,[i("a",Fs,d(u(a)("Discussions")),1)])])),_:1}),i("h1",Os,d(u(a)("Discussions")),1),i("h2",Us,d(u(a)("{n} discussions",f.value)),1),r.value||f.value>0?(t(),b(Ms,{key:0,discussions:x.value,loading:r.value,"sort-direction":h.value,sortedBy:p.value,onSort:C},null,8,["discussions","loading","sort-direction","sortedBy"])):(t(),b(F,{key:1,class:"fr-my-2w"},{default:v((()=>[i("div",Is,[i("img",{src:u("/_themes/gouvfr/assets/discussion.svg"),alt:"",loading:"lazy"},null,8,Ls),i("p",Es,d(u(a)("There is no discussion yet")),1)])])),_:1})),f.value>c.value?(t(),b(u(K),{key:2,page:n.value,"page-size":c.value,"total-results":f.value,onChange:l[0]||(l[0]=e=>n.value=e)},null,8,["page","page-size","total-results"])):g("",!0)])}}}),Ns={class:"fr-container--fluid"},Hs={key:0},Ys={class:"fr-breadcrumb__link","aria-current":"page"},Ws={class:"fr-h3"},Gs={class:"subtitle subtitle--uppercase"},Js=["href"],Ks={class:"text-align-center fr-py-1w"},Qs=["src"],Zs={class:"fr-text--bold fr-my-3v"},Xs=l({__name:"Harvesters",props:{oid:{}},setup(e){const{t:a}=S(),l=e,n=m(!1),c=m(1),f=m(10),p=m(0),_=m([]),w=m({}),{currentOrganization:x}=ha();function A(e){return`${E}harvester/${e.id}/`}function C(e){return e.last_job?w.value[e.last_job.id].items.filter((e=>e.dataservice)).length:0}function $(e){return e.last_job?w.value[e.last_job.id].items.filter((e=>e.dataset)).length:0}function D(e){var l;switch(null===(l=e.last_job)||void 0===l?void 0:l.status){case"pending":return{label:a("Pending"),type:"default"};case"initializing":return{label:a("Initializing"),type:"info"};case"initialized":return{label:a("Initialized"),type:"default"};case"processing":return{label:a("Processing"),type:"info"};case"done":return{label:a("Done"),type:"success"};case"done-errors":return{label:a("Done with errors"),type:"warning"};case"failed":return{label:a("Failed"),type:"error"};default:return{label:a("No job yet"),type:"default"}}}return k((async()=>{n.value=!0,_.value=[];try{const a=await async function(e,a,l){return(await xe.get(Se("harvest/sources/"),{params:{owner:e,deleted:!0,page:a,page_size:l}})).data}(l.oid,c.value,f.value);_.value=a.data,c.value=a.page,f.value=a.page_size,p.value=a.total;const t=[];for(const l of _.value){var e;null!==(e=l.last_job)&&void 0!==e&&e.id&&t.push(xe.get(`harvest/job/${l.last_job.id}/`))}const s=await Promise.allSettled(t);for(const e of s)"fulfilled"===e.status&&(console.log(e.value.data),w.value[e.value.data.id]=e.value.data)}finally{n.value=!1}})),(e,l)=>{const m=z("router-link");return t(),s("div",Ns,[o(Ye,null,{default:v((()=>[i("li",null,[o(m,{class:"fr-breadcrumb__link",to:"/"},{default:v((()=>[y(d(u(a)("Administration")),1)])),_:1})]),u(x)?(t(),s("li",Hs,[o(m,{class:"fr-breadcrumb__link",to:"/"},{default:v((()=>[y(d(u(x).name),1)])),_:1})])):g("",!0),i("li",null,[i("a",Ys,d(u(a)("Harvesters")),1)])])),_:1}),i("h1",Ws,d(u(a)("Harvesters")),1),i("h2",Gs,d(u(a)("{n} harvesters",p.value)),1),n.value||p.value?(t(),b(sa,{key:0,loading:n.value},{default:v((()=>[i("thead",null,[o(ia,{scope:"col"},{default:v((()=>[y(d(u(a)("Name")),1)])),_:1}),o(ia,{scope:"col"},{default:v((()=>[y(d(u(a)("Status")),1)])),_:1}),o(ia,{scope:"col"},{default:v((()=>[y(d(u(a)("Created at")),1)])),_:1}),o(ia,{scope:"col"},{default:v((()=>[y(d(u(a)("Last run")),1)])),_:1}),o(ia,{scope:"col"},{default:v((()=>[y(d(u(a)("Datasets")),1)])),_:1}),o(ia,{scope:"col"},{default:v((()=>[y(d(u(a)("Dataservices")),1)])),_:1})]),i("tbody",null,[(t(!0),s(r,null,h(_.value,(e=>{var l;return t(),s("tr",null,[i("td",null,[o(ea,null,{default:v((()=>[i("a",{class:"fr-link fr-reset-link",href:A(e)},[o(u(O),{text:e.name,"auto-resize":!0,"max-lines":2},null,8,["text"])],8,Js)])),_:2},1024)]),i("td",null,[o(Qe,{type:D(e).type},{default:v((()=>[y(d(D(e).label),1)])),_:2},1032,["type"])]),i("td",null,d(u(U)(e.created_at)),1),i("td",null,[null!==(l=e.last_job)&&void 0!==l&&l.ended?(t(),s(r,{key:0},[y(d(u(U)(e.last_job.ended)),1)],64)):(t(),s(r,{key:1},[y(d(u(a)("Not yet")),1)],64))]),i("td",null,d($(e)),1),i("td",null,d(C(e)),1)])})),256))])])),_:1},8,["loading"])):(t(),b(F,{key:1,class:"fr-my-2w"},{default:v((()=>[i("div",Ks,[i("img",{src:u("/_themes/gouvfr/assets/harvester.svg"),alt:"",loading:"lazy"},null,8,Qs),i("p",Zs,d(u(a)("There is no harvesters yet")),1),o(za,{type:"harvester"})])])),_:1})),p.value>f.value?(t(),b(u(K),{key:2,page:c.value,"page-size":f.value,"total-results":p.value,onChange:l[0]||(l[0]=e=>c.value=e)},null,8,["page","page-size","total-results"])):g("",!0)])}}});je({admin_root:E,default_lang:Me.global.locale.value,only_locales:Me.global.locale.value,schema_documentation_url:Re,schema_validata_url:Te,show_copy_resource_permalink:!0,tabular_api_url:Fe,tabular_page_size:Oe,title:H});const er=[{path:"/me",component:ll,name:"me"},{path:"/organizations/:oid",children:[{path:"datasets",component:Ra,props:!0,name:"organization-datasets"},{path:"reuses",component:Ka,props:!0,name:"organization-reuses"},{path:"discussions",component:Vs,props:!0,name:"organization-discussions"},{path:"members",component:Xt,props:!0,name:"organization-members"},{path:"harvesters",component:Xs,props:!0,name:"organization-harvesters"},{path:"profile",component:zs,props:!0,name:"organization-profile"}]}],ar=Ue({history:Ie(),routes:er}),lr=$(xl);Le(lr),lr.use(Ee),lr.use(Ve),lr.use(Me),lr.use(ar),lr.mount("#admin"),globalThis.dsfr.start(),console.log("JS is injected !")}}}));
