## REGULAR EXPRESSIONS
Template: &TEMPLATE
    options: &OPTIONS
        # options may reference either predefined blocks or regex basic pieces
        basedir:        
        filename:       ${year}${month}${day}_${telnum}_${runsubrun}_${typechar}_${projectext}
        sourcedir:      ${year}_${month}_${day}
        destdir:        pic.es/data/magic/Data/${datatype}/M1/${sourcename}/${year}_${month}_${day}
        datatype:       RAW
        transfer:       False    
        query:          SELECT name FROM element where status='20_to_transfer' and ( name like '%.root' or  name like '%.raw.gz' ) and project_id = ${project_id};
        extra_metadata: False
    reblocks: &REBLOCKS
        # just predefined pieces without regex group names (and little extra regex syntax)
        obsdate:        (?P<obsdate>((${year}[_-]?${month}[_-]?${day})(_${tapevolume})?))
        runsubrun:      (?P<runsubrun>${run}\.${subrun})
        sequence:       (?P<sequence>${run}(\.${subrun})?)
        project:        (?P<project>${sourcename}${wobble}?$)
        projectext:     (?P<projectext>${sourcename}${wobble}?\.${extension}$)
    regex: &REGEX
        # basic regular expressions blocks, no need substitutions
        tapevolume:     (?P<tapevolume>\d)
        day:            (?P<day>\d{2})
        month:          (?P<month>\d{2})
        year:           (?P<year>\d{4})
        telnum:         (?P<telnum>M[1-2])
        run:            (?P<run>\d{8})
        subrun:         (?P<subrun>\d{3})
        typechar:       (?P<typechar>[BDPCLNIYSQJ])
        sourcename:     (?P<sourcename>.*?)
        wobble:         (?P<wobble>(-W\d\.\d{2}[+-]\d{3})|(-O[+-]\d\.\d[+-]W\d\.\d{2}))
        extension:      (?P<extension>raw\.gz|root)
    metadata: &METADATA
        datatype:        ${sourcename}
        night:           ${year}_${month}_${day}
        run_number:      ${run}
        telescope:       M1
    extra_metadata: &EXTRA
        query_1:          select name from element where id = (select parent_id from element where name = '%s');
        query_2:          select value from tag_element where element_id = (select id from element where name = '%s') and name = 'extra_metadata';
    organitzation: &ORGANIZATION
        dataset_1:      ${run}
        container_1:    ${year}_${month}_${day}
        container_2:    ${sourcename}
        container_3:    RAW_M1


Data Sections:

    RAW: &RAW
        <<: *TEMPLATE
        options: &RAWOPTIONS
            <<: *OPTIONS
            sourcedir:      ${year}_${month}_${day}
            transfer:       True
            priority:       2
        regex:
            <<: *REGEX
            typechar:       (?P<typechar>[BDPCLJNI]) 
        metadata:
            <<: *METADATA
            datatype:        ${sourcename}
            night:           ${year}_${month}_${day}                       
            run_number:      ${run}
            telnum:          M1 
        organization:
            <<: *ORGANIZATION
    RAW M1:
        <<: *RAW
        options:
            <<: *RAWOPTIONS
            basedir:        /data/M1/DAQ/RAW
            destdir:        pic.es/data/magic/Data/RAW/M1/${sourcename}/${year}_${month}_${day}
            rule_name:      RAW_M1
        regex:
            <<: *REGEX
            project_id:     4
        metadata:
            <<: *METADATA
            datatype:       RAW
            telnum:         M1
            night:          ${year}_${month}_${day}
            run_number:     ${run}
        organization:
            <<: *ORGANIZATION
            container_3:    RAW_M1
    RAW M2:
        <<: *RAW
        options:
            <<: *RAWOPTIONS
            basedir:        /data/M2/DAQ/RAW 
            destdir:        pic.es/data/magic/Data/RAW/M2/${sourcename}/${year}_${month}_${day}
            rule_name:      RAW_M2
        regex:
            <<: *REGEX
            project_id:     10
        metadata:
            <<: *METADATA
            datatype:       RAW
            telnum:         M2
            night:          ${year}_${month}_${day}
            run_number:     ${run}
        organization:
            <<: *ORGANIZATION
            container_3:    RAW_M2
    Calibrated: &CALIBRATED
        <<: *TEMPLATE
        options: &CALOPTIONS
            <<: *OPTIONS
            sourcedir:      ${year}/${month}/${day}
            destdir:        pic.es/data/magic/Data/Calibrated/v1/${sourcename}/${year}_${month}_${day}
            transfer:       True
            priority:       3
        regex:
            <<: *REGEX
            typechar:       (?P<typechar>[Y])
        metadata:
            <<: *METADATA
            datatype:       Calibrated
            night:          ${year}_${month}_${day}
            run_number:     ${run}
        organization:
            <<: *ORGANIZATION
    Calibrated Data M1:
        <<: *CALIBRATED
        options:
            <<: *CALOPTIONS
            basedir:        /data/M1/OSA/Calibrated 
            rule_name:      Calibrated_M1
        regex:
            <<: *REGEX
            project_id:     3
        metadata:
            <<: *METADATA
            datatype:       Calibrated
            telnum:         M1
            night:          ${year}_${month}_${day}
            run_number:     ${run}
        organization:
            <<: *ORGANIZATION
            container_3:    Calibrated_M1
    Calibrated Data M2:
        <<: *CALIBRATED
        options:
            <<: *CALOPTIONS
            basedir:        /data/M2/OSA/Calibrated
            rule_name:      Calibrated_M2
        regex:
            <<: *REGEX
            project_id:     5
        metadata:
            <<: *METADATA
            datatype:       Calibrated
            telnum:         M2
            night:          ${year}_${month}_${day}
            run_number:     ${run}
        organization:
            <<: *ORGANIZATION
            container_3:    Calibrated_M2
    Calibrated AuxData: &CALIBRATEDAUX
        <<: *TEMPLATE
        options: &CALAUXOPTIONS
            <<: *OPTIONS
            sourcedir:      ${year}/${month}/${day}
            destdir:        pic.es/data/magic/Data/Calibrated/v1/${sourcename}/${year}_${month}_${day}
            filename:       ${year}_${month}_${day}/${fileprefix}${sequence}_${telnum}${projectext}
            datatype:       CalibratedAux
            transfer:       True
            priority:       4
            rule_name:      Calibrated_ST
        regex:
            <<: *REGEX
            fileprefix:     (?P<fileprefix>scalib|ssignal)
            typechar:       (?P<typechar>[Y])
        metadata:
            <<: *METADATA
            datatype:       Calibrated
            night:          ${year}_${month}_${day}
            run_number:     ${run}
        organization:
            <<: *ORGANIZATION
            container_3:    Calibrated_ST
    Calibrated AuxData M1:
        <<: *CALIBRATEDAUX
        options:
            <<: *CALAUXOPTIONS
            basedir:        /data/M1/OSA/Calibrated
            extra_metadata:          True
            rule_name:      Calibrated_M1
        regex:
            <<: *REGEX
            fileprefix:     (?P<fileprefix>scalib|ssignal)
            typechar:       (?P<typechar>[Y])
            project_id:     20
        metadata:
            <<: *METADATA
            datatype:       CalibratedAux
            telnum:         M1
            night:          ${year}_${month}_${day}
            run_number:     ${run}
        organization:
            <<: *ORGANIZATION
            container_3:    Calibrated_M1
    Calibrated AuxData M2:
        <<: *CALIBRATEDAUX
        options:
            <<: *CALAUXOPTIONS
            basedir:        /data/M2/OSA/Calibrated
            extra_metadata:          True
            rule_name:      Calibrated_M2
        regex:
            <<: *REGEX
            fileprefix:     (?P<fileprefix>scalib|ssignal)
            typechar:       (?P<typechar>[Y])
            project_id:     21
        metadata:
            <<: *METADATA
            datatype:       CalibratedAux
            telnum:         M2
            night:          ${year}_${month}_${day}
            run_number:     ${run}
        organization:
            <<: *ORGANIZATION
            container_3:    Calibrated_M2
    Star: &STAR
        <<: *TEMPLATE
        options: &STAROPTIONS
            <<: *OPTIONS
            sourcedir:      ${year}/${month}/${day}
            destdir:        pic.es/data/magic/Data/Star/v1/${sourcename}/${year}_${month}_${day}
            datatype:       Star
            transfer:       True
            priority:       4
        regex:
            <<: *REGEX
            typechar:       (?P<typechar>[I])
        metadata:
            <<: *METADATA
            datatype:       Star
            night:          ${year}_${month}_${day}
            run_number:     ${run}
        organization:
            <<: *ORGANIZATION
    Star Data M1:
        <<: *STAR
        options:
            <<: *STAROPTIONS
            basedir:        /data/M1/OSA/Star
            rule_name:      Star_M1
        regex:
            <<: *REGEX
            project_id:     12  
        metadata:
            <<: *METADATA
            datatype:       Star
            telnum:         M1
            night:          ${year}_${month}_${day}
            run_number:     ${run}
        organization:
            <<: *ORGANIZATION
            container_3:    Star_M1
    Star Data M2:
        <<: *STAR
        options:
            <<: *STAROPTIONS
            basedir:        /data/M2/OSA/Star 
            rule_name:      Star_M2
        regex:
            <<: *REGEX
            project_id:     6
        metadata:
            <<: *METADATA
            datatype:       Calibrated
            telnum:         M2
            night:          ${year}_${month}_${day}
            run_number:     ${run}
        organization:
            <<: *ORGANIZATION
            container_3:    Star_M2
    Star AuxData: &STARAUX
        <<: *TEMPLATE
        options: &STARAUXOPTIONS
            <<: *OPTIONS
            sourcedir:      ${year}/${month}/${day}
            destdir:        pic.es/data/magic/Data/Star/v1/${sourcename}/${year}_${month}_${day}
            filename:       ${year}_${month}_${day}/star${sequence}_${telnum}
            datatype:       StarAux
            transfer:       True
            priority:       4
        regex:
            <<: *REGEX
            typechar:       (?P<typechar>[I])
        metadata:
            <<: *METADATA
            datatype:       Star
            night:          ${year}_${month}_${day}
            run_number:     ${run}
        organization:
            <<: *ORGANIZATION
    Star AuxData M1:
        <<: *STARAUX
        options:
            <<: *STARAUXOPTIONS
            basedir:        /data/M1/OSA/Star
            filename:       ${year}_${month}_${day}/star${sequence}_${telnum}.${extension}
            extra_metadata:          True
            rule_name:      Star_M1
        regex:
            <<: *REGEX
            typechar:       (?P<typechar>[I])
            project_id:     17 
        metadata:
            <<: *METADATA
            datatype:       StarAux
            telnum:         M1
            night:          ${year}_${month}_${day}
            run_number:     ${run}
        organization:
            <<: *ORGANIZATION
            container_3:    Star_M1
    Star AuxData M2:
        <<: *STARAUX
        options:
            <<: *STARAUXOPTIONS
            basedir:        /data/M2/OSA/Star
            filename:       ${year}_${month}_${day}/star${sequence}_${telnum}.${extension}
            extra_metadata:          True
            rule_name:      Star_M2
        regex:
            <<: *REGEX
            typechar:       (?P<typechar>[I])
            project_id:     18
        metadata:
            <<: *METADATA
            datatype:       StarAux
            telnum:         M2
            night:          ${year}_${month}_${day}
            run_number:     ${run}
        organization:
            <<: *ORGANIZATION
            container_3:    Star_M2
    SuperStar: &SUPERSTAR
        <<: *TEMPLATE
        options: &SUPERSTAROPTIONS
            <<: *OPTIONS
            sourcedir:      ${year}/${month}/${day}
            destdir:        pic.es/data/magic/Data/SuperStar/v1/${sourcename}/${year}_${month}_${day}
            filename:       ${year}${month}${day}_${run}_${typechar}_${projectext}
            transfer:       True
            priority:       5
        regex:
            <<: *REGEX
            typechar:       (?P<typechar>[S])
            project_id:     13
        metadata:
            <<: *METADATA
            datatype:       SuperStar
            night:          ${year}_${month}_${day}
            run_number:     ${run}
        organization:
            <<: *ORGANIZATION
    SuperStar Data:
        <<: *SUPERSTAR
        options:
            <<: *SUPERSTAROPTIONS
            basedir:        /data/ST/OSA/SuperStar 
            rule_name:      SuperStar_ST
        regex:
            <<: *REGEX
            project_id:     15
        metadata:
            <<: *METADATA
            datatype:       SuperStar
            telnum:         ST
            night:          ${year}_${month}_${day}
            run_number:     ${run}
        organization:
            <<: *ORGANIZATION
            container_3:    SuperStar_ST
    SuperStar AuxData: &SUPERSTARAUX
        <<: *TEMPLATE
        options: &SUPERSTARAUXOPTIONS
            <<: *OPTIONS
            basedir:        /data/ST/OSA/SuperStar 
            sourcedir:      ${year}/${month}/${day}
            destdir:        pic.es/data/magic/Data/SuperStar/v1/${sourcename}/${year}_${month}_${day}
            filename:       ${year}_${month}_${day}/superstar${run}.${extension}
            datatype:       SuperStarAux
            transfer:       True
            priority:       5
            extra_metadata:          True
            rule_name:      SuperStar_ST
        regex:
            <<: *REGEX
            project_id:     29978
        metadata:
            <<: *METADATA
            datatype:       SuperStarAux
            telnum:         ST
            night:          ${year}_${month}_${day}
            run_number:     ${run}
        organization:
            <<: *ORGANIZATION
            container_3:    SuperStar_ST
    Melibea: &MELIBEA
        <<: *TEMPLATE
        options: &MELIBEAOPTIONS
            <<: *OPTIONS
            sourcedir:      ${year}/${month}/${day}
            destdir:        pic.es/data/magic/Data/Melibea/v1/${sourcename}/${year}_${month}_${day}
            filename:       ${year}${month}${day}_${run}_${typechar}_${projectext}
            datatype:       Melibea
            transfer:       True
            priority:       3
        regex:
            <<: *REGEX
            typechar:       (?P<typechar>[Q])
            project_id:     14
        metadata:
            <<: *METADATA
            datatype:       Melibea
            night:          ${year}_${month}_${day}
            run_number:     ${run}
        organization:
            <<: *ORGANIZATION
    Melibea Data:
        <<: *MELIBEA
        options:
            <<: *MELIBEAOPTIONS
            basedir:        /data/ST/OSA/Melibea
            rule_name:      Melibea_ST
        regex:
            <<: *REGEX
            project_id:     16
        organization:
            <<: *ORGANIZATION
            container_3:    Melibea_ST
    Melibea AuxData: &MELIBEAAUX
        <<: *TEMPLATE
        options: &MELIBEAAUXOPTIONS
            <<: *OPTIONS
            basedir:        /data/ST/OSA/Melibea 
            sourcedir:      ${year}/${month}/${day}
            destdir:        pic.es/data/magic/Data/Melibea/v1/${sourcename}/${year}_${month}_${day}
            filename:       ${year}_${month}_${day}/melibea${run}.${extension}
            datatype:       MelibeaAux
            transfer:       True
            priority:       4
            extra_metadata:          True
            rule_name:      Melibea_ST
        regex:
            <<: *REGEX
            project_id:     29984
        metadata:
            <<: *METADATA
            datatype:       MelibeaAux
            telnum:         ST
            night:          ${year}_${month}_${day}
            run_number:     ${run}
        organization:
            <<: *ORGANIZATION
            container_3:    Melibea_ST
