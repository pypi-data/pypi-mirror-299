"use strict";(self.webpackChunk_streamlit_app=self.webpackChunk_streamlit_app||[]).push([[266],{85850:(e,t,r)=>{r.d(t,{K:()=>b,A:()=>x});r(58878);var i=r(8151),n=r(12274),o=r(63186),l=r(34914),a=r(997),s=r(36459),d=r(84720),c=r(64611),u=r(89653),g=r(58144);const p="-2.4rem",m=(0,u.A)("div",{target:"e2wxzia1"})((e=>{let{theme:t,locked:r,target:i}=e;return{padding:`${t.spacing.sm} 0 ${t.spacing.sm} ${t.spacing.sm}`,position:"absolute",top:r?p:"-1rem",right:t.spacing.none,transition:"none",...!r&&{opacity:0,"&:active, &:focus-visible, &:hover":{transition:"opacity 150ms 100ms, top 100ms 100ms",opacity:1,top:p},...i&&{[`${i}:hover &, ${i}:active &, ${i}:focus-visible &`]:{transition:"opacity 150ms 100ms, top 100ms 100ms",opacity:1,top:p}}}}}),""),f=(0,u.A)("div",{target:"e2wxzia0"})((e=>{let{theme:t}=e;return{color:(0,g.iq)(t)?t.colors.fadedText60:t.colors.bodyText,display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-end",boxShadow:"1px 2px 8px rgba(0, 0, 0, 0.08)",borderRadius:t.radii.default,backgroundColor:t.colors.lightenedBg05,width:"fit-content",zIndex:t.zIndices.sidebar+1}}),"");var h=r(90782);function b(e){let{label:t,show_label:r,icon:n,onClick:o}=e;const u=(0,i.u)(),g=r?t:"";return(0,h.jsx)("div",{"data-testid":"stElementToolbarButton",children:(0,h.jsx)(a.A,{content:(0,h.jsx)(l.Ay,{source:t,allowHTML:!1,style:{fontSize:u.fontSizes.sm}}),placement:a.W.TOP,onMouseEnterDelay:1e3,inline:!0,children:(0,h.jsxs)(s.Ay,{onClick:e=>{o&&o(),e.stopPropagation()},kind:d.KX.ELEMENT_TOOLBAR,"aria-label":t,children:[n&&(0,h.jsx)(c.A,{content:n,size:"md",testid:"stElementToolbarButtonIcon"}),g&&(0,h.jsx)("span",{children:g})]})})})}const x=e=>{let{onExpand:t,onCollapse:r,isFullScreen:i,locked:l,children:a,target:s,disableFullscreenMode:d}=e;return(0,h.jsx)(m,{className:"stElementToolbar","data-testid":"stElementToolbar",locked:l||i,target:s,children:(0,h.jsxs)(f,{children:[a,t&&!d&&!i&&(0,h.jsx)(b,{label:"Fullscreen",icon:n.g,onClick:()=>t()}),r&&!d&&i&&(0,h.jsx)(b,{label:"Close fullscreen",icon:o.Q,onClick:()=>r()})]})})}},30266:(e,t,r)=>{r.r(t),r.d(t,{default:()=>se});var i=r(58878),n=r(8151),o=r(19613),l=r(56146),a=r(95241),s=r(71034),d=r.n(s),c=r(85850),u=r(25571),g=r(58144),p=r(50609),m=r.n(p),f=r(29669),h=r(67253);var b=r(93480),x=r(997),y=r(70474),w=r(35526);const v=e=>{var t;let{widgetMgr:r,id:n,key:o,defaultValue:l}=e;(0,i.useEffect)((()=>{const e=r.getElementState(n,o);(0,u.hX)(e)&&(0,u.se)(l)&&r.setElementState(n,o,l)}),[r,n,o,l]);const[a,s]=(0,i.useState)(null!==(t=r.getElementState(n,o))&&void 0!==t?t:l);return[a,(0,i.useCallback)((e=>{r.setElementState(n,o,e),s(e)}),[r,n,o])]};var j=r(69768),C=r(75577),k=r(3257),A=r(89653);const S=(0,A.A)("div",{target:"e12wn80j15"})(""),R=(0,A.A)("div",{target:"e12wn80j14"})((e=>{let{theme:t}=e;return{height:t.sizes.largestElementHeight,width:"100%",background:t.genericColors.secondaryBg,borderRadius:t.radii.default,marginBottom:t.spacing.twoXS,display:"flex",alignItems:"center",position:"relative",paddingLeft:t.spacing.xs,paddingRight:t.spacing.sm}}),""),I=(0,A.A)("div",{target:"e12wn80j13"})({name:"82a6rk",styles:"flex:1"}),U=(0,A.A)("div",{target:"e12wn80j12"})((e=>{let{show:t}=e;return{display:t?"block":"none"}}),""),T=(0,A.A)("span",{target:"e12wn80j11"})((e=>{let{theme:t,isPlayingOrRecording:r}=e;return{margin:t.spacing.sm,fontFamily:t.fonts.monospace,color:r?t.genericColors.bodyText:t.colors.fadedText60,backgroundColor:t.genericColors.secondaryBg,fontSize:t.fontSizes.sm}}),""),E=(0,A.A)("div",{target:"e12wn80j10"})((()=>({width:"100%",textAlign:"center",overflow:"hidden"})),""),P=(0,A.A)("span",{target:"e12wn80j9"})(""),L=(0,A.A)("a",{target:"e12wn80j8"})(""),F=(0,A.A)("div",{target:"e12wn80j7"})((e=>{let{theme:t}=e;return{height:t.sizes.largestElementHeight,display:"flex",justifyContent:"center",alignItems:"center"}}),""),M=(0,A.A)("div",{target:"e12wn80j6"})((e=>{let{theme:t}=e;return{height:10,opacity:.2,width:"100%",backgroundImage:`radial-gradient(${t.colors.fadedText10} 40%, transparent 40%)`,backgroundSize:"10px 10px",backgroundRepeat:"repeat"}}),""),z=(0,A.A)("span",{target:"e12wn80j5"})((e=>{let{theme:t}=e;return{"& > button":{color:t.colors.primary,padding:t.spacing.threeXS},"& > button:hover, & > button:focus":{color:t.colors.red}}}),""),B=(0,A.A)("span",{target:"e12wn80j4"})((e=>{let{theme:t}=e;return{"& > button":{padding:t.spacing.threeXS,color:t.colors.fadedText40},"& > button:hover, & > button:focus":{color:t.colors.primary}}}),""),O=(0,A.A)("span",{target:"e12wn80j3"})((e=>{let{theme:t}=e;return{"& > button":{padding:t.spacing.threeXS,color:t.colors.fadedText60},"& > button:hover, & > button:focus":{color:t.colors.bodyText}}}),""),X=(0,A.A)("div",{target:"e12wn80j2"})((e=>{let{theme:t}=e;return{display:"flex",justifyContent:"center",alignItems:"center",flexGrow:0,flexShrink:1,padding:t.spacing.xs,gap:t.spacing.twoXS,marginRight:t.spacing.twoXS}}),""),W=(0,A.A)("div",{target:"e12wn80j1"})((e=>{let{theme:t}=e;return{marginLeft:t.spacing.sm}}),""),$=(0,A.A)("div",{target:"e12wn80j0"})((e=>{let{theme:t}=e;return{marginTop:t.spacing.lg}}),"");var _=r(39095),N=r(90782);const D=()=>(0,N.jsxs)(E,{children:[(0,N.jsx)(P,{children:"This app would like to use your microphone."})," ",(0,N.jsx)(L,{href:_.ML,children:"Learn how to allow access."})]}),V=()=>(0,N.jsx)(F,{children:(0,N.jsx)(M,{})}),H="00:00",G=e=>new Date(e).toLocaleTimeString(void 0,{minute:"2-digit",second:"2-digit"});var K=r(96626),q=r(34783),Z=r(37789),Q=r(14757),Y=r(36459),J=r(84720),ee=r(64611);const te=e=>{let{onClick:t,disabled:r,ariaLabel:i,iconContent:n}=e;return(0,N.jsx)(Y.Ay,{kind:J.KX.BORDERLESS_ICON,onClick:t,disabled:r,"aria-label":i,fluidWidth:!0,"data-testid":"stAudioInputActionButton",children:(0,N.jsx)(ee.A,{content:n,size:"lg",color:"inherit"})})},re=e=>{let{disabled:t,stopRecording:r}=e;return(0,N.jsx)(z,{children:(0,N.jsx)(te,{onClick:r,disabled:t,ariaLabel:"Stop recording",iconContent:q.X})})},ie=e=>{let{disabled:t,isPlaying:r,onClickPlayPause:i}=e;return(0,N.jsx)(O,{children:r?(0,N.jsx)(te,{onClick:i,disabled:t,ariaLabel:"Pause",iconContent:Z.v}):(0,N.jsx)(te,{onClick:i,disabled:t,ariaLabel:"Play",iconContent:Q.S})})},ne=e=>{let{disabled:t,startRecording:r}=e;return(0,N.jsx)(B,{children:(0,N.jsx)(te,{onClick:r,disabled:t,ariaLabel:"Record",iconContent:K.G})})},oe=e=>{let{disabled:t,isRecording:r,isPlaying:i,recordingUrlExists:n,startRecording:o,stopRecording:l,onClickPlayPause:a}=e;return(0,N.jsxs)(X,{children:[r?(0,N.jsx)(re,{disabled:t,stopRecording:l}):(0,N.jsx)(ne,{disabled:t,startRecording:o}),n&&(0,N.jsx)(ie,{disabled:t,isPlaying:i,onClickPlayPause:a})]})},le=(0,i.memo)(oe),ae=e=>{var t;let{element:r,uploadClient:s,widgetMgr:p,fragmentId:A,disabled:E}=e;const P=(0,i.useMemo)((()=>{const{browserName:e,os:t}=(0,j.A)();return"Safari"===e||"iOS"===t}),[]),L=(0,n.u)(),F=(0,w.Z)(L),[M,z]=(0,i.useState)(null),B=i.useRef(null),[O,X]=v({widgetMgr:p,id:r.id,key:"deleteFileUrl"}),[_,K]=(0,i.useState)(null),[q,Z]=(0,i.useState)([]),[Q,Y]=(0,i.useState)(null),[J,ee]=v({widgetMgr:p,id:r.id,key:"recordingUrl"}),[,te]=(0,i.useState)(0),re=()=>{te((e=>e+1))},[ie,ne]=(0,i.useState)(H),[oe,ae]=v({widgetMgr:p,id:r.id,key:"recordingTime",defaultValue:H}),[se,de]=(0,i.useState)(!1),[ce,ue]=(0,i.useState)(!1),[ge,pe]=(0,i.useState)(!1),me=r.id,fe=r.formId,he=(0,i.useCallback)((e=>{(async e=>{let{files:t,uploadClient:r,widgetMgr:i,widgetInfo:n,fragmentId:o}=e,l=[];try{l=await r.fetchFileURLs(t)}catch(c){return{successfulUploads:[],failedUploads:t.map((e=>({file:e,error:(0,h.$)(c)})))}}const a=m()(t,l),s=[],d=[];return await Promise.all(a.map((async e=>{let[t,i]=e;if(!t||!i||!i.uploadUrl||!i.fileId)return{file:t,fileUrl:i,error:new Error("No upload URL found")};try{await r.uploadFile({id:i.fileId,formId:n.formId||""},i.uploadUrl,t),s.push({fileUrl:i,file:t})}catch(c){const r=(0,h.$)(c);d.push({file:t,error:r})}}))),i.setFileUploaderStateValue(n,new f.qX({uploadedFileInfo:s.map((e=>{let{file:t,fileUrl:r}=e;return new f.HY({fileId:r.fileId,fileUrls:r,name:t.name,size:t.size})}))}),{fromUi:!0},o),{successfulUploads:s,failedUploads:d}})({files:[e],uploadClient:s,widgetMgr:p,widgetInfo:{id:me,formId:fe},fragmentId:A}).then((e=>{let{successfulUploads:t}=e;const r=t[0];r&&r.fileUrl.deleteUrl&&X(r.fileUrl.deleteUrl)}))}),[s,p,me,fe,A,X]),be=(0,i.useCallback)((e=>{let{updateWidgetManager:t}=e;(0,u.hX)(M)||(0,u.hX)(O)||(ee(null),M.empty(),s.deleteFile(O),ne(H),ae(H),X(null),t&&p.setFileUploaderStateValue(r,{},{fromUi:!0},A),de(!1),(0,u.se)(J)&&URL.revokeObjectURL(J))}),[O,J,s,M,r,p,A,ae,ee,X]),xe=(0,i.useCallback)((()=>{if(null===B.current)return;const e=o.A.create({container:B.current,waveColor:J?(0,g.au)(L.colors.fadedText40,L.genericColors.secondaryBg):L.colors.primary,progressColor:L.colors.bodyText,height:parseFloat(getComputedStyle(document.documentElement).fontSize)*parseFloat(L.sizes.largestElementHeight.replace("rem",""))-8,barWidth:4,barGap:4,barRadius:8,cursorWidth:0,url:null!==J&&void 0!==J?J:void 0});e.on("timeupdate",(e=>{ne(G(1e3*e))})),e.on("pause",(()=>{re()}));const t=e.registerPlugin(l.A.create({scrollingWaveform:!1,renderRecordedAudio:!0}));return t.on("record-end",(e=>{const t=URL.createObjectURL(e);ee(t);const r=new File([e],"audio.wav",{type:e.type});he(r)})),t.on("record-progress",(e=>{ae(G(e))})),z(e),K(t),()=>{e&&e.destroy(),t&&t.destroy()}}),[he]);(0,i.useEffect)((()=>xe()),[xe]),(0,i.useEffect)((()=>{d()(F,L)||null===M||void 0===M||M.setOptions({waveColor:J?(0,g.au)(L.colors.fadedText40,L.genericColors.secondaryBg):L.colors.primary,progressColor:L.colors.bodyText})}),[L,F,J,M]);const ye=(0,i.useCallback)((()=>{M&&(M.playPause(),de(!0),re())}),[M]),we=(0,i.useCallback)((async()=>{let e=Q;ge||(await navigator.mediaDevices.getUserMedia({audio:!0}).then((()=>l.A.getAvailableAudioDevices().then((t=>{if(Z(t),t.length>0){const{deviceId:r}=t[0];Y(r),e=r}})))).catch((e=>{ue(!0)})),pe(!0)),_&&e&&M&&(M.setOptions({waveColor:L.colors.primary}),J&&be({updateWidgetManager:!1}),_.startRecording({deviceId:e}).then((()=>{re()})))}),[Q,_,L,M,J,be,ge]),ve=(0,i.useCallback)((()=>{_&&(_.stopRecording(),null===M||void 0===M||M.setOptions({waveColor:(0,g.au)(L.colors.fadedText40,L.genericColors.secondaryBg)}))}),[_,M,L]),je=Boolean(null===_||void 0===_?void 0:_.isRecording()),Ce=Boolean(null===M||void 0===M?void 0:M.isPlaying()),ke=je||Ce,Ae=!je&&!J&&!ce,Se=ce||Ae,Re=E||ce||P;return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)(S,{className:"stAudioInput","data-testid":"stAudioInput",children:[(0,N.jsx)(y.L,{label:r.label,disabled:Re,labelVisibility:(0,u.yv)(null===(t=r.labelVisibility)||void 0===t?void 0:t.value),children:r.help&&(0,N.jsx)(W,{children:(0,N.jsx)(b.A,{content:r.help,placement:x.W.TOP})})}),(0,N.jsxs)(R,{children:[(0,N.jsx)(c.A,{isFullScreen:!1,disableFullscreenMode:!0,target:R,children:O&&(0,N.jsx)(c.K,{label:"Clear recording",icon:a.e,onClick:()=>be({updateWidgetManager:!0}),"data-testid":"stAudioInputClearRecordingButton"})}),(0,N.jsx)(le,{isRecording:je,isPlaying:Ce,recordingUrlExists:Boolean(J),startRecording:we,stopRecording:ve,onClickPlayPause:ye,disabled:Re}),(0,N.jsxs)(I,{children:[Ae&&(0,N.jsx)(V,{}),ce&&(0,N.jsx)(D,{}),(0,N.jsx)(U,{"data-testid":"stAudioInputWaveSurfer",ref:B,show:!Se})]}),(0,N.jsx)(T,{isPlayingOrRecording:ke,"data-testid":"stAudioInputWaveformTimeCode",children:se?ie:oe})]})]}),P&&(0,N.jsx)($,{children:(0,N.jsx)(C.A,{width:100,kind:k.b.WARNING,body:"`st.experimental_audio_input` does not yet work on this browser. It will be supported in one of the next versions of Streamlit. Please use Chrome or Firefox on a non-iOS device for now."})})]})},se=(0,i.memo)(ae)},35526:(e,t,r)=>{r.d(t,{Z:()=>n});var i=r(58878);const n=e=>{const t=(0,i.useRef)();return(0,i.useEffect)((()=>{t.current=e}),[e]),t.current}}}]);