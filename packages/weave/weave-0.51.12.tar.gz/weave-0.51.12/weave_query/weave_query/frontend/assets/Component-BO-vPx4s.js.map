{"version":3,"file":"Component-BO-vPx4s.js","sources":["../../src/components/Panel2/PanelPlotly/Component.tsx"],"sourcesContent":["import {callOpVeryUnsafe, constNodeUnsafe, Node} from '@wandb/weave/core';\nimport * as Plotly from 'plotly.js';\nimport React, {useEffect, useMemo, useRef} from 'react';\n\nimport {useNodeValue} from '../../../react';\nimport * as Panel2 from '../panel';\nimport {useUpdateConfig2} from '../PanelComp';\nimport {toWeaveType} from '../toWeaveType';\n\nexport const inputType = {type: 'Plotly'} as any;\n\ninterface PanelPlotlyConfig {\n  selected?:\n    | {\n        xMin: number;\n        xMax: number;\n        yMin: number;\n        yMax: number;\n      }\n    | Node;\n}\n\ntype PanelPlotlyProps = Panel2.PanelProps<typeof inputType, PanelPlotlyConfig>;\n\nexport const PanelPlotly: React.FC<PanelPlotlyProps> = props => {\n  const updateConfig2 = useUpdateConfig2(props);\n  const jsonStringNode = useMemo(() => {\n    return callOpVeryUnsafe('Plotly-contents', {self: props.input});\n  }, [props.input]);\n  const divRef = useRef<HTMLDivElement>(null);\n  const result = useNodeValue(jsonStringNode as any);\n  useEffect(() => {\n    if (result.loading) {\n      return;\n    }\n    const plotlySpec = JSON.parse(result.result);\n    Plotly.newPlot(divRef.current as any, plotlySpec.data, plotlySpec.layout, {\n      responsive: true,\n    });\n    (divRef.current as any).on('plotly_click', (data: any) => {\n      console.log('PLOTLY CLICK', data);\n    });\n    (divRef.current as any).on('plotly_selected', (data: any) => {\n      console.log('PLOTLY SELECTED', data);\n      if (data?.range?.geo != null) {\n        const geo = data.range.geo;\n        // Note these are not really x&y, since we're selected in polar space\n        const selection = {\n          xMin: geo[0][0],\n          xMax: geo[0][1],\n          yMin: geo[1][0],\n          yMax: geo[1][1],\n        };\n        console.log('SELECTED', selection);\n        updateConfig2(() => ({\n          selected: constNodeUnsafe(toWeaveType(selection), selection),\n        }));\n      } else if (data?.range != null) {\n        const selection = {\n          xMin: data.range.x[0],\n          xMax: data.range.x[1],\n          yMin: data.range.y[0],\n          yMax: data.range.y[1],\n        };\n        updateConfig2(oldConfig => {\n          console.log('PANEL PLOTLY CHANGE', oldConfig);\n          return {\n            selected: constNodeUnsafe(toWeaveType(selection), selection),\n          };\n        });\n      }\n    });\n    // Purposely ignore loading here still.\n    // TODO: Figure this out\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [result.result, updateConfig2]);\n  return (\n    <div\n      data-test-weave-id=\"PanelPlotly\"\n      style={{width: '100%', height: '100%'}}\n      ref={divRef}\n    />\n  );\n};\n\nexport default PanelPlotly;\n"],"names":["inputType","PanelPlotly","props","updateConfig2","useUpdateConfig2","jsonStringNode","useMemo","callOpVeryUnsafe","divRef","useRef","result","useNodeValue","useEffect","plotlySpec","Plotly.newPlot","data","geo","selection","constNodeUnsafe","toWeaveType","oldConfig","React"],"mappings":"8FASa,MAAAA,EAAY,CAAC,KAAM,QAAQ,EAe3BC,EAAmDC,GAAA,CACxD,MAAAC,EAAgBC,EAAiBF,CAAK,EACtCG,EAAiBC,EAAAA,QAAQ,IACtBC,EAAiB,kBAAmB,CAAC,KAAML,EAAM,MAAM,EAC7D,CAACA,EAAM,KAAK,CAAC,EACVM,EAASC,SAAuB,IAAI,EACpCC,EAASC,EAAaN,CAAqB,EACjDO,OAAAA,EAAAA,UAAU,IAAM,CACd,GAAIF,EAAO,QACT,OAEF,MAAMG,EAAa,KAAK,MAAMH,EAAO,MAAM,EAC3CI,UAAeN,EAAO,QAAgBK,EAAW,KAAMA,EAAW,OAAQ,CACxE,WAAY,EAAA,CACb,EACAL,EAAO,QAAgB,GAAG,eAAiBO,GAAc,CAChD,QAAA,IAAI,eAAgBA,CAAI,CAAA,CACjC,EACAP,EAAO,QAAgB,GAAG,kBAAoBO,GAAc,CAEvD,GADI,QAAA,IAAI,kBAAmBA,CAAI,EAC/BA,GAAM,OAAO,KAAO,KAAM,CACtB,MAAAC,EAAMD,EAAK,MAAM,IAEjBE,EAAY,CAChB,KAAMD,EAAI,CAAC,EAAE,CAAC,EACd,KAAMA,EAAI,CAAC,EAAE,CAAC,EACd,KAAMA,EAAI,CAAC,EAAE,CAAC,EACd,KAAMA,EAAI,CAAC,EAAE,CAAC,CAAA,EAER,QAAA,IAAI,WAAYC,CAAS,EACjCd,EAAc,KAAO,CACnB,SAAUe,EAAgBC,EAAYF,CAAS,EAAGA,CAAS,CAC3D,EAAA,CAAA,SACOF,GAAM,OAAS,KAAM,CAC9B,MAAME,EAAY,CAChB,KAAMF,EAAK,MAAM,EAAE,CAAC,EACpB,KAAMA,EAAK,MAAM,EAAE,CAAC,EACpB,KAAMA,EAAK,MAAM,EAAE,CAAC,EACpB,KAAMA,EAAK,MAAM,EAAE,CAAC,CAAA,EAEtBZ,EAA2BiB,IACjB,QAAA,IAAI,sBAAuBA,CAAS,EACrC,CACL,SAAUF,EAAgBC,EAAYF,CAAS,EAAGA,CAAS,CAAA,EAE9D,CACH,CAAA,CACD,CAIA,EAAA,CAACP,EAAO,OAAQP,CAAa,CAAC,EAE/BkB,EAAA,cAAC,MAAA,CACC,qBAAmB,cACnB,MAAO,CAAC,MAAO,OAAQ,OAAQ,MAAM,EACrC,IAAKb,CAAA,CAAA,CAGX"}