import{c as I,g as de}from"./index-B3IlW4fU.js";function ye(o,r){for(var e=0;e<r.length;e++){const t=r[e];if(typeof t!="string"&&!Array.isArray(t)){for(const n in t)if(n!=="default"&&!(n in o)){const s=Object.getOwnPropertyDescriptor(t,n);s&&Object.defineProperty(o,n,s.get?s:{enumerable:!0,get:()=>t[n]})}}}return Object.freeze(Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}))}var St={},nt={},et={},D={},Se=I&&I.__values||function(o){var r=typeof Symbol=="function"&&o[Symbol.iterator],e=0;return r?r.call(o):{next:function(){return o&&e>=o.length&&(o=void 0),{value:o&&o[e++],done:!o}}}};Object.defineProperty(D,"__esModule",{value:!0});function Kt(o,r){return Math.floor(r()*o)}D.tauRandInt=Kt;function Ee(o){return o()}D.tauRand=Ee;function Me(o){var r,e,t=0;try{for(var n=Se(o),s=n.next();!s.done;s=n.next()){var i=s.value;t+=Math.pow(i,2)}}catch(l){r={error:l}}finally{try{s&&!s.done&&(e=n.return)&&e.call(n)}finally{if(r)throw r.error}}return Math.sqrt(t)}D.norm=Me;function Et(o){for(var r=[],e=0;e<o;e++)r.push(void 0);return r}D.empty=Et;function be(o){return Et(o).map(function(r,e){return e})}D.range=be;function Tt(o,r){return Et(o).map(function(){return r})}D.filled=Tt;function Yt(o){return Tt(o,0)}D.zeros=Yt;function je(o){return Tt(o,1)}D.ones=je;function Ne(o,r,e){return Et(e).map(function(t,n){return o+n*((r-o)/(e-1))})}D.linear=Ne;function Qt(o){return o.reduce(function(r,e){return r+e})}D.sum=Qt;function ke(o){return Qt(o)/o.length}D.mean=ke;function Re(o){for(var r=0,e=0;e<o.length;e++)r=o[e]>r?o[e]:r;return r}D.max=Re;function _e(o){for(var r=0,e=0;e<o.length;e++)for(var t=0;t<o[e].length;t++)r=o[e][t]>r?o[e][t]:r;return r}D.max2d=_e;function ze(o,r,e){for(var t=Yt(o),n=0;n<o;n++)for(var s=!0;s;){for(var i=Kt(r,e),l=!1,h=0;h<n;h++)if(i===t[h]){l=!0;break}l||(s=!1),t[n]=i}return t}D.rejectionSample=ze;function Ie(o,r,e){var t=[],n=0;if(o.length!==r*e)throw new Error("Array dimensions must match input length.");for(var s=0;s<r;s++){for(var i=[],l=0;l<e;l++)i.push(o[n]),n+=1;t.push(i)}return t}D.reshape2d=Ie;var Pe=I&&I.__importStar||function(o){if(o&&o.__esModule)return o;var r={};if(o!=null)for(var e in o)Object.hasOwnProperty.call(o,e)&&(r[e]=o[e]);return r.default=o,r};Object.defineProperty(et,"__esModule",{value:!0});var gt=Pe(D);function Xt(o,r){var e=function(n){return gt.empty(o).map(function(){return gt.filled(r,n)})},t=[];return t.push(e(-1)),t.push(e(1/0)),t.push(e(0)),t}et.makeHeap=Xt;function Te(o,r,e){for(var t=gt.zeros(o),n=0;n<o;n++){for(var s=!0,i=0;s;){i=gt.tauRandInt(r,e);for(var l=!1,h=0;h<n;h++)if(i===t[h]){l=!0;break}l||(s=!1)}t[n]=i}return t}et.rejectionSample=Te;function kt(o,r,e,t,n){r=Math.floor(r);var s=o[0][r],i=o[1][r];if(o[2][r],e>=i[0])return 0;for(var l=0;l<s.length;l++)if(t===s[l])return 0;return Jt(o,r,e,t,n)}et.heapPush=kt;function Jt(o,r,e,t,n){var s=o[0][r],i=o[1][r],l=o[2][r];if(e>=i[0])return 0;i[0]=e,s[0]=t,l[0]=n;for(var h=0,u=0;;){var a=2*h+1,f=a+1,g=o[0][0].length;if(a>=g)break;if(f>=g)if(i[a]>e)u=a;else break;else if(i[a]>=i[f])if(e<i[a])u=a;else break;else if(e<i[f])u=f;else break;i[h]=i[u],s[h]=s[u],l[h]=l[u],h=u}return i[h]=e,s[h]=t,l[h]=n,1}et.uncheckedHeapPush=Jt;function Fe(o,r,e,t,n){for(var s=Xt(r,t),i=0;i<r;i++)for(var l=0;l<e;l++)if(!(o[0][i][l]<0)){var h=o[0][i][l],u=o[2][i][l],a=gt.tauRand(n);kt(s,i,a,h,u),kt(s,h,a,i,u),o[2][i][l]=0}return s}et.buildCandidates=Fe;function Ve(o){for(var r=o[0],e=o[1],t=0;t<r.length;t++)for(var n=r[t],s=e[t],i=0;i<n.length-1;i++){var l=n.length-i-1,h=s.length-i-1,u=n[0];n[0]=n[l],n[l]=u;var a=s[0];s[0]=s[h],s[h]=a,Oe(s,n,h,0)}return{indices:r,weights:e}}et.deheapSort=Ve;function Oe(o,r,e,t){for(;t*2+1<e;){var n=t*2+1,s=n+1,i=t;if(o[i]<o[n]&&(i=n),s<e&&o[i]<o[s]&&(i=s),i===t)break;var l=o[t];o[t]=o[i],o[i]=l;var h=r[t];r[t]=r[i],r[i]=h,t=i}}function $e(o,r){for(var e=o[0][r],t=o[1][r],n=o[2][r],s=1/0,i=-1,l=0;l>e.length;l++)n[l]===1&&t[l]<s&&(s=t[l],i=l);return i>=0?(n[i]=0,Math.floor(e[i])):-1}et.smallestFlagged=$e;var Q={},yt=I&&I.__read||function(o,r){var e=typeof Symbol=="function"&&o[Symbol.iterator];if(!e)return o;var t=e.call(o),n,s=[],i;try{for(;(r===void 0||r-- >0)&&!(n=t.next()).done;)s.push(n.value)}catch(l){i={error:l}}finally{try{n&&!n.done&&(e=t.return)&&e.call(t)}finally{if(i)throw i.error}}return s},Le=I&&I.__values||function(o){var r=typeof Symbol=="function"&&o[Symbol.iterator],e=0;return r?r.call(o):{next:function(){return o&&e>=o.length&&(o=void 0),{value:o&&o[e++],done:!o}}}},qe=I&&I.__importStar||function(o){if(o&&o.__esModule)return o;var r={};if(o!=null)for(var e in o)Object.hasOwnProperty.call(o,e)&&(r[e]=o[e]);return r.default=o,r};Object.defineProperty(Q,"__esModule",{value:!0});var ct,Ft=qe(D),at=function(){function o(r,e,t,n){if(this.entries=new Map,this.nRows=0,this.nCols=0,r.length!==e.length||r.length!==t.length)throw new Error("rows, cols and values arrays must all have the same length");this.nRows=n[0],this.nCols=n[1];for(var s=0;s<t.length;s++){var i=r[s],l=e[s];this.checkDims(i,l);var h=this.makeKey(i,l);this.entries.set(h,{value:t[s],row:i,col:l})}}return o.prototype.makeKey=function(r,e){return r+":"+e},o.prototype.checkDims=function(r,e){var t=r<this.nRows&&e<this.nCols;if(!t)throw new Error("row and/or col specified outside of matrix dimensions")},o.prototype.set=function(r,e,t){this.checkDims(r,e);var n=this.makeKey(r,e);this.entries.has(n)?this.entries.get(n).value=t:this.entries.set(n,{value:t,row:r,col:e})},o.prototype.get=function(r,e,t){t===void 0&&(t=0),this.checkDims(r,e);var n=this.makeKey(r,e);return this.entries.has(n)?this.entries.get(n).value:t},o.prototype.getAll=function(r){r===void 0&&(r=!0);var e=[];return this.entries.forEach(function(t){e.push(t)}),r&&e.sort(function(t,n){return t.row===n.row?t.col-n.col:t.row-n.row}),e},o.prototype.getDims=function(){return[this.nRows,this.nCols]},o.prototype.getRows=function(){return Array.from(this.entries,function(r){var e=yt(r,2);e[0];var t=e[1];return t.row})},o.prototype.getCols=function(){return Array.from(this.entries,function(r){var e=yt(r,2);e[0];var t=e[1];return t.col})},o.prototype.getValues=function(){return Array.from(this.entries,function(r){var e=yt(r,2);e[0];var t=e[1];return t.value})},o.prototype.forEach=function(r){this.entries.forEach(function(e){return r(e.value,e.row,e.col)})},o.prototype.map=function(r){var e=[];this.entries.forEach(function(n){e.push(r(n.value,n.row,n.col))});var t=[this.nRows,this.nCols];return new o(this.getRows(),this.getCols(),e,t)},o.prototype.toArray=function(){var r=this,e=Ft.empty(this.nRows),t=e.map(function(){return Ft.zeros(r.nCols)});return this.entries.forEach(function(n){t[n.row][n.col]=n.value}),t},o}();Q.SparseMatrix=at;function Ce(o){var r=[],e=[],t=[];o.forEach(function(s,i,l){r.push(i),e.push(l),t.push(s)});var n=[o.nCols,o.nRows];return new at(e,r,t,n)}Q.transpose=Ce;function De(o){for(var r=yt(o,1),e=r[0],t=new at([],[],[],o),n=0;n<e;n++)t.set(n,n,1);return t}Q.identity=De;function Be(o,r){return Mt(o,r,function(e,t){return e*t})}Q.pairwiseMultiply=Be;function Ue(o,r){return Mt(o,r,function(e,t){return e+t})}Q.add=Ue;function We(o,r){return Mt(o,r,function(e,t){return e-t})}Q.subtract=We;function xe(o,r){return Mt(o,r,function(e,t){return e>t?e:t})}Q.maximum=xe;function Ge(o,r){return o.map(function(e){return e*r})}Q.multiplyScalar=Ge;function Ke(o){for(var r=new Set,e=o.getValues(),t=o.getRows(),n=o.getCols(),s=0;s<e.length;s++)e[s]===0&&r.add(s);var i=function(a,f){return!r.has(f)},l=e.filter(i),h=t.filter(i),u=n.filter(i);return new at(h,u,l,o.getDims())}Q.eliminateZeros=Ke;function Ye(o,r){r===void 0&&(r="l2");var e,t,n=Qe[r],s=new Map;o.forEach(function(f,g,w){var m=s.get(g)||[];m.push(w),s.set(g,m)});var i=new at([],[],[],o.getDims()),l=function(f){for(var g=s.get(f).sort(),w=g.map(function(S){return o.get(f,S)}),m=n(w),p=0;p<m.length;p++)i.set(f,g[p],m[p])};try{for(var h=Le(s.keys()),u=h.next();!u.done;u=h.next()){var a=u.value;l(a)}}catch(f){e={error:f}}finally{try{u&&!u.done&&(t=h.return)&&t.call(h)}finally{if(e)throw e.error}}return i}Q.normalize=Ye;var Qe=(ct={},ct.max=function(o){for(var r=-1/0,e=0;e<o.length;e++)r=o[e]>r?o[e]:r;return o.map(function(t){return t/r})},ct.l1=function(o){for(var r=0,e=0;e<o.length;e++)r+=o[e];return o.map(function(t){return t/r})},ct.l2=function(o){for(var r=0,e=0;e<o.length;e++)r+=Math.pow(o[e],2);return o.map(function(t){return Math.sqrt(Math.pow(t,2)/r)})},ct);function Mt(o,r,e){for(var t=new Set,n=[],s=[],i=[],l=function(j,N){n.push(j),s.push(N);var R=e(o.get(j,N),r.get(j,N));i.push(R)},h=o.getValues(),u=o.getRows(),a=o.getCols(),f=0;f<h.length;f++){var g=u[f],w=a[f],m=g+":"+w;t.add(m),l(g,w)}for(var p=r.getValues(),S=r.getRows(),v=r.getCols(),f=0;f<p.length;f++){var g=S[f],w=v[f],m=g+":"+w;t.has(m)||l(g,w)}var k=[o.nRows,o.nCols];return new at(n,s,i,k)}function Xe(o){var r=[];o.forEach(function(f,g,w){r.push({value:f,row:g,col:w})}),r.sort(function(f,g){return f.row===g.row?f.col-g.col:f.row-g.row});for(var e=[],t=[],n=[],s=-1,i=0;i<r.length;i++){var l=r[i],h=l.row,u=l.col,a=l.value;h!==s&&(s=h,n.push(i)),e.push(u),t.push(a)}return{indices:e,values:t,indptr:n}}Q.getCSR=Xe;var ft={},st={},Je=I&&I.__read||function(o,r){var e=typeof Symbol=="function"&&o[Symbol.iterator];if(!e)return o;var t=e.call(o),n,s=[],i;try{for(;(r===void 0||r-- >0)&&!(n=t.next()).done;)s.push(n.value)}catch(l){i={error:l}}finally{try{n&&!n.done&&(e=t.return)&&e.call(t)}finally{if(i)throw i.error}}return s},Zt=I&&I.__spread||function(){for(var o=[],r=0;r<arguments.length;r++)o=o.concat(Je(arguments[r]));return o},Ze=I&&I.__values||function(o){var r=typeof Symbol=="function"&&o[Symbol.iterator],e=0;return r?r.call(o):{next:function(){return o&&e>=o.length&&(o=void 0),{value:o&&o[e++],done:!o}}}},He=I&&I.__importStar||function(o){if(o&&o.__esModule)return o;var r={};if(o!=null)for(var e in o)Object.hasOwnProperty.call(o,e)&&(r[e]=o[e]);return r.default=o,r};Object.defineProperty(st,"__esModule",{value:!0});var K=He(D),Ht=function(){function o(r,e,t,n){this.hyperplanes=r,this.offsets=e,this.children=t,this.indices=n}return o}();st.FlatTree=Ht;function Ae(o,r,e,t){var n=Math.max(10,r),s=K.range(e).map(function(l,h){return tr(o,n,h,t)}),i=s.map(function(l){return rr(l,n)});return i}st.makeForest=Ae;function tr(o,r,e,t){r===void 0&&(r=30);var n=K.range(o.length),s=Rt(o,n,r,e,t);return s}function Rt(o,r,e,t,n){if(e===void 0&&(e=30),r.length>e){var s=er(o,r,n),i=s.indicesLeft,l=s.indicesRight,h=s.hyperplane,u=s.offset,a=Rt(o,i,e,t+1,n),f=Rt(o,l,e,t+1,n),g={leftChild:a,rightChild:f,isLeaf:!1,hyperplane:h,offset:u};return g}else{var g={indices:r,isLeaf:!0};return g}}function er(o,r,e){var t=o[0].length,n=K.tauRandInt(r.length,e),s=K.tauRandInt(r.length,e);s+=n===s?1:0,s=s%r.length;for(var i=r[n],l=r[s],h=0,u=K.zeros(t),a=0;a<u.length;a++)u[a]=o[i][a]-o[l][a],h-=u[a]*(o[i][a]+o[l][a])/2;for(var f=0,g=0,w=K.zeros(r.length),a=0;a<r.length;a++){for(var m=h,p=0;p<t;p++)m+=u[p]*o[r[a]][p];m===0?(w[a]=K.tauRandInt(2,e),w[a]===0?f+=1:g+=1):m>0?(w[a]=0,f+=1):(w[a]=1,g+=1)}var S=K.zeros(f),v=K.zeros(g);f=0,g=0;for(var a=0;a<w.length;a++)w[a]===0?(S[f]=r[a],f+=1):(v[g]=r[a],g+=1);return{indicesLeft:S,indicesRight:v,hyperplane:u,offset:h}}function rr(o,r){var e=zt(o),t=It(o),n=K.range(e).map(function(){return K.zeros(o.hyperplane?o.hyperplane.length:0)}),s=K.zeros(e),i=K.range(e).map(function(){return[-1,-1]}),l=K.range(t).map(function(){return K.range(r).map(function(){return-1})});return _t(o,n,s,i,l,0,0),new Ht(n,s,i,l)}function _t(o,r,e,t,n,s,i){var l;if(o.isLeaf)return t[s][0]=-i,(l=n[i]).splice.apply(l,Zt([0,o.indices.length],o.indices)),i+=1,{nodeNum:s,leafNum:i};r[s]=o.hyperplane,e[s]=o.offset,t[s][0]=s+1;var h=s,u=_t(o.leftChild,r,e,t,n,s+1,i);return s=u.nodeNum,i=u.leafNum,t[h][1]=s+1,u=_t(o.rightChild,r,e,t,n,s+1,i),{nodeNum:u.nodeNum,leafNum:u.leafNum}}function zt(o){return o.isLeaf?1:1+zt(o.leftChild)+zt(o.rightChild)}function It(o){return o.isLeaf?1:It(o.leftChild)+It(o.rightChild)}function nr(o){var r,e;if(o.length>0){var t=[];try{for(var n=Ze(o),s=n.next();!s.done;s=n.next()){var i=s.value;t.push.apply(t,Zt(i.indices))}}catch(l){r={error:l}}finally{try{s&&!s.done&&(e=n.return)&&e.call(n)}finally{if(r)throw r.error}}return t}else return[[-1]]}st.makeLeafArray=nr;function or(o,r,e,t){for(var n=r,s=0;s<e.length;s++)n+=o[s]*e[s];if(n===0){var i=K.tauRandInt(2,t);return i}else return n>0?0:1}function sr(o,r,e){for(var t=0;r.children[t][0]>0;){var n=or(r.hyperplanes[t],r.offsets[t],o,e);n===0?t=r.children[t][0]:t=r.children[t][1]}var s=-1*r.children[t][0];return r.indices[s]}st.searchFlatTree=sr;var At=I&&I.__values||function(o){var r=typeof Symbol=="function"&&o[Symbol.iterator],e=0;return r?r.call(o):{next:function(){return o&&e>=o.length&&(o=void 0),{value:o&&o[e++],done:!o}}}},bt=I&&I.__importStar||function(o){if(o&&o.__esModule)return o;var r={};if(o!=null)for(var e in o)Object.hasOwnProperty.call(o,e)&&(r[e]=o[e]);return r.default=o,r};Object.defineProperty(ft,"__esModule",{value:!0});var Y=bt(et),ir=bt(Q),lr=bt(st),te=bt(D);function hr(o,r){return function(t,n,s,i,l,h,u,a){i===void 0&&(i=10),l===void 0&&(l=50),h===void 0&&(h=.001),u===void 0&&(u=.5),a===void 0&&(a=!0);for(var f=t.length,g=Y.makeHeap(t.length,s),w=0;w<t.length;w++)for(var m=Y.rejectionSample(s,t.length,r),p=0;p<m.length;p++){var S=o(t[w],t[m[p]]);Y.heapPush(g,w,S,m[p],1),Y.heapPush(g,m[p],S,w,1)}if(a)for(var v=0;v<n.length;v++)for(var w=0;w<n[v].length&&!(n[v][w]<0);w++)for(var p=w+1;p<n[v].length&&!(n[v][p]<0);p++){var S=o(t[n[v][w]],t[n[v][p]]);Y.heapPush(g,n[v][w],S,n[v][p],1),Y.heapPush(g,n[v][p],S,n[v][w],1)}for(var v=0;v<i;v++){for(var k=Y.buildCandidates(g,f,s,l,r),j=0,w=0;w<f;w++)for(var p=0;p<l;p++){var N=Math.floor(k[0][w][p]);if(!(N<0||te.tauRand(r)<u))for(var R=0;R<l;R++){var O=Math.floor(k[0][w][R]),b=k[2][w][p],V=k[2][w][R];if(!(O<0||!b&&!V)){var S=o(t[N],t[O]);j+=Y.heapPush(g,N,S,O,1),j+=Y.heapPush(g,O,S,N,1)}}}if(j<=h*s*t.length)break}var x=Y.deheapSort(g);return x}}ft.makeNNDescent=hr;function ur(o){function r(t,n,s,i,l){for(var h=0;h<s.length;h++)for(var u=te.rejectionSample(t,n.length,l),a=0;a<u.length;a++)if(!(u[a]<0)){var f=o(n[u[a]],s[h]);Y.heapPush(i,h,f,u[a],1)}}function e(t,n,s,i,l){for(var h=0;h<s.length;h++)for(var u=lr.searchFlatTree(s[h],t,l),a=0;a<u.length;a++){if(u[a]<0)return;var f=o(n[u[a]],s[h]);Y.heapPush(i,h,f,u[a],1)}}return{initFromRandom:r,initFromTree:e}}ft.makeInitializations=ur;function ar(o){return function(e,t,n,s){for(var i,l,h=ir.getCSR(t),u=h.indices,a=h.indptr,f=0;f<s.length;f++)for(var g=new Set(n[0][f]);;){var w=Y.smallestFlagged(n,f);if(w===-1)break;var m=u.slice(a[w],a[w+1]);try{for(var p=At(m),S=p.next();!S.done;S=p.next()){var v=S.value;if(!(v===w||v===-1||g.has(v))){var k=o(e[v],s[f]);Y.uncheckedHeapPush(n,f,k,v,1),g.add(v)}}}catch(j){i={error:j}}finally{try{S&&!S.done&&(l=p.return)&&l.call(p)}finally{if(i)throw i.error}}}return n}}ft.makeInitializedNNSearch=ar;function fr(o,r,e,t,n,s,i){var l,h,u=Y.makeHeap(e.length,t);if(n(t,r,e,u,i),o)try{for(var a=At(o),f=a.next();!f.done;f=a.next()){var g=f.value;s(g,r,e,u,i)}}catch(w){l={error:w}}finally{try{f&&!f.done&&(h=a.return)&&h.call(a)}finally{if(l)throw l.error}}return u}ft.initializeSearch=fr;const cr=Object.prototype.toString;function Nt(o){return cr.call(o).endsWith("Array]")}function Vt(o,r,e){let t=0;const n=e(r);for(let s=0;s<o.x.length;s++)t+=Math.abs(o.y[s]-n(o.x[s]));return t}const gr=Object.prototype.toString;function Z(o){const r=gr.call(o);return r.endsWith("Array]")&&!r.includes("Big")}function mr(o){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Z(o))throw new TypeError("input must be an array");if(o.length===0)throw new TypeError("input must not be empty");var e=r.fromIndex,t=e===void 0?0:e,n=r.toIndex,s=n===void 0?o.length:n;if(t<0||t>=o.length||!Number.isInteger(t))throw new Error("fromIndex must be a positive integer smaller than length");if(s<=t||s>o.length||!Number.isInteger(s))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var i=o[t],l=t+1;l<s;l++)o[l]>i&&(i=o[l]);return i}function pr(o){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!Z(o))throw new TypeError("input must be an array");if(o.length===0)throw new TypeError("input must not be empty");var e=r.fromIndex,t=e===void 0?0:e,n=r.toIndex,s=n===void 0?o.length:n;if(t<0||t>=o.length||!Number.isInteger(t))throw new Error("fromIndex must be a positive integer smaller than length");if(s<=t||s>o.length||!Number.isInteger(s))throw new Error("toIndex must be an integer greater than fromIndex and at most equal to length");for(var i=o[t],l=t+1;l<s;l++)o[l]<i&&(i=o[l]);return i}function Ot(o){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(Z(o)){if(o.length===0)throw new TypeError("input must not be empty")}else throw new TypeError("input must be an array");var e;if(r.output!==void 0){if(!Z(r.output))throw new TypeError("output option must be an array if specified");e=r.output}else e=new Array(o.length);var t=pr(o),n=mr(o);if(t===n)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var s=r.min,i=s===void 0?r.autoMinMax?t:0:s,l=r.max,h=l===void 0?r.autoMinMax?n:1:l;if(i>=h)throw new RangeError("min option must be smaller than max option");for(var u=(h-i)/(n-t),a=0;a<o.length;a++)e[a]=(o[a]-t)*u+i;return e}const pt=" ".repeat(2),ee=" ".repeat(4);function wr(){return re(this)}function re(o,r={}){const{maxRows:e=15,maxColumns:t=10,maxNumSize:n=8,padMinus:s="auto"}=r;return`${o.constructor.name} {
${pt}[
${ee}${vr(o,e,t,n,s)}
${pt}]
${pt}rows: ${o.rows}
${pt}columns: ${o.columns}
}`}function vr(o,r,e,t,n){const{rows:s,columns:i}=o,l=Math.min(s,r),h=Math.min(i,e),u=[];if(n==="auto"){n=!1;t:for(let a=0;a<l;a++)for(let f=0;f<h;f++)if(o.get(a,f)<0){n=!0;break t}}for(let a=0;a<l;a++){let f=[];for(let g=0;g<h;g++)f.push(dr(o.get(a,g),t,n));u.push(`${f.join(" ")}`)}return h!==i&&(u[u.length-1]+=` ... ${i-e} more columns`),l!==s&&u.push(`... ${s-r} more rows`),u.join(`
${ee}`)}function dr(o,r,e){return(o>=0&&e?` ${$t(o,r-1)}`:$t(o,r)).padEnd(r)}function $t(o,r){let e=o.toString();if(e.length<=r)return e;let t=o.toFixed(r);if(t.length>r&&(t=o.toFixed(Math.max(0,r-(t.length-r)))),t.length<=r&&!t.startsWith("0.000")&&!t.startsWith("-0.000"))return t;let n=o.toExponential(r);return n.length>r&&(n=o.toExponential(Math.max(0,r-(n.length-r)))),n.slice(0)}function yr(o,r){o.prototype.add=function(t){return typeof t=="number"?this.addS(t):this.addM(t)},o.prototype.addS=function(t){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)+t);return this},o.prototype.addM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)+t.get(n,s));return this},o.add=function(t,n){return new r(t).add(n)},o.prototype.sub=function(t){return typeof t=="number"?this.subS(t):this.subM(t)},o.prototype.subS=function(t){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)-t);return this},o.prototype.subM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)-t.get(n,s));return this},o.sub=function(t,n){return new r(t).sub(n)},o.prototype.subtract=o.prototype.sub,o.prototype.subtractS=o.prototype.subS,o.prototype.subtractM=o.prototype.subM,o.subtract=o.sub,o.prototype.mul=function(t){return typeof t=="number"?this.mulS(t):this.mulM(t)},o.prototype.mulS=function(t){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)*t);return this},o.prototype.mulM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)*t.get(n,s));return this},o.mul=function(t,n){return new r(t).mul(n)},o.prototype.multiply=o.prototype.mul,o.prototype.multiplyS=o.prototype.mulS,o.prototype.multiplyM=o.prototype.mulM,o.multiply=o.mul,o.prototype.div=function(t){return typeof t=="number"?this.divS(t):this.divM(t)},o.prototype.divS=function(t){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)/t);return this},o.prototype.divM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)/t.get(n,s));return this},o.div=function(t,n){return new r(t).div(n)},o.prototype.divide=o.prototype.div,o.prototype.divideS=o.prototype.divS,o.prototype.divideM=o.prototype.divM,o.divide=o.div,o.prototype.mod=function(t){return typeof t=="number"?this.modS(t):this.modM(t)},o.prototype.modS=function(t){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)%t);return this},o.prototype.modM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)%t.get(n,s));return this},o.mod=function(t,n){return new r(t).mod(n)},o.prototype.modulus=o.prototype.mod,o.prototype.modulusS=o.prototype.modS,o.prototype.modulusM=o.prototype.modM,o.modulus=o.mod,o.prototype.and=function(t){return typeof t=="number"?this.andS(t):this.andM(t)},o.prototype.andS=function(t){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)&t);return this},o.prototype.andM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)&t.get(n,s));return this},o.and=function(t,n){return new r(t).and(n)},o.prototype.or=function(t){return typeof t=="number"?this.orS(t):this.orM(t)},o.prototype.orS=function(t){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)|t);return this},o.prototype.orM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)|t.get(n,s));return this},o.or=function(t,n){return new r(t).or(n)},o.prototype.xor=function(t){return typeof t=="number"?this.xorS(t):this.xorM(t)},o.prototype.xorS=function(t){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)^t);return this},o.prototype.xorM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)^t.get(n,s));return this},o.xor=function(t,n){return new r(t).xor(n)},o.prototype.leftShift=function(t){return typeof t=="number"?this.leftShiftS(t):this.leftShiftM(t)},o.prototype.leftShiftS=function(t){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)<<t);return this},o.prototype.leftShiftM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)<<t.get(n,s));return this},o.leftShift=function(t,n){return new r(t).leftShift(n)},o.prototype.signPropagatingRightShift=function(t){return typeof t=="number"?this.signPropagatingRightShiftS(t):this.signPropagatingRightShiftM(t)},o.prototype.signPropagatingRightShiftS=function(t){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)>>t);return this},o.prototype.signPropagatingRightShiftM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)>>t.get(n,s));return this},o.signPropagatingRightShift=function(t,n){return new r(t).signPropagatingRightShift(n)},o.prototype.rightShift=function(t){return typeof t=="number"?this.rightShiftS(t):this.rightShiftM(t)},o.prototype.rightShiftS=function(t){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)>>>t);return this},o.prototype.rightShiftM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,this.get(n,s)>>>t.get(n,s));return this},o.rightShift=function(t,n){return new r(t).rightShift(n)},o.prototype.zeroFillRightShift=o.prototype.rightShift,o.prototype.zeroFillRightShiftS=o.prototype.rightShiftS,o.prototype.zeroFillRightShiftM=o.prototype.rightShiftM,o.zeroFillRightShift=o.rightShift,o.prototype.not=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,~this.get(t,n));return this},o.not=function(t){return new r(t).not()},o.prototype.abs=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.abs(this.get(t,n)));return this},o.abs=function(t){return new r(t).abs()},o.prototype.acos=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.acos(this.get(t,n)));return this},o.acos=function(t){return new r(t).acos()},o.prototype.acosh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.acosh(this.get(t,n)));return this},o.acosh=function(t){return new r(t).acosh()},o.prototype.asin=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.asin(this.get(t,n)));return this},o.asin=function(t){return new r(t).asin()},o.prototype.asinh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.asinh(this.get(t,n)));return this},o.asinh=function(t){return new r(t).asinh()},o.prototype.atan=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.atan(this.get(t,n)));return this},o.atan=function(t){return new r(t).atan()},o.prototype.atanh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.atanh(this.get(t,n)));return this},o.atanh=function(t){return new r(t).atanh()},o.prototype.cbrt=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.cbrt(this.get(t,n)));return this},o.cbrt=function(t){return new r(t).cbrt()},o.prototype.ceil=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.ceil(this.get(t,n)));return this},o.ceil=function(t){return new r(t).ceil()},o.prototype.clz32=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.clz32(this.get(t,n)));return this},o.clz32=function(t){return new r(t).clz32()},o.prototype.cos=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.cos(this.get(t,n)));return this},o.cos=function(t){return new r(t).cos()},o.prototype.cosh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.cosh(this.get(t,n)));return this},o.cosh=function(t){return new r(t).cosh()},o.prototype.exp=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.exp(this.get(t,n)));return this},o.exp=function(t){return new r(t).exp()},o.prototype.expm1=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.expm1(this.get(t,n)));return this},o.expm1=function(t){return new r(t).expm1()},o.prototype.floor=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.floor(this.get(t,n)));return this},o.floor=function(t){return new r(t).floor()},o.prototype.fround=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.fround(this.get(t,n)));return this},o.fround=function(t){return new r(t).fround()},o.prototype.log=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.log(this.get(t,n)));return this},o.log=function(t){return new r(t).log()},o.prototype.log1p=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.log1p(this.get(t,n)));return this},o.log1p=function(t){return new r(t).log1p()},o.prototype.log10=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.log10(this.get(t,n)));return this},o.log10=function(t){return new r(t).log10()},o.prototype.log2=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.log2(this.get(t,n)));return this},o.log2=function(t){return new r(t).log2()},o.prototype.round=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.round(this.get(t,n)));return this},o.round=function(t){return new r(t).round()},o.prototype.sign=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.sign(this.get(t,n)));return this},o.sign=function(t){return new r(t).sign()},o.prototype.sin=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.sin(this.get(t,n)));return this},o.sin=function(t){return new r(t).sin()},o.prototype.sinh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.sinh(this.get(t,n)));return this},o.sinh=function(t){return new r(t).sinh()},o.prototype.sqrt=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.sqrt(this.get(t,n)));return this},o.sqrt=function(t){return new r(t).sqrt()},o.prototype.tan=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.tan(this.get(t,n)));return this},o.tan=function(t){return new r(t).tan()},o.prototype.tanh=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.tanh(this.get(t,n)));return this},o.tanh=function(t){return new r(t).tanh()},o.prototype.trunc=function(){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.set(t,n,Math.trunc(this.get(t,n)));return this},o.trunc=function(t){return new r(t).trunc()},o.pow=function(t,n){return new r(t).pow(n)},o.prototype.pow=function(t){return typeof t=="number"?this.powS(t):this.powM(t)},o.prototype.powS=function(t){for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.pow(this.get(n,s),t));return this},o.prototype.powM=function(t){if(t=r.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let n=0;n<this.rows;n++)for(let s=0;s<this.columns;s++)this.set(n,s,Math.pow(this.get(n,s),t.get(n,s)));return this}}function H(o,r,e){let t=e?o.rows:o.rows-1;if(r<0||r>t)throw new RangeError("Row index out of range")}function A(o,r,e){let t=e?o.columns:o.columns-1;if(r<0||r>t)throw new RangeError("Column index out of range")}function lt(o,r){if(r.to1DArray&&(r=r.to1DArray()),r.length!==o.columns)throw new RangeError("vector size must be the same as the number of columns");return r}function ht(o,r){if(r.to1DArray&&(r=r.to1DArray()),r.length!==o.rows)throw new RangeError("vector size must be the same as the number of rows");return r}function Sr(o,r){if(!Z(r))throw new TypeError("row indices must be an array");for(let e=0;e<r.length;e++)if(r[e]<0||r[e]>=o.rows)throw new RangeError("row indices are out of range")}function Er(o,r){if(!Z(r))throw new TypeError("column indices must be an array");for(let e=0;e<r.length;e++)if(r[e]<0||r[e]>=o.columns)throw new RangeError("column indices are out of range")}function Lt(o,r,e,t,n){if(arguments.length!==5)throw new RangeError("expected 4 arguments");if(wt("startRow",r),wt("endRow",e),wt("startColumn",t),wt("endColumn",n),r>e||t>n||r<0||r>=o.rows||e<0||e>=o.rows||t<0||t>=o.columns||n<0||n>=o.columns)throw new RangeError("Submatrix indices are out of range")}function jt(o,r=0){let e=[];for(let t=0;t<o;t++)e.push(r);return e}function wt(o,r){if(typeof r!="number")throw new TypeError(`${o} must be a number`)}function it(o){if(o.isEmpty())throw new Error("Empty matrix has no elements to index")}function Mr(o){let r=jt(o.rows);for(let e=0;e<o.rows;++e)for(let t=0;t<o.columns;++t)r[e]+=o.get(e,t);return r}function br(o){let r=jt(o.columns);for(let e=0;e<o.rows;++e)for(let t=0;t<o.columns;++t)r[t]+=o.get(e,t);return r}function jr(o){let r=0;for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)r+=o.get(e,t);return r}function Nr(o){let r=jt(o.rows,1);for(let e=0;e<o.rows;++e)for(let t=0;t<o.columns;++t)r[e]*=o.get(e,t);return r}function kr(o){let r=jt(o.columns,1);for(let e=0;e<o.rows;++e)for(let t=0;t<o.columns;++t)r[t]*=o.get(e,t);return r}function Rr(o){let r=1;for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)r*=o.get(e,t);return r}function _r(o,r,e){const t=o.rows,n=o.columns,s=[];for(let i=0;i<t;i++){let l=0,h=0,u=0;for(let a=0;a<n;a++)u=o.get(i,a)-e[i],l+=u,h+=u*u;r?s.push((h-l*l/n)/(n-1)):s.push((h-l*l/n)/n)}return s}function zr(o,r,e){const t=o.rows,n=o.columns,s=[];for(let i=0;i<n;i++){let l=0,h=0,u=0;for(let a=0;a<t;a++)u=o.get(a,i)-e[i],l+=u,h+=u*u;r?s.push((h-l*l/t)/(t-1)):s.push((h-l*l/t)/t)}return s}function Ir(o,r,e){const t=o.rows,n=o.columns,s=t*n;let i=0,l=0,h=0;for(let u=0;u<t;u++)for(let a=0;a<n;a++)h=o.get(u,a)-e,i+=h,l+=h*h;return r?(l-i*i/s)/(s-1):(l-i*i/s)/s}function Pr(o,r){for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)o.set(e,t,o.get(e,t)-r[e])}function Tr(o,r){for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)o.set(e,t,o.get(e,t)-r[t])}function Fr(o,r){for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)o.set(e,t,o.get(e,t)-r)}function Vr(o){const r=[];for(let e=0;e<o.rows;e++){let t=0;for(let n=0;n<o.columns;n++)t+=Math.pow(o.get(e,n),2)/(o.columns-1);r.push(Math.sqrt(t))}return r}function Or(o,r){for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)o.set(e,t,o.get(e,t)/r[e])}function $r(o){const r=[];for(let e=0;e<o.columns;e++){let t=0;for(let n=0;n<o.rows;n++)t+=Math.pow(o.get(n,e),2)/(o.rows-1);r.push(Math.sqrt(t))}return r}function Lr(o,r){for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)o.set(e,t,o.get(e,t)/r[t])}function qr(o){const r=o.size-1;let e=0;for(let t=0;t<o.columns;t++)for(let n=0;n<o.rows;n++)e+=Math.pow(o.get(n,t),2)/r;return Math.sqrt(e)}function Cr(o,r){for(let e=0;e<o.rows;e++)for(let t=0;t<o.columns;t++)o.set(e,t,o.get(e,t)/r)}class _{static from1DArray(r,e,t){if(r*e!==t.length)throw new RangeError("data length does not match given dimensions");let s=new M(r,e);for(let i=0;i<r;i++)for(let l=0;l<e;l++)s.set(i,l,t[i*e+l]);return s}static rowVector(r){let e=new M(1,r.length);for(let t=0;t<r.length;t++)e.set(0,t,r[t]);return e}static columnVector(r){let e=new M(r.length,1);for(let t=0;t<r.length;t++)e.set(t,0,r[t]);return e}static zeros(r,e){return new M(r,e)}static ones(r,e){return new M(r,e).fill(1)}static rand(r,e,t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{random:n=Math.random}=t;let s=new M(r,e);for(let i=0;i<r;i++)for(let l=0;l<e;l++)s.set(i,l,n());return s}static randInt(r,e,t={}){if(typeof t!="object")throw new TypeError("options must be an object");const{min:n=0,max:s=1e3,random:i=Math.random}=t;if(!Number.isInteger(n))throw new TypeError("min must be an integer");if(!Number.isInteger(s))throw new TypeError("max must be an integer");if(n>=s)throw new RangeError("min must be smaller than max");let l=s-n,h=new M(r,e);for(let u=0;u<r;u++)for(let a=0;a<e;a++){let f=n+Math.round(i()*l);h.set(u,a,f)}return h}static eye(r,e,t){e===void 0&&(e=r),t===void 0&&(t=1);let n=Math.min(r,e),s=this.zeros(r,e);for(let i=0;i<n;i++)s.set(i,i,t);return s}static diag(r,e,t){let n=r.length;e===void 0&&(e=n),t===void 0&&(t=e);let s=Math.min(n,e,t),i=this.zeros(e,t);for(let l=0;l<s;l++)i.set(l,l,r[l]);return i}static min(r,e){r=this.checkMatrix(r),e=this.checkMatrix(e);let t=r.rows,n=r.columns,s=new M(t,n);for(let i=0;i<t;i++)for(let l=0;l<n;l++)s.set(i,l,Math.min(r.get(i,l),e.get(i,l)));return s}static max(r,e){r=this.checkMatrix(r),e=this.checkMatrix(e);let t=r.rows,n=r.columns,s=new this(t,n);for(let i=0;i<t;i++)for(let l=0;l<n;l++)s.set(i,l,Math.max(r.get(i,l),e.get(i,l)));return s}static checkMatrix(r){return _.isMatrix(r)?r:new M(r)}static isMatrix(r){return r!=null&&r.klass==="Matrix"}get size(){return this.rows*this.columns}apply(r){if(typeof r!="function")throw new TypeError("callback must be a function");for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)r.call(this,e,t);return this}to1DArray(){let r=[];for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)r.push(this.get(e,t));return r}to2DArray(){let r=[];for(let e=0;e<this.rows;e++){r.push([]);for(let t=0;t<this.columns;t++)r[e].push(this.get(e,t))}return r}toJSON(){return this.to2DArray()}isRowVector(){return this.rows===1}isColumnVector(){return this.columns===1}isVector(){return this.rows===1||this.columns===1}isSquare(){return this.rows===this.columns}isEmpty(){return this.rows===0||this.columns===0}isSymmetric(){if(this.isSquare()){for(let r=0;r<this.rows;r++)for(let e=0;e<=r;e++)if(this.get(r,e)!==this.get(e,r))return!1;return!0}return!1}isEchelonForm(){let r=0,e=0,t=-1,n=!0,s=!1;for(;r<this.rows&&n;){for(e=0,s=!1;e<this.columns&&s===!1;)this.get(r,e)===0?e++:this.get(r,e)===1&&e>t?(s=!0,t=e):(n=!1,s=!0);r++}return n}isReducedEchelonForm(){let r=0,e=0,t=-1,n=!0,s=!1;for(;r<this.rows&&n;){for(e=0,s=!1;e<this.columns&&s===!1;)this.get(r,e)===0?e++:this.get(r,e)===1&&e>t?(s=!0,t=e):(n=!1,s=!0);for(let i=e+1;i<this.rows;i++)this.get(r,i)!==0&&(n=!1);r++}return n}echelonForm(){let r=this.clone(),e=0,t=0;for(;e<r.rows&&t<r.columns;){let n=e;for(let s=e;s<r.rows;s++)r.get(s,t)>r.get(n,t)&&(n=s);if(r.get(n,t)===0)t++;else{r.swapRows(e,n);let s=r.get(e,t);for(let i=t;i<r.columns;i++)r.set(e,i,r.get(e,i)/s);for(let i=e+1;i<r.rows;i++){let l=r.get(i,t)/r.get(e,t);r.set(i,t,0);for(let h=t+1;h<r.columns;h++)r.set(i,h,r.get(i,h)-r.get(e,h)*l)}e++,t++}}return r}reducedEchelonForm(){let r=this.echelonForm(),e=r.columns,t=r.rows,n=t-1;for(;n>=0;)if(r.maxRow(n)===0)n--;else{let s=0,i=!1;for(;s<t&&i===!1;)r.get(n,s)===1?i=!0:s++;for(let l=0;l<n;l++){let h=r.get(l,s);for(let u=s;u<e;u++){let a=r.get(l,u)-h*r.get(n,u);r.set(l,u,a)}}n--}return r}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(r={}){if(typeof r!="object")throw new TypeError("options must be an object");const{rows:e=1,columns:t=1}=r;if(!Number.isInteger(e)||e<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(t)||t<=0)throw new TypeError("columns must be a positive integer");let n=new M(this.rows*e,this.columns*t);for(let s=0;s<e;s++)for(let i=0;i<t;i++)n.setSubMatrix(this,this.rows*s,this.columns*i);return n}fill(r){for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,r);return this}neg(){return this.mulS(-1)}getRow(r){H(this,r);let e=[];for(let t=0;t<this.columns;t++)e.push(this.get(r,t));return e}getRowVector(r){return M.rowVector(this.getRow(r))}setRow(r,e){H(this,r),e=lt(this,e);for(let t=0;t<this.columns;t++)this.set(r,t,e[t]);return this}swapRows(r,e){H(this,r),H(this,e);for(let t=0;t<this.columns;t++){let n=this.get(r,t);this.set(r,t,this.get(e,t)),this.set(e,t,n)}return this}getColumn(r){A(this,r);let e=[];for(let t=0;t<this.rows;t++)e.push(this.get(t,r));return e}getColumnVector(r){return M.columnVector(this.getColumn(r))}setColumn(r,e){A(this,r),e=ht(this,e);for(let t=0;t<this.rows;t++)this.set(t,r,e[t]);return this}swapColumns(r,e){A(this,r),A(this,e);for(let t=0;t<this.rows;t++){let n=this.get(t,r);this.set(t,r,this.get(t,e)),this.set(t,e,n)}return this}addRowVector(r){r=lt(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)+r[t]);return this}subRowVector(r){r=lt(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)-r[t]);return this}mulRowVector(r){r=lt(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)*r[t]);return this}divRowVector(r){r=lt(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)/r[t]);return this}addColumnVector(r){r=ht(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)+r[e]);return this}subColumnVector(r){r=ht(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)-r[e]);return this}mulColumnVector(r){r=ht(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)*r[e]);return this}divColumnVector(r){r=ht(this,r);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)this.set(e,t,this.get(e,t)/r[e]);return this}mulRow(r,e){H(this,r);for(let t=0;t<this.columns;t++)this.set(r,t,this.get(r,t)*e);return this}mulColumn(r,e){A(this,r);for(let t=0;t<this.rows;t++)this.set(t,r,this.get(t,r)*e);return this}max(r){if(this.isEmpty())return NaN;switch(r){case"row":{const e=new Array(this.rows).fill(Number.NEGATIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)>e[t]&&(e[t]=this.get(t,n));return e}case"column":{const e=new Array(this.columns).fill(Number.NEGATIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)>e[n]&&(e[n]=this.get(t,n));return e}case void 0:{let e=this.get(0,0);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)>e&&(e=this.get(t,n));return e}default:throw new Error(`invalid option: ${r}`)}}maxIndex(){it(this);let r=this.get(0,0),e=[0,0];for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)>r&&(r=this.get(t,n),e[0]=t,e[1]=n);return e}min(r){if(this.isEmpty())return NaN;switch(r){case"row":{const e=new Array(this.rows).fill(Number.POSITIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)<e[t]&&(e[t]=this.get(t,n));return e}case"column":{const e=new Array(this.columns).fill(Number.POSITIVE_INFINITY);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)<e[n]&&(e[n]=this.get(t,n));return e}case void 0:{let e=this.get(0,0);for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)<e&&(e=this.get(t,n));return e}default:throw new Error(`invalid option: ${r}`)}}minIndex(){it(this);let r=this.get(0,0),e=[0,0];for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)this.get(t,n)<r&&(r=this.get(t,n),e[0]=t,e[1]=n);return e}maxRow(r){if(H(this,r),this.isEmpty())return NaN;let e=this.get(r,0);for(let t=1;t<this.columns;t++)this.get(r,t)>e&&(e=this.get(r,t));return e}maxRowIndex(r){H(this,r),it(this);let e=this.get(r,0),t=[r,0];for(let n=1;n<this.columns;n++)this.get(r,n)>e&&(e=this.get(r,n),t[1]=n);return t}minRow(r){if(H(this,r),this.isEmpty())return NaN;let e=this.get(r,0);for(let t=1;t<this.columns;t++)this.get(r,t)<e&&(e=this.get(r,t));return e}minRowIndex(r){H(this,r),it(this);let e=this.get(r,0),t=[r,0];for(let n=1;n<this.columns;n++)this.get(r,n)<e&&(e=this.get(r,n),t[1]=n);return t}maxColumn(r){if(A(this,r),this.isEmpty())return NaN;let e=this.get(0,r);for(let t=1;t<this.rows;t++)this.get(t,r)>e&&(e=this.get(t,r));return e}maxColumnIndex(r){A(this,r),it(this);let e=this.get(0,r),t=[0,r];for(let n=1;n<this.rows;n++)this.get(n,r)>e&&(e=this.get(n,r),t[0]=n);return t}minColumn(r){if(A(this,r),this.isEmpty())return NaN;let e=this.get(0,r);for(let t=1;t<this.rows;t++)this.get(t,r)<e&&(e=this.get(t,r));return e}minColumnIndex(r){A(this,r),it(this);let e=this.get(0,r),t=[0,r];for(let n=1;n<this.rows;n++)this.get(n,r)<e&&(e=this.get(n,r),t[0]=n);return t}diag(){let r=Math.min(this.rows,this.columns),e=[];for(let t=0;t<r;t++)e.push(this.get(t,t));return e}norm(r="frobenius"){let e=0;if(r==="max")return this.max();if(r==="frobenius"){for(let t=0;t<this.rows;t++)for(let n=0;n<this.columns;n++)e=e+this.get(t,n)*this.get(t,n);return Math.sqrt(e)}else throw new RangeError(`unknown norm type: ${r}`)}cumulativeSum(){let r=0;for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)r+=this.get(e,t),this.set(e,t,r);return this}dot(r){_.isMatrix(r)&&(r=r.to1DArray());let e=this.to1DArray();if(e.length!==r.length)throw new RangeError("vectors do not have the same size");let t=0;for(let n=0;n<e.length;n++)t+=e[n]*r[n];return t}mmul(r){r=M.checkMatrix(r);let e=this.rows,t=this.columns,n=r.columns,s=new M(e,n),i=new Float64Array(t);for(let l=0;l<n;l++){for(let h=0;h<t;h++)i[h]=r.get(h,l);for(let h=0;h<e;h++){let u=0;for(let a=0;a<t;a++)u+=this.get(h,a)*i[a];s.set(h,l,u)}}return s}strassen2x2(r){r=M.checkMatrix(r);let e=new M(2,2);const t=this.get(0,0),n=r.get(0,0),s=this.get(0,1),i=r.get(0,1),l=this.get(1,0),h=r.get(1,0),u=this.get(1,1),a=r.get(1,1),f=(t+u)*(n+a),g=(l+u)*n,w=t*(i-a),m=u*(h-n),p=(t+s)*a,S=(l-t)*(n+i),v=(s-u)*(h+a),k=f+m-p+v,j=w+p,N=g+m,R=f-g+w+S;return e.set(0,0,k),e.set(0,1,j),e.set(1,0,N),e.set(1,1,R),e}strassen3x3(r){r=M.checkMatrix(r);let e=new M(3,3);const t=this.get(0,0),n=this.get(0,1),s=this.get(0,2),i=this.get(1,0),l=this.get(1,1),h=this.get(1,2),u=this.get(2,0),a=this.get(2,1),f=this.get(2,2),g=r.get(0,0),w=r.get(0,1),m=r.get(0,2),p=r.get(1,0),S=r.get(1,1),v=r.get(1,2),k=r.get(2,0),j=r.get(2,1),N=r.get(2,2),R=(t+n+s-i-l-a-f)*S,O=(t-i)*(-w+S),b=l*(-g+w+p-S-v-k+N),V=(-t+i+l)*(g-w+S),x=(i+l)*(-g+w),c=t*g,d=(-t+u+a)*(g-m+v),E=(-t+u)*(m-v),y=(u+a)*(-g+m),$=(t+n+s-l-h-u-a)*v,T=a*(-g+m+p-S-v-k+j),P=(-s+a+f)*(S+k-j),F=(s-f)*(S-j),q=s*k,G=(a+f)*(-k+j),B=(-s+l+h)*(v+k-N),tt=(s-h)*(v-N),rt=(l+h)*(-k+N),z=n*p,W=h*j,X=i*m,J=u*w,U=f*N,ue=c+q+z,ae=R+V+x+c+P+q+G,fe=c+d+y+$+q+B+rt,ce=O+b+V+c+q+B+tt,ge=O+V+x+c+W,me=q+B+tt+rt+X,pe=c+d+E+T+P+F+q,we=P+F+q+G+J,ve=c+d+E+y+U;return e.set(0,0,ue),e.set(0,1,ae),e.set(0,2,fe),e.set(1,0,ce),e.set(1,1,ge),e.set(1,2,me),e.set(2,0,pe),e.set(2,1,we),e.set(2,2,ve),e}mmulStrassen(r){r=M.checkMatrix(r);let e=this.clone(),t=e.rows,n=e.columns,s=r.rows,i=r.columns;n!==s&&console.warn(`Multiplying ${t} x ${n} and ${s} x ${i} matrix: dimensions do not match.`);function l(f,g,w){let m=f.rows,p=f.columns;if(m===g&&p===w)return f;{let S=_.zeros(g,w);return S=S.setSubMatrix(f,0,0),S}}let h=Math.max(t,s),u=Math.max(n,i);e=l(e,h,u),r=l(r,h,u);function a(f,g,w,m){if(w<=512||m<=512)return f.mmul(g);w%2===1&&m%2===1?(f=l(f,w+1,m+1),g=l(g,w+1,m+1)):w%2===1?(f=l(f,w+1,m),g=l(g,w+1,m)):m%2===1&&(f=l(f,w,m+1),g=l(g,w,m+1));let p=parseInt(f.rows/2,10),S=parseInt(f.columns/2,10),v=f.subMatrix(0,p-1,0,S-1),k=g.subMatrix(0,p-1,0,S-1),j=f.subMatrix(0,p-1,S,f.columns-1),N=g.subMatrix(0,p-1,S,g.columns-1),R=f.subMatrix(p,f.rows-1,0,S-1),O=g.subMatrix(p,g.rows-1,0,S-1),b=f.subMatrix(p,f.rows-1,S,f.columns-1),V=g.subMatrix(p,g.rows-1,S,g.columns-1),x=a(_.add(v,b),_.add(k,V),p,S),c=a(_.add(R,b),k,p,S),d=a(v,_.sub(N,V),p,S),E=a(b,_.sub(O,k),p,S),y=a(_.add(v,j),V,p,S),$=a(_.sub(R,v),_.add(k,N),p,S),T=a(_.sub(j,b),_.add(O,V),p,S),P=_.add(x,E);P.sub(y),P.add(T);let F=_.add(d,y),q=_.add(c,E),G=_.sub(x,c);G.add(d),G.add($);let B=_.zeros(2*P.rows,2*P.columns);return B=B.setSubMatrix(P,0,0),B=B.setSubMatrix(F,P.rows,0),B=B.setSubMatrix(q,0,P.columns),B=B.setSubMatrix(G,P.rows,P.columns),B.subMatrix(0,w-1,0,m-1)}return a(e,r,h,u)}scaleRows(r={}){if(typeof r!="object")throw new TypeError("options must be an object");const{min:e=0,max:t=1}=r;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(t))throw new TypeError("max must be a number");if(e>=t)throw new RangeError("min must be smaller than max");let n=new M(this.rows,this.columns);for(let s=0;s<this.rows;s++){const i=this.getRow(s);i.length>0&&Ot(i,{min:e,max:t,output:i}),n.setRow(s,i)}return n}scaleColumns(r={}){if(typeof r!="object")throw new TypeError("options must be an object");const{min:e=0,max:t=1}=r;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(t))throw new TypeError("max must be a number");if(e>=t)throw new RangeError("min must be smaller than max");let n=new M(this.rows,this.columns);for(let s=0;s<this.columns;s++){const i=this.getColumn(s);i.length&&Ot(i,{min:e,max:t,output:i}),n.setColumn(s,i)}return n}flipRows(){const r=Math.ceil(this.columns/2);for(let e=0;e<this.rows;e++)for(let t=0;t<r;t++){let n=this.get(e,t),s=this.get(e,this.columns-1-t);this.set(e,t,s),this.set(e,this.columns-1-t,n)}return this}flipColumns(){const r=Math.ceil(this.rows/2);for(let e=0;e<this.columns;e++)for(let t=0;t<r;t++){let n=this.get(t,e),s=this.get(this.rows-1-t,e);this.set(t,e,s),this.set(this.rows-1-t,e,n)}return this}kroneckerProduct(r){r=M.checkMatrix(r);let e=this.rows,t=this.columns,n=r.rows,s=r.columns,i=new M(e*n,t*s);for(let l=0;l<e;l++)for(let h=0;h<t;h++)for(let u=0;u<n;u++)for(let a=0;a<s;a++)i.set(n*l+u,s*h+a,this.get(l,h)*r.get(u,a));return i}kroneckerSum(r){if(r=M.checkMatrix(r),!this.isSquare()||!r.isSquare())throw new Error("Kronecker Sum needs two Square Matrices");let e=this.rows,t=r.rows,n=this.kroneckerProduct(M.eye(t,t)),s=M.eye(e,e).kroneckerProduct(r);return n.add(s)}transpose(){let r=new M(this.columns,this.rows);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)r.set(t,e,this.get(e,t));return r}sortRows(r=qt){for(let e=0;e<this.rows;e++)this.setRow(e,this.getRow(e).sort(r));return this}sortColumns(r=qt){for(let e=0;e<this.columns;e++)this.setColumn(e,this.getColumn(e).sort(r));return this}subMatrix(r,e,t,n){Lt(this,r,e,t,n);let s=new M(e-r+1,n-t+1);for(let i=r;i<=e;i++)for(let l=t;l<=n;l++)s.set(i-r,l-t,this.get(i,l));return s}subMatrixRow(r,e,t){if(e===void 0&&(e=0),t===void 0&&(t=this.columns-1),e>t||e<0||e>=this.columns||t<0||t>=this.columns)throw new RangeError("Argument out of range");let n=new M(r.length,t-e+1);for(let s=0;s<r.length;s++)for(let i=e;i<=t;i++){if(r[s]<0||r[s]>=this.rows)throw new RangeError(`Row index out of range: ${r[s]}`);n.set(s,i-e,this.get(r[s],i))}return n}subMatrixColumn(r,e,t){if(e===void 0&&(e=0),t===void 0&&(t=this.rows-1),e>t||e<0||e>=this.rows||t<0||t>=this.rows)throw new RangeError("Argument out of range");let n=new M(t-e+1,r.length);for(let s=0;s<r.length;s++)for(let i=e;i<=t;i++){if(r[s]<0||r[s]>=this.columns)throw new RangeError(`Column index out of range: ${r[s]}`);n.set(i-e,s,this.get(i,r[s]))}return n}setSubMatrix(r,e,t){if(r=M.checkMatrix(r),r.isEmpty())return this;let n=e+r.rows-1,s=t+r.columns-1;Lt(this,e,n,t,s);for(let i=0;i<r.rows;i++)for(let l=0;l<r.columns;l++)this.set(e+i,t+l,r.get(i,l));return this}selection(r,e){Sr(this,r),Er(this,e);let t=new M(r.length,e.length);for(let n=0;n<r.length;n++){let s=r[n];for(let i=0;i<e.length;i++){let l=e[i];t.set(n,i,this.get(s,l))}}return t}trace(){let r=Math.min(this.rows,this.columns),e=0;for(let t=0;t<r;t++)e+=this.get(t,t);return e}clone(){let r=new M(this.rows,this.columns);for(let e=0;e<this.rows;e++)for(let t=0;t<this.columns;t++)r.set(e,t,this.get(e,t));return r}sum(r){switch(r){case"row":return Mr(this);case"column":return br(this);case void 0:return jr(this);default:throw new Error(`invalid option: ${r}`)}}product(r){switch(r){case"row":return Nr(this);case"column":return kr(this);case void 0:return Rr(this);default:throw new Error(`invalid option: ${r}`)}}mean(r){const e=this.sum(r);switch(r){case"row":{for(let t=0;t<this.rows;t++)e[t]/=this.columns;return e}case"column":{for(let t=0;t<this.columns;t++)e[t]/=this.rows;return e}case void 0:return e/this.size;default:throw new Error(`invalid option: ${r}`)}}variance(r,e={}){if(typeof r=="object"&&(e=r,r=void 0),typeof e!="object")throw new TypeError("options must be an object");const{unbiased:t=!0,mean:n=this.mean(r)}=e;if(typeof t!="boolean")throw new TypeError("unbiased must be a boolean");switch(r){case"row":{if(!Z(n))throw new TypeError("mean must be an array");return _r(this,t,n)}case"column":{if(!Z(n))throw new TypeError("mean must be an array");return zr(this,t,n)}case void 0:{if(typeof n!="number")throw new TypeError("mean must be a number");return Ir(this,t,n)}default:throw new Error(`invalid option: ${r}`)}}standardDeviation(r,e){typeof r=="object"&&(e=r,r=void 0);const t=this.variance(r,e);if(r===void 0)return Math.sqrt(t);for(let n=0;n<t.length;n++)t[n]=Math.sqrt(t[n]);return t}center(r,e={}){if(typeof r=="object"&&(e=r,r=void 0),typeof e!="object")throw new TypeError("options must be an object");const{center:t=this.mean(r)}=e;switch(r){case"row":{if(!Z(t))throw new TypeError("center must be an array");return Pr(this,t),this}case"column":{if(!Z(t))throw new TypeError("center must be an array");return Tr(this,t),this}case void 0:{if(typeof t!="number")throw new TypeError("center must be a number");return Fr(this,t),this}default:throw new Error(`invalid option: ${r}`)}}scale(r,e={}){if(typeof r=="object"&&(e=r,r=void 0),typeof e!="object")throw new TypeError("options must be an object");let t=e.scale;switch(r){case"row":{if(t===void 0)t=Vr(this);else if(!Z(t))throw new TypeError("scale must be an array");return Or(this,t),this}case"column":{if(t===void 0)t=$r(this);else if(!Z(t))throw new TypeError("scale must be an array");return Lr(this,t),this}case void 0:{if(t===void 0)t=qr(this);else if(typeof t!="number")throw new TypeError("scale must be a number");return Cr(this,t),this}default:throw new Error(`invalid option: ${r}`)}}toString(r){return re(this,r)}}_.prototype.klass="Matrix";typeof Symbol<"u"&&(_.prototype[Symbol.for("nodejs.util.inspect.custom")]=wr);function qt(o,r){return o-r}function Dr(o){return o.every(r=>typeof r=="number")}_.random=_.rand;_.randomInt=_.randInt;_.diagonal=_.diag;_.prototype.diagonal=_.prototype.diag;_.identity=_.eye;_.prototype.negate=_.prototype.neg;_.prototype.tensorProduct=_.prototype.kroneckerProduct;class M extends _{constructor(r,e){if(super(),M.isMatrix(r))return r.clone();if(Number.isInteger(r)&&r>=0)if(this.data=[],Number.isInteger(e)&&e>=0)for(let t=0;t<r;t++)this.data.push(new Float64Array(e));else throw new TypeError("nColumns must be a positive integer");else if(Z(r)){const t=r;if(r=t.length,e=r?t[0].length:0,typeof e!="number")throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let n=0;n<r;n++){if(t[n].length!==e)throw new RangeError("Inconsistent array dimensions");if(!Dr(t[n]))throw new TypeError("Input data contains non-numeric values");this.data.push(Float64Array.from(t[n]))}}else throw new TypeError("First argument must be a positive number or an array");this.rows=r,this.columns=e}set(r,e,t){return this.data[r][e]=t,this}get(r,e){return this.data[r][e]}removeRow(r){return H(this,r),this.data.splice(r,1),this.rows-=1,this}addRow(r,e){return e===void 0&&(e=r,r=this.rows),H(this,r,!0),e=Float64Array.from(lt(this,e)),this.data.splice(r,0,e),this.rows+=1,this}removeColumn(r){A(this,r);for(let e=0;e<this.rows;e++){const t=new Float64Array(this.columns-1);for(let n=0;n<r;n++)t[n]=this.data[e][n];for(let n=r+1;n<this.columns;n++)t[n-1]=this.data[e][n];this.data[e]=t}return this.columns-=1,this}addColumn(r,e){typeof e>"u"&&(e=r,r=this.columns),A(this,r,!0),e=ht(this,e);for(let t=0;t<this.rows;t++){const n=new Float64Array(this.columns+1);let s=0;for(;s<r;s++)n[s]=this.data[t][s];for(n[s++]=e[t];s<this.columns+1;s++)n[s]=this.data[t][s-1];this.data[t]=n}return this.columns+=1,this}}yr(_,M);class ut extends _{constructor(r){super(),this.data=r,this.rows=r.length,this.columns=r[0].length}set(r,e,t){return this.data[r][e]=t,this}get(r,e){return this.data[r][e]}}class Br{constructor(r){r=ut.checkMatrix(r);let e=r.clone(),t=e.rows,n=e.columns,s=new Float64Array(t),i=1,l,h,u,a,f,g,w,m,p;for(l=0;l<t;l++)s[l]=l;for(m=new Float64Array(t),h=0;h<n;h++){for(l=0;l<t;l++)m[l]=e.get(l,h);for(l=0;l<t;l++){for(p=Math.min(l,h),f=0,u=0;u<p;u++)f+=e.get(l,u)*m[u];m[l]-=f,e.set(l,h,m[l])}for(a=h,l=h+1;l<t;l++)Math.abs(m[l])>Math.abs(m[a])&&(a=l);if(a!==h){for(u=0;u<n;u++)g=e.get(a,u),e.set(a,u,e.get(h,u)),e.set(h,u,g);w=s[a],s[a]=s[h],s[h]=w,i=-i}if(h<t&&e.get(h,h)!==0)for(l=h+1;l<t;l++)e.set(l,h,e.get(l,h)/e.get(h,h))}this.LU=e,this.pivotVector=s,this.pivotSign=i}isSingular(){let r=this.LU,e=r.columns;for(let t=0;t<e;t++)if(r.get(t,t)===0)return!0;return!1}solve(r){r=M.checkMatrix(r);let e=this.LU;if(e.rows!==r.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let n=r.columns,s=r.subMatrixRow(this.pivotVector,0,n-1),i=e.columns,l,h,u;for(u=0;u<i;u++)for(l=u+1;l<i;l++)for(h=0;h<n;h++)s.set(l,h,s.get(l,h)-s.get(u,h)*e.get(l,u));for(u=i-1;u>=0;u--){for(h=0;h<n;h++)s.set(u,h,s.get(u,h)/e.get(u,u));for(l=0;l<u;l++)for(h=0;h<n;h++)s.set(l,h,s.get(l,h)-s.get(u,h)*e.get(l,u))}return s}get determinant(){let r=this.LU;if(!r.isSquare())throw new Error("Matrix must be square");let e=this.pivotSign,t=r.columns;for(let n=0;n<t;n++)e*=r.get(n,n);return e}get lowerTriangularMatrix(){let r=this.LU,e=r.rows,t=r.columns,n=new M(e,t);for(let s=0;s<e;s++)for(let i=0;i<t;i++)s>i?n.set(s,i,r.get(s,i)):s===i?n.set(s,i,1):n.set(s,i,0);return n}get upperTriangularMatrix(){let r=this.LU,e=r.rows,t=r.columns,n=new M(e,t);for(let s=0;s<e;s++)for(let i=0;i<t;i++)s<=i?n.set(s,i,r.get(s,i)):n.set(s,i,0);return n}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function ot(o,r){let e=0;return Math.abs(o)>Math.abs(r)?(e=r/o,Math.abs(o)*Math.sqrt(1+e*e)):r!==0?(e=o/r,Math.abs(r)*Math.sqrt(1+e*e)):0}class Ur{constructor(r){r=ut.checkMatrix(r);let e=r.clone(),t=r.rows,n=r.columns,s=new Float64Array(n),i,l,h,u;for(h=0;h<n;h++){let a=0;for(i=h;i<t;i++)a=ot(a,e.get(i,h));if(a!==0){for(e.get(h,h)<0&&(a=-a),i=h;i<t;i++)e.set(i,h,e.get(i,h)/a);for(e.set(h,h,e.get(h,h)+1),l=h+1;l<n;l++){for(u=0,i=h;i<t;i++)u+=e.get(i,h)*e.get(i,l);for(u=-u/e.get(h,h),i=h;i<t;i++)e.set(i,l,e.get(i,l)+u*e.get(i,h))}}s[h]=-a}this.QR=e,this.Rdiag=s}solve(r){r=M.checkMatrix(r);let e=this.QR,t=e.rows;if(r.rows!==t)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let n=r.columns,s=r.clone(),i=e.columns,l,h,u,a;for(u=0;u<i;u++)for(h=0;h<n;h++){for(a=0,l=u;l<t;l++)a+=e.get(l,u)*s.get(l,h);for(a=-a/e.get(u,u),l=u;l<t;l++)s.set(l,h,s.get(l,h)+a*e.get(l,u))}for(u=i-1;u>=0;u--){for(h=0;h<n;h++)s.set(u,h,s.get(u,h)/this.Rdiag[u]);for(l=0;l<u;l++)for(h=0;h<n;h++)s.set(l,h,s.get(l,h)-s.get(u,h)*e.get(l,u))}return s.subMatrix(0,i-1,0,n-1)}isFullRank(){let r=this.QR.columns;for(let e=0;e<r;e++)if(this.Rdiag[e]===0)return!1;return!0}get upperTriangularMatrix(){let r=this.QR,e=r.columns,t=new M(e,e),n,s;for(n=0;n<e;n++)for(s=0;s<e;s++)n<s?t.set(n,s,r.get(n,s)):n===s?t.set(n,s,this.Rdiag[n]):t.set(n,s,0);return t}get orthogonalMatrix(){let r=this.QR,e=r.rows,t=r.columns,n=new M(e,t),s,i,l,h;for(l=t-1;l>=0;l--){for(s=0;s<e;s++)n.set(s,l,0);for(n.set(l,l,1),i=l;i<t;i++)if(r.get(l,l)!==0){for(h=0,s=l;s<e;s++)h+=r.get(s,l)*n.get(s,i);for(h=-h/r.get(l,l),s=l;s<e;s++)n.set(s,i,n.get(s,i)+h*r.get(s,l))}}return n}}class ne{constructor(r,e={}){if(r=ut.checkMatrix(r),r.isEmpty())throw new Error("Matrix must be non-empty");let t=r.rows,n=r.columns;const{computeLeftSingularVectors:s=!0,computeRightSingularVectors:i=!0,autoTranspose:l=!1}=e;let h=!!s,u=!!i,a=!1,f;if(t<n)if(!l)f=r.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else{f=r.transpose(),t=f.rows,n=f.columns,a=!0;let c=h;h=u,u=c}else f=r.clone();let g=Math.min(t,n),w=Math.min(t+1,n),m=new Float64Array(w),p=new M(t,g),S=new M(n,n),v=new Float64Array(n),k=new Float64Array(t),j=new Float64Array(w);for(let c=0;c<w;c++)j[c]=c;let N=Math.min(t-1,n),R=Math.max(0,Math.min(n-2,t)),O=Math.max(N,R);for(let c=0;c<O;c++){if(c<N){m[c]=0;for(let d=c;d<t;d++)m[c]=ot(m[c],f.get(d,c));if(m[c]!==0){f.get(c,c)<0&&(m[c]=-m[c]);for(let d=c;d<t;d++)f.set(d,c,f.get(d,c)/m[c]);f.set(c,c,f.get(c,c)+1)}m[c]=-m[c]}for(let d=c+1;d<n;d++){if(c<N&&m[c]!==0){let E=0;for(let y=c;y<t;y++)E+=f.get(y,c)*f.get(y,d);E=-E/f.get(c,c);for(let y=c;y<t;y++)f.set(y,d,f.get(y,d)+E*f.get(y,c))}v[d]=f.get(c,d)}if(h&&c<N)for(let d=c;d<t;d++)p.set(d,c,f.get(d,c));if(c<R){v[c]=0;for(let d=c+1;d<n;d++)v[c]=ot(v[c],v[d]);if(v[c]!==0){v[c+1]<0&&(v[c]=0-v[c]);for(let d=c+1;d<n;d++)v[d]/=v[c];v[c+1]+=1}if(v[c]=-v[c],c+1<t&&v[c]!==0){for(let d=c+1;d<t;d++)k[d]=0;for(let d=c+1;d<t;d++)for(let E=c+1;E<n;E++)k[d]+=v[E]*f.get(d,E);for(let d=c+1;d<n;d++){let E=-v[d]/v[c+1];for(let y=c+1;y<t;y++)f.set(y,d,f.get(y,d)+E*k[y])}}if(u)for(let d=c+1;d<n;d++)S.set(d,c,v[d])}}let b=Math.min(n,t+1);if(N<n&&(m[N]=f.get(N,N)),t<b&&(m[b-1]=0),R+1<b&&(v[R]=f.get(R,b-1)),v[b-1]=0,h){for(let c=N;c<g;c++){for(let d=0;d<t;d++)p.set(d,c,0);p.set(c,c,1)}for(let c=N-1;c>=0;c--)if(m[c]!==0){for(let d=c+1;d<g;d++){let E=0;for(let y=c;y<t;y++)E+=p.get(y,c)*p.get(y,d);E=-E/p.get(c,c);for(let y=c;y<t;y++)p.set(y,d,p.get(y,d)+E*p.get(y,c))}for(let d=c;d<t;d++)p.set(d,c,-p.get(d,c));p.set(c,c,1+p.get(c,c));for(let d=0;d<c-1;d++)p.set(d,c,0)}else{for(let d=0;d<t;d++)p.set(d,c,0);p.set(c,c,1)}}if(u)for(let c=n-1;c>=0;c--){if(c<R&&v[c]!==0)for(let d=c+1;d<n;d++){let E=0;for(let y=c+1;y<n;y++)E+=S.get(y,c)*S.get(y,d);E=-E/S.get(c+1,c);for(let y=c+1;y<n;y++)S.set(y,d,S.get(y,d)+E*S.get(y,c))}for(let d=0;d<n;d++)S.set(d,c,0);S.set(c,c,1)}let V=b-1,x=Number.EPSILON;for(;b>0;){let c,d;for(c=b-2;c>=-1&&c!==-1;c--){const E=Number.MIN_VALUE+x*Math.abs(m[c]+Math.abs(m[c+1]));if(Math.abs(v[c])<=E||Number.isNaN(v[c])){v[c]=0;break}}if(c===b-2)d=4;else{let E;for(E=b-1;E>=c&&E!==c;E--){let y=(E!==b?Math.abs(v[E]):0)+(E!==c+1?Math.abs(v[E-1]):0);if(Math.abs(m[E])<=x*y){m[E]=0;break}}E===c?d=3:E===b-1?d=1:(d=2,c=E)}switch(c++,d){case 1:{let E=v[b-2];v[b-2]=0;for(let y=b-2;y>=c;y--){let $=ot(m[y],E),T=m[y]/$,P=E/$;if(m[y]=$,y!==c&&(E=-P*v[y-1],v[y-1]=T*v[y-1]),u)for(let F=0;F<n;F++)$=T*S.get(F,y)+P*S.get(F,b-1),S.set(F,b-1,-P*S.get(F,y)+T*S.get(F,b-1)),S.set(F,y,$)}break}case 2:{let E=v[c-1];v[c-1]=0;for(let y=c;y<b;y++){let $=ot(m[y],E),T=m[y]/$,P=E/$;if(m[y]=$,E=-P*v[y],v[y]=T*v[y],h)for(let F=0;F<t;F++)$=T*p.get(F,y)+P*p.get(F,c-1),p.set(F,c-1,-P*p.get(F,y)+T*p.get(F,c-1)),p.set(F,y,$)}break}case 3:{const E=Math.max(Math.abs(m[b-1]),Math.abs(m[b-2]),Math.abs(v[b-2]),Math.abs(m[c]),Math.abs(v[c])),y=m[b-1]/E,$=m[b-2]/E,T=v[b-2]/E,P=m[c]/E,F=v[c]/E,q=(($+y)*($-y)+T*T)/2,G=y*T*(y*T);let B=0;(q!==0||G!==0)&&(q<0?B=0-Math.sqrt(q*q+G):B=Math.sqrt(q*q+G),B=G/(q+B));let tt=(P+y)*(P-y)+B,rt=P*F;for(let z=c;z<b-1;z++){let W=ot(tt,rt);W===0&&(W=Number.MIN_VALUE);let X=tt/W,J=rt/W;if(z!==c&&(v[z-1]=W),tt=X*m[z]+J*v[z],v[z]=X*v[z]-J*m[z],rt=J*m[z+1],m[z+1]=X*m[z+1],u)for(let U=0;U<n;U++)W=X*S.get(U,z)+J*S.get(U,z+1),S.set(U,z+1,-J*S.get(U,z)+X*S.get(U,z+1)),S.set(U,z,W);if(W=ot(tt,rt),W===0&&(W=Number.MIN_VALUE),X=tt/W,J=rt/W,m[z]=W,tt=X*v[z]+J*m[z+1],m[z+1]=-J*v[z]+X*m[z+1],rt=J*v[z+1],v[z+1]=X*v[z+1],h&&z<t-1)for(let U=0;U<t;U++)W=X*p.get(U,z)+J*p.get(U,z+1),p.set(U,z+1,-J*p.get(U,z)+X*p.get(U,z+1)),p.set(U,z,W)}v[b-2]=tt;break}case 4:{if(m[c]<=0&&(m[c]=m[c]<0?-m[c]:0,u))for(let E=0;E<=V;E++)S.set(E,c,-S.get(E,c));for(;c<V&&!(m[c]>=m[c+1]);){let E=m[c];if(m[c]=m[c+1],m[c+1]=E,u&&c<n-1)for(let y=0;y<n;y++)E=S.get(y,c+1),S.set(y,c+1,S.get(y,c)),S.set(y,c,E);if(h&&c<t-1)for(let y=0;y<t;y++)E=p.get(y,c+1),p.set(y,c+1,p.get(y,c)),p.set(y,c,E);c++}b--;break}}}if(a){let c=S;S=p,p=c}this.m=t,this.n=n,this.s=m,this.U=p,this.V=S}solve(r){let e=r,t=this.threshold,n=this.s.length,s=M.zeros(n,n);for(let g=0;g<n;g++)Math.abs(this.s[g])<=t?s.set(g,g,0):s.set(g,g,1/this.s[g]);let i=this.U,l=this.rightSingularVectors,h=l.mmul(s),u=l.rows,a=i.rows,f=M.zeros(u,a);for(let g=0;g<u;g++)for(let w=0;w<a;w++){let m=0;for(let p=0;p<n;p++)m+=h.get(g,p)*i.get(w,p);f.set(g,w,m)}return f.mmul(e)}solveForDiagonal(r){return this.solve(M.diag(r))}inverse(){let r=this.V,e=this.threshold,t=r.rows,n=r.columns,s=new M(t,this.s.length);for(let a=0;a<t;a++)for(let f=0;f<n;f++)Math.abs(this.s[f])>e&&s.set(a,f,r.get(a,f)/this.s[f]);let i=this.U,l=i.rows,h=i.columns,u=new M(t,l);for(let a=0;a<t;a++)for(let f=0;f<l;f++){let g=0;for(let w=0;w<h;w++)g+=s.get(a,w)*i.get(f,w);u.set(a,f,g)}return u}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let r=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,e=0,t=this.s;for(let n=0,s=t.length;n<s;n++)t[n]>r&&e++;return e}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return M.diag(this.s)}}function Wr(o,r=!1){return o=ut.checkMatrix(o),r?new ne(o).inverse():xr(o,M.eye(o.rows))}function xr(o,r,e=!1){return o=ut.checkMatrix(o),r=ut.checkMatrix(r),e?new ne(o).solve(r):o.isSquare()?new Br(o).solve(r):new Ur(o).solve(r)}function Gr(o,r,e,t,n){const s=e.length,i=o.x.length;let l=new Array(s);for(let h=0;h<s;h++){l[h]=new Array(i);let u=e.slice();u[h]+=t;let a=n(u);for(let f=0;f<i;f++)l[h][f]=r[f]-a(o.x[f])}return new M(l)}function Kr(o,r){const e=o.x.length;let t=new Array(e);for(let n=0;n<e;n++)t[n]=[o.y[n]-r[n]];return new M(t)}function Yr(o,r,e,t,n){let s=e*t*t,i=M.eye(r.length,r.length,s);const l=n(r);let h=new Float64Array(o.x.length);for(let g=0;g<o.x.length;g++)h[g]=l(o.x[g]);let u=Gr(o,h,r,t,n),a=Kr(o,h),f=Wr(i.add(u.mmul(u.transpose())));return r=new M([r]),r=r.sub(f.mmul(u).mmul(a).mul(t).transpose()),r.to1DArray()}function Qr(o,r,e={}){let{maxIterations:t=100,gradientDifference:n=.1,damping:s=0,errorTolerance:i=.01,minValues:l,maxValues:h,initialValues:u}=e;if(s<=0)throw new Error("The damping option must be a positive number");if(!o.x||!o.y)throw new Error("The data parameter must have x and y elements");if(!Nt(o.x)||o.x.length<2||!Nt(o.y)||o.y.length<2)throw new Error("The data parameter elements must be an array with more than 2 points");if(o.x.length!==o.y.length)throw new Error("The data parameter elements must have the same size");let a=u||new Array(r.length).fill(1),f=a.length;if(h=h||new Array(f).fill(Number.MAX_SAFE_INTEGER),l=l||new Array(f).fill(Number.MIN_SAFE_INTEGER),h.length!==l.length)throw new Error("minValues and maxValues must be the same size");if(!Nt(a))throw new Error("initialValues must be an array");let g=Vt(o,a,r),w=g<=i,m;for(m=0;m<t&&!w;m++){a=Yr(o,a,s,n,r);for(let p=0;p<f;p++)a[p]=Math.min(Math.max(l[p],a[p]),h[p]);if(g=Vt(o,a,r),isNaN(g))break;w=g<=i}return{parameterValues:a,parameterError:g,iterations:m}}const Xr=Object.freeze(Object.defineProperty({__proto__:null,default:Qr},Symbol.toStringTag,{value:"Module"})),Jr=de(Xr);var Ct=I&&I.__awaiter||function(o,r,e,t){return new(e||(e=Promise))(function(n,s){function i(u){try{h(t.next(u))}catch(a){s(a)}}function l(u){try{h(t.throw(u))}catch(a){s(a)}}function h(u){u.done?n(u.value):new e(function(a){a(u.value)}).then(i,l)}h((t=t.apply(o,r||[])).next())})},Dt=I&&I.__generator||function(o,r){var e={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},t,n,s,i;return i={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function l(u){return function(a){return h([u,a])}}function h(u){if(t)throw new TypeError("Generator is already executing.");for(;e;)try{if(t=1,n&&(s=u[0]&2?n.return:u[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,u[1])).done)return s;switch(n=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return e.label++,{value:u[1],done:!1};case 5:e.label++,n=u[1],u=[0];continue;case 7:u=e.ops.pop(),e.trys.pop();continue;default:if(s=e.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){e=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){e.label=u[1];break}if(u[0]===6&&e.label<s[1]){e.label=s[1],s=u;break}if(s&&e.label<s[2]){e.label=s[2],e.ops.push(u);break}s[2]&&e.ops.pop(),e.trys.pop();continue}u=r.call(o,e)}catch(a){u=[6,a],n=0}finally{t=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}},Pt=I&&I.__read||function(o,r){var e=typeof Symbol=="function"&&o[Symbol.iterator];if(!e)return o;var t=e.call(o),n,s=[],i;try{for(;(r===void 0||r-- >0)&&!(n=t.next()).done;)s.push(n.value)}catch(l){i={error:l}}finally{try{n&&!n.done&&(e=t.return)&&e.call(t)}finally{if(i)throw i.error}}return s},Bt=I&&I.__spread||function(){for(var o=[],r=0;r<arguments.length;r++)o=o.concat(Pt(arguments[r]));return o},mt=I&&I.__importStar||function(o){if(o&&o.__esModule)return o;var r={};if(o!=null)for(var e in o)Object.hasOwnProperty.call(o,e)&&(r[e]=o[e]);return r.default=o,r},Zr=I&&I.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(nt,"__esModule",{value:!0});var Hr=mt(et),L=mt(Q),vt=mt(ft),Ut=mt(st),C=mt(D),Ar=Zr(Jr),Wt=1e-5,dt=.001,tn=function(){function o(r){r===void 0&&(r={});var e=this;this.learningRate=1,this.localConnectivity=1,this.minDist=.1,this.nComponents=2,this.nEpochs=0,this.nNeighbors=15,this.negativeSampleRate=5,this.random=Math.random,this.repulsionStrength=1,this.setOpMixRatio=1,this.spread=1,this.transformQueueSize=4,this.targetMetric="categorical",this.targetWeight=.5,this.targetNNeighbors=this.nNeighbors,this.distanceFn=oe,this.isInitialized=!1,this.rpForest=[],this.embedding=[],this.optimizationState=new rn;var t=function(n){r[n]!==void 0&&(e[n]=r[n])};t("distanceFn"),t("learningRate"),t("localConnectivity"),t("minDist"),t("nComponents"),t("nEpochs"),t("nNeighbors"),t("negativeSampleRate"),t("random"),t("repulsionStrength"),t("setOpMixRatio"),t("spread"),t("transformQueueSize")}return o.prototype.fit=function(r){return this.initializeFit(r),this.optimizeLayout(),this.embedding},o.prototype.fitAsync=function(r,e){return e===void 0&&(e=function(){return!0}),Ct(this,void 0,void 0,function(){return Dt(this,function(t){switch(t.label){case 0:return this.initializeFit(r),[4,this.optimizeLayoutAsync(e)];case 1:return t.sent(),[2,this.embedding]}})})},o.prototype.setSupervisedProjection=function(r,e){e===void 0&&(e={}),this.Y=r,this.targetMetric=e.targetMetric||this.targetMetric,this.targetWeight=e.targetWeight||this.targetWeight,this.targetNNeighbors=e.targetNNeighbors||this.targetNNeighbors},o.prototype.setPrecomputedKNN=function(r,e){this.knnIndices=r,this.knnDistances=e},o.prototype.initializeFit=function(r){if(r.length<=this.nNeighbors)throw new Error("Not enough data points ("+r.length+") to create nNeighbors: "+this.nNeighbors+".  Add more data points or adjust the configuration.");if(this.X===r&&this.isInitialized)return this.getNEpochs();if(this.X=r,!this.knnIndices&&!this.knnDistances){var e=this.nearestNeighbors(r);this.knnIndices=e.knnIndices,this.knnDistances=e.knnDistances}this.graph=this.fuzzySimplicialSet(r,this.nNeighbors,this.setOpMixRatio),this.makeSearchFns(),this.searchGraph=this.makeSearchGraph(r),this.processGraphForSupervisedProjection();var t=this.initializeSimplicialSetEmbedding(),n=t.head,s=t.tail,i=t.epochsPerSample;return this.optimizationState.head=n,this.optimizationState.tail=s,this.optimizationState.epochsPerSample=i,this.initializeOptimization(),this.prepareForOptimizationLoop(),this.isInitialized=!0,this.getNEpochs()},o.prototype.makeSearchFns=function(){var r=vt.makeInitializations(this.distanceFn),e=r.initFromTree,t=r.initFromRandom;this.initFromTree=e,this.initFromRandom=t,this.search=vt.makeInitializedNNSearch(this.distanceFn)},o.prototype.makeSearchGraph=function(r){for(var e=this.knnIndices,t=this.knnDistances,n=[r.length,r.length],s=new L.SparseMatrix([],[],[],n),i=0;i<e.length;i++)for(var l=e[i],h=t[i],u=0;u<l.length;u++){var a=l[u],f=h[u];f>0&&s.set(i,a,f)}var g=L.transpose(s);return L.maximum(s,g)},o.prototype.transform=function(r){var e=this,t=this.X;if(t===void 0||t.length===0)throw new Error("No data has been fit.");var n=Math.floor(this.nNeighbors*this.transformQueueSize);n=Math.min(t.length,n);var s=vt.initializeSearch(this.rpForest,t,r,n,this.initFromRandom,this.initFromTree,this.random),i=this.search(t,this.searchGraph,s,r),l=Hr.deheapSort(i),h=l.indices,u=l.weights;h=h.map(function(T){return T.slice(0,e.nNeighbors)}),u=u.map(function(T){return T.slice(0,e.nNeighbors)});var a=Math.max(0,this.localConnectivity-1),f=this.smoothKNNDistance(u,this.nNeighbors,a),g=f.sigmas,w=f.rhos,m=this.computeMembershipStrengths(h,u,g,w),p=m.rows,S=m.cols,v=m.vals,k=[r.length,t.length],j=new L.SparseMatrix(p,S,v,k),N=L.normalize(j,"l1"),R=L.getCSR(N),O=r.length,b=C.reshape2d(R.indices,O,this.nNeighbors),V=C.reshape2d(R.values,O,this.nNeighbors),x=he(b,V,this.embedding),c=this.nEpochs?this.nEpochs/3:j.nRows<=1e4?100:30,d=j.getValues().reduce(function(T,P){return P>T?P:T},0);j=j.map(function(T){return T<d/c?0:T}),j=L.eliminateZeros(j);var E=this.makeEpochsPerSample(j.getValues(),c),y=j.getRows(),$=j.getCols();return this.assignOptimizationStateParameters({headEmbedding:x,tailEmbedding:this.embedding,head:y,tail:$,currentEpoch:0,nEpochs:c,nVertices:j.getDims()[1],epochsPerSample:E}),this.prepareForOptimizationLoop(),this.optimizeLayout()},o.prototype.processGraphForSupervisedProjection=function(){var r=this,e=r.Y,t=r.X;if(e){if(e.length!==t.length)throw new Error("Length of X and y must be equal");if(this.targetMetric==="categorical"){var n=this.targetWeight<1,s=n?2.5*(1/(1-this.targetWeight)):1e12;this.graph=this.categoricalSimplicialSetIntersection(this.graph,e,s)}}},o.prototype.step=function(){var r=this.optimizationState.currentEpoch;return r<this.getNEpochs()&&this.optimizeLayoutStep(r),this.optimizationState.currentEpoch},o.prototype.getEmbedding=function(){return this.embedding},o.prototype.nearestNeighbors=function(r){var e=this,t=e.distanceFn,n=e.nNeighbors,s=function(m){return Math.log(m)/Math.log(2)},i=vt.makeNNDescent(t,this.random),l=function(m){return m===.5?0:Math.round(m)},h=5+Math.floor(l(Math.pow(r.length,.5)/20)),u=Math.max(5,Math.floor(Math.round(s(r.length))));this.rpForest=Ut.makeForest(r,n,h,this.random);var a=Ut.makeLeafArray(this.rpForest),f=i(r,a,n,u),g=f.indices,w=f.weights;return{knnIndices:g,knnDistances:w}},o.prototype.fuzzySimplicialSet=function(r,e,t){t===void 0&&(t=1);var n=this,s=n.knnIndices,i=s===void 0?[]:s,l=n.knnDistances,h=l===void 0?[]:l,u=n.localConnectivity,a=this.smoothKNNDistance(h,e,u),f=a.sigmas,g=a.rhos,w=this.computeMembershipStrengths(i,h,f,g),m=w.rows,p=w.cols,S=w.vals,v=[r.length,r.length],k=new L.SparseMatrix(m,p,S,v),j=L.transpose(k),N=L.pairwiseMultiply(k,j),R=L.subtract(L.add(k,j),N),O=L.multiplyScalar(R,t),b=L.multiplyScalar(N,1-t),V=L.add(O,b);return V},o.prototype.categoricalSimplicialSetIntersection=function(r,e,t,n){n===void 0&&(n=1);var s=ie(r,e,n,t);return s=L.eliminateZeros(s),le(s)},o.prototype.smoothKNNDistance=function(r,e,t,n,s){t===void 0&&(t=1),n===void 0&&(n=64),s===void 0&&(s=1);for(var i=Math.log(e)/Math.log(2)*s,l=C.zeros(r.length),h=C.zeros(r.length),u=0;u<r.length;u++){var a=0,f=1/0,g=1,w=r[u],m=w.filter(function(b){return b>0});if(m.length>=t){var p=Math.floor(t),S=t-p;p>0?(l[u]=m[p-1],S>Wt&&(l[u]+=S*(m[p]-m[p-1]))):l[u]=S*m[0]}else m.length>0&&(l[u]=C.max(m));for(var v=0;v<n;v++){for(var k=0,j=1;j<r[u].length;j++){var N=r[u][j]-l[u];N>0?k+=Math.exp(-(N/g)):k+=1}if(Math.abs(k-i)<Wt)break;k>i?(f=g,g=(a+f)/2):(a=g,f===1/0?g*=2:g=(a+f)/2)}if(h[u]=g,l[u]>0){var R=C.mean(w);h[u]<dt*R&&(h[u]=dt*R)}else{var O=C.mean(r.map(C.mean));h[u]<dt*O&&(h[u]=dt*O)}}return{sigmas:h,rhos:l}},o.prototype.computeMembershipStrengths=function(r,e,t,n){for(var s=r.length,i=r[0].length,l=C.zeros(s*i),h=C.zeros(s*i),u=C.zeros(s*i),a=0;a<s;a++)for(var f=0;f<i;f++){var g=0;r[a][f]!==-1&&(r[a][f]===a?g=0:e[a][f]-n[a]<=0?g=1:g=Math.exp(-((e[a][f]-n[a])/t[a])),l[a*i+f]=a,h[a*i+f]=r[a][f],u[a*i+f]=g)}return{rows:l,cols:h,vals:u}},o.prototype.initializeSimplicialSetEmbedding=function(){for(var r=this,e=this.getNEpochs(),t=this.nComponents,n=this.graph.getValues(),s=0,i=0;i<n.length;i++){var l=n[i];s<n[i]&&(s=l)}var h=this.graph.map(function(p){return p<s/e?0:p});this.embedding=C.zeros(h.nRows).map(function(){return C.zeros(t).map(function(){return C.tauRand(r.random)*20+-10})});for(var u=[],a=[],f=[],g=h.getAll(),i=0;i<g.length;i++){var w=g[i];w.value&&(u.push(w.value),f.push(w.row),a.push(w.col))}var m=this.makeEpochsPerSample(u,e);return{head:a,tail:f,epochsPerSample:m}},o.prototype.makeEpochsPerSample=function(r,e){var t=C.filled(r.length,-1),n=C.max(r),s=r.map(function(i){return i/n*e});return s.forEach(function(i,l){i>0&&(t[l]=e/s[l])}),t},o.prototype.assignOptimizationStateParameters=function(r){Object.assign(this.optimizationState,r)},o.prototype.prepareForOptimizationLoop=function(){var r=this,e=r.repulsionStrength,t=r.learningRate,n=r.negativeSampleRate,s=this.optimizationState,i=s.epochsPerSample,l=s.headEmbedding,h=s.tailEmbedding,u=l[0].length,a=l.length===h.length,f=i.map(function(m){return m/n}),g=Bt(f),w=Bt(i);this.assignOptimizationStateParameters({epochOfNextSample:w,epochOfNextNegativeSample:g,epochsPerNegativeSample:f,moveOther:a,initialAlpha:t,alpha:t,gamma:e,dim:u})},o.prototype.initializeOptimization=function(){var r=this.embedding,e=this.embedding,t=this.optimizationState,n=t.head,s=t.tail,i=t.epochsPerSample,l=this.getNEpochs(),h=this.graph.nCols,u=se(this.spread,this.minDist),a=u.a,f=u.b;this.assignOptimizationStateParameters({headEmbedding:r,tailEmbedding:e,head:n,tail:s,epochsPerSample:i,a,b:f,nEpochs:l,nVertices:h})},o.prototype.optimizeLayoutStep=function(r){for(var e=this.optimizationState,t=e.head,n=e.tail,s=e.headEmbedding,i=e.tailEmbedding,l=e.epochsPerSample,h=e.epochOfNextSample,u=e.epochOfNextNegativeSample,a=e.epochsPerNegativeSample,f=e.moveOther,g=e.initialAlpha,w=e.alpha,m=e.gamma,p=e.a,S=e.b,v=e.dim,k=e.nEpochs,j=e.nVertices,N=4,R=0;R<l.length;R++)if(!(h[R]>r)){var O=t[R],b=n[R],V=s[O],x=i[b],c=Gt(V,x),d=0;c>0&&(d=-2*p*S*Math.pow(c,S-1),d/=p*Math.pow(c,S)+1);for(var E=0;E<v;E++){var y=xt(d*(V[E]-x[E]),N);V[E]+=y*w,f&&(x[E]+=-y*w)}h[R]+=l[R];for(var $=Math.floor((r-u[R])/a[R]),T=0;T<$;T++){var P=C.tauRandInt(j,this.random),F=i[P],q=Gt(V,F),G=0;if(q>0)G=2*m*S,G/=(.001+q)*(p*Math.pow(q,S)+1);else if(O===P)continue;for(var E=0;E<v;E++){var y=4;G>0&&(y=xt(G*(V[E]-F[E]),N)),V[E]+=y*w}}u[R]+=$*a[R]}return e.alpha=g*(1-r/k),e.currentEpoch+=1,s},o.prototype.optimizeLayoutAsync=function(r){var e=this;return r===void 0&&(r=function(){return!0}),new Promise(function(t,n){var s=function(){return Ct(e,void 0,void 0,function(){var i,l,h,u,a,f;return Dt(this,function(g){try{if(i=this.optimizationState,l=i.nEpochs,h=i.currentEpoch,this.embedding=this.optimizeLayoutStep(h),u=this.optimizationState.currentEpoch,a=r(u)===!1,f=u===l,!a&&!f)setTimeout(function(){return s()},0);else return[2,t(f)]}catch(w){n(w)}return[2]})})};setTimeout(function(){return s()},0)})},o.prototype.optimizeLayout=function(r){r===void 0&&(r=function(){return!0});for(var e=!1,t=[];!e;){var n=this.optimizationState,s=n.nEpochs,i=n.currentEpoch;t=this.optimizeLayoutStep(i);var l=this.optimizationState.currentEpoch,h=r(l)===!1;e=l===s||h}return t},o.prototype.getNEpochs=function(){var r=this.graph;if(this.nEpochs>0)return this.nEpochs;var e=r.nRows;return e<=2500?500:e<=5e3?400:e<=7500?300:200},o}();nt.UMAP=tn;function oe(o,r){for(var e=0,t=0;t<o.length;t++)e+=Math.pow(o[t]-r[t],2);return Math.sqrt(e)}nt.euclidean=oe;function en(o,r){for(var e=0,t=0,n=0,s=0;s<o.length;s++)e+=o[s]*r[s],t+=Math.pow(o[s],2),n+=Math.pow(r[s],2);return t===0&&n===0?0:t===0||n===0?1:1-e/Math.sqrt(t*n)}nt.cosine=en;var rn=function(){function o(){this.currentEpoch=0,this.headEmbedding=[],this.tailEmbedding=[],this.head=[],this.tail=[],this.epochsPerSample=[],this.epochOfNextSample=[],this.epochOfNextNegativeSample=[],this.epochsPerNegativeSample=[],this.moveOther=!0,this.initialAlpha=1,this.alpha=1,this.gamma=1,this.a=1.5769434603113077,this.b=.8950608779109733,this.dim=2,this.nEpochs=500,this.nVertices=0}return o}();function xt(o,r){return o>r?r:o<-r?-r:o}function Gt(o,r){for(var e=0,t=0;t<o.length;t++)e+=Math.pow(o[t]-r[t],2);return e}function se(o,r){var e=function(g){var w=Pt(g,2),m=w[0],p=w[1];return function(S){return 1/(1+m*Math.pow(S,2*p))}},t=C.linear(0,o*3,300).map(function(g){return g<r?1:g}),n=C.zeros(t.length).map(function(g,w){var m=t[w]>=r;return m?Math.exp(-(t[w]-r)/o):g}),s=[.5,.5],i={x:t,y:n},l={damping:1.5,initialValues:s,gradientDifference:.1,maxIterations:100,errorTolerance:.01},h=Ar.default(i,e,l).parameterValues,u=Pt(h,2),a=u[0],f=u[1];return{a,b:f}}nt.findABParams=se;function ie(o,r,e,t){return e===void 0&&(e=1),t===void 0&&(t=5),o.map(function(n,s,i){return r[s]===-1||r[i]===-1?n*Math.exp(-e):r[s]!==r[i]?n*Math.exp(-t):n})}nt.fastIntersection=ie;function le(o){o=L.normalize(o,"max");var r=L.transpose(o),e=L.pairwiseMultiply(r,o);return o=L.add(o,L.subtract(r,e)),L.eliminateZeros(o)}nt.resetLocalConnectivity=le;function he(o,r,e){for(var t=C.zeros(o.length).map(function(h){return C.zeros(e[0].length)}),n=0;n<o.length;n++)for(var s=0;s<o[0].length;s++)for(var i=0;i<e[0].length;i++){var l=o[n][s];t[n][i]+=r[n][s]*e[l][i]}return t}nt.initTransform=he;Object.defineProperty(St,"__esModule",{value:!0});var nn=nt,on=St.UMAP=nn.UMAP;const ln=ye({__proto__:null,UMAP:on,default:St},[St]);export{ln as i};
//# sourceMappingURL=index-BRrUqCRX.js.map
