"use strict";(self.webpackChunkjupyterlab_terminal_html_log=self.webpackChunkjupyterlab_terminal_html_log||[]).push([[509],{509:(e,t,n)=>{n.r(t),n.d(t,{DEFAULT_ANSI_COLORS:()=>r,default:()=>c});var i=n(200),o=n(283),s=n(456),l=n(313);const r=Object.freeze((()=>{function e(e){const t=e.toString(16);return t.length<2?"0"+t:t}function t(t,n,i,o){return void 0!==o?`#${e(t)}${e(n)}${e(i)}${e(o)}`:`#${e(t)}${e(n)}${e(i)}`}const n=["#2e3436","#cc0000","#4e9a06","#c4a000","#3465a4","#75507b","#06989a","#d3d7cf","#555753","#ef2929","#8ae234","#fce94f","#729fcf","#ad7fa8","#34e2e2","#eeeeec"],i=[0,95,135,175,215,255];for(let e=0;e<216;e++){const o=i[e/36%6|0],s=i[e/6%6|0],l=i[e%6];n.push(t(o,s,l))}for(let e=0;e<24;e++){const i=8+10*e;n.push(t(i,i,i))}return n})());class a{constructor(e,t,n){this.session_id=e,this.xt=t,this.disposed=!1,this.lastLogLine=0,this.listeners=[this.xt.onLineFeed(this.onLineFeed.bind(this)),this.xt.onKey(this.onKey.bind(this))],this.dump_callback=n,this.log="",this.onLineFeed(),this.dump_callback(this.dump())}dispose(){if(!this.disposed){this.disposed=!0;for(const e of this.listeners)e.dispose()}}dump(){var e;return`\n<html>\n  <head>\n    <style>\n      body {\n        background: ${(null===(e=this.xt.options.theme)||void 0===e?void 0:e.background)||"#000000"};\n        font-family: ${this.xt.options.fontFamily||"monospace"};\n        font-weight: ${this.xt.options.fontWeight||"normal"};\n        margin: 1em;\n      }\n    </style>\n  </head>\n  <body><pre>`+this.log+"</pre></body></html>"}rewind(e){let t=this.log.length;for(let n=0;n<e;n++)t=this.log.lastIndexOf("\n",t-1);this.log=this.log.slice(0,t+1)}onKey(e){"\r"!==e.key&&"\n"!==e.key||setTimeout((()=>{this.dump_callback(this.dump())}),500)}onLineFeed(){if(!this.disposed&&!this.xt.modes.applicationCursorKeysMode){const e=this.xt.buffer.active,t=void 0===this.xt.options.theme?{foreground:"#ffffff",background:"#000000"}:this.xt.options.theme,n=e.baseY+e.cursorY-1;this.lastLogLine>n&&(this.rewind(this.lastLogLine-n),this.lastLogLine=n);let i="";for(;this.lastLogLine<=n;this.lastLogLine+=1){const n=e.getLine(this.lastLogLine);if(!n)continue;let o,s,l,a=e.getNullCell(),c="<span>";for(let e=0;e<n.length;e+=1){if(a=n.getCell(e,a),!a)continue;let i=a.getFgColor(),d=a.getBgColor();const h=a.isBold();if(h&&a.isFgPalette()&&(i+=8),h&&a.isBgPalette()&&(d+=8),i!==o||d!==s||h!==l){let e="";h&&(e+="font-weight: bold; "),c+=`</span><span style="color: ${-1===i?t.foreground:i<=255?r[i]:i}; background-color: ${-1===d?t.background:d<=255?r[d]:d}; ${e}">`}let g=a.getChars();""===g&&(g=" "),c+=g,o=i,s=d,l=h}c+="</span>\n",i+=c}this.log+=i}}}const c={id:"jupyterlab_terminal_html_log:logger",description:"Add HTML logging capabilities to JupyterLab's integrated terminal",requires:[i.ICommandPalette,s.IDocumentManager,o.ITerminalTracker],autoStart:!0,activate:(e,t,n,o)=>{const s={},r="terminal:log-to-html";e.commands.addCommand(r,{label:"Log to HTML file",isToggled:()=>null!==o.currentWidget&&o.currentWidget===e.shell.currentWidget&&o.currentWidget.content.session.name in s,isEnabled:()=>null!==o.currentWidget&&o.currentWidget===e.shell.currentWidget,execute:async()=>{if(o.currentWidget){const e=o.currentWidget.content.session.name;if(e in s)s[e].dispose(),delete s[e];else{const t=function(e){if("_term"in e)return e._term}(o.currentWidget.content),r=await async function(e){let t=null;const n=l.FileDialog.getOpenFiles({manager:e,title:"Select log destination",label:"Choose a pre-existing file to overwrite or a directory to create a new file within it",filter:e=>"text/html"===e.mimetype||"directory"===e.type?{}:null}),o=await n;if(o.button.accept)if(o.value.length>1)(0,i.showErrorMessage)("Too many items selected","Please select only one file or directory");else{const e=o.value[0];if("directory"===e.type){const n=await i.InputDialog.getText({title:"Enter a filename for the log",label:e.path+"/"});n.button.accept&&(t=e.path+"/"+n.value)}else t="/"+e.path}return t}(n);null!==r&&t&&(s[e]=new a(e,t,(e=>{n.services.contents.save(r,{content:e,format:"text",mimetype:"text/html",type:"file"})})),o.currentWidget.content.disposed.connect((()=>{s[e].dispose(),delete s[e]})))}}}}),t.addItem({command:r,category:"terminal"})}}}}]);