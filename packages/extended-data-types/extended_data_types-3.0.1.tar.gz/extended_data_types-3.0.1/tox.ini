[tox]
min_version = 4
env_list =
    pre-commit,
    mypy,
    pyright,
    py3{9,10,11,12},
    report,
    docs

[gh]
python =
    3.12 = pre-commit, mypy, pyright, py312
    3.11 = py311
    3.10 = py310
    3.9 = py39

[testenv]
package = wheel
wheel_build_env = .pkg
extras = tests
setenv =
    py3{9,10,11,12}: COVERAGE_FILE = .coverage.{envname}
passenv =
    GITLAB_*
    CI_*
    CI
commands = pytest -n auto --cov --cov-report=term-missing {posargs:-vv}
depends =
    report: py3{9,10,11,12}

[testenv:report]
skip_install = true
deps = coverage[toml]
commands =
    coverage combine
    coverage html
    coverage report

[testenv:mypy]
extras = typing
commands = mypy src

[testenv:pyright]
deps = pyright
extras = typing
commands = pyright src

[testenv:docs]
extras = docs
allowlist_externals =
    rm
commands =
    rm -rf docs/_build
    rm -rf docs/apidocs
    rm -rf docs/doctrees
    rm -rf public
    sphinx-build -W -n --jobs auto -b html -d docs/_build/doctrees docs docs/_build/html

[testenv:pre-commit]
skip_install = true
deps = pre-commit
commands = pre-commit run --all-files
