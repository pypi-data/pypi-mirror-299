"use strict";const tarsierId="__tarsier_id",tarsierDataAttribute="data-tarsier-id",tarsierSelector=`#${tarsierId}`,reworkdVisibilityAttribute="reworkd-original-visibility",elIsVisible=t=>{const o=t.getBoundingClientRect(),n=window.getComputedStyle(t),e=n.visibility==="hidden"||n.display==="none"||t.hidden||t.hasAttribute("disabled")&&t.getAttribute("disabled"),r=n.opacity==="0"&&!hasLabel(t),a=n.display==="contents",d=(o.width===0||o.height===0)&&!a,m=t.tagName==="SCRIPT"||t.tagName==="STYLE";return!e&&!r&&!d&&!m};function hasLabel(t){if(!["input","textarea","select","button"].includes(t.tagName.toLowerCase()))return!1;const n=CSS.escape(t.id);if(document.querySelector(`label[for="${n}"]`))return!0;const s=Array.from(t.parentElement?.children||[]);for(let r of s)if(r.tagName.toLowerCase()==="label")return!0;return!1}const isTaggableTextNode=t=>isNonWhiteSpaceTextNode(t)&&isTextNodeAValidWord(t),isNonWhiteSpaceTextNode=t=>t.nodeType===Node.TEXT_NODE&&t.textContent&&t.textContent.trim().length>0&&t.textContent.trim()!=="\u200B",isTextNodeAValidWord=t=>{const o=t.textContent?.trim();return o&&(o.match(/\w/)||o.length>3)},isImageElement=t=>t.tagName.toLowerCase()==="img",inputs=["a","button","textarea","select","details","label"],isInteractable=t=>t.tagName.toLowerCase()==="label"&&t.querySelector("input")?!1:inputs.includes(t.tagName.toLowerCase())||t.tagName.toLowerCase()==="input"&&t.type!=="hidden"||t.role==="button",text_input_types=["text","password","email","search","url","tel","number"],isTextInsertable=t=>t.tagName.toLowerCase()==="textarea"||t.tagName.toLowerCase()==="input"&&text_input_types.includes(t.type),textLessTagWhiteList=["input","textarea","select","button","a"],isTextLess=t=>{const o=t.tagName.toLowerCase();if(textLessTagWhiteList.includes(o)||t.childElementCount>0)return!1;if("innerText"in t&&t.innerText.trim().length===0){const n=t.querySelector("svg"),e=t.querySelector("img");return n||e?!1:isElementInViewport(t)}return!1};function isElementInViewport(t){const o=t.getBoundingClientRect(),n=o.width>1||o.height>1;let e=document.body,s=document.documentElement;const r=Math.max(e.scrollHeight,e.offsetHeight,s.clientHeight,s.scrollHeight,s.offsetHeight),a=Math.max(e.scrollWidth,e.offsetWidth,s.clientWidth,s.scrollWidth,s.offsetWidth);return n&&o.top>=0&&o.left>=0&&o.bottom<=r&&o.right<=a}function getElementXPath(t){let o=[],n="";for(t&&t.ownerDocument!==window.document&&(n=`iframe[${t.getAttribute("iframe_index")}]`);t;){if(!t.tagName){t=t.parentNode;continue}let e=t.tagName.toLowerCase(),s=window.fixNamespaces(e),r=1,a=t.previousElementSibling;for(;a;)a.tagName===t.tagName&&a.id!=tarsierId&&r++,a=a.previousElementSibling;let d=t.nextElementSibling,m=!1;for(;d;){if(d.tagName===t.tagName){m=!0;break}d=d.nextElementSibling}if((r>1||m)&&(s+=`[${r}]`),t.id){if(s+=`[@id="${t.id}"]`,o.length>3)return o.unshift(s),"//"+o.join("/")}else t.className&&(s+=`[@class="${t.className}"]`);o.unshift(s),t=t.parentNode}return n+"//"+o.join("/")}function create_tagged_span(t,o){let n=`[${o}${t}]`,e=document.createElement("span");return e.id=tarsierId,e.style.position="relative",e.style.display="inline",e.style.color="white",e.style.backgroundColor="red",e.style.padding="1.5px",e.style.borderRadius="3px",e.style.fontWeight="bold",e.style.fontFamily="Arial",e.style.margin="1px",e.style.lineHeight="1.25",e.style.letterSpacing="2px",e.style.zIndex="2140000046",e.style.clip="auto",e.style.height="fit-content",e.style.width="fit-content",e.style.minHeight="15px",e.style.minWidth="23px",e.style.maxHeight="unset",e.style.maxWidth="unset",e.textContent=n,e.style.webkitTextFillColor="white",e.style.textShadow="",e.style.textDecoration="none",e.style.letterSpacing="0px",e.setAttribute(tarsierDataAttribute,t.toString()),e}const MIN_FONT_SIZE=11,ensureMinimumTagFontSizes=()=>{Array.from(document.querySelectorAll(tarsierSelector)).forEach(o=>{parseFloat(window.getComputedStyle(o).fontSize.split("px")[0])<MIN_FONT_SIZE&&(o.style.fontSize=`${MIN_FONT_SIZE}px`)})};window.tagifyWebpage=(t=!1)=>{window.removeTags(),hideMapElements();const o=getAllElementsInAllFrames(),n=getElementsToTag(o,t),e=removeNestedTags(n),s=insertTags(e,t);return shrinkCollidingTags(),ensureMinimumTagFontSizes(),s};function getAllElementsInAllFrames(){const t=Array.from(document.body.querySelectorAll("*")),o=document.getElementsByTagName("iframe");for(let n=0;n<o.length;n++)try{const e=o[n],s=e.contentDocument||e.contentWindow?.document;if(!s)continue;const r=Array.from(s.querySelectorAll("*"));r.forEach(a=>a.setAttribute("iframe_index",n.toString())),t.push(...r)}catch(e){console.error("Error accessing iframe content:",e)}return t}function getElementsToTag(t,o){const n=[];for(let e of t)isTextLess(e)&&!isImageElement(e)||!elIsVisible(e)||(isInteractable(e)||isImageElement(e)||o&&Array.from(e.childNodes).filter(isTaggableTextNode).length>=1)&&n.push(e);return n}function removeNestedTags(t){const o=[...t];return t.map(n=>{if(isInteractable(n)){const e=[];if(n.querySelectorAll("*").forEach(s=>{o.indexOf(s)>-1&&e.push(s)}),e.length<=2)for(let s of e)o.splice(o.indexOf(s),1)}}),o}function getTagSymbol(t){return isInteractable(t)?isTextInsertable(t)?"#":t.tagName.toLowerCase()==="a"?"@":"$":isImageElement(t)?"%":""}function insertTags(t,o){function n(i){if(!i.firstChild||i.firstChild.nodeType!==Node.TEXT_NODE)return;const c=i.firstChild;c.textContent=c.textContent.trimStart()}function e(i){const c=Array.from(i.childNodes).filter(l=>isNonWhiteSpaceTextNode(l)?!0:l.nodeType===Node.TEXT_NODE?!1:!(l.nodeType===Node.ELEMENT_NODE&&(isTextLess(l)||!elIsVisible(l))));if(c.length===1){const l=c[0],u=["div","span","p","h1","h2","h3","h4","h5","h6"];if(l.nodeType===Node.ELEMENT_NODE&&u.includes(l.tagName.toLowerCase()))return e(l)}return n(i),i}function s(i){const c=i.cloneNode(!1),l=c.outerHTML,g=`</${c.tagName.toLowerCase()}>`;return l.endsWith(g)?l.slice(0,-g.length):l}const r=[];let a=0;function d(i,c,l,u,g=null,f=null){const h=getTagSymbol(i),p=create_tagged_span(a,h),x={tarsierId:a,xpath:c,element:i,tagElement:p,textNodeIndex:l,originalTextContent:f};if(g&&i.parentElement)i.insertBefore(p,g);else if(isTextInsertable(i)&&i.parentElement)i.parentElement.insertBefore(p,i);else{const y=e(i);y.prepend(p),u&&absolutelyPositionTagIfMisaligned(p,y)}return u&&!g&&absolutelyPositionTagIfMisaligned(p,i),x}for(const i of t){const c=getElementXPath(i);if(isInteractable(i)||isImageElement(i)){const l=!isTextInsertable(i)||isImageElement(i),u=i.textContent?.trim()||null,g=d(i,c,null,l,null,u);r.push(g),a++}else if(o){n(i);const l=Array.from(i.childNodes).filter(g=>g.nodeType===Node.TEXT_NODE);l.filter(isTaggableTextNode).forEach(g=>{const f=l.indexOf(g)+1,h=g.textContent?.trim()||null,p=d(i,c,f,!1,g,h);r.push(p),a++})}}const m={};return r.forEach(i=>{const c=s(i.element),l=getTagSymbol(i.element)||"",u=`[ ${l}${l?" ":""}${i.tarsierId} ]`,g=i.originalTextContent;m[i.tarsierId]={tarsierId:i.tarsierId,elementName:i.element.tagName.toLowerCase(),openingTagHTML:c,xpath:i.xpath,elementText:g,textNodeIndex:i.textNodeIndex,idSymbol:l,idString:u}}),m}function absolutelyPositionTagIfMisaligned(t,o){let n=t.getBoundingClientRect();if(!(n.width===0||n.height===0))return;const e=250,s=o.getBoundingClientRect();if(s.right<0||s.left>(window.innerWidth||document.documentElement.clientWidth)){t.remove();return}const r={x:s.left,y:s.top},a={x:(n.left+n.right)/2,y:(n.top+n.bottom)/2},d=Math.abs(r.x-a.x),m=Math.abs(r.y-a.y);if(d>e||m>e||!elIsVisible(t)){t.style.position="absolute";let i=Math.max(0,s.left-(n.right+3-n.left));i=Math.min(i,window.innerWidth-(n.right-n.left));let c=Math.max(0,s.top+3);c=Math.min(c,Math.max(window.innerHeight,document.documentElement.scrollHeight)-(n.bottom-n.top)),t.style.left=`${i}px`,t.style.top=`${c}px`,t.parentElement&&t.parentElement.removeChild(t),document.body.appendChild(t)}}const shrinkCollidingTags=()=>{const t=Array.from(document.querySelectorAll(tarsierSelector));for(let o=0;o<t.length;o++){const n=t[o];let e=n.getBoundingClientRect(),s=parseFloat(window.getComputedStyle(n).fontSize.split("px")[0]);for(let r=o+1;r<t.length;r++){const a=t[r];let d=a.getBoundingClientRect(),m=parseFloat(window.getComputedStyle(a).fontSize.split("px")[0]);for(;e.left<d.right&&e.right>d.left&&e.top<d.bottom&&e.bottom>d.top&&s>MIN_FONT_SIZE&&m>MIN_FONT_SIZE;)s-=.5,m-=.5,n.style.fontSize=`${s}px`,a.style.fontSize=`${m}px`,e=n.getBoundingClientRect(),d=a.getBoundingClientRect()}}};window.removeTags=()=>{getAllElementsInAllFrames().filter(t=>t.matches(tarsierSelector)).forEach(t=>t.remove()),showMapElements()};const GOOGLE_MAPS_OPACITY_CONTROL="__reworkd_google_maps_opacity",hideMapElements=()=>{const t=['iframe[src*="google.com/maps"]','iframe[id*="gmap_canvas"]',".maplibregl-map",".mapboxgl-map",".leaflet-container",'img[src*="maps.googleapis.com"]','[aria-label="Map"]',".cmp-location-map__map",'.map-view[data-role="mapView"]',".google_Map-wrapper",".google_map-wrapper",".googleMap-wrapper",".googlemap-wrapper",".ls-map-canvas",".gmapcluster","#googleMap","#googleMaps","#googlemaps","#googlemap","#google_map","#google_maps","#MapId",".geolocation-map-wrapper",".locatorMap"];document.querySelectorAll(t.join(", ")).forEach(o=>{const n=window.getComputedStyle(o).opacity;o.setAttribute("data-original-opacity",n),o.style.opacity="0"})},showMapElements=()=>{document.querySelectorAll(`[${GOOGLE_MAPS_OPACITY_CONTROL}]`).forEach(o=>{o.style.opacity=o.getAttribute("data-original-opacity")||"1"})};window.hideNonTagElements=()=>{getAllElementsInAllFrames().forEach(o=>{const n=o;n.style.visibility&&n.setAttribute(reworkdVisibilityAttribute,n.style.visibility),n.id.startsWith(tarsierId)?n.style.visibility="visible":n.style.visibility="hidden"})},window.fixNamespaces=t=>{const o=/^[a-zA-Z_][\w\-.]*:[a-zA-Z_][\w\-.]*$/,n=t.split(/[#.]/)[0];return o.test(n)?t.replace(n,`*[name()="${n}"]`):t},window.revertVisibilities=()=>{getAllElementsInAllFrames().forEach(o=>{const n=o;n.getAttribute(reworkdVisibilityAttribute)?n.style.visibility=n.getAttribute(reworkdVisibilityAttribute)||"true":n.style.removeProperty("visibility")})};
