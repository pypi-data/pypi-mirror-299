[build-system]
requires = [
    "pdm-backend",
    "pdm-build-locked",
]
build-backend = "pdm.backend"

[tool.pdm]
distribution = true

[tool.pdm.dev-dependencies]
dev = [
    "justscheduleit[all]",
    "types-croniter",
    "pipdeptree",
]
examples = [
    "justscheduleit[all]",
    "fast-depends ~=2.4",
    "fastapi-slim ~=0.111",
]
test = [
    "justscheduleit[all]",
    "anyio[test]",
    "pytest ~=8.1",
    "pytest-mock ~=3.14",
    "pytest-cov ~=5.0",
    "coverage[toml] ~=7.6",
]

[tool.pdm.version]
source = "scm"
write_to = "justscheduleit/_version.py"
write_template = "__version__ = '{}'"

[tool.pdm.build]
excludes = [
    "./**/.git",
    "tests",
    "examples",
]
source-includes = [
    "CHANGELOG.md",
    "LICENSE",
]

[tool.ruff]
line-length = 120

[tool.ruff.format]
docstring-code-format = true

[tool.ruff.lint]
select = [
    "E",
    "W",
    "F",
    "I",
    "C",
    "B",
    "Q",
]

[tool.ruff.lint.pydocstyle]
convention = "google"

[tool.pytest.ini_options]
minversion = "8.0"
addopts = "-q -m 'not slow'"
asyncio_default_fixture_loop_scope = "function"
testpaths = [
    "tests",
]
python_files = [
    "*.py",
]
markers = []

[tool.coverage.run]
parallel = true
branch = true
concurrency = [
    "multiprocessing",
    "thread",
]
source = [
    "examples",
    "justscheduleit",
    "tests",
]
context = "${CONTEXT}"
omit = [
    "**/__init__.py",
]

[tool.coverage.report]
show_missing = true
skip_empty = true
exclude_lines = [
    ".*# pragma: no cover",
    "if __name__ == .__main__.:",
    "self.logger",
    "def __repr__",
    "lambda: None",
    "from .*",
    "import .*",
    "@(abc\\.)?abstractmethod",
    "raise NotImplementedError",
    "raise AssertionError",
    "raise ValueError",
    "logger\\..*",
    "pass",
    "\\.\\.\\.",
]
omit = [
    "*/__about__.py",
    "*/__main__.py",
    "*/__init__.py",
    "*/annotations.py",
]

[project]
name = "justscheduleit"
dynamic = []
description = "Simple in-process task scheduler for Python apps"
keywords = [
    "scheduler",
    "cron",
]
readme = "pypi_readme.md"
requires-python = ">=3.10"
authors = [
    { name = "Alexey Shokov" },
]
classifiers = [
    "Development Status :: 4 - Beta",
    "Programming Language :: Python :: 3.10",
    "Programming Language :: Python :: 3.11",
    "Programming Language :: Python :: 3.12",
    "Typing :: Typed",
    "Framework :: AsyncIO",
    "Framework :: AnyIO",
    "Topic :: System",
    "Topic :: Software Development",
    "Topic :: Software Development :: Libraries",
    "Topic :: Software Development :: Libraries :: Python Modules",
    "Topic :: Software Development :: Libraries :: Application Frameworks",
    "Topic :: Office/Business :: Scheduling",
    "Intended Audience :: Developers",
    "Intended Audience :: System Administrators",
    "License :: OSI Approved :: MIT License",
]
dependencies = [
    "typing_extensions ~=4.10",
    "anyio >=3.6,<5.0",
]
version = "0.2.0"

[project.urls]
homepage = "https://github.com/alexeyshockov/justscheduleit"
docs = "https://alexeyshockov.github.io/justscheduleit/"
changelog = "https://github.com/alexeyshockov/justscheduleit/blob/main/CHANGELOG.md"

[project.license]
text = "MIT"

[project.optional-dependencies]
cron = [
    "croniter >=2.0,<4.0",
]
http = [
    "uvicorn ~=0.30",
]
otel = [
    "opentelemetry-api ~=1.26",
]
all = [
    "justscheduleit[cron,http,otel]",
    "uvloop ~=0.15",
    "humanize >=3.0,<5.0",
    "pytimeparse2 ~=1.6",
]
