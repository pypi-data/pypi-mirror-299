"use strict";(self.webpackChunknearbeach=self.webpackChunknearbeach||[]).push([[8727],{4196:(e,t,s)=>{s.r(t),s.d(t,{default:()=>O});var o=s(641),l=s(3751);const r={class:"card"},i={class:"card card-body"},a={class:"row"},d={class:"col-md-8"},n={class:"row"},u={class:"col-md-8",style:{"min-height":"610px"}},c={class:"form-group"},p=["src"],h={class:"row submit-row"},b={class:"col-md-12"};var m=s(8838),g=s(3913),y=s(1080),M=s(5607),k=s(2407),f=s(4406),j=s(555),_=s(9827),v=s(379),D=s(9639),T=s(3855),w=s(404),L=s(2124);const S={name:"NewScheduledObject",setup:()=>({v$:(0,D.Ay)()}),components:{BetweenDates:M.A,editor:m.A,GetStakeholders:k.A,GroupPermissions:f.A,NConfigProvider:g.A,NSelect:y.A,SchedulerFrequency:j.A,ValidationRendering:w.A},props:{groupResults:{type:Array,default:()=>[]},rootUrl:{type:String,default:"/"},staticUrl:{type:String,default:"/"},theme:{type:String,default:"light"},userGroupAndLevel:{type:Array,default:()=>[]},userGroupResults:{type:Array,default:()=>[]},uuid:{type:String,default:""}},data:()=>({groupModel:{},groupModelValidation:!0,displayGroupPermissionIssue:!1,objectDescriptionModel:"",objectEndDateModel:"",objectStartDateModel:"",objectTitleModel:"",objectTypeModel:"",objectTypeOptions:[{value:0,label:"Project"},{value:1,label:"Task"}],stakeholderModel:"",daysBeforeModel:0,dayModel:[],endDateConditionModel:"no-end-date",endDateModel:0,isFormValid:!1,numberOfRepeats:0,schedulerFrequencyModel:"Set Day of the Week",singleDayModel:"monday",startDateModel:0}),computed:{...(0,L.L8)({contentCss:"getContentCss",skin:"getSkin"})},validations:{groupModel:{required:T.mw},objectDescriptionModel:{required:T.mw},objectTitleModel:{required:T.mw},objectTypeModel:{required:T.mw},stakeholderModel:{required:T.mw}},mixins:[_.A,v.A],methods:{calculateUserLevel(e){if(0===e.length)return 0;const t=e.reduce(((e,t)=>e&&e.project_permission>t.project_permission?e:t)).project_permission,s=e.reduce(((e,t)=>e&&e.task_permission>t.task_permission?e:t)).task_permission;return s>t?s:t},submitNewScheduledObject:async function(){if(!await this.v$.$validate()||this.displayGroupPermissionIssue||!this.isFormValid)return void this.$store.dispatch("newToast",{header:"Please check all validation",message:"There are some fields that are filled in correctly. Please correct these mistakes.",extra_classes:"bg-danger",delay:0});if(!this.groupModelValidation)return void this.$store.dispatch("newToast",{header:"No CREATE permission for groups",message:"Please note - for the current groups selected, you do not have create permissions. Please add in a group you have create permission with.",extra_classes:"bg-danger",delay:5e3});const e=new FormData;e.set("object_type",this.objectTypeModel),e.set("object_title",this.objectTitleModel),e.set("object_description",this.objectDescriptionModel),e.set("organisation",this.stakeholderModel),e.set("object_start_date",this.objectStartDateModel.toISOString()),e.set("object_end_date",this.objectEndDateModel.toISOString()),e.set("uuid",this.uuid),this.groupModel.forEach(((t,s)=>{e.append("group_list",t)}));const t=(new Date).getTimezoneOffset();let s=new Date(this.endDateModel-60*t*1e3),o=new Date(this.startDateModel-60*t*1e3);s=s.toISOString().split("T")[0],o=o.toISOString().split("T")[0],e.set("days_before",this.daysBeforeModel),e.set("number_of_repeats",this.numberOfRepeats),e.set("scheduler_frequency",this.schedulerFrequencyModel),e.set("scheduler_end_date",s),e.set("scheduler_start_date",o),e.set("single_day",this.singleDayModel),e.set("end_date_condition",this.endDateConditionModel),this.dayModel.forEach((t=>{e.append("day",t)})),this.axios.post(`${this.rootUrl}new_scheduled_object/save/`,e).then((e=>{const t=e.data.scheduled_object_id;window.location.href=`${this.rootUrl}scheduled_object_information/${t}`})).catch((e=>{this.$store.dispatch("newToast",{header:"Error creating new scheduled object",message:`Sorry, we could not create this scheduled object for you. Error -> ${e}`,extra_classes:"bg-danger",delay:0})}))},updateDates(e){this.objectStartDateModel=new Date(e.start_date),this.objectEndDateModel=new Date(e.end_date)},updateGroupModel(e){this.groupModel=e,this.displayGroupPermissionIssue=0===this.userGroupResults.filter((e=>this.groupModel.includes(e.group_id))).length;const t=this.userGroupAndLevel.filter((t=>e.includes(t.group_id)));this.groupModelValidation=this.calculateUserLevel(t)>=3,this.groupModelValidation||this.$store.dispatch("newToast",{header:"No CREATE permission for groups",message:"Please note - for the current groups selected, you do not have create permissions. Please add in a group you have create permission with.",extra_classes:"bg-danger",delay:5e3,unique_type:"group-model-validation"})},updateSchedulerFrequency(e){this.daysBeforeModel=e.daysBeforeModel,this.dayModel=e.dayModel,this.endDateConditionModel=e.endDateConditionModel,this.endDateModel=e.endDateModel,this.isFormValid=e.isFormValid,this.numberOfRepeats=e.numberOfRepeatsModel,this.schedulerFrequencyModel=e.schedulerFrequencyModel,this.singleDayModel=e.singleDayModel,this.startDateModel=e.startDateModel},updateStakeholderModel(e){this.stakeholderModel=e}},async beforeMount(){await this.$store.dispatch("processThemeUpdate",{theme:this.theme})},mounted(){this.$store.commit({type:"updateUrl",rootUrl:this.rootUrl,staticUrl:this.staticUrl});const e=this.calculateUserLevel(this.userGroupAndLevel);this.$store.commit({type:"updateUserLevel",userLevel:e})}},O=(0,s(6262).A)(S,[["render",function(e,t,s,m,g,y){const M=(0,o.g2)("validation-rendering"),k=(0,o.g2)("n-select"),f=(0,o.g2)("editor"),j=(0,o.g2)("get-stakeholders"),_=(0,o.g2)("between-dates"),v=(0,o.g2)("group-permissions"),D=(0,o.g2)("scheduler-frequency"),T=(0,o.g2)("n-config-provider");return(0,o.uX)(),(0,o.Wv)(T,{theme:e.getTheme(s.theme)},{default:(0,o.k6)((()=>[(0,o.Lk)("div",r,[(0,o.Lk)("div",i,[t[14]||(t[14]=(0,o.Lk)("h1",null,"New Scheduled Object",-1)),t[15]||(t[15]=(0,o.Lk)("hr",null,null,-1)),(0,o.Lk)("div",a,[t[8]||(t[8]=(0,o.Lk)("div",{class:"col-md-4"},[(0,o.Lk)("h2",null,"Object Type"),(0,o.Lk)("p",{class:"text-instructions"}," Please select if the object will be either a Project or Task. ")],-1)),(0,o.Lk)("div",d,[(0,o.Lk)("label",null,[t[7]||(t[7]=(0,o.eW)(" Object Type ")),(0,o.bF)(M,{"error-list":m.v$.objectTypeModel.$errors},null,8,["error-list"])]),(0,o.bF)(k,{value:g.objectTypeModel,"onUpdate:value":t[0]||(t[0]=e=>g.objectTypeModel=e),options:g.objectTypeOptions},null,8,["value","options"])])]),(0,o.Q3)(" OBJECT DESCRIPTION"),t[16]||(t[16]=(0,o.Lk)("hr",null,null,-1)),(0,o.Lk)("div",n,[t[13]||(t[13]=(0,o.Lk)("div",{class:"col-md-4"},[(0,o.Lk)("h2",null,"Description"),(0,o.Lk)("p",{class:"text-instructions"}," Please supply a suitable Title and Description for your object. This will be created exactly each time the object is created. ")],-1)),(0,o.Lk)("div",u,[(0,o.Lk)("div",c,[(0,o.Lk)("label",null,[t[9]||(t[9]=(0,o.eW)("Object Title ")),(0,o.bF)(M,{"error-list":m.v$.objectTitleModel.$errors},null,8,["error-list"])]),(0,o.bo)((0,o.Lk)("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=e=>g.objectTitleModel=e),class:"form-control"},null,512),[[l.vModelText,g.objectTitleModel]])]),t[11]||(t[11]=(0,o.Lk)("br",null,null,-1)),(0,o.Q3)(" OBJECT DESCRIPTION "),(0,o.Lk)("label",null,[t[10]||(t[10]=(0,o.eW)(" Object Description: ")),(0,o.bF)(M,{"error-list":m.v$.objectDescriptionModel.$errors},null,8,["error-list"])]),t[12]||(t[12]=(0,o.Lk)("br",null,null,-1)),(0,o.Lk)("img",{src:`${s.staticUrl}NearBeach/images/placeholder/body_text.svg`,class:"loader-image",alt:"loading image for Tinymce"},null,8,p),(0,o.bF)(f,{init:{file_picker_types:"image",height:500,images_upload_handler:e.newObjectUploadImage,menubar:!1,paste_data_images:!0,plugins:["lists","image","codesample","table"],toolbar:"undo redo | blocks | bold italic strikethrough underline backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | removeformat | table image codesample",skin:`${this.skin}`,content_css:`${this.contentCss}`},modelValue:g.objectDescriptionModel,"onUpdate:modelValue":t[2]||(t[2]=e=>g.objectDescriptionModel=e)},null,8,["init","modelValue"])])]),(0,o.Q3)(" STAKEHOLDER ORGANISATION "),t[17]||(t[17]=(0,o.Lk)("hr",null,null,-1)),(0,o.bF)(j,{onUpdate_stakeholder_model:t[3]||(t[3]=e=>y.updateStakeholderModel(e)),"is-dirty":m.v$.stakeholderModel.$dirty},null,8,["is-dirty"]),(0,o.Q3)(" START DATE & END DATE "),t[18]||(t[18]=(0,o.Lk)("hr",null,null,-1)),(0,o.bF)(_,{destination:"object",onUpdate_dates:t[4]||(t[4]=e=>y.updateDates(e))}),(0,o.Q3)(" Group Permissions "),t[19]||(t[19]=(0,o.Lk)("hr",null,null,-1)),(0,o.bF)(v,{"display-group-permission-issue":g.displayGroupPermissionIssue,"group-results":s.groupResults,destination:"object","user-group-results":s.userGroupResults,onUpdate_group_model:t[5]||(t[5]=e=>y.updateGroupModel(e)),"is-dirty":m.v$.groupModel.$dirty},null,8,["display-group-permission-issue","group-results","user-group-results","is-dirty"]),(0,o.Q3)(" Scheduler Frequency "),t[20]||(t[20]=(0,o.Lk)("hr",null,null,-1)),(0,o.bF)(D,{onUpdate_scheduler_frequency:y.updateSchedulerFrequency},null,8,["onUpdate_scheduler_frequency"]),(0,o.Q3)(" Submit Button "),t[21]||(t[21]=(0,o.Lk)("hr",null,null,-1)),(0,o.Lk)("div",h,[(0,o.Lk)("div",b,[(0,o.Lk)("button",{class:"btn btn-primary save-changes",onClick:t[6]||(t[6]=(...e)=>y.submitNewScheduledObject&&y.submitNewScheduledObject(...e))}," Create new Project ")])])])])])),_:1},8,["theme"])}]])}}]);