stages:          # List of stages for jobs, and their order of execution
  - build
  - deploy


image: python:latest



build-job:       # This job runs in the build stage, which runs first.
  stage: build
  script:
    - python --version  # For debugging
    - echo "Installing the code..."
    - pip install .
    - echo "Compile complete."


deploy-job:      # This job runs in the deploy stage.
  stage: deploy  # It only runs when *both* jobs in the test stage complete successfully.
  environment: production
  when: manual
  script:
    - pip install twine build
    - python -m build
    - TWINE_PASSWORD=${PYPY_TOKEN} TWINE_USERNAME=__token__ python -m twine upload dist/*
